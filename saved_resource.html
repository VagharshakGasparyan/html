<!DOCTYPE html>
<!-- saved from url=(212714)data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8aHRtbD4NCg0KPGhlYWQ+DQogICAgPG1ldGEgY2hhcnNldD0idXRm%0ALTgiPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IkNhY2hlLUNvbnRyb2wiIGNvbnRlbnQ9Im5vLWNh%0AY2hlIj4NCg0KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Ut%0Ad2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vIj4NCiAgICA8bWV0YSBu%0AYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1zdGF0dXMtYmFyLXN0eWxlIiBjb250ZW50PSJibGFj%0Aay10cmFuc2x1Y2VudCI+DQogICAgPG1ldGEgbmFtZT0iYXBwbGUtbW9iaWxlLXdlYi1hcHAtY2Fw%0AYWJsZSIgY29udGVudD0ieWVzIj4NCiAgICA8bWV0YSBuYW1lPSJtb2JpbGUtd2ViLWFwcC1jYXBh%0AYmxlIiBjb250ZW50PSJ5ZXMiPg0KDQogICAgPG1ldGEgcHJvcGVydHk9Im9nOnR5cGUiIGNvbnRl%0AbnQ9IndlYnNpdGUiPg0KDQogICAgPHNjcmlwdD4NCiAgICAgICAgISBmdW5jdGlvbihlLCB0KSB7%0ADQogICAgICAgICAgICAib2JqZWN0IiA9PSB0eXBlb2YgZXhwb3J0cyAmJiAidW5kZWZpbmVkIiAh%0APSB0eXBlb2YgbW9kdWxlID8gdChleHBvcnRzKSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmlu%0AZSAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsiZXhwb3J0cyJdLCB0KSA6IHQoZS5kYXQgPSB7fSkN%0ACiAgICAgICAgfSh0aGlzLCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAidXNlIHN0cmljdCI7%0ADQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIHQoZSwgdCkgew0KICAgICAgICAgICAgICAgIHZhciBu%0AID0gZS5fX3N0YXRlLmNvbnZlcnNpb25OYW1lLnRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAg%0AICAgIG8gPSBNYXRoLnJvdW5kKGUuciksDQogICAgICAgICAgICAgICAgICAgIGkgPSBNYXRoLnJv%0AdW5kKGUuZyksDQogICAgICAgICAgICAgICAgICAgIHIgPSBNYXRoLnJvdW5kKGUuYiksDQogICAg%0AICAgICAgICAgICAgICAgIHMgPSBlLmEsDQogICAgICAgICAgICAgICAgICAgIGEgPSBNYXRoLnJv%0AdW5kKGUuaCksDQogICAgICAgICAgICAgICAgICAgIGwgPSBlLnMudG9GaXhlZCgxKSwNCiAgICAg%0AICAgICAgICAgICAgICAgZCA9IGUudi50b0ZpeGVkKDEpOw0KICAgICAgICAgICAgICAgIGlmICh0%0AIHx8ICJUSFJFRV9DSEFSX0hFWCIgPT09IG4gfHwgIlNJWF9DSEFSX0hFWCIgPT09IG4pIHsNCiAg%0AICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IGUuaGV4LnRvU3RyaW5nKDE2KTsgYy5sZW5n%0AdGggPCA2OykgYyA9ICIwIiArIGM7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIyIgKyBj%0ADQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiAiQ1NTX1JHQiIgPT09%0AIG4gPyAicmdiKCIgKyBvICsgIiwiICsgaSArICIsIiArIHIgKyAiKSIgOiAiQ1NTX1JHQkEiID09%0APSBuID8gInJnYmEoIiArIG8gKyAiLCIgKyBpICsgIiwiICsgciArICIsIiArIHMgKyAiKSIgOiAi%0ASEVYIiA9PT0gbiA/ICIweCIgKyBlLmhleC50b1N0cmluZygxNikgOiAiUkdCX0FSUkFZIiA9PT0g%0AbiA/ICJbIiArIG8gKyAiLCIgKyBpICsgIiwiICsgciArICJdIiA6ICJSR0JBX0FSUkFZIiA9PT0g%0AbiA/ICJbIiArIG8gKyAiLCIgKyBpICsgIiwiICsgciArICIsIiArIHMgKyAiXSIgOiAiUkdCX09C%0ASiIgPT09IG4gPyAie3I6IiArIG8gKyAiLGc6IiArIGkgKyAiLGI6IiArIHIgKyAifSIgOiAiUkdC%0AQV9PQkoiID09PSBuID8gIntyOiIgKyBvICsgIixnOiIgKyBpICsgIixiOiIgKyByICsgIixhOiIg%0AKyBzICsgIn0iIDogIkhTVl9PQkoiID09PSBuID8gIntoOiIgKyBhICsgIixzOiIgKyBsICsgIix2%0AOiIgKyBkICsgIn0iIDogIkhTVkFfT0JKIiA9PT0gbiA/ICJ7aDoiICsgYSArICIsczoiICsgbCAr%0AICIsdjoiICsgZCArICIsYToiICsgcyArICJ9IiA6ICJ1bmtub3duIGZvcm1hdCINCiAgICAgICAg%0AICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gbihlLCB0LCBuKSB7DQogICAgICAgICAgICAg%0AICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHQsIHsNCiAgICAgICAgICAgICAgICAgICAgZ2V0%0AOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiUkdCIiA9PT0g%0AdGhpcy5fX3N0YXRlLnNwYWNlID8gdGhpcy5fX3N0YXRlW3RdIDogKEkucmVjYWxjdWxhdGVSR0Io%0AdGhpcywgdCwgbiksIHRoaXMuX19zdGF0ZVt0XSkNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAg%0AICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAiUkdCIiAhPT0gdGhpcy5fX3N0YXRlLnNwYWNlICYmIChJLnJlY2FsY3VsYXRlUkdCKHRo%0AaXMsIHQsIG4pLCB0aGlzLl9fc3RhdGUuc3BhY2UgPSAiUkdCIiksIHRoaXMuX19zdGF0ZVt0XSA9%0AIGUNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAg%0AICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIG8oZSwgdCkgew0KICAgICAgICAgICAgICAgIE9i%0AamVjdC5kZWZpbmVQcm9wZXJ0eShlLCB0LCB7DQogICAgICAgICAgICAgICAgICAgIGdldDogZnVu%0AY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkhTViIgPT09IHRoaXMu%0AX19zdGF0ZS5zcGFjZSA/IHRoaXMuX19zdGF0ZVt0XSA6IChJLnJlY2FsY3VsYXRlSFNWKHRoaXMp%0ALCB0aGlzLl9fc3RhdGVbdF0pDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAg%0AICAgICAgIHNldDogZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgIkhTViIg%0AIT09IHRoaXMuX19zdGF0ZS5zcGFjZSAmJiAoSS5yZWNhbGN1bGF0ZUhTVih0aGlzKSwgdGhpcy5f%0AX3N0YXRlLnNwYWNlID0gIkhTViIpLCB0aGlzLl9fc3RhdGVbdF0gPSBlDQogICAgICAgICAgICAg%0AICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAg%0AICBmdW5jdGlvbiBpKGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoIjAiID09PSBlIHx8IFMuaXNV%0AbmRlZmluZWQoZSkpIHJldHVybiAwOw0KICAgICAgICAgICAgICAgIHZhciB0ID0gZS5tYXRjaChV%0AKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gUy5pc051bGwodCkgPyAwIDogcGFyc2VGbG9hdCh0%0AWzFdKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiByKGUpIHsNCiAgICAg%0AICAgICAgICAgICB2YXIgdCA9IGUudG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4g%0AdC5pbmRleE9mKCIuIikgPiAtMSA/IHQubGVuZ3RoIC0gdC5pbmRleE9mKCIuIikgLSAxIDogMA0K%0AICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiBzKGUsIHQpIHsNCiAgICAgICAg%0AICAgICAgICB2YXIgbiA9IE1hdGgucG93KDEwLCB0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4g%0ATWF0aC5yb3VuZChlICogbikgLyBuDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0%0AaW9uIGEoZSwgdCwgbiwgbywgaSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBvICsgKGUgLSB0%0AKSAvIChuIC0gdCkgKiAoaSAtIG8pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0%0AaW9uIGwoZSwgdCwgbiwgbykgew0KICAgICAgICAgICAgICAgIGUuc3R5bGUuYmFja2dyb3VuZCA9%0AICIiLCBTLmVhY2goZWUsIGZ1bmN0aW9uKGkpIHsNCiAgICAgICAgICAgICAgICAgICAgZS5zdHls%0AZS5jc3NUZXh0ICs9ICJiYWNrZ3JvdW5kOiAiICsgaSArICJsaW5lYXItZ3JhZGllbnQoIiArIHQg%0AKyAiLCAiICsgbiArICIgMCUsICIgKyBvICsgIiAxMDAlKTsgIg0KICAgICAgICAgICAgICAgIH0p%0ADQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIGQoZSkgew0KICAgICAgICAg%0AICAgICAgIGUuc3R5bGUuYmFja2dyb3VuZCA9ICIiLCBlLnN0eWxlLmNzc1RleHQgKz0gImJhY2tn%0Acm91bmQ6IC1tb3otbGluZWFyLWdyYWRpZW50KHRvcCwgICNmZjAwMDAgMCUsICNmZjAwZmYgMTcl%0ALCAjMDAwMGZmIDM0JSwgIzAwZmZmZiA1MCUsICMwMGZmMDAgNjclLCAjZmZmZjAwIDg0JSwgI2Zm%0AMDAwMCAxMDAlKTsiLCBlLnN0eWxlLmNzc1RleHQgKz0gImJhY2tncm91bmQ6IC13ZWJraXQtbGlu%0AZWFyLWdyYWRpZW50KHRvcCwgICNmZjAwMDAgMCUsI2ZmMDBmZiAxNyUsIzAwMDBmZiAzNCUsIzAw%0AZmZmZiA1MCUsIzAwZmYwMCA2NyUsI2ZmZmYwMCA4NCUsI2ZmMDAwMCAxMDAlKTsiLCBlLnN0eWxl%0ALmNzc1RleHQgKz0gImJhY2tncm91bmQ6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICAjZmYwMDAw%0AIDAlLCNmZjAwZmYgMTclLCMwMDAwZmYgMzQlLCMwMGZmZmYgNTAlLCMwMGZmMDAgNjclLCNmZmZm%0AMDAgODQlLCNmZjAwMDAgMTAwJSk7IiwgZS5zdHlsZS5jc3NUZXh0ICs9ICJiYWNrZ3JvdW5kOiAt%0AbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgICNmZjAwMDAgMCUsI2ZmMDBmZiAxNyUsIzAwMDBmZiAz%0ANCUsIzAwZmZmZiA1MCUsIzAwZmYwMCA2NyUsI2ZmZmYwMCA4NCUsI2ZmMDAwMCAxMDAlKTsiLCBl%0ALnN0eWxlLmNzc1RleHQgKz0gImJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0b3AsICAjZmYw%0AMDAwIDAlLCNmZjAwZmYgMTclLCMwMDAwZmYgMzQlLCMwMGZmZmYgNTAlLCMwMGZmMDAgNjclLCNm%0AZmZmMDAgODQlLCNmZjAwMDAgMTAwJSk7Ig0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBm%0AdW5jdGlvbiBjKGUsIHQsIG4pIHsNCiAgICAgICAgICAgICAgICB2YXIgbyA9IGRvY3VtZW50LmNy%0AZWF0ZUVsZW1lbnQoImxpIik7DQogICAgICAgICAgICAgICAgcmV0dXJuIHQgJiYgby5hcHBlbmRD%0AaGlsZCh0KSwgbiA/IGUuX191bC5pbnNlcnRCZWZvcmUobywgbikgOiBlLl9fdWwuYXBwZW5kQ2hp%0AbGQobyksIGUub25SZXNpemUoKSwgbw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5j%0AdGlvbiB1KGUpIHsNCiAgICAgICAgICAgICAgICBYLnVuYmluZCh3aW5kb3csICJyZXNpemUiLCBl%0ALl9fcmVzaXplSGFuZGxlciksIGUuc2F2ZVRvTG9jYWxTdG9yYWdlSWZQb3NzaWJsZSAmJiBYLnVu%0AYmluZCh3aW5kb3csICJ1bmxvYWQiLCBlLnNhdmVUb0xvY2FsU3RvcmFnZUlmUG9zc2libGUpDQog%0AICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIF8oZSwgdCkgew0KICAgICAgICAg%0AICAgICAgIHZhciBuID0gZS5fX3ByZXNldF9zZWxlY3RbZS5fX3ByZXNldF9zZWxlY3Quc2VsZWN0%0AZWRJbmRleF07DQogICAgICAgICAgICAgICAgbi5pbm5lckhUTUwgPSB0ID8gbi52YWx1ZSArICIq%0AIiA6IG4udmFsdWUNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gaChlLCB0%0ALCBuKSB7DQogICAgICAgICAgICAgICAgaWYgKG4uX19saSA9IHQsIG4uX19ndWkgPSBlLCBTLmV4%0AdGVuZChuLCB7DQogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBmdW5jdGlvbih0KSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gbi5fX2xpLm5leHRFbGVt%0AZW50U2libGluZzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4ucmVt%0Ab3ZlKCksIGYoZSwgbi5vYmplY3QsIG4ucHJvcGVydHksIHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGJlZm9yZTogbywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIGZhY3RvcnlBcmdzOiBbUy50b0FycmF5KGFyZ3VtZW50cyldDQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTLmlzQXJyYXkodCkgfHwgUy5pc09iamVjdCh0%0AKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG4uX19saS5uZXh0%0ARWxlbWVudFNpYmxpbmc7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBu%0ALnJlbW92ZSgpLCBmKGUsIG4ub2JqZWN0LCBuLnByb3BlcnR5LCB7DQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICBiZWZvcmU6IGksDQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICBmYWN0b3J5QXJnczogW3RdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAg%0AICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGZ1bmN0aW9uKGUpIHsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5fX2xpLmZpcnN0RWxlbWVudENoaWxk%0ALmZpcnN0RWxlbWVudENoaWxkLmlubmVySFRNTCA9IGUsIG4NCiAgICAgICAgICAgICAgICAgICAg%0AICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW46IGZ1bmN0aW9uKCkgew0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLl9fZ3VpLmxpc3RlbihuKSwgbg0KICAg%0AICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZTog%0AZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uX19ndWku%0AcmVtb3ZlKG4pLCBuDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAg%0AICAgIH0pLCBuIGluc3RhbmNlb2YgcSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IG5l%0AdyBRKG4ub2JqZWN0LCBuLnByb3BlcnR5LCB7DQogICAgICAgICAgICAgICAgICAgICAgICBtaW46%0AIG4uX19taW4sDQogICAgICAgICAgICAgICAgICAgICAgICBtYXg6IG4uX19tYXgsDQogICAgICAg%0AICAgICAgICAgICAgICAgICBzdGVwOiBuLl9fc3RlcA0KICAgICAgICAgICAgICAgICAgICB9KTsN%0ACiAgICAgICAgICAgICAgICAgICAgUy5lYWNoKFsidXBkYXRlRGlzcGxheSIsICJvbkNoYW5nZSIs%0AICJvbkZpbmlzaENoYW5nZSIsICJzdGVwIl0sIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAg%0AICAgICAgICAgIHZhciB0ID0gbltlXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpID0g%0Ab1tlXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5bZV0gPSBvW2VdID0gZnVuY3Rpb24oKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBBcnJheS5wcm90b3R5cGUuc2xp%0AY2UuY2FsbChhcmd1bWVudHMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBp%0ALmFwcGx5KG8sIGUpLCB0LmFwcGx5KG4sIGUpDQogICAgICAgICAgICAgICAgICAgICAgICB9DQog%0AICAgICAgICAgICAgICAgICAgIH0pLCBYLmFkZENsYXNzKHQsICJoYXMtc2xpZGVyIiksIG4uZG9t%0ARWxlbWVudC5pbnNlcnRCZWZvcmUoby5kb21FbGVtZW50LCBuLmRvbUVsZW1lbnQuZmlyc3RFbGVt%0AZW50Q2hpbGQpDQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuIGluc3RhbmNlb2YgUSkgew0K%0AICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGZ1bmN0aW9uKHQpIHsNCiAgICAgICAgICAgICAg%0AICAgICAgICAgIGlmIChTLmlzTnVtYmVyKG4uX19taW4pICYmIFMuaXNOdW1iZXIobi5fX21heCkp%0AIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IG4uX19saS5maXJzdEVsZW1l%0AbnRDaGlsZC5maXJzdEVsZW1lbnRDaGlsZC5pbm5lckhUTUwsDQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIGkgPSBuLl9fZ3VpLl9fbGlzdGVuaW5nLmluZGV4T2YobikgPiAtMTsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICBuLnJlbW92ZSgpOw0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIHZhciByID0gZihlLCBuLm9iamVjdCwgbi5wcm9wZXJ0eSwgew0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmU6IG4uX19saS5uZXh0RWxlbWVudFNpYmxpbmcs%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhY3RvcnlBcmdzOiBbbi5fX21pbiwg%0Abi5fX21heCwgbi5fX3N0ZXBdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIubmFtZShvKSwgaSAmJiByLmxpc3Rlbigp%0ALCByDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBy%0AZXR1cm4gdA0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBuLm1p%0AbiA9IFMuY29tcG9zZShpLCBuLm1pbiksIG4ubWF4ID0gUy5jb21wb3NlKGksIG4ubWF4KQ0KICAg%0AICAgICAgICAgICAgIH0gZWxzZSBuIGluc3RhbmNlb2YgSyA/IChYLmJpbmQodCwgImNsaWNrIiwg%0AZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIFguZmFrZUV2ZW50KG4uX19jaGVja2Jv%0AeCwgImNsaWNrIikNCiAgICAgICAgICAgICAgICB9KSwgWC5iaW5kKG4uX19jaGVja2JveCwgImNs%0AaWNrIiwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlv%0AbigpDQogICAgICAgICAgICAgICAgfSkpIDogbiBpbnN0YW5jZW9mIFogPyAoWC5iaW5kKHQsICJj%0AbGljayIsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBYLmZha2VFdmVudChuLl9f%0AYnV0dG9uLCAiY2xpY2siKQ0KICAgICAgICAgICAgICAgIH0pLCBYLmJpbmQodCwgIm1vdXNlb3Zl%0AciIsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBYLmFkZENsYXNzKG4uX19idXR0%0Ab24sICJob3ZlciIpDQogICAgICAgICAgICAgICAgfSksIFguYmluZCh0LCAibW91c2VvdXQiLCBm%0AdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgWC5yZW1vdmVDbGFzcyhuLl9fYnV0dG9u%0ALCAiaG92ZXIiKQ0KICAgICAgICAgICAgICAgIH0pKSA6IG4gaW5zdGFuY2VvZiAkICYmIChYLmFk%0AZENsYXNzKHQsICJjb2xvciIpLCBuLnVwZGF0ZURpc3BsYXkgPSBTLmNvbXBvc2UoZnVuY3Rpb24o%0AZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5zdHlsZS5ib3JkZXJMZWZ0Q29sb3Ig%0APSBuLl9fY29sb3IudG9TdHJpbmcoKSwgZQ0KICAgICAgICAgICAgICAgIH0sIG4udXBkYXRlRGlz%0AcGxheSksIG4udXBkYXRlRGlzcGxheSgpKTsNCiAgICAgICAgICAgICAgICBuLnNldFZhbHVlID0g%0AUy5jb21wb3NlKGZ1bmN0aW9uKHQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuZ2V0%0AUm9vdCgpLl9fcHJlc2V0X3NlbGVjdCAmJiBuLmlzTW9kaWZpZWQoKSAmJiBfKGUuZ2V0Um9vdCgp%0ALCAhMCksIHQNCiAgICAgICAgICAgICAgICB9LCBuLnNldFZhbHVlKQ0KICAgICAgICAgICAgfQ0K%0ADQogICAgICAgICAgICBmdW5jdGlvbiBwKGUsIHQpIHsNCiAgICAgICAgICAgICAgICB2YXIgbiA9%0AIGUuZ2V0Um9vdCgpLA0KICAgICAgICAgICAgICAgICAgICBvID0gbi5fX3JlbWVtYmVyZWRPYmpl%0AY3RzLmluZGV4T2YodC5vYmplY3QpOw0KICAgICAgICAgICAgICAgIGlmICgtMSAhPT0gbykgew0K%0AICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG4uX19yZW1lbWJlcmVkT2JqZWN0SW5kZWNlc1Rv%0AQ29udHJvbGxlcnNbb107DQogICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGkgJiYg%0AKGkgPSB7fSwgbi5fX3JlbWVtYmVyZWRPYmplY3RJbmRlY2VzVG9Db250cm9sbGVyc1tvXSA9IGkp%0ALCBpW3QucHJvcGVydHldID0gdCwgbi5sb2FkICYmIG4ubG9hZC5yZW1lbWJlcmVkKSB7DQogICAg%0AICAgICAgICAgICAgICAgICAgICB2YXIgciA9IG4ubG9hZC5yZW1lbWJlcmVkLA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIHMgPSB2b2lkIDA7DQogICAgICAgICAgICAgICAgICAgICAgICBp%0AZiAocltlLnByZXNldF0pIHMgPSByW2UucHJlc2V0XTsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcltzZV0pIHJldHVybjsN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gcltzZV0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzW29dICYmIHZvaWQgMCAhPT0g%0Ac1tvXVt0LnByb3BlcnR5XSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0g%0Ac1tvXVt0LnByb3BlcnR5XTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmluaXRpYWxW%0AYWx1ZSA9IGEsIHQuc2V0VmFsdWUoYSkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAg%0AICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAg%0AICAgICAgICAgZnVuY3Rpb24gZihlLCB0LCBuLCBvKSB7DQogICAgICAgICAgICAgICAgaWYgKHZv%0AaWQgMCA9PT0gdFtuXSkgdGhyb3cgbmV3IEVycm9yKCdPYmplY3QgIicgKyB0ICsgJyIgaGFzIG5v%0AIHByb3BlcnR5ICInICsgbiArICciJyk7DQogICAgICAgICAgICAgICAgdmFyIGkgPSB2b2lkIDA7%0ADQogICAgICAgICAgICAgICAgaWYgKG8uY29sb3IpIGkgPSBuZXcgJCh0LCBuKTsNCiAgICAgICAg%0AICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSBbdCwgbl0uY29uY2F0%0AKG8uZmFjdG9yeUFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICBpID0gbmUuYXBwbHkoZSwgcikN%0ACiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgby5iZWZvcmUgaW5zdGFuY2VvZiB6%0AICYmIChvLmJlZm9yZSA9IG8uYmVmb3JlLl9fbGkpLCBwKGUsIGkpLCBYLmFkZENsYXNzKGkuZG9t%0ARWxlbWVudCwgImMiKTsNCiAgICAgICAgICAgICAgICB2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVs%0AZW1lbnQoInNwYW4iKTsNCiAgICAgICAgICAgICAgICBYLmFkZENsYXNzKHMsICJwcm9wZXJ0eS1u%0AYW1lIiksIHMuaW5uZXJIVE1MID0gaS5wcm9wZXJ0eTsNCiAgICAgICAgICAgICAgICB2YXIgYSA9%0AIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgIGEuYXBwZW5k%0AQ2hpbGQocyksIGEuYXBwZW5kQ2hpbGQoaS5kb21FbGVtZW50KTsNCiAgICAgICAgICAgICAgICB2%0AYXIgbCA9IGMoZSwgYSwgby5iZWZvcmUpOw0KICAgICAgICAgICAgICAgIHJldHVybiBYLmFkZENs%0AYXNzKGwsIGhlLkNMQVNTX0NPTlRST0xMRVJfUk9XKSwgaSBpbnN0YW5jZW9mICQgPyBYLmFkZENs%0AYXNzKGwsICJjb2xvciIpIDogWC5hZGRDbGFzcyhsLCBIKGkuZ2V0VmFsdWUoKSkpLCBoKGUsIGws%0AIGkpLCBlLl9fY29udHJvbGxlcnMucHVzaChpKSwgaQ0KICAgICAgICAgICAgfQ0KDQogICAgICAg%0AICAgICBmdW5jdGlvbiBtKGUsIHQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQu%0AbG9jYXRpb24uaHJlZiArICIuIiArIHQNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVu%0AY3Rpb24gZyhlLCB0LCBuKSB7DQogICAgICAgICAgICAgICAgdmFyIG8gPSBkb2N1bWVudC5jcmVh%0AdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgICAgICAgICAgICBvLmlubmVySFRNTCA9IHQsIG8u%0AdmFsdWUgPSB0LCBlLl9fcHJlc2V0X3NlbGVjdC5hcHBlbmRDaGlsZChvKSwgbiAmJiAoZS5fX3By%0AZXNldF9zZWxlY3Quc2VsZWN0ZWRJbmRleCA9IGUuX19wcmVzZXRfc2VsZWN0Lmxlbmd0aCAtIDEp%0ADQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIGIoZSwgdCkgew0KICAgICAg%0AICAgICAgICAgIHQuc3R5bGUuZGlzcGxheSA9IGUudXNlTG9jYWxTdG9yYWdlID8gImJsb2NrIiA6%0AICJub25lIg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiB5KGUpIHsNCiAg%0AICAgICAgICAgICAgICBmdW5jdGlvbiB0KHQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu%0AIHQucHJldmVudERlZmF1bHQoKSwgZS53aWR0aCArPSBpIC0gdC5jbGllbnRYLCBlLm9uUmVzaXpl%0AKCksIGkgPSB0LmNsaWVudFgsICExDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAg%0AICAgZnVuY3Rpb24gbigpIHsNCiAgICAgICAgICAgICAgICAgICAgWC5yZW1vdmVDbGFzcyhlLl9f%0AY2xvc2VCdXR0b24sIGhlLkNMQVNTX0RSQUcpLCBYLnVuYmluZCh3aW5kb3csICJtb3VzZW1vdmUi%0ALCB0KSwgWC51bmJpbmQod2luZG93LCAibW91c2V1cCIsIG4pDQogICAgICAgICAgICAgICAgfQ0K%0ADQogICAgICAgICAgICAgICAgZnVuY3Rpb24gbyhvKSB7DQogICAgICAgICAgICAgICAgICAgIHJl%0AdHVybiBvLnByZXZlbnREZWZhdWx0KCksIGkgPSBvLmNsaWVudFgsIFguYWRkQ2xhc3MoZS5fX2Ns%0Ab3NlQnV0dG9uLCBoZS5DTEFTU19EUkFHKSwgWC5iaW5kKHdpbmRvdywgIm1vdXNlbW92ZSIsIHQp%0ALCBYLmJpbmQod2luZG93LCAibW91c2V1cCIsIG4pLCAhMQ0KICAgICAgICAgICAgICAgIH0NCiAg%0AICAgICAgICAgICAgICB2YXIgaSA9IHZvaWQgMDsNCiAgICAgICAgICAgICAgICBlLl9fcmVzaXpl%0AX2hhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLCBTLmV4dGVuZChlLl9fcmVz%0AaXplX2hhbmRsZS5zdHlsZSwgew0KICAgICAgICAgICAgICAgICAgICB3aWR0aDogIjZweCIsDQog%0AICAgICAgICAgICAgICAgICAgIG1hcmdpbkxlZnQ6ICItM3B4IiwNCiAgICAgICAgICAgICAgICAg%0AICAgaGVpZ2h0OiAiMjAwcHgiLA0KICAgICAgICAgICAgICAgICAgICBjdXJzb3I6ICJldy1yZXNp%0AemUiLA0KICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIg0KICAgICAgICAg%0AICAgICAgIH0pLCBYLmJpbmQoZS5fX3Jlc2l6ZV9oYW5kbGUsICJtb3VzZWRvd24iLCBvKSwgWC5i%0AaW5kKGUuX19jbG9zZUJ1dHRvbiwgIm1vdXNlZG93biIsIG8pLCBlLmRvbUVsZW1lbnQuaW5zZXJ0%0AQmVmb3JlKGUuX19yZXNpemVfaGFuZGxlLCBlLmRvbUVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQp%0ADQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIHcoZSwgdCkgew0KICAgICAg%0AICAgICAgICAgIGUuZG9tRWxlbWVudC5zdHlsZS53aWR0aCA9IHQgKyAicHgiLCBlLl9fc2F2ZV9y%0Ab3cgJiYgZS5hdXRvUGxhY2UgJiYgKGUuX19zYXZlX3Jvdy5zdHlsZS53aWR0aCA9IHQgKyAicHgi%0AKSwgZS5fX2Nsb3NlQnV0dG9uICYmIChlLl9fY2xvc2VCdXR0b24uc3R5bGUud2lkdGggPSB0ICsg%0AInB4IikNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24geChlLCB0KSB7DQog%0AICAgICAgICAgICAgICAgdmFyIG4gPSB7fTsNCiAgICAgICAgICAgICAgICByZXR1cm4gUy5lYWNo%0AKGUuX19yZW1lbWJlcmVkT2JqZWN0cywgZnVuY3Rpb24obywgaSkgew0KICAgICAgICAgICAgICAg%0AICAgICB2YXIgciA9IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGUuX19yZW1lbWJl%0AcmVkT2JqZWN0SW5kZWNlc1RvQ29udHJvbGxlcnNbaV07DQogICAgICAgICAgICAgICAgICAgIFMu%0AZWFjaChzLCBmdW5jdGlvbihlLCBuKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByW25dID0g%0AdCA/IGUuaW5pdGlhbFZhbHVlIDogZS5nZXRWYWx1ZSgpDQogICAgICAgICAgICAgICAgICAgIH0p%0ALCBuW2ldID0gcg0KICAgICAgICAgICAgICAgIH0pLCBuDQogICAgICAgICAgICB9DQoNCiAgICAg%0AICAgICAgIGZ1bmN0aW9uIEUoZSkgew0KICAgICAgICAgICAgICAgIGZvciAodmFyIHQgPSAwOyB0%0AIDwgZS5fX3ByZXNldF9zZWxlY3QubGVuZ3RoOyB0KyspIGUuX19wcmVzZXRfc2VsZWN0W3RdLnZh%0AbHVlID09PSBlLnByZXNldCAmJiAoZS5fX3ByZXNldF9zZWxlY3Quc2VsZWN0ZWRJbmRleCA9IHQp%0ADQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIEMoZSkgew0KICAgICAgICAg%0AICAgICAgIDAgIT09IGUubGVuZ3RoICYmIG9lLmNhbGwod2luZG93LCBmdW5jdGlvbigpIHsNCiAg%0AICAgICAgICAgICAgICAgICAgQyhlKQ0KICAgICAgICAgICAgICAgIH0pLCBTLmVhY2goZSwgZnVu%0AY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICBlLnVwZGF0ZURpc3BsYXkoKQ0KICAgICAg%0AICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAg%0AICAgICB2YXIgQSA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLA0KICAgICAgICAgICAgICAgICAg%0AICBrID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLA0KICAgICAgICAgICAgICAgICAgICBTID0gew0K%0AICAgICAgICAgICAgICAgICAgICAgICAgQlJFQUs6IHt9LA0KICAgICAgICAgICAgICAgICAgICAg%0AICAgZXh0ZW5kOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0%0AdXJuIHRoaXMuZWFjaChrLmNhbGwoYXJndW1lbnRzLCAxKSwgZnVuY3Rpb24odCkgew0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pc09iamVjdCh0KSA/IE9iamVjdC5rZXlz%0AKHQpIDogW10pLmZvckVhY2goZnVuY3Rpb24obikgew0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgdGhpcy5pc1VuZGVmaW5lZCh0W25dKSB8fCAoZVtuXSA9IHRbbl0pDQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSkNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICB9LCB0aGlzKSwgZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAg%0AICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRzOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChrLmNhbGwoYXJndW1lbnRzLCAxKSwg%0AZnVuY3Rpb24odCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pc09i%0AamVjdCh0KSA/IE9iamVjdC5rZXlzKHQpIDogW10pLmZvckVhY2goZnVuY3Rpb24obikgew0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1VuZGVmaW5lZChlW25dKSAm%0AJiAoZVtuXSA9IHRbbl0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0%0AaGlzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSwgZQ0KICAgICAgICAg%0AICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvc2U6IGZ1bmN0%0AaW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gay5jYWxsKGFyZ3Vt%0AZW50cyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gay5jYWxsKGFyZ3Vt%0AZW50cyksIG4gPSBlLmxlbmd0aCAtIDE7IG4gPj0gMDsgbi0tKSB0ID0gW2Vbbl0uYXBwbHkodGhp%0AcywgdCldOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdFswXQ0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQog%0AICAgICAgICAgICAgICAgICAgICAgICBlYWNoOiBmdW5jdGlvbihlLCB0LCBuKSB7DQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgaWYgKGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIGlmIChBICYmIGUuZm9yRWFjaCAmJiBlLmZvckVhY2ggPT09IEEpIGUuZm9yRWFjaCh0LCBu%0AKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZS5sZW5ndGggPT09%0AIGUubGVuZ3RoICsgMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9%0AIHZvaWQgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB2b2lkIDA7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobyA9IDAsIGkgPSBlLmxlbmd0%0AaDsgbyA8IGk7IG8rKykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChv%0AIGluIGUgJiYgdC5jYWxsKG4sIGVbb10sIG8pID09PSB0aGlzLkJSRUFLKSByZXR1cm4NCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgZm9yICh2YXIgciBpbiBlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgaWYgKHQuY2FsbChuLCBlW3JdLCByKSA9PT0gdGhpcy5CUkVBSykgcmV0dXJuDQogICAgICAg%0AICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXI6IGZ1bmN0%0AaW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGUsIDApDQog%0AICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVib3Vu%0AY2U6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIg%0AbyA9IHZvaWQgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24o%0AKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcywNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBhcmd1bWVudHMsDQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gbiB8fCAhbzsNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG8pLCBvID0gc2V0VGltZW91dChmdW5jdGlvbigp%0AIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBudWxsLCBuIHx8IGUu%0AYXBwbHkoaSwgcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdCksIHMgJiYg%0AZS5hcHBseShpLCByKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg%0AICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICB0b0FycmF5OiBmdW5jdGlv%0AbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUudG9BcnJheSA/IGUu%0AdG9BcnJheSgpIDogay5jYWxsKGUpDQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAg%0AICAgICAgICAgICAgICAgICAgaXNVbmRlZmluZWQ6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBlDQogICAgICAgICAgICAgICAgICAg%0AICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgaXNOdWxsOiBmdW5jdGlvbihlKSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgPT09IGUNCiAgICAgICAgICAg%0AICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBpc05hTjogZnVuY3Rpb24o%0AZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHQodCkgew0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5hcHBseSh0aGlzLCBhcmd1bWVudHMp%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIHJldHVybiB0LnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIHJldHVybiBlLnRvU3RyaW5nKCkNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICB9LCB0DQogICAgICAgICAgICAgICAgICAgICAgICB9KGZ1bmN0aW9uKGUpIHsNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNOYU4oZSkNCiAgICAgICAgICAgICAgICAg%0AICAgICAgIH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgaXNBcnJheTogQXJyYXkuaXNBcnJh%0AeSB8fCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUu%0AY29uc3RydWN0b3IgPT09IEFycmF5DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAg%0AICAgICAgICAgICAgICAgICAgaXNPYmplY3Q6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICByZXR1cm4gZSA9PT0gT2JqZWN0KGUpDQogICAgICAgICAgICAgICAgICAg%0AICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgaXNOdW1iZXI6IGZ1bmN0aW9uKGUpIHsN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA9PT0gZSArIDANCiAgICAgICAg%0AICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBpc1N0cmluZzogZnVu%0AY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlID09PSBlICsg%0AIiINCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBp%0Ac0Jvb2xlYW46IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1%0Acm4gITEgPT09IGUgfHwgITAgPT09IGUNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAg%0AICAgICAgICAgICAgICAgICAgICBpc0Z1bmN0aW9uOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEZ1bmN0aW9uXSIgPT09IE9iamVjdC5w%0Acm90b3R5cGUudG9TdHJpbmcuY2FsbChlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAg%0AICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBPID0gW3sNCiAgICAgICAg%0AICAgICAgICAgICAgICAgIGxpdG11czogUy5pc1N0cmluZywNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIGNvbnZlcnNpb25zOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVEhSRUVfQ0hB%0AUl9IRVg6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogZnVuY3Rpb24o%0AZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBlLm1hdGNo%0AKC9eIyhbQS1GMC05XSkoW0EtRjAtOV0pKFtBLUYwLTldKSQvaSk7DQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPT0gdCAmJiB7DQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2U6ICJIRVgiLA0KICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIGhleDogcGFyc2VJbnQoIjB4IiArIHRbMV0udG9TdHJp%0AbmcoKSArIHRbMV0udG9TdHJpbmcoKSArIHRbMl0udG9TdHJpbmcoKSArIHRbMl0udG9TdHJpbmco%0AKSArIHRbM10udG9TdHJpbmcoKSArIHRbM10udG9TdHJpbmcoKSwgMCkNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGU6IHQNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJWF9DSEFS%0AX0hFWDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiBmdW5jdGlvbihl%0AKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGUubWF0Y2go%0AL14jKFtBLUYwLTldezZ9KSQvaSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICByZXR1cm4gbnVsbCAhPT0gdCAmJiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgc3BhY2U6ICJIRVgiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIGhleDogcGFyc2VJbnQoIjB4IiArIHRbMV0udG9TdHJpbmcoKSwgMCkNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGU6IHQNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENT%0AU19SR0I6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogZnVuY3Rpb24o%0AZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBlLm1hdGNo%0AKC9ecmdiXChccyooLispXHMqLFxzKiguKylccyosXHMqKC4rKVxzKlwpLyk7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPT0gdCAmJiB7DQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2U6ICJSR0IiLA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHI6IHBhcnNlRmxvYXQodFsxXSksDQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZzogcGFyc2VGbG9hdCh0WzJdKSwN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiOiBwYXJzZUZsb2F0KHRb%0AM10pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdy%0AaXRlOiB0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICBDU1NfUkdCQTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy%0AZWFkOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2%0AYXIgdCA9IGUubWF0Y2goL15yZ2JhXChccyooLispXHMqLFxzKiguKylccyosXHMqKC4rKVxzKixc%0AcyooLispXHMqXCkvKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy%0AbiBudWxsICE9PSB0ICYmIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBzcGFjZTogIlJHQiIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AcjogcGFyc2VGbG9hdCh0WzFdKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBnOiBwYXJzZUZsb2F0KHRbMl0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIGI6IHBhcnNlRmxvYXQodFszXSksDQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgYTogcGFyc2VGbG9hdCh0WzRdKQ0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZTogdA0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgfSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGl0bXVzOiBTLmlzTnVtYmVyLA0KICAg%0AICAgICAgICAgICAgICAgICAgICAgY29udmVyc2lvbnM6IHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBIRVg6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogZnVu%0AY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFjZTogIkhFWCIsDQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGV4OiBlLA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNpb25OYW1lOiAiSEVYIg0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZTogZnVu%0AY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUu%0AaGV4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAg%0AICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpdG11czogUy5pc0FycmF5LA0KICAg%0AICAgICAgICAgICAgICAgICAgICAgY29udmVyc2lvbnM6IHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBSR0JfQVJSQVk6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVh%0AZDogZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0%0AdXJuIDMgPT09IGUubGVuZ3RoICYmIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBzcGFjZTogIlJHQiIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgcjogZVswXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBn%0AOiBlWzFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IGVbMl0N%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGU6%0AIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy%0AbiBbZS5yLCBlLmcsIGUuYl0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AUkdCQV9BUlJBWTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiBmdW5j%0AdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNCA9%0APT0gZS5sZW5ndGggJiYgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHNwYWNlOiAiUkdCIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy%0AOiBlWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGc6IGVbMV0s%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYjogZVsyXSwNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhOiBlWzNdDQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlOiBmdW5jdGlvbihlKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2UuciwgZS5nLCBl%0ALmIsIGUuYV0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg%0AICAgICAgICAgfSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGl0bXVzOiBTLmlzT2JqZWN0%0ALA0KICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2lvbnM6IHsNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICBSR0JBX09CSjogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICByZWFkOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICByZXR1cm4gISEoUy5pc051bWJlcihlLnIpICYmIFMuaXNOdW1iZXIoZS5nKSAmJiBTLmlzTnVt%0AYmVyKGUuYikgJiYgUy5pc051bWJlcihlLmEpKSAmJiB7DQogICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgc3BhY2U6ICJSR0IiLA0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHI6IGUuciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBnOiBlLmcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AYjogZS5iLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGE6IGUuYQ0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZTog%0AZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu%0AIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByOiBlLnIsDQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZzogZS5nLA0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIGI6IGUuYiwNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICBhOiBlLmENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUkdCX09CSjog%0Aew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiBmdW5jdGlvbihlKSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gISEoUy5pc051bWJlcihl%0ALnIpICYmIFMuaXNOdW1iZXIoZS5nKSAmJiBTLmlzTnVtYmVyKGUuYikpICYmIHsNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFjZTogIlJHQiIsDQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcjogZS5yLA0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIGc6IGUuZywNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICBiOiBlLmINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgd3JpdGU6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgcjogZS5yLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIGc6IGUuZywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiOiBlLmIN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgSFNWQV9PQko6IHsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgcmVhZDogZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgcmV0dXJuICEhKFMuaXNOdW1iZXIoZS5oKSAmJiBTLmlzTnVtYmVyKGUucykgJiYg%0AUy5pc051bWJlcihlLnYpICYmIFMuaXNOdW1iZXIoZS5hKSkgJiYgew0KICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIHNwYWNlOiAiSFNWIiwNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICBoOiBlLmgsDQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgczogZS5zLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIHY6IGUudiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBh%0AOiBlLmENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0Ad3JpdGU6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogZS5o%0ALA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6IGUucywNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2OiBlLnYsDQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgYTogZS5hDQogICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhT%0AVl9PQko6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogZnVuY3Rpb24o%0AZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhKFMuaXNO%0AdW1iZXIoZS5oKSAmJiBTLmlzTnVtYmVyKGUucykgJiYgUy5pc051bWJlcihlLnYpKSAmJiB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2U6ICJIU1YiLA0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGUuaCwNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiBlLnMsDQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgdjogZS52DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIHdyaXRlOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGg6IGUuaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBzOiBlLnMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AdjogZS52DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQog%0AICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH1dLA0KICAgICAg%0AICAgICAgICAgICAgICBUID0gdm9pZCAwLA0KICAgICAgICAgICAgICAgICAgICBMID0gdm9pZCAw%0ALA0KICAgICAgICAgICAgICAgICAgICBSID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAg%0AICAgICAgICBMID0gITE7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGFyZ3VtZW50%0Acy5sZW5ndGggPiAxID8gUy50b0FycmF5KGFyZ3VtZW50cykgOiBhcmd1bWVudHNbMF07DQogICAg%0AICAgICAgICAgICAgICAgICAgICByZXR1cm4gUy5lYWNoKE8sIGZ1bmN0aW9uKHQpIHsNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5saXRtdXMoZSkpIHJldHVybiBTLmVhY2godC5j%0Ab252ZXJzaW9ucywgZnVuY3Rpb24odCwgbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBpZiAoVCA9IHQucmVhZChlKSwgITEgPT09IEwgJiYgITEgIT09IFQpIHJldHVybiBMID0g%0AVCwgVC5jb252ZXJzaW9uTmFtZSA9IG4sIFQuY29udmVyc2lvbiA9IHQsIFMuQlJFQUsNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9KSwgUy5CUkVBSw0KICAgICAgICAgICAgICAgICAgICAg%0AICAgfSksIEwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgQiA9%0AIHZvaWQgMCwNCiAgICAgICAgICAgICAgICAgICAgTiA9IHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIGhzdl90b19yZ2I6IGZ1bmN0aW9uKGUsIHQsIG4pIHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICB2YXIgbyA9IE1hdGguZmxvb3IoZSAvIDYwKSAlIDYsDQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGkgPSBlIC8gNjAgLSBNYXRoLmZsb29yKGUgLyA2MCksDQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBuICogKDEgLSB0KSwNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgcyA9IG4gKiAoMSAtIGkgKiB0KSwNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgYSA9IG4gKiAoMSAtICgxIC0gaSkgKiB0KSwNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgbCA9IFsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIFtuLCBhLCByXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtzLCBu%0ALCByXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtyLCBuLCBhXSwNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtyLCBzLCBuXSwNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIFthLCByLCBuXSwNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIFtuLCByLCBzXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBdW29dOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIHI6IDI1NSAqIGxbMF0sDQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIGc6IDI1NSAqIGxbMV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIGI6IDI1NSAqIGxbMl0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAg%0AICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgcmdiX3RvX2hzdjog%0AZnVuY3Rpb24oZSwgdCwgbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0g%0ATWF0aC5taW4oZSwgdCwgbiksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBN%0AYXRoLm1heChlLCB0LCBuKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGkg%0ALSBvLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gdm9pZCAwLA0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gdm9pZCAwOw0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIHJldHVybiAwID09PSBpID8gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBoOiBOYU4sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6IDAsDQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6IDANCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICB9IDogKGEgPSByIC8gaSwgcyA9IGUgPT09IGkgPyAodCAtIG4pIC8gciA6IHQgPT09IGkg%0APyAyICsgKG4gLSBlKSAvIHIgOiA0ICsgKGUgLSB0KSAvIHIsIChzIC89IDYpIDwgMCAmJiAocyAr%0APSAxKSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoOiAzNjAgKiBzLA0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiBhLA0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB2OiBpIC8gMjU1DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAg%0AICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICByZ2JfdG9f%0AaGV4OiBmdW5jdGlvbihlLCB0LCBuKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFy%0AIG8gPSB0aGlzLmhleF93aXRoX2NvbXBvbmVudCgwLCAyLCBlKTsNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICByZXR1cm4gbyA9IHRoaXMuaGV4X3dpdGhfY29tcG9uZW50KG8sIDEsIHQpLCBv%0AID0gdGhpcy5oZXhfd2l0aF9jb21wb25lbnQobywgMCwgbikNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRfZnJvbV9oZXg6IGZ1bmN0%0AaW9uKGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA+PiA4ICog%0AdCAmIDI1NQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIGhleF93aXRoX2NvbXBvbmVudDogZnVuY3Rpb24oZSwgdCwgbikgew0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHJldHVybiBuIDw8IChCID0gOCAqIHQpIHwgZSAmIH4oMjU1IDw8IEIp%0ADQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAg%0AICAgICAgICAgICAgICAgIEggPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJv%0AbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgZQ0KICAgICAgICAgICAgICAgICAgICB9IDogZnVu%0AY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgJiYgImZ1bmN0aW9u%0AIiA9PSB0eXBlb2YgU3ltYm9sICYmIGUuY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBlICE9PSBT%0AeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2YgZQ0KICAgICAgICAgICAgICAgICAg%0AICB9LA0KICAgICAgICAgICAgICAgICAgICBGID0gZnVuY3Rpb24oZSwgdCkgew0KICAgICAgICAg%0AICAgICAgICAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIHQpKSB0aHJvdyBuZXcgVHlwZUVycm9y%0AKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKQ0KICAgICAgICAgICAgICAgICAg%0AICB9LA0KICAgICAgICAgICAgICAgICAgICBQID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAg%0AICAgICAgICAgICBmdW5jdGlvbiBlKGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBmb3IgKHZhciBuID0gMDsgbiA8IHQubGVuZ3RoOyBuKyspIHsNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgdmFyIG8gPSB0W25dOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBvLmVudW1lcmFibGUgPSBvLmVudW1lcmFibGUgfHwgITEsIG8uY29uZmlndXJhYmxlID0g%0AITAsICJ2YWx1ZSIgaW4gbyAmJiAoby53cml0YWJsZSA9ICEwKSwgT2JqZWN0LmRlZmluZVByb3Bl%0AcnR5KGUsIG8ua2V5LCBvKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAg%0AICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlv%0Abih0LCBuLCBvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4gJiYgZSh0%0ALnByb3RvdHlwZSwgbiksIG8gJiYgZSh0LCBvKSwgdA0KICAgICAgICAgICAgICAgICAgICAgICAg%0AfQ0KICAgICAgICAgICAgICAgICAgICB9KCksDQogICAgICAgICAgICAgICAgICAgIGogPSBmdW5j%0AdGlvbiBlKHQsIG4sIG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT09IHQgJiYg%0AKHQgPSBGdW5jdGlvbi5wcm90b3R5cGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkg%0APSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIG4pOw0KICAgICAgICAgICAgICAg%0AICAgICAgICAgaWYgKHZvaWQgMCA9PT0gaSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHZhciByID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHQpOw0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIHJldHVybiBudWxsID09PSByID8gdm9pZCAwIDogZShyLCBuLCBvKQ0KICAgICAgICAg%0AICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4g%0AaSkgcmV0dXJuIGkudmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGkuZ2V0%0AOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gcykgcmV0dXJuIHMuY2Fs%0AbChvKQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBEID0gZnVu%0AY3Rpb24oZSwgdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0g%0AdHlwZW9mIHQgJiYgbnVsbCAhPT0gdCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVz%0Ac2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgdHlwZW9mIHQp%0AOw0KICAgICAgICAgICAgICAgICAgICAgICAgZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHQg%0AJiYgdC5wcm90b3R5cGUsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdHJ1Y3Rv%0Acjogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZSwNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogITEsDQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgY29uZmlndXJhYmxlOiAhMA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAg%0AICAgICAgICAgICAgICAgICAgICAgIH0pLCB0ICYmIChPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBP%0AYmplY3Quc2V0UHJvdG90eXBlT2YoZSwgdCkgOiBlLl9fcHJvdG9fXyA9IHQpDQogICAgICAgICAg%0AICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIFYgPSBmdW5jdGlvbihlLCB0KSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWUpIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigi%0AdGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVk%0AIik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXQgfHwgIm9iamVjdCIgIT0gdHlw%0AZW9mIHQgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCA/IGUgOiB0DQogICAgICAgICAgICAgICAg%0AICAgIH0sDQogICAgICAgICAgICAgICAgICAgIEkgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgIGZ1bmN0aW9uIGUoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AaWYgKEYodGhpcywgZSksIHRoaXMuX19zdGF0ZSA9IFIuYXBwbHkodGhpcywgYXJndW1lbnRzKSwg%0AITEgPT09IHRoaXMuX19zdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJGYWlsZWQgdG8gaW50ZXJwcmV0%0AIGNvbG9yIGFyZ3VtZW50cyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX19z%0AdGF0ZS5hID0gdGhpcy5fX3N0YXRlLmEgfHwgMQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0K%0AICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFAoZSwgW3sNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICBrZXk6ICJ0b1N0cmluZyIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AdmFsdWU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1%0Acm4gdCh0aGlzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAg%0AICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICJ0b0hleFN0%0AcmluZyIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgew0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCh0aGlzLCAhMCkNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9LCB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAidG9PcmlnaW5hbCIsDQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX3N0YXRlLmNvbnZlcnNpb24ud3JpdGUodGhpcykN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9%0AXSksIGUNCiAgICAgICAgICAgICAgICAgICAgfSgpOw0KICAgICAgICAgICAgICAgIEkucmVjYWxj%0AdWxhdGVSR0IgPSBmdW5jdGlvbihlLCB0LCBuKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgi%0ASEVYIiA9PT0gZS5fX3N0YXRlLnNwYWNlKSBlLl9fc3RhdGVbdF0gPSBOLmNvbXBvbmVudF9mcm9t%0AX2hleChlLl9fc3RhdGUuaGV4LCBuKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAg%0AICAgICAgICAgICAgICAgICAgICBpZiAoIkhTViIgIT09IGUuX19zdGF0ZS5zcGFjZSkgdGhyb3cg%0AbmV3IEVycm9yKCJDb3JydXB0ZWQgY29sb3Igc3RhdGUiKTsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIFMuZXh0ZW5kKGUuX19zdGF0ZSwgTi5oc3ZfdG9fcmdiKGUuX19zdGF0ZS5oLCBlLl9fc3Rh%0AdGUucywgZS5fX3N0YXRlLnYpKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAg%0AICAgfSwgSS5yZWNhbGN1bGF0ZUhTViA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAg%0AICAgdmFyIHQgPSBOLnJnYl90b19oc3YoZS5yLCBlLmcsIGUuYik7DQogICAgICAgICAgICAgICAg%0AICAgIFMuZXh0ZW5kKGUuX19zdGF0ZSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgczogdC5z%0ALA0KICAgICAgICAgICAgICAgICAgICAgICAgdjogdC52DQogICAgICAgICAgICAgICAgICAgIH0p%0ALCBTLmlzTmFOKHQuaCkgPyBTLmlzVW5kZWZpbmVkKGUuX19zdGF0ZS5oKSAmJiAoZS5fX3N0YXRl%0ALmggPSAwKSA6IGUuX19zdGF0ZS5oID0gdC5oDQogICAgICAgICAgICAgICAgfSwgSS5DT01QT05F%0ATlRTID0gWyJyIiwgImciLCAiYiIsICJoIiwgInMiLCAidiIsICJoZXgiLCAiYSJdLCBuKEkucHJv%0AdG90eXBlLCAiciIsIDIpLCBuKEkucHJvdG90eXBlLCAiZyIsIDEpLCBuKEkucHJvdG90eXBlLCAi%0AYiIsIDApLCBvKEkucHJvdG90eXBlLCAiaCIpLCBvKEkucHJvdG90eXBlLCAicyIpLCBvKEkucHJv%0AdG90eXBlLCAidiIpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoSS5wcm90b3R5cGUsICJhIiwgew0K%0AICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAg%0AICAgICAgcmV0dXJuIHRoaXMuX19zdGF0ZS5hDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAg%0AICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAg%0AICAgdGhpcy5fX3N0YXRlLmEgPSBlDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAg%0AICAgICB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KEkucHJvdG90eXBlLCAiaGV4Iiwgew0KICAg%0AICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAg%0AICAgcmV0dXJuICJIRVgiICE9PSAhdGhpcy5fX3N0YXRlLnNwYWNlICYmICh0aGlzLl9fc3RhdGUu%0AaGV4ID0gTi5yZ2JfdG9faGV4KHRoaXMuciwgdGhpcy5nLCB0aGlzLmIpKSwgdGhpcy5fX3N0YXRl%0ALmhleA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1%0AbmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX19zdGF0ZS5zcGFjZSA9%0AICJIRVgiLCB0aGlzLl9fc3RhdGUuaGV4ID0gZQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAg%0AICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgdmFyIHogPSBmdW5jdGlvbigpIHsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGUodCwgbikgew0KICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIEYodGhpcywgZSksIHRoaXMuaW5pdGlhbFZhbHVlID0gdFtuXSwgdGhpcy5k%0Ab21FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIHRoaXMub2JqZWN0ID0g%0AdCwgdGhpcy5wcm9wZXJ0eSA9IG4sIHRoaXMuX19vbkNoYW5nZSA9IHZvaWQgMCwgdGhpcy5fX29u%0ARmluaXNoQ2hhbmdlID0gdm9pZCAwDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAg%0AICAgICAgICAgICAgICAgICByZXR1cm4gUChlLCBbew0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIGtleTogIm9uQ2hhbmdlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTog%0AZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhp%0Acy5fX29uQ2hhbmdlID0gZSwgdGhpcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAg%0AICAgICAgICAgICAgICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBr%0AZXk6ICJvbkZpbmlzaENoYW5nZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6%0AIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRo%0AaXMuX19vbkZpbmlzaENoYW5nZSA9IGUsIHRoaXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9LCB7DQogICAgICAgICAgICAgICAgICAgICAg%0AICAgICAga2V5OiAic2V0VmFsdWUiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVl%0AOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0%0AaGlzLm9iamVjdFt0aGlzLnByb3BlcnR5XSA9IGUsIHRoaXMuX19vbkNoYW5nZSAmJiB0aGlzLl9f%0Ab25DaGFuZ2UuY2FsbCh0aGlzLCBlKSwgdGhpcy51cGRhdGVEaXNwbGF5KCksIHRoaXMNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9LCB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAiZ2V0VmFsdWUiLA0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0W3RoaXMucHJvcGVydHldDQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgew0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIGtleTogInVwZGF0ZURpc3BsYXkiLA0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgcmV0dXJuIHRoaXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQog%0AICAgICAgICAgICAgICAgICAgICAgICB9LCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0Aa2V5OiAiaXNNb2RpZmllZCIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1%0AbmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5p%0Abml0aWFsVmFsdWUgIT09IHRoaXMuZ2V0VmFsdWUoKQ0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH1dKSwgZQ0KICAgICAgICAgICAgICAgICAg%0AICB9KCksDQogICAgICAgICAgICAgICAgICAgIE0gPSB7DQogICAgICAgICAgICAgICAgICAgICAg%0AICBIVE1MRXZlbnRzOiBbImNoYW5nZSJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgTW91c2VF%0AdmVudHM6IFsiY2xpY2siLCAibW91c2Vtb3ZlIiwgIm1vdXNlZG93biIsICJtb3VzZXVwIiwgIm1v%0AdXNlb3ZlciJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgS2V5Ym9hcmRFdmVudHM6IFsia2V5%0AZG93biJdDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIEcgPSB7%0AfTsNCiAgICAgICAgICAgICAgICBTLmVhY2goTSwgZnVuY3Rpb24oZSwgdCkgew0KICAgICAgICAg%0AICAgICAgICAgICBTLmVhY2goZSwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAg%0AICAgR1tlXSA9IHQNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICB9KTsN%0ACiAgICAgICAgICAgICAgICB2YXIgVSA9IC8oXGQrKFwuXGQrKT8pcHgvLA0KICAgICAgICAgICAg%0AICAgICAgICBYID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVNlbGVjdGFibGU6IGZ1%0AbmN0aW9uKGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGUg%0AJiYgdm9pZCAwICE9PSBlLnN0eWxlICYmIChlLm9uc2VsZWN0c3RhcnQgPSB0ID8gZnVuY3Rpb24o%0AKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQ0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbigpIHt9LCBlLnN0eWxlLk1velVzZXJTZWxl%0AY3QgPSB0ID8gImF1dG8iIDogIm5vbmUiLCBlLnN0eWxlLktodG1sVXNlclNlbGVjdCA9IHQgPyAi%0AYXV0byIgOiAibm9uZSIsIGUudW5zZWxlY3RhYmxlID0gdCA/ICJvbiIgOiAib2ZmIikNCiAgICAg%0AICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBtYWtlRnVsbHNj%0AcmVlbjogZnVuY3Rpb24oZSwgdCwgbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZh%0AciBvID0gbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IHQ7DQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgUy5pc1VuZGVmaW5lZChpKSAmJiAoaSA9ICEwKSwgUy5pc1Vu%0AZGVmaW5lZChvKSAmJiAobyA9ICEwKSwgZS5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSIsIGkg%0AJiYgKGUuc3R5bGUubGVmdCA9IDAsIGUuc3R5bGUucmlnaHQgPSAwKSwgbyAmJiAoZS5zdHlsZS50%0Ab3AgPSAwLCBlLnN0eWxlLmJvdHRvbSA9IDApDQogICAgICAgICAgICAgICAgICAgICAgICB9LA0K%0AICAgICAgICAgICAgICAgICAgICAgICAgZmFrZUV2ZW50OiBmdW5jdGlvbihlLCB0LCBuLCBvKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBuIHx8IHt9LA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICByID0gR1t0XTsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBpZiAoIXIpIHRocm93IG5ldyBFcnJvcigiRXZlbnQgdHlwZSAiICsgdCArICIgbm90IHN1%0AcHBvcnRlZC4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGRvY3VtZW50%0ALmNyZWF0ZUV2ZW50KHIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocikg%0Aew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJNb3VzZUV2ZW50cyI6DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGkueCB8fCBpLmNsaWVu%0AdFggfHwgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gaS55%0AIHx8IGkuY2xpZW50WSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0Acy5pbml0TW91c2VFdmVudCh0LCBpLmJ1YmJsZXMgfHwgITEsIGkuY2FuY2VsYWJsZSB8fCAhMCwg%0Ad2luZG93LCBpLmNsaWNrQ291bnQgfHwgMSwgMCwgMCwgYSwgbCwgITEsICExLCAhMSwgITEsIDAs%0AIG51bGwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIktleWJvYXJkRXZlbnRzIjoNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gcy5pbml0S2V5Ym9hcmRFdmVu%0AdCB8fCBzLmluaXRLZXlFdmVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIFMuZGVmYXVsdHMoaSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIGNhbmNlbGFibGU6ICEwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIGN0cmxLZXk6ICExLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFs%0AdEtleTogITEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hpZnRL%0AZXk6ICExLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFLZXk6%0AICExLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleUNvZGU6IHZv%0AaWQgMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyQ29kZTog%0Adm9pZCAwDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZCh0LCBpLmJ1%0AYmJsZXMgfHwgITEsIGkuY2FuY2VsYWJsZSwgd2luZG93LCBpLmN0cmxLZXksIGkuYWx0S2V5LCBp%0ALnNoaWZ0S2V5LCBpLm1ldGFLZXksIGkua2V5Q29kZSwgaS5jaGFyQ29kZSk7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMu%0AaW5pdEV2ZW50KHQsIGkuYnViYmxlcyB8fCAhMSwgaS5jYW5jZWxhYmxlIHx8ICEwKQ0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTLmRl%0AZmF1bHRzKHMsIG8pLCBlLmRpc3BhdGNoRXZlbnQocykNCiAgICAgICAgICAgICAgICAgICAgICAg%0AIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBiaW5kOiBmdW5jdGlvbihlLCB0LCBuLCBvKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBvIHx8ICExOw0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIHJldHVybiBlLmFkZEV2ZW50TGlzdGVuZXIgPyBlLmFkZEV2ZW50%0ATGlzdGVuZXIodCwgbiwgaSkgOiBlLmF0dGFjaEV2ZW50ICYmIGUuYXR0YWNoRXZlbnQoIm9uIiAr%0AIHQsIG4pLCBYDQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAg%0AICAgICAgdW5iaW5kOiBmdW5jdGlvbihlLCB0LCBuLCBvKSB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgdmFyIGkgPSBvIHx8ICExOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl%0AdHVybiBlLnJlbW92ZUV2ZW50TGlzdGVuZXIgPyBlLnJlbW92ZUV2ZW50TGlzdGVuZXIodCwgbiwg%0AaSkgOiBlLmRldGFjaEV2ZW50ICYmIGUuZGV0YWNoRXZlbnQoIm9uIiArIHQsIG4pLCBYDQogICAg%0AICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3M6%0AIGZ1bmN0aW9uKGUsIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAw%0AID09PSBlLmNsYXNzTmFtZSkgZS5jbGFzc05hbWUgPSB0Ow0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIGVsc2UgaWYgKGUuY2xhc3NOYW1lICE9PSB0KSB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIHZhciBuID0gZS5jbGFzc05hbWUuc3BsaXQoLyArLyk7IC0gMSA9PT0gbi5p%0AbmRleE9mKHQpICYmIChuLnB1c2godCksIGUuY2xhc3NOYW1lID0gbi5qb2luKCIgIikucmVwbGFj%0AZSgvXlxzKy8sICIiKS5yZXBsYWNlKC9ccyskLywgIiIpKQ0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzOiBm%0AdW5jdGlvbihlLCB0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQpDQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmNsYXNzTmFtZSA9PT0gdCkgZS5yZW1v%0AdmVBdHRyaWJ1dGUoImNsYXNzIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVs%0Ac2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlLmNsYXNz%0ATmFtZS5zcGxpdCgvICsvKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBvID0gbi5pbmRleE9mKHQpOyAtIDEgIT09IG8gJiYgKG4uc3BsaWNlKG8sIDEpLCBlLmNsYXNz%0ATmFtZSA9IG4uam9pbigiICIpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBlLmNsYXNzTmFtZSA9IHZvaWQgMDsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWA0KICAgICAgICAgICAgICAgICAgICAg%0AICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhc0NsYXNzOiBmdW5jdGlvbihlLCB0KSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoIig/Ol58XFxz%0AKykiICsgdCArICIoPzpcXHMrfCQpIikudGVzdChlLmNsYXNzTmFtZSkgfHwgITENCiAgICAgICAg%0AICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBnZXRXaWR0aDogZnVu%0AY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gZ2V0Q29tcHV0%0AZWRTdHlsZShlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSh0WyJib3Jk%0AZXItbGVmdC13aWR0aCJdKSArIGkodFsiYm9yZGVyLXJpZ2h0LXdpZHRoIl0pICsgaSh0WyJwYWRk%0AaW5nLWxlZnQiXSkgKyBpKHRbInBhZGRpbmctcmlnaHQiXSkgKyBpKHQud2lkdGgpDQogICAgICAg%0AICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SGVpZ2h0OiBm%0AdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBnZXRDb21w%0AdXRlZFN0eWxlKGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpKHRbImJv%0AcmRlci10b3Atd2lkdGgiXSkgKyBpKHRbImJvcmRlci1ib3R0b20td2lkdGgiXSkgKyBpKHRbInBh%0AZGRpbmctdG9wIl0pICsgaSh0WyJwYWRkaW5nLWJvdHRvbSJdKSArIGkodC5oZWlnaHQpDQogICAg%0AICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0T2Zmc2V0%0AOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBlLA0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gew0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgbGVmdDogMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIHRvcDogMA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIGlmICh0Lm9mZnNldFBhcmVudCkNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgZG8gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgbi5sZWZ0ICs9IHQub2Zmc2V0TGVmdCwgbi50b3AgKz0gdC5vZmZzZXRUb3AsIHQgPSB0Lm9m%0AZnNldFBhcmVudA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICh0KTsN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbg0KICAgICAgICAgICAgICAgICAg%0AICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlzQWN0aXZlOiBmdW5jdGlvbihlKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPT09IGRvY3VtZW50LmFjdGl2%0AZUVsZW1lbnQgJiYgKGUudHlwZSB8fCBlLmhyZWYpDQogICAgICAgICAgICAgICAgICAgICAgICB9%0ADQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIEsgPSBmdW5jdGlv%0AbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB0KGUsIG4pIHsNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICBGKHRoaXMsIHQpOw0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIHZhciBvID0gVih0aGlzLCAodC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlw%0AZU9mKHQpKS5jYWxsKHRoaXMsIGUsIG4pKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgaSA9IG87DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG8uX19wcmV2ID0g%0Aby5nZXRWYWx1ZSgpLCBvLl9fY2hlY2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1%0AdCIpLCBvLl9fY2hlY2tib3guc2V0QXR0cmlidXRlKCJ0eXBlIiwgImNoZWNrYm94IiksIFguYmlu%0AZChvLl9fY2hlY2tib3gsICJjaGFuZ2UiLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgaS5zZXRWYWx1ZSghaS5fX3ByZXYpDQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgfSwgITEpLCBvLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQoby5fX2NoZWNrYm94KSwg%0Aby51cGRhdGVEaXNwbGF5KCksIG8NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAg%0AICAgICAgICAgICAgICAgIHJldHVybiBEKHQsIHopLCBQKHQsIFt7DQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAga2V5OiAic2V0VmFsdWUiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHZhbHVlOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZh%0AciBuID0gaih0LnByb3RvdHlwZS5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKHQu%0AcHJvdG90eXBlKSwgInNldFZhbHVlIiwgdGhpcykuY2FsbCh0aGlzLCBlKTsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19vbkZpbmlzaENoYW5nZSAmJiB0aGlz%0ALl9fb25GaW5pc2hDaGFuZ2UuY2FsbCh0aGlzLCB0aGlzLmdldFZhbHVlKCkpLCB0aGlzLl9fcHJl%0AdiA9IHRoaXMuZ2V0VmFsdWUoKSwgbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAg%0AICAgICAgICAgICAgICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBr%0AZXk6ICJ1cGRhdGVEaXNwbGF5IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTog%0AZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMCA9%0APT0gdGhpcy5nZXRWYWx1ZSgpID8gKHRoaXMuX19jaGVja2JveC5zZXRBdHRyaWJ1dGUoImNoZWNr%0AZWQiLCAiY2hlY2tlZCIpLCB0aGlzLl9fY2hlY2tib3guY2hlY2tlZCA9ICEwLCB0aGlzLl9fcHJl%0AdiA9ICEwKSA6ICh0aGlzLl9fY2hlY2tib3guY2hlY2tlZCA9ICExLCB0aGlzLl9fcHJldiA9ICEx%0AKSwgaih0LnByb3RvdHlwZS5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJv%0AdG90eXBlKSwgInVwZGF0ZURpc3BsYXkiLCB0aGlzKS5jYWxsKHRoaXMpDQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfV0pLCB0DQogICAgICAg%0AICAgICAgICAgICAgIH0oKSwNCiAgICAgICAgICAgICAgICAgICAgWSA9IGZ1bmN0aW9uKGUpIHsN%0ACiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHQoZSwgbiwgbykgew0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIEYodGhpcywgdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgdmFyIGkgPSBWKHRoaXMsICh0Ll9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yo%0AdCkpLmNhbGwodGhpcywgZSwgbikpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy%0AID0gbywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IGk7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgaWYgKGkuX19zZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50%0AKCJzZWxlY3QiKSwgUy5pc0FycmF5KHIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIHZhciBhID0ge307DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMuZWFjaChy%0ALCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhW2Vd%0AID0gZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgciA9IGENCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu%0AIFMuZWFjaChyLCBmdW5jdGlvbihlLCB0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIHZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIG4uaW5uZXJIVE1MID0gdCwgbi5zZXRBdHRyaWJ1dGUoInZh%0AbHVlIiwgZSksIHMuX19zZWxlY3QuYXBwZW5kQ2hpbGQobikNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICB9KSwgaS51cGRhdGVEaXNwbGF5KCksIFguYmluZChpLl9fc2VsZWN0LCAiY2hhbmdl%0AIiwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0g%0AdGhpcy5vcHRpb25zW3RoaXMuc2VsZWN0ZWRJbmRleF0udmFsdWU7DQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHMuc2V0VmFsdWUoZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB9KSwgaS5kb21FbGVtZW50LmFwcGVuZENoaWxkKGkuX19zZWxlY3QpLCBpDQogICAgICAgICAg%0AICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRCh0LCB6KSwg%0AUCh0LCBbew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogInNldFZhbHVlIiwNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oZSkgew0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGoodC5wcm90b3R5cGUuX19wcm90b19fIHx8%0AIE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksICJzZXRWYWx1ZSIsIHRoaXMpLmNh%0AbGwodGhpcywgZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlz%0ALl9fb25GaW5pc2hDaGFuZ2UgJiYgdGhpcy5fX29uRmluaXNoQ2hhbmdlLmNhbGwodGhpcywgdGhp%0Acy5nZXRWYWx1ZSgpKSwgbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAg%0AICAgICAgICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICJ1%0AcGRhdGVEaXNwbGF5IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rp%0Ab24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBYLmlzQWN0aXZl%0AKHRoaXMuX19zZWxlY3QpID8gdGhpcyA6ICh0aGlzLl9fc2VsZWN0LnZhbHVlID0gdGhpcy5nZXRW%0AYWx1ZSgpLCBqKHQucHJvdG90eXBlLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yo%0AdC5wcm90b3R5cGUpLCAidXBkYXRlRGlzcGxheSIsIHRoaXMpLmNhbGwodGhpcykpDQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfV0pLCB0DQog%0AICAgICAgICAgICAgICAgICAgIH0oKSwNCiAgICAgICAgICAgICAgICAgICAgSiA9IGZ1bmN0aW9u%0AKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHQoZSwgbikgew0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG8oKSB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIHIuc2V0VmFsdWUoci5fX2lucHV0LnZhbHVlKQ0KICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGKHRoaXMsIHQpOw0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gVih0aGlzLCAodC5fX3Byb3RvX18g%0AfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKHQpKS5jYWxsKHRoaXMsIGUsIG4pKSwNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgciA9IGk7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgcmV0dXJuIGkuX19pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0IiksIGku%0AX19pbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dCIpLCBYLmJpbmQoaS5fX2lucHV0LCAi%0Aa2V5dXAiLCBvKSwgWC5iaW5kKGkuX19pbnB1dCwgImNoYW5nZSIsIG8pLCBYLmJpbmQoaS5fX2lu%0AcHV0LCAiYmx1ciIsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICByLl9fb25GaW5pc2hDaGFuZ2UgJiYgci5fX29uRmluaXNoQ2hhbmdlLmNhbGwociwgci5nZXRW%0AYWx1ZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBYLmJpbmQoaS5fX2lucHV0%0ALCAia2V5ZG93biIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgMTMgPT09IGUua2V5Q29kZSAmJiB0aGlzLmJsdXIoKQ0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIH0pLCBpLnVwZGF0ZURpc3BsYXkoKSwgaS5kb21FbGVtZW50LmFwcGVuZENoaWxkKGku%0AX19pbnB1dCksIGkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgIHJldHVybiBEKHQsIHopLCBQKHQsIFt7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAga2V5OiAidXBkYXRlRGlzcGxheSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFs%0AdWU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g%0AWC5pc0FjdGl2ZSh0aGlzLl9faW5wdXQpIHx8ICh0aGlzLl9faW5wdXQudmFsdWUgPSB0aGlzLmdl%0AdFZhbHVlKCkpLCBqKHQucHJvdG90eXBlLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBl%0AT2YodC5wcm90b3R5cGUpLCAidXBkYXRlRGlzcGxheSIsIHRoaXMpLmNhbGwodGhpcykNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9XSksIHQN%0ACiAgICAgICAgICAgICAgICAgICAgfSgpLA0KICAgICAgICAgICAgICAgICAgICBXID0gZnVuY3Rp%0Ab24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdChlLCBuLCBvKSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgRih0aGlzLCB0KTsNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB2YXIgaSA9IFYodGhpcywgKHQuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90%0Ab3R5cGVPZih0KSkuY2FsbCh0aGlzLCBlLCBuKSksDQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIHMgPSBvIHx8IHt9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBp%0ALl9fbWluID0gcy5taW4sIGkuX19tYXggPSBzLm1heCwgaS5fX3N0ZXAgPSBzLnN0ZXAsIFMuaXNV%0AbmRlZmluZWQoaS5fX3N0ZXApID8gMCA9PT0gaS5pbml0aWFsVmFsdWUgPyBpLl9faW1wbGllZFN0%0AZXAgPSAxIDogaS5fX2ltcGxpZWRTdGVwID0gTWF0aC5wb3coMTAsIE1hdGguZmxvb3IoTWF0aC5s%0Ab2coTWF0aC5hYnMoaS5pbml0aWFsVmFsdWUpKSAvIE1hdGguTE4xMCkpIC8gMTAgOiBpLl9faW1w%0AbGllZFN0ZXAgPSBpLl9fc3RlcCwgaS5fX3ByZWNpc2lvbiA9IHIoaS5fX2ltcGxpZWRTdGVwKSwg%0AaQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0%0AdXJuIEQodCwgeiksIFAodCwgW3sNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICJz%0AZXRWYWx1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKGUp%0AIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlOw0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSB0aGlzLl9fbWluICYmIG4g%0APCB0aGlzLl9fbWluID8gbiA9IHRoaXMuX19taW4gOiB2b2lkIDAgIT09IHRoaXMuX19tYXggJiYg%0AbiA+IHRoaXMuX19tYXggJiYgKG4gPSB0aGlzLl9fbWF4KSwgdm9pZCAwICE9PSB0aGlzLl9fc3Rl%0AcCAmJiBuICUgdGhpcy5fX3N0ZXAgIT0gMCAmJiAobiA9IE1hdGgucm91bmQobiAvIHRoaXMuX19z%0AdGVwKSAqIHRoaXMuX19zdGVwKSwgaih0LnByb3RvdHlwZS5fX3Byb3RvX18gfHwgT2JqZWN0Lmdl%0AdFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwgInNldFZhbHVlIiwgdGhpcykuY2FsbCh0aGlzLCBu%0AKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAg%0AIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICJtaW4iLA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9fbWluID0gZSwgdGhpcw0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICBrZXk6ICJtYXgiLA0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIHZhbHVlOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHJldHVybiB0aGlzLl9fbWF4ID0gZSwgdGhpcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBrZXk6ICJzdGVwIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZnVu%0AY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5f%0AX3N0ZXAgPSBlLCB0aGlzLl9faW1wbGllZFN0ZXAgPSBlLCB0aGlzLl9fcHJlY2lzaW9uID0gcihl%0AKSwgdGhpcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgIH1dKSwgdA0KICAgICAgICAgICAgICAgICAgICB9KCksDQogICAgICAgICAgICAgICAg%0AICAgIFEgPSBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB0%0AKGUsIG4sIG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBpKCkgew0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsLl9fb25GaW5pc2hDaGFuZ2UgJiYgbC5f%0AX29uRmluaXNoQ2hhbmdlLmNhbGwobCwgbC5nZXRWYWx1ZSgpKQ0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHIoZSkg%0Aew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGQgLSBlLmNsaWVudFk7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuc2V0VmFsdWUobC5nZXRWYWx1ZSgp%0AICsgdCAqIGwuX19pbXBsaWVkU3RlcCksIGQgPSBlLmNsaWVudFkNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzKCkg%0Aew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBYLnVuYmluZCh3aW5kb3csICJtb3Vz%0AZW1vdmUiLCByKSwgWC51bmJpbmQod2luZG93LCAibW91c2V1cCIsIHMpLCBpKCkNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRih0aGlz%0ALCB0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IFYodGhpcywgKHQuX19w%0Acm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZih0KSkuY2FsbCh0aGlzLCBlLCBuLCBvKSk7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5fX3RydW5jYXRpb25TdXNwZW5kZWQgPSAh%0AMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGEsDQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIGQgPSB2b2lkIDA7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgcmV0dXJuIGEuX19pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0IiksIGEu%0AX19pbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dCIpLCBYLmJpbmQoYS5fX2lucHV0LCAi%0AY2hhbmdlIiwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZh%0AciBlID0gcGFyc2VGbG9hdChsLl9faW5wdXQudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICBTLmlzTmFOKGUpIHx8IGwuc2V0VmFsdWUoZSkNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB9KSwgWC5iaW5kKGEuX19pbnB1dCwgImJsdXIiLCBmdW5jdGlvbigpIHsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSgpDQogICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgfSksIFguYmluZChhLl9faW5wdXQsICJtb3VzZWRvd24iLCBmdW5jdGlvbihlKSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFguYmluZCh3aW5kb3csICJtb3VzZW1vdmUi%0ALCByKSwgWC5iaW5kKHdpbmRvdywgIm1vdXNldXAiLCBzKSwgZCA9IGUuY2xpZW50WQ0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIH0pLCBYLmJpbmQoYS5fX2lucHV0LCAia2V5ZG93biIsIGZ1%0AbmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTMgPT09IGUua2V5%0AQ29kZSAmJiAobC5fX3RydW5jYXRpb25TdXNwZW5kZWQgPSAhMCwgdGhpcy5ibHVyKCksIGwuX190%0AcnVuY2F0aW9uU3VzcGVuZGVkID0gITEsIGkoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB9KSwgYS51cGRhdGVEaXNwbGF5KCksIGEuZG9tRWxlbWVudC5hcHBlbmRDaGlsZChhLl9faW5w%0AdXQpLCBhDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAg%0AICByZXR1cm4gRCh0LCBXKSwgUCh0LCBbew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtl%0AeTogInVwZGF0ZURpc3BsYXkiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBm%0AdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMu%0AX19pbnB1dC52YWx1ZSA9IHRoaXMuX190cnVuY2F0aW9uU3VzcGVuZGVkID8gdGhpcy5nZXRWYWx1%0AZSgpIDogcyh0aGlzLmdldFZhbHVlKCksIHRoaXMuX19wcmVjaXNpb24pLCBqKHQucHJvdG90eXBl%0ALl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCAidXBkYXRl%0ARGlzcGxheSIsIHRoaXMpLmNhbGwodGhpcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9%0ADQogICAgICAgICAgICAgICAgICAgICAgICB9XSksIHQNCiAgICAgICAgICAgICAgICAgICAgfSgp%0ALA0KICAgICAgICAgICAgICAgICAgICBxID0gZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAg%0AICAgICAgICAgZnVuY3Rpb24gdChlLCBuLCBvLCBpLCByKSB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgZnVuY3Rpb24gcyhlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFy%0AIHQgPSBfLl9fYmFja2dyb3VuZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uc2V0VmFsdWUoYShlLmNsaWVudFgsIHQubGVm%0AdCwgdC5yaWdodCwgXy5fX21pbiwgXy5fX21heCkpLCAhMQ0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGwoKSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFgudW5iaW5kKHdpbmRvdywgIm1vdXNlbW92%0AZSIsIHMpLCBYLnVuYmluZCh3aW5kb3csICJtb3VzZXVwIiwgbCksIF8uX19vbkZpbmlzaENoYW5n%0AZSAmJiBfLl9fb25GaW5pc2hDaGFuZ2UuY2FsbChfLCBfLmdldFZhbHVlKCkpDQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rp%0Ab24gZChlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gZS50b3Vj%0AaGVzWzBdLmNsaWVudFgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0g%0AXy5fX2JhY2tncm91bmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIF8uc2V0VmFsdWUoYSh0LCBuLmxlZnQsIG4ucmlnaHQsIF8uX19taW4s%0AIF8uX19tYXgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGMoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIFgudW5iaW5kKHdpbmRvdywgInRvdWNobW92ZSIsIGQpLCBYLnVuYmluZCh3aW5kb3cs%0AICJ0b3VjaGVuZCIsIGMpLCBfLl9fb25GaW5pc2hDaGFuZ2UgJiYgXy5fX29uRmluaXNoQ2hhbmdl%0ALmNhbGwoXywgXy5nZXRWYWx1ZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICBGKHRoaXMsIHQpOw0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIHZhciB1ID0gVih0aGlzLCAodC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3Rv%0AdHlwZU9mKHQpKS5jYWxsKHRoaXMsIGUsIG4sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIG1pbjogbywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1h%0AeDogaSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IHINCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLA0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBfID0gdTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdS5fX2Jh%0AY2tncm91bmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgdS5fX2ZvcmVncm91bmQg%0APSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgWC5iaW5kKHUuX19iYWNrZ3JvdW5kLCAi%0AbW91c2Vkb3duIiwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKSwgWC5iaW5kKHdpbmRvdywgIm1vdXNlbW92%0AZSIsIHMpLCBYLmJpbmQod2luZG93LCAibW91c2V1cCIsIGwpLCBzKGUpDQogICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgfSksIFguYmluZCh1Ll9fYmFja2dyb3VuZCwgInRvdWNoc3RhcnQiLCBm%0AdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgPT09IGUudG91%0AY2hlcy5sZW5ndGggJiYgKFguYmluZCh3aW5kb3csICJ0b3VjaG1vdmUiLCBkKSwgWC5iaW5kKHdp%0AbmRvdywgInRvdWNoZW5kIiwgYyksIGQoZSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AfSksIFguYWRkQ2xhc3ModS5fX2JhY2tncm91bmQsICJzbGlkZXIiKSwgWC5hZGRDbGFzcyh1Ll9f%0AZm9yZWdyb3VuZCwgInNsaWRlci1mZyIpLCB1LnVwZGF0ZURpc3BsYXkoKSwgdS5fX2JhY2tncm91%0AbmQuYXBwZW5kQ2hpbGQodS5fX2ZvcmVncm91bmQpLCB1LmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQo%0AdS5fX2JhY2tncm91bmQpLCB1DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAg%0AICAgICAgICAgICAgICByZXR1cm4gRCh0LCBXKSwgUCh0LCBbew0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIGtleTogInVwZGF0ZURpc3BsYXkiLA0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIHZhbHVlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AdmFyIGUgPSAodGhpcy5nZXRWYWx1ZSgpIC0gdGhpcy5fX21pbikgLyAodGhpcy5fX21heCAtIHRo%0AaXMuX19taW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5f%0AX2ZvcmVncm91bmQuc3R5bGUud2lkdGggPSAxMDAgKiBlICsgIiUiLCBqKHQucHJvdG90eXBlLl9f%0AcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCAidXBkYXRlRGlz%0AcGxheSIsIHRoaXMpLmNhbGwodGhpcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQog%0AICAgICAgICAgICAgICAgICAgICAgICB9XSksIHQNCiAgICAgICAgICAgICAgICAgICAgfSgpLA0K%0AICAgICAgICAgICAgICAgICAgICBaID0gZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAg%0AICAgICAgZnVuY3Rpb24gdChlLCBuLCBvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0ARih0aGlzLCB0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IFYodGhpcywg%0AKHQuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZih0KSkuY2FsbCh0aGlzLCBlLCBu%0AKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBpOw0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHJldHVybiBpLl9fYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVu%0AdCgiZGl2IiksIGkuX19idXR0b24uaW5uZXJIVE1MID0gdm9pZCAwID09PSBvID8gIkZpcmUiIDog%0AbywgWC5iaW5kKGkuX19idXR0b24sICJjbGljayIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUucHJldmVudERlZmF1bHQoKSwgci5maXJlKCks%0AICExDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIFguYWRkQ2xhc3MoaS5fX2J1dHRv%0AbiwgImJ1dHRvbiIpLCBpLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQoaS5fX2J1dHRvbiksIGkNCiAg%0AICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBE%0AKHQsIHopLCBQKHQsIFt7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAiZmlyZSIs%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgew0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fb25DaGFuZ2UgJiYgdGhpcy5fX29uQ2hh%0AbmdlLmNhbGwodGhpcyksIHRoaXMuZ2V0VmFsdWUoKS5jYWxsKHRoaXMub2JqZWN0KSwgdGhpcy5f%0AX29uRmluaXNoQ2hhbmdlICYmIHRoaXMuX19vbkZpbmlzaENoYW5nZS5jYWxsKHRoaXMsIHRoaXMu%0AZ2V0VmFsdWUoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAg%0AICAgICAgICAgICB9XSksIHQNCiAgICAgICAgICAgICAgICAgICAgfSgpLA0KICAgICAgICAgICAg%0AICAgICAgICAkID0gZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rp%0Ab24gdChlLCBuKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gbyhlKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUoZSksIFguYmluZCh3aW5kb3csICJt%0Ab3VzZW1vdmUiLCB1KSwgWC5iaW5kKHdpbmRvdywgInRvdWNobW92ZSIsIHUpLCBYLmJpbmQod2lu%0AZG93LCAibW91c2V1cCIsIHIpLCBYLmJpbmQod2luZG93LCAidG91Y2hlbmQiLCByKQ0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1%0AbmN0aW9uIGkoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfKGUpLCBYLmJp%0AbmQod2luZG93LCAibW91c2Vtb3ZlIiwgXyksIFguYmluZCh3aW5kb3csICJ0b3VjaG1vdmUiLCBf%0AKSwgWC5iaW5kKHdpbmRvdywgIm1vdXNldXAiLCBzKSwgWC5iaW5kKHdpbmRvdywgInRvdWNoZW5k%0AIiwgcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICBmdW5jdGlvbiByKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBYLnVuYmluZCh3aW5kb3csICJtb3VzZW1vdmUiLCB1KSwgWC51bmJpbmQod2luZG93LCAidG91%0AY2htb3ZlIiwgdSksIFgudW5iaW5kKHdpbmRvdywgIm1vdXNldXAiLCByKSwgWC51bmJpbmQod2lu%0AZG93LCAidG91Y2hlbmQiLCByKSwgYygpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0K%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gcygpIHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgWC51bmJpbmQod2luZG93LCAibW91c2Vtb3ZlIiwgXyksIFgu%0AdW5iaW5kKHdpbmRvdywgInRvdWNobW92ZSIsIF8pLCBYLnVuYmluZCh3aW5kb3csICJtb3VzZXVw%0AIiwgcyksIFgudW5iaW5kKHdpbmRvdywgInRvdWNoZW5kIiwgcyksIGMoKQ0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9u%0AIGEoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gUih0aGlzLnZh%0AbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgITEgIT09IGUgPyAocC5fX2Nv%0AbG9yLl9fc3RhdGUgPSBlLCBwLnNldFZhbHVlKHAuX19jb2xvci50b09yaWdpbmFsKCkpKSA6IHRo%0AaXMudmFsdWUgPSBwLl9fY29sb3IudG9TdHJpbmcoKQ0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGMoKSB7DQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuX19vbkZpbmlzaENoYW5nZSAmJiBwLl9fb25G%0AaW5pc2hDaGFuZ2UuY2FsbChwLCBwLl9fY29sb3IudG9PcmlnaW5hbCgpKQ0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9u%0AIHUoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtMSA9PT0gZS50eXBlLmlu%0AZGV4T2YoInRvdWNoIikgJiYgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICB2YXIgdCA9IHAuX19zYXR1cmF0aW9uX2ZpZWxkLmdldEJvdW5kaW5nQ2xp%0AZW50UmVjdCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGUudG91%0AY2hlcyAmJiBlLnRvdWNoZXNbMF0gfHwgZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIG8gPSBuLmNsaWVudFgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBpID0gbi5jbGllbnRZLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9%0AIChvIC0gdC5sZWZ0KSAvICh0LnJpZ2h0IC0gdC5sZWZ0KSwNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHMgPSAxIC0gKGkgLSB0LnRvcCkgLyAodC5ib3R0b20gLSB0LnRvcCk7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzID4gMSA/IHMgPSAxIDog%0AcyA8IDAgJiYgKHMgPSAwKSwgciA+IDEgPyByID0gMSA6IHIgPCAwICYmIChyID0gMCksIHAuX19j%0Ab2xvci52ID0gcywgcC5fX2NvbG9yLnMgPSByLCBwLnNldFZhbHVlKHAuX19jb2xvci50b09yaWdp%0AbmFsKCkpLCAhMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGZ1bmN0aW9uIF8oZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAtMSA9PT0gZS50eXBlLmluZGV4T2YoInRvdWNoIikgJiYgZS5wcmV2ZW50RGVmYXVs%0AdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IHAuX19odWVfZmll%0AbGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBuID0gMSAtICgoZS50b3VjaGVzICYmIGUudG91Y2hlc1swXSB8fCBlKS5jbGllbnRZ%0AIC0gdC50b3ApIC8gKHQuYm90dG9tIC0gdC50b3ApOw0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICByZXR1cm4gbiA+IDEgPyBuID0gMSA6IG4gPCAwICYmIChuID0gMCksIHAuX19jb2xv%0Aci5oID0gMzYwICogbiwgcC5zZXRWYWx1ZShwLl9fY29sb3IudG9PcmlnaW5hbCgpKSwgITENCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0ARih0aGlzLCB0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IFYodGhpcywg%0AKHQuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZih0KSkuY2FsbCh0aGlzLCBlLCBu%0AKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5fX2NvbG9yID0gbmV3IEkoaC5nZXRW%0AYWx1ZSgpKSwgaC5fX3RlbXAgPSBuZXcgSSgwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB2YXIgcCA9IGg7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5kb21FbGVtZW50ID0g%0AZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIFgubWFrZVNlbGVjdGFibGUoaC5kb21FbGVt%0AZW50LCAhMSksIGguX19zZWxlY3RvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLCBo%0ALl9fc2VsZWN0b3IuY2xhc3NOYW1lID0gInNlbGVjdG9yIiwgaC5fX3NhdHVyYXRpb25fZmllbGQg%0APSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgaC5fX3NhdHVyYXRpb25fZmllbGQuY2xh%0Ac3NOYW1lID0gInNhdHVyYXRpb24tZmllbGQiLCBoLl9fZmllbGRfa25vYiA9IGRvY3VtZW50LmNy%0AZWF0ZUVsZW1lbnQoImRpdiIpLCBoLl9fZmllbGRfa25vYi5jbGFzc05hbWUgPSAiZmllbGQta25v%0AYiIsIGguX19maWVsZF9rbm9iX2JvcmRlciA9ICIycHggc29saWQgIiwgaC5fX2h1ZV9rbm9iID0g%0AZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIGguX19odWVfa25vYi5jbGFzc05hbWUgPSAi%0AaHVlLWtub2IiLCBoLl9faHVlX2ZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iiks%0AIGguX19odWVfZmllbGQuY2xhc3NOYW1lID0gImh1ZS1maWVsZCIsIGguX19pbnB1dCA9IGRvY3Vt%0AZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0IiksIGguX19pbnB1dC50eXBlID0gInRleHQiLCBoLl9f%0AaW5wdXRfdGV4dFNoYWRvdyA9ICIwIDFweCAxcHggIiwgWC5iaW5kKGguX19pbnB1dCwgImtleWRv%0Ad24iLCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEzID09%0APSBlLmtleUNvZGUgJiYgYS5jYWxsKHRoaXMpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AfSksIFguYmluZChoLl9faW5wdXQsICJibHVyIiwgYSksIFguYmluZChoLl9fc2VsZWN0b3IsICJt%0Ab3VzZWRvd24iLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AWC5hZGRDbGFzcyh0aGlzLCAiZHJhZyIpLmJpbmQod2luZG93LCAibW91c2V1cCIsIGZ1bmN0aW9u%0AKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWC5yZW1vdmVDbGFzcyhw%0ALl9fc2VsZWN0b3IsICJkcmFnIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgWC5iaW5kKGguX19zZWxlY3RvciwgInRv%0AdWNoc3RhcnQiLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AWC5hZGRDbGFzcyh0aGlzLCAiZHJhZyIpLmJpbmQod2luZG93LCAidG91Y2hlbmQiLCBmdW5jdGlv%0AbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFgucmVtb3ZlQ2xhc3Mo%0AcC5fX3NlbGVjdG9yLCAiZHJhZyIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0p%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgdmFyIGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICByZXR1cm4gUy5leHRlbmQoaC5fX3NlbGVjdG9yLnN0eWxlLCB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAiMTIycHgiLA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICIxMDJweCIsDQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHBhZGRpbmc6ICIzcHgiLA0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICIjMjIyIiwNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgYm94U2hhZG93OiAiMHB4IDFweCAzcHggcmdiYSgwLDAsMCwwLjMpIg0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIH0pLCBTLmV4dGVuZChoLl9fZmllbGRfa25vYi5zdHlsZSwg%0Aew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICIxMnB4IiwNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiMTJweCIsDQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGJvcmRlcjogaC5fX2ZpZWxkX2tub2JfYm9yZGVyICsgKGguX19jb2xv%0Aci52IDwgLjUgPyAiI2ZmZiIgOiAiIzAwMCIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBib3hTaGFkb3c6ICIwcHggMXB4IDNweCByZ2JhKDAsMCwwLDAuNSkiLA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICIxMnB4IiwNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxDQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgfSksIFMuZXh0ZW5kKGguX19odWVfa25vYi5zdHlsZSwgew0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgd2lkdGg6ICIxNXB4IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgaGVpZ2h0OiAiMnB4IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVy%0AUmlnaHQ6ICI0cHggc29saWQgI2ZmZiIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHpJbmRleDogMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBTLmV4dGVuZChoLl9f%0Ac2F0dXJhdGlvbl9maWVsZC5zdHlsZSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB3aWR0aDogIjEwMHB4IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0%0AOiAiMTAwcHgiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICIxcHgg%0Ac29saWQgIzU1NSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpblJpZ2h0%0AOiAiM3B4IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogImlubGlu%0AZS1ibG9jayIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvcjogInBvaW50%0AZXIiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIFMuZXh0ZW5kKGYuc3R5bGUsIHsN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICIxMDAlIiwNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAiMTAwJSIsDQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICJub25lIg0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIH0pLCBsKGYsICJ0b3AiLCAicmdiYSgwLDAsMCwwKSIsICIjMDAwIiksIFMuZXh0ZW5k%0AKGguX19odWVfZmllbGQuc3R5bGUsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0Ad2lkdGg6ICIxNXB4IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAi%0AMTAwcHgiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICIxcHggc29s%0AaWQgIzU1NSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvcjogIm5zLXJl%0Ac2l6ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1%0AdGUiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICIzcHgiLA0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodDogIjNweCINCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB9KSwgZChoLl9faHVlX2ZpZWxkKSwgUy5leHRlbmQoaC5fX2lucHV0LnN0eWxl%0ALCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGxpbmU6ICJub25lIiwNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEFsaWduOiAiY2VudGVyIiwNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICIjZmZmIiwNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgYm9yZGVyOiAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBmb250V2VpZ2h0OiAiYm9sZCIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHRleHRTaGFkb3c6IGguX19pbnB1dF90ZXh0U2hhZG93ICsgInJnYmEoMCwwLDAsMC43KSINCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgWC5iaW5kKGguX19zYXR1cmF0aW9uX2ZpZWxk%0ALCAibW91c2Vkb3duIiwgbyksIFguYmluZChoLl9fc2F0dXJhdGlvbl9maWVsZCwgInRvdWNoc3Rh%0AcnQiLCBvKSwgWC5iaW5kKGguX19maWVsZF9rbm9iLCAibW91c2Vkb3duIiwgbyksIFguYmluZCho%0ALl9fZmllbGRfa25vYiwgInRvdWNoc3RhcnQiLCBvKSwgWC5iaW5kKGguX19odWVfZmllbGQsICJt%0Ab3VzZWRvd24iLCBpKSwgWC5iaW5kKGguX19odWVfZmllbGQsICJ0b3VjaHN0YXJ0IiwgaSksIGgu%0AX19zYXR1cmF0aW9uX2ZpZWxkLmFwcGVuZENoaWxkKGYpLCBoLl9fc2VsZWN0b3IuYXBwZW5kQ2hp%0AbGQoaC5fX2ZpZWxkX2tub2IpLCBoLl9fc2VsZWN0b3IuYXBwZW5kQ2hpbGQoaC5fX3NhdHVyYXRp%0Ab25fZmllbGQpLCBoLl9fc2VsZWN0b3IuYXBwZW5kQ2hpbGQoaC5fX2h1ZV9maWVsZCksIGguX19o%0AdWVfZmllbGQuYXBwZW5kQ2hpbGQoaC5fX2h1ZV9rbm9iKSwgaC5kb21FbGVtZW50LmFwcGVuZENo%0AaWxkKGguX19pbnB1dCksIGguZG9tRWxlbWVudC5hcHBlbmRDaGlsZChoLl9fc2VsZWN0b3IpLCBo%0ALnVwZGF0ZURpc3BsYXkoKSwgaA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAg%0AICAgICAgICAgICAgICAgcmV0dXJuIEQodCwgeiksIFAodCwgW3sNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICBrZXk6ICJ1cGRhdGVEaXNwbGF5IiwNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHZhciBlID0gUih0aGlzLmdldFZhbHVlKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBpZiAoITEgIT09IGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIHZhciB0ID0gITE7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTLmVhY2go%0ASS5DT01QT05FTlRTLCBmdW5jdGlvbihuKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgaWYgKCFTLmlzVW5kZWZpbmVkKGVbbl0pICYmICFTLmlzVW5kZWZpbmVkKHRo%0AaXMuX19jb2xvci5fX3N0YXRlW25dKSAmJiBlW25dICE9PSB0aGlzLl9fY29sb3IuX19zdGF0ZVtu%0AXSkgcmV0dXJuIHQgPSAhMCwge30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIH0sIHRoaXMpLCB0ICYmIFMuZXh0ZW5kKHRoaXMuX19jb2xvci5fX3N0YXRlLCBlKQ0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIFMuZXh0ZW5kKHRoaXMuX190ZW1wLl9fc3RhdGUsIHRoaXMuX19jb2xvci5fX3N0YXRlKSwg%0AdGhpcy5fX3RlbXAuYSA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBu%0AID0gdGhpcy5fX2NvbG9yLnYgPCAuNSB8fCB0aGlzLl9fY29sb3IucyA+IC41ID8gMjU1IDogMCwN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSAyNTUgLSBuOw0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICBTLmV4dGVuZCh0aGlzLl9fZmllbGRfa25vYi5zdHls%0AZSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogMTAw%0AICogdGhpcy5fX2NvbG9yLnMgLSA3ICsgInB4IiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIG1hcmdpblRvcDogMTAwICogKDEgLSB0aGlzLl9fY29sb3IudikgLSA3ICsgInB4%0AIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjog%0AdGhpcy5fX3RlbXAudG9IZXhTdHJpbmcoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIGJvcmRlcjogdGhpcy5fX2ZpZWxkX2tub2JfYm9yZGVyICsgInJnYigiICsgbiArICIs%0AIiArIG4gKyAiLCIgKyBuICsgIikiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0p%0ALCB0aGlzLl9faHVlX2tub2Iuc3R5bGUubWFyZ2luVG9wID0gMTAwICogKDEgLSB0aGlzLl9fY29s%0Ab3IuaCAvIDM2MCkgKyAicHgiLCB0aGlzLl9fdGVtcC5zID0gMSwgdGhpcy5fX3RlbXAudiA9IDEs%0AIGwodGhpcy5fX3NhdHVyYXRpb25fZmllbGQsICJsZWZ0IiwgIiNmZmYiLCB0aGlzLl9fdGVtcC50%0Ab0hleFN0cmluZygpKSwgdGhpcy5fX2lucHV0LnZhbHVlID0gdGhpcy5fX2NvbG9yLnRvU3RyaW5n%0AKCksIFMuZXh0ZW5kKHRoaXMuX19pbnB1dC5zdHlsZSwgew0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGlzLl9fY29sb3IudG9IZXhTdHJpbmco%0AKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAicmdiKCIgKyBu%0AICsgIiwiICsgbiArICIsIiArIG4gKyAiKSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICB0ZXh0U2hhZG93OiB0aGlzLl9faW5wdXRfdGV4dFNoYWRvdyArICJyZ2JhKCIgKyBv%0AICsgIiwiICsgbyArICIsIiArIG8gKyAiLC43KSINCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAg%0AICAgICAgICB9XSksIHQNCiAgICAgICAgICAgICAgICAgICAgfSgpLA0KICAgICAgICAgICAgICAg%0AICAgICBlZSA9IFsiLW1vei0iLCAiLW8tIiwgIi13ZWJraXQtIiwgIi1tcy0iLCAiIl0sDQogICAg%0AICAgICAgICAgICAgICAgIHRlID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgbG9hZDogZnVu%0AY3Rpb24oZSwgdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gdCB8fCBk%0Ab2N1bWVudCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbyA9IG4uY3JlYXRlRWxl%0AbWVudCgibGluayIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8udHlwZSA9ICJ0ZXh0%0AL2NzcyIsIG8ucmVsID0gInN0eWxlc2hlZXQiLCBvLmhyZWYgPSBlLCBuLmdldEVsZW1lbnRzQnlU%0AYWdOYW1lKCJoZWFkIilbMF0uYXBwZW5kQ2hpbGQobykNCiAgICAgICAgICAgICAgICAgICAgICAg%0AIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBpbmplY3Q6IGZ1bmN0aW9uKGUsIHQpIHsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHQgfHwgZG9jdW1lbnQsDQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHls%0AZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8udHlwZSA9ICJ0ZXh0L2NzcyIsIG8u%0AaW5uZXJIVE1MID0gZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG4uZ2V0%0ARWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmFwcGVuZENoaWxkKG8p%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30NCiAgICAgICAgICAg%0AICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAg%0AICAgbmUgPSBmdW5jdGlvbihlLCB0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9%0AIGVbdF07DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUy5pc0FycmF5KGFyZ3VtZW50%0Ac1syXSkgfHwgUy5pc09iamVjdChhcmd1bWVudHNbMl0pID8gbmV3IFkoZSwgdCwgYXJndW1lbnRz%0AWzJdKSA6IFMuaXNOdW1iZXIobikgPyBTLmlzTnVtYmVyKGFyZ3VtZW50c1syXSkgJiYgUy5pc051%0AbWJlcihhcmd1bWVudHNbM10pID8gUy5pc051bWJlcihhcmd1bWVudHNbNF0pID8gbmV3IHEoZSwg%0AdCwgYXJndW1lbnRzWzJdLCBhcmd1bWVudHNbM10sIGFyZ3VtZW50c1s0XSkgOiBuZXcgcShlLCB0%0ALCBhcmd1bWVudHNbMl0sIGFyZ3VtZW50c1szXSkgOiBTLmlzTnVtYmVyKGFyZ3VtZW50c1s0XSkg%0APyBuZXcgUShlLCB0LCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluOiBhcmd1bWVu%0AdHNbMl0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4OiBhcmd1bWVudHNbM10sDQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcDogYXJndW1lbnRzWzRdDQogICAgICAgICAg%0AICAgICAgICAgICAgICB9KSA6IG5ldyBRKGUsIHQsIHsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBtaW46IGFyZ3VtZW50c1syXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXg6%0AIGFyZ3VtZW50c1szXQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBTLmlzU3RyaW5nKG4p%0AID8gbmV3IEooZSwgdCkgOiBTLmlzRnVuY3Rpb24obikgPyBuZXcgWihlLCB0LCAiIikgOiBTLmlz%0AQm9vbGVhbihuKSA/IG5ldyBLKGUsIHQpIDogbnVsbA0KICAgICAgICAgICAgICAgICAgICB9LA0K%0AICAgICAgICAgICAgICAgICAgICBvZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwg%0Ad2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubW96UmVxdWVzdEFu%0AaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5t%0Ac1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAg%0AICAgICAgICBzZXRUaW1lb3V0KGUsIDFlMyAvIDYwKQ0KICAgICAgICAgICAgICAgICAgICB9LA0K%0AICAgICAgICAgICAgICAgICAgICBpZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAg%0AICAgICAgZnVuY3Rpb24gZSgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGKHRoaXMs%0AIGUpLCB0aGlzLmJhY2tncm91bmRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2%0AIiksIFMuZXh0ZW5kKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUsIHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAicmdiYSgwLDAsMCwwLjgpIiwN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAwLA0KICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICBsZWZ0OiAwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBkaXNwbGF5OiAibm9uZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRl%0AeDogIjEwMDAiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLA0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXZWJraXRUcmFuc2l0aW9uOiAib3BhY2l0%0AeSAwLjJzIGxpbmVhciIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRp%0Ab246ICJvcGFjaXR5IDAuMnMgbGluZWFyIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0p%0ALCBYLm1ha2VGdWxsc2NyZWVuKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQpLCB0aGlzLmJhY2tncm91%0AbmRFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gImZpeGVkIiwgdGhpcy5kb21FbGVtZW50ID0gZG9j%0AdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIFMuZXh0ZW5kKHRoaXMuZG9tRWxlbWVudC5zdHls%0AZSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImZpeGVkIiwN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiLA0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6ICIxMDAxIiwNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgV2Via2l0VHJhbnNpdGlvbjogIi13ZWJraXQtdHJhbnNmb3JtIDAuMnMgZWFzZS1vdXQs%0AIG9wYWNpdHkgMC4ycyBsaW5lYXIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0%0AcmFuc2l0aW9uOiAidHJhbnNmb3JtIDAuMnMgZWFzZS1vdXQsIG9wYWNpdHkgMC4ycyBsaW5lYXIi%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hp%0AbGQodGhpcy5iYWNrZ3JvdW5kRWxlbWVudCksIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhp%0Acy5kb21FbGVtZW50KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWC5iaW5kKHRoaXMuYmFja2dyb3VuZEVsZW1l%0AbnQsICJjbGljayIsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB0LmhpZGUoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAg%0AICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUChlLCBbew0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogInNob3ciLA0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgdmFyIGUgPSB0aGlzOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlz%0ALmJhY2tncm91bmRFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siLCB0aGlzLmRvbUVsZW1l%0AbnQuc3R5bGUuZGlzcGxheSA9ICJibG9jayIsIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5vcGFjaXR5%0AID0gMCwgdGhpcy5kb21FbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICJzY2FsZSgxLjEp%0AIiwgdGhpcy5sYXlvdXQoKSwgUy5kZWZlcihmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIGUuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUub3BhY2l0eSA9IDEs%0AIGUuZG9tRWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gMSwgZS5kb21FbGVtZW50LnN0eWxlLndlYmtp%0AdFRyYW5zZm9ybSA9ICJzY2FsZSgxKSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAg%0AICB9LCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAiaGlkZSIsDQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMsDQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB0ID0gZnVuY3Rpb24gdCgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICBlLmRvbUVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgZS5iYWNr%0AZ3JvdW5kRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiLCBYLnVuYmluZChlLmRvbUVsZW1l%0AbnQsICJ3ZWJraXRUcmFuc2l0aW9uRW5kIiwgdCksIFgudW5iaW5kKGUuZG9tRWxlbWVudCwgInRy%0AYW5zaXRpb25lbmQiLCB0KSwgWC51bmJpbmQoZS5kb21FbGVtZW50LCAib1RyYW5zaXRpb25FbmQi%0ALCB0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgWC5iaW5kKHRoaXMuZG9tRWxlbWVudCwgIndlYmtpdFRyYW5z%0AaXRpb25FbmQiLCB0KSwgWC5iaW5kKHRoaXMuZG9tRWxlbWVudCwgInRyYW5zaXRpb25lbmQiLCB0%0AKSwgWC5iaW5kKHRoaXMuZG9tRWxlbWVudCwgIm9UcmFuc2l0aW9uRW5kIiwgdCksIHRoaXMuYmFj%0Aa2dyb3VuZEVsZW1lbnQuc3R5bGUub3BhY2l0eSA9IDAsIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5v%0AcGFjaXR5ID0gMCwgdGhpcy5kb21FbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICJzY2Fs%0AZSgxLjEpIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICJsYXlvdXQiLA0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb21FbGVtZW50LnN0eWxlLmxlZnQgPSB3aW5k%0Ab3cuaW5uZXJXaWR0aCAvIDIgLSBYLmdldFdpZHRoKHRoaXMuZG9tRWxlbWVudCkgLyAyICsgInB4%0AIiwgdGhpcy5kb21FbGVtZW50LnN0eWxlLnRvcCA9IHdpbmRvdy5pbm5lckhlaWdodCAvIDIgLSBY%0ALmdldEhlaWdodCh0aGlzLmRvbUVsZW1lbnQpIC8gMiArICJweCINCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9XSksIGUNCiAgICAgICAgICAg%0AICAgICAgICAgfSgpLA0KICAgICAgICAgICAgICAgICAgICByZSA9IGZ1bmN0aW9uKGUpIHsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgIGlmIChlICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5k%0Ab3cpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0%0AZUVsZW1lbnQoInN0eWxlIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQu%0Ac2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQvY3NzIiksIHQuaW5uZXJIVE1MID0gZSwgZG9jdW1l%0AbnQuaGVhZC5hcHBlbmRDaGlsZCh0KSwgZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAg%0AICAgICAgICAgICAgICAgICB9KCIuZGcgdWx7bGlzdC1zdHlsZTpub25lO21hcmdpbjowO3BhZGRp%0Abmc6MDt3aWR0aDoxMDAlO2NsZWFyOmJvdGh9LmRnLmFje3Bvc2l0aW9uOmZpeGVkO3RvcDowO2xl%0AZnQ6MDtyaWdodDowO2hlaWdodDowO3otaW5kZXg6MH0uZGc6bm90KC5hYykgLm1haW57b3ZlcmZs%0Ab3c6aGlkZGVufS5kZy5tYWluey13ZWJraXQtdHJhbnNpdGlvbjpvcGFjaXR5IC4xcyBsaW5lYXI7%0ALW8tdHJhbnNpdGlvbjpvcGFjaXR5IC4xcyBsaW5lYXI7LW1vei10cmFuc2l0aW9uOm9wYWNpdHkg%0ALjFzIGxpbmVhcjt0cmFuc2l0aW9uOm9wYWNpdHkgLjFzIGxpbmVhcn0uZGcubWFpbi50YWxsZXIt%0AdGhhbi13aW5kb3d7b3ZlcmZsb3cteTphdXRvfS5kZy5tYWluLnRhbGxlci10aGFuLXdpbmRvdyAu%0AY2xvc2UtYnV0dG9ue29wYWNpdHk6MTttYXJnaW4tdG9wOi0xcHg7Ym9yZGVyLXRvcDoxcHggc29s%0AaWQgIzJjMmMyY30uZGcubWFpbiB1bC5jbG9zZWQgLmNsb3NlLWJ1dHRvbntvcGFjaXR5OjEgIWlt%0AcG9ydGFudH0uZGcubWFpbjpob3ZlciAuY2xvc2UtYnV0dG9uLC5kZy5tYWluIC5jbG9zZS1idXR0%0Ab24uZHJhZ3tvcGFjaXR5OjF9LmRnLm1haW4gLmNsb3NlLWJ1dHRvbnstd2Via2l0LXRyYW5zaXRp%0Ab246b3BhY2l0eSAuMXMgbGluZWFyOy1vLXRyYW5zaXRpb246b3BhY2l0eSAuMXMgbGluZWFyOy1t%0Ab3otdHJhbnNpdGlvbjpvcGFjaXR5IC4xcyBsaW5lYXI7dHJhbnNpdGlvbjpvcGFjaXR5IC4xcyBs%0AaW5lYXI7Ym9yZGVyOjA7bGluZS1oZWlnaHQ6MTlweDtoZWlnaHQ6MjBweDtjdXJzb3I6cG9pbnRl%0Acjt0ZXh0LWFsaWduOmNlbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOiMwMDB9LmRnLm1haW4gLmNsb3Nl%0ALWJ1dHRvbi5jbG9zZS10b3B7cG9zaXRpb246cmVsYXRpdmV9LmRnLm1haW4gLmNsb3NlLWJ1dHRv%0Abi5jbG9zZS1ib3R0b217cG9zaXRpb246YWJzb2x1dGV9LmRnLm1haW4gLmNsb3NlLWJ1dHRvbjpo%0Ab3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiMxMTF9LmRnLmF7ZmxvYXQ6cmlnaHQ7bWFyZ2luLXJpZ2h0%0AOjE1cHg7b3ZlcmZsb3cteTp2aXNpYmxlfS5kZy5hLmhhcy1zYXZlPnVsLmNsb3NlLXRvcHttYXJn%0AaW4tdG9wOjB9LmRnLmEuaGFzLXNhdmU+dWwuY2xvc2UtYm90dG9te21hcmdpbi10b3A6MjdweH0u%0AZGcuYS5oYXMtc2F2ZT51bC5jbG9zZWR7bWFyZ2luLXRvcDowfS5kZy5hIC5zYXZlLXJvd3t0b3A6%0AMDt6LWluZGV4OjEwMDJ9LmRnLmEgLnNhdmUtcm93LmNsb3NlLXRvcHtwb3NpdGlvbjpyZWxhdGl2%0AZX0uZGcuYSAuc2F2ZS1yb3cuY2xvc2UtYm90dG9te3Bvc2l0aW9uOmZpeGVkfS5kZyBsaXstd2Vi%0Aa2l0LXRyYW5zaXRpb246aGVpZ2h0IC4xcyBlYXNlLW91dDstby10cmFuc2l0aW9uOmhlaWdodCAu%0AMXMgZWFzZS1vdXQ7LW1vei10cmFuc2l0aW9uOmhlaWdodCAuMXMgZWFzZS1vdXQ7dHJhbnNpdGlv%0AbjpoZWlnaHQgLjFzIGVhc2Utb3V0Oy13ZWJraXQtdHJhbnNpdGlvbjpvdmVyZmxvdyAuMXMgbGlu%0AZWFyOy1vLXRyYW5zaXRpb246b3ZlcmZsb3cgLjFzIGxpbmVhcjstbW96LXRyYW5zaXRpb246b3Zl%0AcmZsb3cgLjFzIGxpbmVhcjt0cmFuc2l0aW9uOm92ZXJmbG93IC4xcyBsaW5lYXJ9LmRnIGxpOm5v%0AdCguZm9sZGVyKXtjdXJzb3I6YXV0bztoZWlnaHQ6MjdweDtsaW5lLWhlaWdodDoyN3B4O3BhZGRp%0Abmc6MCA0cHggMCA1cHh9LmRnIGxpLmZvbGRlcntwYWRkaW5nOjA7Ym9yZGVyLWxlZnQ6NHB4IHNv%0AbGlkIHJnYmEoMCwwLDAsMCl9LmRnIGxpLnRpdGxle2N1cnNvcjpwb2ludGVyO21hcmdpbi1sZWZ0%0AOi00cHh9LmRnIC5jbG9zZWQgbGk6bm90KC50aXRsZSksLmRnIC5jbG9zZWQgdWwgbGksLmRnIC5j%0AbG9zZWQgdWwgbGk+KntoZWlnaHQ6MDtvdmVyZmxvdzpoaWRkZW47Ym9yZGVyOjB9LmRnIC5jcntj%0AbGVhcjpib3RoO3BhZGRpbmctbGVmdDozcHg7aGVpZ2h0OjI3cHg7b3ZlcmZsb3c6aGlkZGVufS5k%0AZyAucHJvcGVydHktbmFtZXtjdXJzb3I6ZGVmYXVsdDtmbG9hdDpsZWZ0O2NsZWFyOmxlZnQ7d2lk%0AdGg6NDAlO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzfS5kZyAuY3tmbG9h%0AdDpsZWZ0O3dpZHRoOjYwJTtwb3NpdGlvbjpyZWxhdGl2ZX0uZGcgLmMgaW5wdXRbdHlwZT10ZXh0%0AXXtib3JkZXI6MDttYXJnaW4tdG9wOjRweDtwYWRkaW5nOjNweDt3aWR0aDoxMDAlO2Zsb2F0OnJp%0AZ2h0fS5kZyAuaGFzLXNsaWRlciBpbnB1dFt0eXBlPXRleHRde3dpZHRoOjMwJTttYXJnaW4tbGVm%0AdDowfS5kZyAuc2xpZGVye2Zsb2F0OmxlZnQ7d2lkdGg6NjYlO21hcmdpbi1sZWZ0Oi01cHg7bWFy%0AZ2luLXJpZ2h0OjA7aGVpZ2h0OjE5cHg7bWFyZ2luLXRvcDo0cHh9LmRnIC5zbGlkZXItZmd7aGVp%0AZ2h0OjEwMCV9LmRnIC5jIGlucHV0W3R5cGU9Y2hlY2tib3hde21hcmdpbi10b3A6N3B4fS5kZyAu%0AYyBzZWxlY3R7bWFyZ2luLXRvcDo1cHh9LmRnIC5jci5mdW5jdGlvbiwuZGcgLmNyLmZ1bmN0aW9u%0AIC5wcm9wZXJ0eS1uYW1lLC5kZyAuY3IuZnVuY3Rpb24gKiwuZGcgLmNyLmJvb2xlYW4sLmRnIC5j%0Aci5ib29sZWFuICp7Y3Vyc29yOnBvaW50ZXJ9LmRnIC5jci5jb2xvcntvdmVyZmxvdzp2aXNpYmxl%0AfS5kZyAuc2VsZWN0b3J7ZGlzcGxheTpub25lO3Bvc2l0aW9uOmFic29sdXRlO21hcmdpbi1sZWZ0%0AOi05cHg7bWFyZ2luLXRvcDoyM3B4O3otaW5kZXg6MTB9LmRnIC5jOmhvdmVyIC5zZWxlY3Rvciwu%0AZGcgLnNlbGVjdG9yLmRyYWd7ZGlzcGxheTpibG9ja30uZGcgbGkuc2F2ZS1yb3d7cGFkZGluZzow%0AfS5kZyBsaS5zYXZlLXJvdyAuYnV0dG9ue2Rpc3BsYXk6aW5saW5lLWJsb2NrO3BhZGRpbmc6MHB4%0AIDZweH0uZGcuZGlhbG9ndWV7YmFja2dyb3VuZC1jb2xvcjojMjIyO3dpZHRoOjQ2MHB4O3BhZGRp%0Abmc6MTVweDtmb250LXNpemU6MTNweDtsaW5lLWhlaWdodDoxNXB4fSNkZy1uZXctY29uc3RydWN0%0Ab3J7cGFkZGluZzoxMHB4O2NvbG9yOiMyMjI7Zm9udC1mYW1pbHk6TW9uYWNvLCBtb25vc3BhY2U7%0AZm9udC1zaXplOjEwcHg7Ym9yZGVyOjA7cmVzaXplOm5vbmU7Ym94LXNoYWRvdzppbnNldCAxcHgg%0AMXB4IDFweCAjODg4O3dvcmQtd3JhcDpicmVhay13b3JkO21hcmdpbjoxMnB4IDA7ZGlzcGxheTpi%0AbG9jazt3aWR0aDo0NDBweDtvdmVyZmxvdy15OnNjcm9sbDtoZWlnaHQ6MTAwcHg7cG9zaXRpb246%0AcmVsYXRpdmV9I2RnLWxvY2FsLWV4cGxhaW57ZGlzcGxheTpub25lO2ZvbnQtc2l6ZToxMXB4O2xp%0AbmUtaGVpZ2h0OjE3cHg7Ym9yZGVyLXJhZGl1czozcHg7YmFja2dyb3VuZC1jb2xvcjojMzMzO3Bh%0AZGRpbmc6OHB4O21hcmdpbi10b3A6MTBweH0jZGctbG9jYWwtZXhwbGFpbiBjb2Rle2ZvbnQtc2l6%0AZToxMHB4fSNkYXQtZ3VpLXNhdmUtbG9jYWxseXtkaXNwbGF5Om5vbmV9LmRne2NvbG9yOiNlZWU7%0AZm9udDoxMXB4ICdMdWNpZGEgR3JhbmRlJywgc2Fucy1zZXJpZjt0ZXh0LXNoYWRvdzowIC0xcHgg%0AMCAjMTExfS5kZy5tYWluOjotd2Via2l0LXNjcm9sbGJhcnt3aWR0aDo1cHg7YmFja2dyb3VuZDoj%0AMWExYTFhfS5kZy5tYWluOjotd2Via2l0LXNjcm9sbGJhci1jb3JuZXJ7aGVpZ2h0OjA7ZGlzcGxh%0AeTpub25lfS5kZy5tYWluOjotd2Via2l0LXNjcm9sbGJhci10aHVtYntib3JkZXItcmFkaXVzOjVw%0AeDtiYWNrZ3JvdW5kOiM2NzY3Njd9LmRnIGxpOm5vdCguZm9sZGVyKXtiYWNrZ3JvdW5kOiMxYTFh%0AMWE7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgIzJjMmMyY30uZGcgbGkuc2F2ZS1yb3d7bGluZS1o%0AZWlnaHQ6MjVweDtiYWNrZ3JvdW5kOiNkYWQ1Y2I7Ym9yZGVyOjB9LmRnIGxpLnNhdmUtcm93IHNl%0AbGVjdHttYXJnaW4tbGVmdDo1cHg7d2lkdGg6MTA4cHh9LmRnIGxpLnNhdmUtcm93IC5idXR0b257%0AbWFyZ2luLWxlZnQ6NXB4O21hcmdpbi10b3A6MXB4O2JvcmRlci1yYWRpdXM6MnB4O2ZvbnQtc2l6%0AZTo5cHg7bGluZS1oZWlnaHQ6N3B4O3BhZGRpbmc6NHB4IDRweCA1cHggNHB4O2JhY2tncm91bmQ6%0AI2M1YmRhZDtjb2xvcjojZmZmO3RleHQtc2hhZG93OjAgMXB4IDAgI2IwYTU4Zjtib3gtc2hhZG93%0AOjAgLTFweCAwICNiMGE1OGY7Y3Vyc29yOnBvaW50ZXJ9LmRnIGxpLnNhdmUtcm93IC5idXR0b24u%0AZ2VhcnN7YmFja2dyb3VuZDojYzViZGFkIHVybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3%0AMEtHZ29BQUFBTlNVaEVVZ0FBQUFzQUFBQU5DQVlBQUFCLzlaUTdBQUFBR1hSRldIUlRiMlowZDJG%0AeVpRQkJaRzlpWlNCSmJXRm5aVkpsWVdSNWNjbGxQQUFBQVFKSlJFRlVlTnBpWUtBVS9QLy9Qd0dJ%0AQy9BcENBQmlCU0FXK0k4QUNsQWNnS3hRNFQ5aG9NQUVVcnh4MlFTR042K2VnRFgrL3ZXVDRlN044%0AMkFNWW9QQXgvZXZ3V29Zb1NZYkFDWDJzN0t4Q3h6Y3NlekRoM2V2Rm9ERUJZVEVFcXljZ2dXQXpB%0AOUF1VVNRUWdlWVBhOWZQdjYvWVdtL0FjeDVJUGI3dHkvZncrUVpibHc2N3ZEczhSMFlIeVFoZ09i%0AeCt5QUprQnFtRzVkUFBEaDFhUE9HUi9ldWdXMEc0dmxJb1RJZnlGY0ErUWVraGhISmhQZFF4YmlB%0ASWd1TUJUUVpyUEQ3MTA4TTZyb1dZREZRaUlBQXY2QW93LzFiRndYZ2lzK2YyTFVBeW53b0lhTmN6%0AOFhOeDNEbDdNRUpVREdRcHg5Z3RROFlDdWVCK0QyNk9FQ0FBUURhZHQ3ZTQ2RDQyUUFBQUFCSlJV%0ANUVya0pnZ2c9PSkgMnB4IDFweCBuby1yZXBlYXQ7aGVpZ2h0OjdweDt3aWR0aDo4cHh9LmRnIGxp%0ALnNhdmUtcm93IC5idXR0b246aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojYmFiMTllO2JveC1zaGFk%0Ab3c6MCAtMXB4IDAgI2IwYTU4Zn0uZGcgbGkuZm9sZGVye2JvcmRlci1ib3R0b206MH0uZGcgbGku%0AdGl0bGV7cGFkZGluZy1sZWZ0OjE2cHg7YmFja2dyb3VuZDojMDAwIHVybChkYXRhOmltYWdlL2dp%0AZjtiYXNlNjQsUjBsR09EbGhCUUFGQUpFQUFQLy8vL1B6OC8vLy8vLy8veUg1QkFFQUFBSUFMQUFB%0AQUFBRkFBVUFBQUlJbEkraEtnRnhvQ2dBT3c9PSkgNnB4IDEwcHggbm8tcmVwZWF0O2N1cnNvcjpw%0Ab2ludGVyO2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4yKX0uZGcg%0ALmNsb3NlZCBsaS50aXRsZXtiYWNrZ3JvdW5kLWltYWdlOnVybChkYXRhOmltYWdlL2dpZjtiYXNl%0ANjQsUjBsR09EbGhCUUFGQUpFQUFQLy8vL1B6OC8vLy8vLy8veUg1QkFFQUFBSUFMQUFBQUFBRkFB%0AVUFBQUlJbEdJV3FNQ2JXQUVBT3c9PSl9LmRnIC5jci5ib29sZWFue2JvcmRlci1sZWZ0OjNweCBz%0Ab2xpZCAjODA2Nzg3fS5kZyAuY3IuY29sb3J7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkfS5kZyAuY3Iu%0AZnVuY3Rpb257Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICNlNjFkNWZ9LmRnIC5jci5udW1iZXJ7Ym9y%0AZGVyLWxlZnQ6M3B4IHNvbGlkICMyRkExRDZ9LmRnIC5jci5udW1iZXIgaW5wdXRbdHlwZT10ZXh0%0AXXtjb2xvcjojMkZBMUQ2fS5kZyAuY3Iuc3RyaW5ne2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjMWVk%0AMzZmfS5kZyAuY3Iuc3RyaW5nIGlucHV0W3R5cGU9dGV4dF17Y29sb3I6IzFlZDM2Zn0uZGcgLmNy%0ALmZ1bmN0aW9uOmhvdmVyLC5kZyAuY3IuYm9vbGVhbjpob3ZlcntiYWNrZ3JvdW5kOiMxMTF9LmRn%0AIC5jIGlucHV0W3R5cGU9dGV4dF17YmFja2dyb3VuZDojMzAzMDMwO291dGxpbmU6bm9uZX0uZGcg%0ALmMgaW5wdXRbdHlwZT10ZXh0XTpob3ZlcntiYWNrZ3JvdW5kOiMzYzNjM2N9LmRnIC5jIGlucHV0%0AW3R5cGU9dGV4dF06Zm9jdXN7YmFja2dyb3VuZDojNDk0OTQ5O2NvbG9yOiNmZmZ9LmRnIC5jIC5z%0AbGlkZXJ7YmFja2dyb3VuZDojMzAzMDMwO2N1cnNvcjpldy1yZXNpemV9LmRnIC5jIC5zbGlkZXIt%0AZmd7YmFja2dyb3VuZDojMkZBMUQ2O21heC13aWR0aDoxMDAlfS5kZyAuYyAuc2xpZGVyOmhvdmVy%0Ae2JhY2tncm91bmQ6IzNjM2MzY30uZGcgLmMgLnNsaWRlcjpob3ZlciAuc2xpZGVyLWZne2JhY2tn%0Acm91bmQ6IzQ0YWJkYX1cbiIpOw0KICAgICAgICAgICAgICAgIHRlLmluamVjdChyZSk7DQogICAg%0AICAgICAgICAgICAgdmFyIHNlID0gIkRlZmF1bHQiLA0KICAgICAgICAgICAgICAgICAgICBhZSA9%0AIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICByZXR1cm4gISF3aW5kb3cubG9jYWxTdG9yYWdlDQogICAgICAgICAg%0AICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AcmV0dXJuICExDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAg%0AIH0oKSwNCiAgICAgICAgICAgICAgICAgICAgbGUgPSB2b2lkIDAsDQogICAgICAgICAgICAgICAg%0AICAgIGRlID0gITAsDQogICAgICAgICAgICAgICAgICAgIGNlID0gdm9pZCAwLA0KICAgICAgICAg%0AICAgICAgICAgICB1ZSA9ICExLA0KICAgICAgICAgICAgICAgICAgICBfZSA9IFtdLA0KICAgICAg%0AICAgICAgICAgICAgICBoZSA9IGZ1bmN0aW9uIGUodCkgew0KICAgICAgICAgICAgICAgICAgICAg%0AICAgdmFyIG4gPSB0aGlzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSB0IHx8IHt9%0AOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb21FbGVtZW50ID0gZG9jdW1lbnQuY3Jl%0AYXRlRWxlbWVudCgiZGl2IiksIHRoaXMuX191bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInVs%0AIiksIHRoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fdWwpLCBYLmFkZENsYXNzKHRo%0AaXMuZG9tRWxlbWVudCwgImRnIiksIHRoaXMuX19mb2xkZXJzID0ge30sIHRoaXMuX19jb250cm9s%0AbGVycyA9IFtdLCB0aGlzLl9fcmVtZW1iZXJlZE9iamVjdHMgPSBbXSwgdGhpcy5fX3JlbWVtYmVy%0AZWRPYmplY3RJbmRlY2VzVG9Db250cm9sbGVycyA9IFtdLCB0aGlzLl9fbGlzdGVuaW5nID0gW10s%0AIG8gPSBTLmRlZmF1bHRzKG8sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9u%0AVG9wOiAhMSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvUGxhY2U6ICEwLA0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBlLkRFRkFVTFRfV0lEVEgNCiAgICAgICAg%0AICAgICAgICAgICAgICAgIH0pLCBvID0gUy5kZWZhdWx0cyhvLCB7DQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgcmVzaXphYmxlOiBvLmF1dG9QbGFjZSwNCiAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBoaWRlYWJsZTogby5hdXRvUGxhY2UNCiAgICAgICAgICAgICAgICAgICAgICAgIH0p%0ALCBTLmlzVW5kZWZpbmVkKG8ubG9hZCkgPyBvLmxvYWQgPSB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgcHJlc2V0OiBzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSA6IG8ucHJlc2V0%0AICYmIChvLmxvYWQucHJlc2V0ID0gby5wcmVzZXQpLCBTLmlzVW5kZWZpbmVkKG8ucGFyZW50KSAm%0AJiBvLmhpZGVhYmxlICYmIF9lLnB1c2godGhpcyksIG8ucmVzaXphYmxlID0gUy5pc1VuZGVmaW5l%0AZChvLnBhcmVudCkgJiYgby5yZXNpemFibGUsIG8uYXV0b1BsYWNlICYmIFMuaXNVbmRlZmluZWQo%0Aby5zY3JvbGxhYmxlKSAmJiAoby5zY3JvbGxhYmxlID0gITApOw0KICAgICAgICAgICAgICAgICAg%0AICAgICAgdmFyIGkgPSBhZSAmJiAidHJ1ZSIgPT09IGxvY2FsU3RvcmFnZS5nZXRJdGVtKG0odGhp%0AcywgImlzTG9jYWwiKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IHZvaWQgMCwN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gdm9pZCAwOw0KICAgICAgICAgICAgICAg%0AICAgICAgICAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsNCiAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgcGFyZW50OiB7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgIHJldHVybiBvLnBhcmVudA0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxhYmxlOiB7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIHJldHVybiBvLnNjcm9sbGFibGUNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1BsYWNlOiB7DQogICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvLmF1dG9QbGFjZQ0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uVG9wOiB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvLmNsb3NlT25Ub3AN%0ACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlc2V0%0AOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkg%0Aew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLnBhcmVu%0AdCA/IG4uZ2V0Um9vdCgpLnByZXNldCA6IG8ubG9hZC5wcmVzZXQNCiAgICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICBzZXQ6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBuLnBhcmVudCA/IG4uZ2V0Um9vdCgpLnByZXNldCA9IGUgOiBvLmxvYWQucHJlc2V0ID0g%0AZSwgRSh0aGlzKSwgbi5yZXZlcnQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICB3aWR0aDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICByZXR1cm4gby53aWR0aA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24o%0AZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8ud2lkdGggPSBl%0ALCB3KG4sIGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIG5hbWU6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldDogZnVu%0AY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu%0AIG8ubmFtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZSkgew0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8ubmFtZSA9IGUsIHMgJiYgKHMuaW5uZXJI%0AVE1MID0gby5uYW1lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBjbG9zZWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdl%0AdDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AcmV0dXJuIG8uY2xvc2VkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih0KSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5jbG9zZWQgPSB0LCBvLmNs%0Ab3NlZCA/IFguYWRkQ2xhc3Mobi5fX3VsLCBlLkNMQVNTX0NMT1NFRCkgOiBYLnJlbW92ZUNsYXNz%0AKG4uX191bCwgZS5DTEFTU19DTE9TRUQpLCB0aGlzLm9uUmVzaXplKCksIG4uX19jbG9zZUJ1dHRv%0AbiAmJiAobi5fX2Nsb3NlQnV0dG9uLmlubmVySFRNTCA9IHQgPyBlLlRFWFRfT1BFTiA6IGUuVEVY%0AVF9DTE9TRUQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgIGxvYWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldDogZnVu%0AY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu%0AIG8ubG9hZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICB1c2VMb2NhbFN0b3JhZ2U6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AIGdldDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgcmV0dXJuIGkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGUpIHsNCiAgICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZSAmJiAoaSA9IGUsIGUgPyBYLmJp%0AbmQod2luZG93LCAidW5sb2FkIiwgcikgOiBYLnVuYmluZCh3aW5kb3csICJ1bmxvYWQiLCByKSwg%0AbG9jYWxTdG9yYWdlLnNldEl0ZW0obShuLCAiaXNMb2NhbCIpLCBlKSkNCiAgICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg%0AfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBTLmlzVW5kZWZpbmVkKG8ucGFyZW50%0AKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLmNsb3NlZCA9ICExLCBYLmFk%0AZENsYXNzKHRoaXMuZG9tRWxlbWVudCwgZS5DTEFTU19NQUlOKSwgWC5tYWtlU2VsZWN0YWJsZSh0%0AaGlzLmRvbUVsZW1lbnQsICExKSwgYWUgJiYgaSkgew0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICBuLnVzZUxvY2FsU3RvcmFnZSA9ICEwOw0KICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgICB2YXIgYSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKG0odGhpcywgImd1aSIpKTsNCiAg%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSAmJiAoby5sb2FkID0gSlNPTi5wYXJzZShh%0AKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgdGhpcy5fX2Nsb3NlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iiks%0AIHRoaXMuX19jbG9zZUJ1dHRvbi5pbm5lckhUTUwgPSBlLlRFWFRfQ0xPU0VELCBYLmFkZENsYXNz%0AKHRoaXMuX19jbG9zZUJ1dHRvbiwgZS5DTEFTU19DTE9TRV9CVVRUT04pLCBvLmNsb3NlT25Ub3Ag%0APyAoWC5hZGRDbGFzcyh0aGlzLl9fY2xvc2VCdXR0b24sIGUuQ0xBU1NfQ0xPU0VfVE9QKSwgdGhp%0Acy5kb21FbGVtZW50Lmluc2VydEJlZm9yZSh0aGlzLl9fY2xvc2VCdXR0b24sIHRoaXMuZG9tRWxl%0AbWVudC5jaGlsZE5vZGVzWzBdKSkgOiAoWC5hZGRDbGFzcyh0aGlzLl9fY2xvc2VCdXR0b24sIGUu%0AQ0xBU1NfQ0xPU0VfQk9UVE9NKSwgdGhpcy5kb21FbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX19j%0AbG9zZUJ1dHRvbikpLCBYLmJpbmQodGhpcy5fX2Nsb3NlQnV0dG9uLCAiY2xpY2siLCBmdW5jdGlv%0AbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5jbG9zZWQgPSAhbi5jbG9z%0AZWQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAg%0AICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IG8uY2xv%0Ac2VkICYmIChvLmNsb3NlZCA9ICEwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIg%0AbCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG8ubmFtZSk7DQogICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgWC5hZGRDbGFzcyhsLCAiY29udHJvbGxlci1uYW1lIiksIHMgPSBjKG4sIGwpOw0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIFguYWRkQ2xhc3ModGhpcy5fX3VsLCBlLkNMQVNT%0AX0NMT1NFRCksIFguYWRkQ2xhc3MocywgInRpdGxlIiksIFguYmluZChzLCAiY2xpY2siLCBmdW5j%0AdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLnByZXZl%0AbnREZWZhdWx0KCksIG4uY2xvc2VkID0gIW4uY2xvc2VkLCAhMQ0KICAgICAgICAgICAgICAgICAg%0AICAgICAgICAgIH0pLCBvLmNsb3NlZCB8fCAodGhpcy5jbG9zZWQgPSAhMSkNCiAgICAgICAgICAg%0AICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIG8uYXV0b1BsYWNlICYmIChT%0ALmlzVW5kZWZpbmVkKG8ucGFyZW50KSAmJiAoZGUgJiYgKGNlID0gZG9jdW1lbnQuY3JlYXRlRWxl%0AbWVudCgiZGl2IiksIFguYWRkQ2xhc3MoY2UsICJkZyIpLCBYLmFkZENsYXNzKGNlLCBlLkNMQVNT%0AX0FVVE9fUExBQ0VfQ09OVEFJTkVSKSwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjZSksIGRl%0AID0gITEpLCBjZS5hcHBlbmRDaGlsZCh0aGlzLmRvbUVsZW1lbnQpLCBYLmFkZENsYXNzKHRoaXMu%0AZG9tRWxlbWVudCwgZS5DTEFTU19BVVRPX1BMQUNFKSksIHRoaXMucGFyZW50IHx8IHcobiwgby53%0AaWR0aCkpLCB0aGlzLl9fcmVzaXplSGFuZGxlciA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIG4ub25SZXNpemVEZWJvdW5jZWQoKQ0KICAgICAgICAgICAgICAgICAg%0AICAgICAgfSwgWC5iaW5kKHdpbmRvdywgInJlc2l6ZSIsIHRoaXMuX19yZXNpemVIYW5kbGVyKSwg%0AWC5iaW5kKHRoaXMuX191bCwgIndlYmtpdFRyYW5zaXRpb25FbmQiLCB0aGlzLl9fcmVzaXplSGFu%0AZGxlciksIFguYmluZCh0aGlzLl9fdWwsICJ0cmFuc2l0aW9uZW5kIiwgdGhpcy5fX3Jlc2l6ZUhh%0AbmRsZXIpLCBYLmJpbmQodGhpcy5fX3VsLCAib1RyYW5zaXRpb25FbmQiLCB0aGlzLl9fcmVzaXpl%0ASGFuZGxlciksIHRoaXMub25SZXNpemUoKSwgby5yZXNpemFibGUgJiYgeSh0aGlzKSwgciA9IGZ1%0AbmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFlICYmICJ0cnVlIiA9PT0g%0AbG9jYWxTdG9yYWdlLmdldEl0ZW0obShuLCAiaXNMb2NhbCIpKSAmJiBsb2NhbFN0b3JhZ2Uuc2V0%0ASXRlbShtKG4sICJndWkiKSwgSlNPTi5zdHJpbmdpZnkobi5nZXRTYXZlT2JqZWN0KCkpKQ0KICAg%0AICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5zYXZlVG9Mb2NhbFN0b3JhZ2VJZlBvc3NpYmxl%0AID0gciwgby5wYXJlbnQgfHwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgdmFyIGUgPSBuLmdldFJvb3QoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLndp%0AZHRoICs9IDEsIFMuZGVmZXIoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgIGUud2lkdGggLT0gMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAg%0AICAgICAgICAgICAgICAgICAgICB9KCkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAg%0AICAgICAgICBoZS50b2dnbGVIaWRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAg%0AIHVlID0gIXVlLCBTLmVhY2goX2UsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIGUuZG9tRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gdWUgPyAibm9uZSIgOiAiIg0KICAgICAg%0AICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0sIGhlLkNMQVNTX0FVVE9fUExBQ0Ug%0APSAiYSIsIGhlLkNMQVNTX0FVVE9fUExBQ0VfQ09OVEFJTkVSID0gImFjIiwgaGUuQ0xBU1NfTUFJ%0ATiA9ICJtYWluIiwgaGUuQ0xBU1NfQ09OVFJPTExFUl9ST1cgPSAiY3IiLCBoZS5DTEFTU19UT09f%0AVEFMTCA9ICJ0YWxsZXItdGhhbi13aW5kb3ciLCBoZS5DTEFTU19DTE9TRUQgPSAiY2xvc2VkIiwg%0AaGUuQ0xBU1NfQ0xPU0VfQlVUVE9OID0gImNsb3NlLWJ1dHRvbiIsIGhlLkNMQVNTX0NMT1NFX1RP%0AUCA9ICJjbG9zZS10b3AiLCBoZS5DTEFTU19DTE9TRV9CT1RUT00gPSAiY2xvc2UtYm90dG9tIiwg%0AaGUuQ0xBU1NfRFJBRyA9ICJkcmFnIiwgaGUuREVGQVVMVF9XSURUSCA9IDI0NSwgaGUuVEVYVF9D%0ATE9TRUQgPSAiQ2xvc2UgQ29udHJvbHMiLCBoZS5URVhUX09QRU4gPSAiT3BlbiBDb250cm9scyIs%0AIGhlLl9rZXlkb3duSGFuZGxlciA9IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAg%0AInRleHQiID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50LnR5cGUgfHwgNzIgIT09IGUud2hpY2gg%0AJiYgNzIgIT09IGUua2V5Q29kZSB8fCBoZS50b2dnbGVIaWRlKCkNCiAgICAgICAgICAgICAgICB9%0ALCBYLmJpbmQod2luZG93LCAia2V5ZG93biIsIGhlLl9rZXlkb3duSGFuZGxlciwgITEpLCBTLmV4%0AdGVuZChoZS5wcm90b3R5cGUsIHsNCiAgICAgICAgICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihl%0ALCB0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZih0aGlzLCBlLCB0LCB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjdG9yeUFyZ3M6IEFycmF5LnByb3RvdHlwZS5z%0AbGljZS5jYWxsKGFyZ3VtZW50cywgMikNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAg%0AICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGFkZENvbG9yOiBmdW5jdGlv%0AbihlLCB0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZih0aGlzLCBlLCB0LCB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICEwDQogICAgICAgICAgICAgICAg%0AICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBy%0AZW1vdmU6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX191bC5y%0AZW1vdmVDaGlsZChlLl9fbGkpLCB0aGlzLl9fY29udHJvbGxlcnMuc3BsaWNlKHRoaXMuX19jb250%0Acm9sbGVycy5pbmRleE9mKGUpLCAxKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0g%0AdGhpczsNCiAgICAgICAgICAgICAgICAgICAgICAgIFMuZGVmZXIoZnVuY3Rpb24oKSB7DQogICAg%0AICAgICAgICAgICAgICAgICAgICAgICAgdC5vblJlc2l6ZSgpDQogICAgICAgICAgICAgICAgICAg%0AICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBkZXN0%0Acm95OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcmVu%0AdCkgdGhyb3cgbmV3IEVycm9yKCJPbmx5IHRoZSByb290IEdVSSBzaG91bGQgYmUgcmVtb3ZlZCB3%0AaXRoIC5kZXN0cm95KCkuIEZvciBzdWJmb2xkZXJzLCB1c2UgZ3VpLnJlbW92ZUZvbGRlcihmb2xk%0AZXIpIGluc3RlYWQuIik7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dG9QbGFjZSAm%0AJiBjZS5yZW1vdmVDaGlsZCh0aGlzLmRvbUVsZW1lbnQpOw0KICAgICAgICAgICAgICAgICAgICAg%0AICAgdmFyIGUgPSB0aGlzOw0KICAgICAgICAgICAgICAgICAgICAgICAgUy5lYWNoKHRoaXMuX19m%0Ab2xkZXJzLCBmdW5jdGlvbih0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5yZW1v%0AdmVGb2xkZXIodCkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBYLnVuYmluZCh3aW5kb3cs%0AICJrZXlkb3duIiwgaGUuX2tleWRvd25IYW5kbGVyLCAhMSksIHUodGhpcykNCiAgICAgICAgICAg%0AICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgYWRkRm9sZGVyOiBmdW5jdGlvbihlKSB7%0ADQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSB0aGlzLl9fZm9sZGVyc1tl%0AXSkgdGhyb3cgbmV3IEVycm9yKCdZb3UgYWxyZWFkeSBoYXZlIGEgZm9sZGVyIGluIHRoaXMgR1VJ%0AIGJ5IHRoZSBuYW1lICInICsgZSArICciJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIg%0AdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBlLA0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHBhcmVudDogdGhpcw0KICAgICAgICAgICAgICAgICAgICAgICAgfTsN%0ACiAgICAgICAgICAgICAgICAgICAgICAgIHQuYXV0b1BsYWNlID0gdGhpcy5hdXRvUGxhY2UsIHRo%0AaXMubG9hZCAmJiB0aGlzLmxvYWQuZm9sZGVycyAmJiB0aGlzLmxvYWQuZm9sZGVyc1tlXSAmJiAo%0AdC5jbG9zZWQgPSB0aGlzLmxvYWQuZm9sZGVyc1tlXS5jbG9zZWQsIHQubG9hZCA9IHRoaXMubG9h%0AZC5mb2xkZXJzW2VdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbmV3IGhlKHQp%0AOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2ZvbGRlcnNbZV0gPSBuOw0KICAgICAg%0AICAgICAgICAgICAgICAgICAgdmFyIG8gPSBjKHRoaXMsIG4uZG9tRWxlbWVudCk7DQogICAgICAg%0AICAgICAgICAgICAgICAgICByZXR1cm4gWC5hZGRDbGFzcyhvLCAiZm9sZGVyIiksIG4NCiAgICAg%0AICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRm9sZGVyOiBmdW5j%0AdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9fdWwucmVtb3ZlQ2hpbGQo%0AZS5kb21FbGVtZW50LnBhcmVudEVsZW1lbnQpLCBkZWxldGUgdGhpcy5fX2ZvbGRlcnNbZS5uYW1l%0AXSwgdGhpcy5sb2FkICYmIHRoaXMubG9hZC5mb2xkZXJzICYmIHRoaXMubG9hZC5mb2xkZXJzW2Uu%0AbmFtZV0gJiYgZGVsZXRlIHRoaXMubG9hZC5mb2xkZXJzW2UubmFtZV0sIHUoZSk7DQogICAgICAg%0AICAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXM7DQogICAgICAgICAgICAgICAgICAgICAgICBT%0ALmVhY2goZS5fX2ZvbGRlcnMsIGZ1bmN0aW9uKHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AICAgICBlLnJlbW92ZUZvbGRlcih0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSksIFMuZGVm%0AZXIoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5vblJlc2l6ZSgp%0ADQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAg%0AICAgICAgICAgICAgICAgICBvcGVuOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIHRoaXMuY2xvc2VkID0gITENCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAg%0AICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhp%0Acy5jbG9zZWQgPSAhMA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAg%0AICBvblJlc2l6ZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9%0AIHRoaXMuZ2V0Um9vdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuc2Nyb2xsYWJs%0AZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gWC5nZXRPZmZzZXQoZS5f%0AX3VsKS50b3AsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSAwOw0KICAgICAg%0AICAgICAgICAgICAgICAgICAgICAgIFMuZWFjaChlLl9fdWwuY2hpbGROb2RlcywgZnVuY3Rpb24o%0AdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmF1dG9QbGFjZSAmJiB0ID09%0APSBlLl9fc2F2ZV9yb3cgfHwgKG4gKz0gWC5nZXRIZWlnaHQodCkpDQogICAgICAgICAgICAgICAg%0AICAgICAgICAgICAgfSksIHdpbmRvdy5pbm5lckhlaWdodCAtIHQgLSAyMCA8IG4gPyAoWC5hZGRD%0AbGFzcyhlLmRvbUVsZW1lbnQsIGhlLkNMQVNTX1RPT19UQUxMKSwgZS5fX3VsLnN0eWxlLmhlaWdo%0AdCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIHQgLSAyMCArICJweCIpIDogKFgucmVtb3ZlQ2xhc3Mo%0AZS5kb21FbGVtZW50LCBoZS5DTEFTU19UT09fVEFMTCksIGUuX191bC5zdHlsZS5oZWlnaHQgPSAi%0AYXV0byIpDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAg%0AICBlLl9fcmVzaXplX2hhbmRsZSAmJiBTLmRlZmVyKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIGUuX19yZXNpemVfaGFuZGxlLnN0eWxlLmhlaWdodCA9IGUuX191bC5v%0AZmZzZXRIZWlnaHQgKyAicHgiDQogICAgICAgICAgICAgICAgICAgICAgICB9KSwgZS5fX2Nsb3Nl%0AQnV0dG9uICYmIChlLl9fY2xvc2VCdXR0b24uc3R5bGUud2lkdGggPSBlLndpZHRoICsgInB4IikN%0ACiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgb25SZXNpemVEZWJv%0AdW5jZWQ6IFMuZGVib3VuY2UoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0%0AaGlzLm9uUmVzaXplKCkNCiAgICAgICAgICAgICAgICAgICAgfSwgNTApLA0KICAgICAgICAgICAg%0AICAgICAgICByZW1lbWJlcjogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBp%0AZiAoUy5pc1VuZGVmaW5lZChsZSkgJiYgKChsZSA9IG5ldyBpZSkuZG9tRWxlbWVudC5pbm5lckhU%0ATUwgPSAnPGRpdiBpZD0iZGctc2F2ZSIgY2xhc3M9ImRnIGRpYWxvZ3VlIj5cblxuICBIZXJlXCdz%0AIHRoZSBuZXcgbG9hZCBwYXJhbWV0ZXIgZm9yIHlvdXIgPGNvZGU+R1VJPC9jb2RlPlwncyBjb25z%0AdHJ1Y3RvcjpcblxuICA8dGV4dGFyZWEgaWQ9ImRnLW5ldy1jb25zdHJ1Y3RvciI+PC90ZXh0YXJl%0AYT5cblxuICA8ZGl2IGlkPSJkZy1zYXZlLWxvY2FsbHkiPlxuXG4gICAgPGlucHV0IGlkPSJkZy1s%0Ab2NhbC1zdG9yYWdlIiB0eXBlPSJjaGVja2JveCIvPiBBdXRvbWF0aWNhbGx5IHNhdmVcbiAgICB2%0AYWx1ZXMgdG8gPGNvZGU+bG9jYWxTdG9yYWdlPC9jb2RlPiBvbiBleGl0LlxuXG4gICAgPGRpdiBp%0AZD0iZGctbG9jYWwtZXhwbGFpbiI+VGhlIHZhbHVlcyBzYXZlZCB0byA8Y29kZT5sb2NhbFN0b3Jh%0AZ2U8L2NvZGU+IHdpbGxcbiAgICAgIG92ZXJyaWRlIHRob3NlIHBhc3NlZCB0byA8Y29kZT5kYXQu%0AR1VJPC9jb2RlPlwncyBjb25zdHJ1Y3Rvci4gVGhpcyBtYWtlcyBpdFxuICAgICAgZWFzaWVyIHRv%0AIHdvcmsgaW5jcmVtZW50YWxseSwgYnV0IDxjb2RlPmxvY2FsU3RvcmFnZTwvY29kZT4gaXMgZnJh%0AZ2lsZSxcbiAgICAgIGFuZCB5b3VyIGZyaWVuZHMgbWF5IG5vdCBzZWUgdGhlIHNhbWUgdmFsdWVz%0AIHlvdSBkby5cblxuICAgIDwvZGl2PlxuXG4gIDwvZGl2PlxuXG48L2Rpdj4nKSwgdGhpcy5wYXJl%0AbnQpIHRocm93IG5ldyBFcnJvcigiWW91IGNhbiBvbmx5IGNhbGwgcmVtZW1iZXIgb24gYSB0b3Ag%0AbGV2ZWwgR1VJLiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzOw0KICAg%0AICAgICAgICAgICAgICAgICAgICAgUy5lYWNoKEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFy%0AZ3VtZW50cyksIGZ1bmN0aW9uKHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwID09%0APSBlLl9fcmVtZW1iZXJlZE9iamVjdHMubGVuZ3RoICYmIHYoZSksIC0xID09PSBlLl9fcmVtZW1i%0AZXJlZE9iamVjdHMuaW5kZXhPZih0KSAmJiBlLl9fcmVtZW1iZXJlZE9iamVjdHMucHVzaCh0KQ0K%0AICAgICAgICAgICAgICAgICAgICAgICAgfSksIHRoaXMuYXV0b1BsYWNlICYmIHcodGhpcywgdGhp%0Acy53aWR0aCkNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZ2V0%0AUm9vdDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBlID0g%0AdGhpczsgZS5wYXJlbnQ7KSBlID0gZS5wYXJlbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICBy%0AZXR1cm4gZQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBnZXRT%0AYXZlT2JqZWN0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0g%0AdGhpcy5sb2FkOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuY2xvc2VkID0gdGhp%0Acy5jbG9zZWQsIHRoaXMuX19yZW1lbWJlcmVkT2JqZWN0cy5sZW5ndGggPiAwICYmIChlLnByZXNl%0AdCA9IHRoaXMucHJlc2V0LCBlLnJlbWVtYmVyZWQgfHwgKGUucmVtZW1iZXJlZCA9IHt9KSwgZS5y%0AZW1lbWJlcmVkW3RoaXMucHJlc2V0XSA9IHgodGhpcykpLCBlLmZvbGRlcnMgPSB7fSwgUy5lYWNo%0AKHRoaXMuX19mb2xkZXJzLCBmdW5jdGlvbih0LCBuKSB7DQogICAgICAgICAgICAgICAgICAgICAg%0AICAgICAgZS5mb2xkZXJzW25dID0gdC5nZXRTYXZlT2JqZWN0KCkNCiAgICAgICAgICAgICAgICAg%0AICAgICAgIH0pLCBlDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAg%0AIHNhdmU6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkLnJl%0AbWVtYmVyZWQgfHwgKHRoaXMubG9hZC5yZW1lbWJlcmVkID0ge30pLCB0aGlzLmxvYWQucmVtZW1i%0AZXJlZFt0aGlzLnByZXNldF0gPSB4KHRoaXMpLCBfKHRoaXMsICExKSwgdGhpcy5zYXZlVG9Mb2Nh%0AbFN0b3JhZ2VJZlBvc3NpYmxlKCkNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAg%0AICAgICAgICAgc2F2ZUFzOiBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0%0AaGlzLmxvYWQucmVtZW1iZXJlZCB8fCAodGhpcy5sb2FkLnJlbWVtYmVyZWQgPSB7fSwgdGhpcy5s%0Ab2FkLnJlbWVtYmVyZWRbc2VdID0geCh0aGlzLCAhMCkpLCB0aGlzLmxvYWQucmVtZW1iZXJlZFtl%0AXSA9IHgodGhpcyksIHRoaXMucHJlc2V0ID0gZSwgZyh0aGlzLCBlLCAhMCksIHRoaXMuc2F2ZVRv%0ATG9jYWxTdG9yYWdlSWZQb3NzaWJsZSgpDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAg%0AICAgICAgICAgICAgIHJldmVydDogZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgICAgICAg%0AICAgUy5lYWNoKHRoaXMuX19jb250cm9sbGVycywgZnVuY3Rpb24odCkgew0KICAgICAgICAgICAg%0AICAgICAgICAgICAgICAgIHRoaXMuZ2V0Um9vdCgpLmxvYWQucmVtZW1iZXJlZCA/IHAoZSB8fCB0%0AaGlzLmdldFJvb3QoKSwgdCkgOiB0LnNldFZhbHVlKHQuaW5pdGlhbFZhbHVlKSwgdC5fX29uRmlu%0AaXNoQ2hhbmdlICYmIHQuX19vbkZpbmlzaENoYW5nZS5jYWxsKHQsIHQuZ2V0VmFsdWUoKSkNCiAg%0AICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBTLmVhY2godGhpcy5fX2ZvbGRlcnMsIGZ1%0AbmN0aW9uKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnJldmVydChlKQ0KICAg%0AICAgICAgICAgICAgICAgICAgICAgfSksIGUgfHwgXyh0aGlzLmdldFJvb3QoKSwgITEpDQogICAg%0AICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24o%0AZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSAwID09PSB0aGlzLl9fbGlzdGVu%0AaW5nLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX19saXN0ZW5pbmcucHVz%0AaChlKSwgdCAmJiBDKHRoaXMuX19saXN0ZW5pbmcpDQogICAgICAgICAgICAgICAgICAgIH0sDQog%0AICAgICAgICAgICAgICAgICAgIHVwZGF0ZURpc3BsYXk6IGZ1bmN0aW9uKCkgew0KICAgICAgICAg%0AICAgICAgICAgICAgICAgUy5lYWNoKHRoaXMuX19jb250cm9sbGVycywgZnVuY3Rpb24oZSkgew0K%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUudXBkYXRlRGlzcGxheSgpDQogICAgICAgICAg%0AICAgICAgICAgICAgICB9KSwgUy5lYWNoKHRoaXMuX19mb2xkZXJzLCBmdW5jdGlvbihlKSB7DQog%0AICAgICAgICAgICAgICAgICAgICAgICAgICAgZS51cGRhdGVEaXNwbGF5KCkNCiAgICAgICAgICAg%0AICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9%0AKTsNCiAgICAgICAgICAgICAgICB2YXIgcGUgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBD%0Ab2xvcjogSSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGg6IE4sDQogICAgICAgICAgICAg%0AICAgICAgICAgICBpbnRlcnByZXQ6IFINCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAg%0AICAgICAgICAgICAgZmUgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBDb250cm9sbGVyOiB6%0ALA0KICAgICAgICAgICAgICAgICAgICAgICAgQm9vbGVhbkNvbnRyb2xsZXI6IEssDQogICAgICAg%0AICAgICAgICAgICAgICAgICBPcHRpb25Db250cm9sbGVyOiBZLA0KICAgICAgICAgICAgICAgICAg%0AICAgICAgU3RyaW5nQ29udHJvbGxlcjogSiwNCiAgICAgICAgICAgICAgICAgICAgICAgIE51bWJl%0AckNvbnRyb2xsZXI6IFcsDQogICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJDb250cm9sbGVy%0AQm94OiBRLA0KICAgICAgICAgICAgICAgICAgICAgICAgTnVtYmVyQ29udHJvbGxlclNsaWRlcjog%0AcSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEZ1bmN0aW9uQ29udHJvbGxlcjogWiwNCiAgICAg%0AICAgICAgICAgICAgICAgICAgIENvbG9yQ29udHJvbGxlcjogJA0KICAgICAgICAgICAgICAgICAg%0AICB9LA0KICAgICAgICAgICAgICAgICAgICBtZSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAg%0AIGRvbTogWA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBnZSA9%0AIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEdVSTogaGUNCiAgICAgICAgICAgICAgICAgICAg%0AfSwNCiAgICAgICAgICAgICAgICAgICAgYmUgPSBoZSwNCiAgICAgICAgICAgICAgICAgICAgdmUg%0APSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogcGUsDQogICAgICAgICAgICAgICAg%0AICAgICAgICBjb250cm9sbGVyczogZmUsDQogICAgICAgICAgICAgICAgICAgICAgICBkb206IG1l%0ALA0KICAgICAgICAgICAgICAgICAgICAgICAgZ3VpOiBnZSwNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIEdVSTogYmUNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBlLmNv%0AbG9yID0gcGUsIGUuY29udHJvbGxlcnMgPSBmZSwgZS5kb20gPSBtZSwgZS5ndWkgPSBnZSwgZS5H%0AVUkgPSBiZSwgZS5kZWZhdWx0ID0gdmUsIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCAiX19lc01v%0AZHVsZSIsIHsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICEwDQogICAgICAgICAgICAgICAg%0AfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgPC9zY3JpcHQ+DQoNCiAgICA8c3R5%0AbGU+DQogICAgICAgIEBmb250LWZhY2Ugew0KICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdpY29u%0AZm9udCc7DQogICAgICAgICAgICBzcmM6IHVybCgnaWNvbmZvbnQudHRmJykgZm9ybWF0KCd0cnVl%0AdHlwZScpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAqIHsNCiAgICAgICAgICAgIHVz%0AZXItc2VsZWN0OiBub25lOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBodG1sLA0KICAg%0AICAgICBib2R5IHsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICBi%0AYWNrZ3JvdW5kLWNvbG9yOiAjMDAwOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBib2R5%0AIHsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsN%0ACiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAg%0AICAgICB9DQogICAgICAgIA0KICAgICAgICBjYW52YXMgew0KICAgICAgICAgICAgd2lkdGg6IDEw%0AMCU7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgIH0NCiAgICAgICAgDQogICAg%0AICAgIC5kZyB7DQogICAgICAgICAgICBtYXJnaW4tbGVmdDogMHB4Ow0KICAgICAgICAgICAgb3Bh%0AY2l0eTogMC45Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAuZGcgLnByb3BlcnR5LW5h%0AbWUgew0KICAgICAgICAgICAgb3ZlcmZsb3c6IHZpc2libGU7DQogICAgICAgIH0NCiAgICAgICAg%0ADQogICAgICAgIC5iaWdGb250IHsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTUwJTsNCiAgICAg%0AICAgICAgIGNvbG9yOiAjOEM4QzhDOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAuY3Iu%0AZnVuY3Rpb24uYXBwQmlnRm9udCB7DQogICAgICAgICAgICBmb250LXNpemU6IDE1MCU7DQogICAg%0AICAgICAgICBsaW5lLWhlaWdodDogMjdweDsNCiAgICAgICAgICAgIGNvbG9yOiAjQTVGOEQzOw0K%0AICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzAyM0M0MDsNCiAgICAgICAgfQ0KICAgICAg%0AICANCiAgICAgICAgLmNyLmZ1bmN0aW9uLmFwcEJpZ0ZvbnQgLnByb3BlcnR5LW5hbWUgew0KICAg%0AICAgICAgICAgZmxvYXQ6IG5vbmU7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC5jci5m%0AdW5jdGlvbi5hcHBCaWdGb250IC5pY29uIHsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBzdGlja3k7%0ADQogICAgICAgICAgICBib3R0b206IDI3cHg7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAg%0AIC5pY29uIHsNCiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnaWNvbmZvbnQnOw0KICAgICAgICAg%0AICAgZm9udC1zaXplOiAxMzAlOw0KICAgICAgICAgICAgZmxvYXQ6IHJpZ2h0Ow0KICAgICAgICB9%0ADQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCg0KPGJvZHk+DQogICAgPGNhbnZhcz48L2NhbnZhcz4N%0ACiAgICA8c2NyaXB0Pg0KICAgICAgICBpZiAoaXNNb2JpbGUoKSkgew0KICAgICAgICAgICAgc2V0%0AVGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgcHJvbW9Qb3B1cC5zdHlsZS5kaXNwbGF5%0AID0gJ3RhYmxlJzsNCiAgICAgICAgICAgIH0sIDIwMDAwKTsNCiAgICAgICAgfQ0KDQogICAgICAg%0AIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjYW52YXMnKVsw%0AXTsNCiAgICAgICAgcmVzaXplQ2FudmFzKCk7DQogICAgICAgIGxldCBjb25maWcgPSB7ClNJTV9S%0ARVNPTFVUSU9OOiAyNTUsCkRZRV9SRVNPTFVUSU9OOiAxMDI0LApERU5TSVRZX0RJU1NJUEFUSU9O%0AOiAzLjAzLApWRUxPQ0lUWV9ESVNTSVBBVElPTjogMC4yMSwKUFJFU1NVUkU6IDAuNzcyMjA4NzU3%0ANTkyNDYyMywKUFJFU1NVUkVfSVRFUkFUSU9OUzogMjAsCkNVUkw6IDI4LApTUExBVF9SQURJVVM6%0AIDAuMzkyODMxNTYwODcyODgyNCwKU1BMQVRfRk9SQ0U6IDYwMDAsClNIQURJTkc6IHRydWUsCkNP%0ATE9SRlVMOiB0cnVlLApDT0xPUl9VUERBVEVfU1BFRUQ6IDEwLApQQVVTRUQ6IGZhbHNlLApTSU5H%0ATEVfQ09MT1I6IGZhbHNlLApCUlVTSF9DT0xPUjogewpyOjAuMTY4NDc3NTg1NjE3Njc1MjYsCmc6%0AMC4yNDQxNDAxMjI4OTc5ODgyNSwKYjowLjIzMTcwMzkxNTA0MjY2NDgzLAp9LApCQUNLX0NPTE9S%0AOiB7CnI6IDAsCmc6IDAsCmI6IDAsCn0sClRSQU5TUEFSRU5UOiBmYWxzZSwKQkxPT006IGZhbHNl%0ALApCTE9PTV9JVEVSQVRJT05TOiA4LApCTE9PTV9SRVNPTFVUSU9OOiAyNTYsCkJMT09NX0lOVEVO%0AU0lUWTogMC41OTc4MTI2NTMzMzE5MzAxLApCTE9PTV9USFJFU0hPTEQ6IDAuNzQ0OTE4NTgyMzc2%0ANTIwNCwKQkxPT01fU09GVF9LTkVFOiAwLjcsClNVTlJBWVM6IGZhbHNlLApTVU5SQVlTX1JFU09M%0AVVRJT046IDE5NiwKU1VOUkFZU19XRUlHSFQ6IDAuNzY4NDQwMzQyODY2MDg5MywKfQ0KDQoNCiAg%0AICAgICAgZnVuY3Rpb24gcG9pbnRlclByb3RvdHlwZSgpIHsNCiAgICAgICAgICAgIHRoaXMuaWQg%0APSAtMTsNCiAgICAgICAgICAgIHRoaXMudGV4Y29vcmRYID0gMDsNCiAgICAgICAgICAgIHRoaXMu%0AdGV4Y29vcmRZID0gMDsNCiAgICAgICAgICAgIHRoaXMucHJldlRleGNvb3JkWCA9IDA7DQogICAg%0AICAgICAgICB0aGlzLnByZXZUZXhjb29yZFkgPSAwOw0KICAgICAgICAgICAgdGhpcy5kZWx0YVgg%0APSAwOw0KICAgICAgICAgICAgdGhpcy5kZWx0YVkgPSAwOw0KICAgICAgICAgICAgdGhpcy5kb3du%0AID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLm1vdmVkID0gZmFsc2U7DQogICAgICAgICAgICB0%0AaGlzLmNvbG9yID0gWzMwLCAwLCAzMDBdOw0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IHBvaW50%0AZXJzID0gW107DQogICAgICAgIGxldCBzcGxhdFN0YWNrID0gW107DQogICAgICAgIHBvaW50ZXJz%0ALnB1c2gobmV3IHBvaW50ZXJQcm90b3R5cGUoKSk7DQoNCiAgICAgICAgY29uc3Qgew0KICAgICAg%0AICAgICAgZ2wsDQogICAgICAgICAgICBleHQNCiAgICAgICAgfSA9IGdldFdlYkdMQ29udGV4dChj%0AYW52YXMpOw0KDQogICAgICAgIGlmIChpc01vYmlsZSgpKSB7DQogICAgICAgICAgICBjb25maWcu%0ARFlFX1JFU09MVVRJT04gPSA1MTI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFleHQuc3VwcG9y%0AdExpbmVhckZpbHRlcmluZykgew0KICAgICAgICAgICAgY29uZmlnLkRZRV9SRVNPTFVUSU9OID0g%0ANTEyOw0KICAgICAgICAgICAgY29uZmlnLlNIQURJTkcgPSBmYWxzZTsNCiAgICAgICAgICAgIGNv%0AbmZpZy5CTE9PTSA9IGZhbHNlOw0KICAgICAgICAgICAgY29uZmlnLlNVTlJBWVMgPSBmYWxzZTsN%0ACiAgICAgICAgfQ0KDQoNCg0KICAgICAgICBmdW5jdGlvbiBnZXRXZWJHTENvbnRleHQoY2FudmFz%0AKSB7DQogICAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7DQogICAgICAgICAgICAgICAgYWxwaGE6%0AIHRydWUsDQogICAgICAgICAgICAgICAgZGVwdGg6IGZhbHNlLA0KICAgICAgICAgICAgICAgIHN0%0AZW5jaWw6IGZhbHNlLA0KICAgICAgICAgICAgICAgIGFudGlhbGlhczogZmFsc2UsDQogICAgICAg%0AICAgICAgICAgcHJlc2VydmVEcmF3aW5nQnVmZmVyOiBmYWxzZQ0KICAgICAgICAgICAgfTsNCg0K%0AICAgICAgICAgICAgbGV0IGdsID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsMicsIHBhcmFtcyk7%0ADQogICAgICAgICAgICBjb25zdCBpc1dlYkdMMiA9ICEhZ2w7DQogICAgICAgICAgICBpZiAoIWlz%0AV2ViR0wyKQ0KICAgICAgICAgICAgICAgIGdsID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJywg%0AcGFyYW1zKSB8fCBjYW52YXMuZ2V0Q29udGV4dCgnZXhwZXJpbWVudGFsLXdlYmdsJywgcGFyYW1z%0AKTsNCg0KICAgICAgICAgICAgbGV0IGhhbGZGbG9hdDsNCiAgICAgICAgICAgIGxldCBzdXBwb3J0%0ATGluZWFyRmlsdGVyaW5nOw0KICAgICAgICAgICAgaWYgKGlzV2ViR0wyKSB7DQogICAgICAgICAg%0AICAgICAgZ2wuZ2V0RXh0ZW5zaW9uKCdFWFRfY29sb3JfYnVmZmVyX2Zsb2F0Jyk7DQogICAgICAg%0AICAgICAgICAgc3VwcG9ydExpbmVhckZpbHRlcmluZyA9IGdsLmdldEV4dGVuc2lvbignT0VTX3Rl%0AeHR1cmVfZmxvYXRfbGluZWFyJyk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAg%0AICAgIGhhbGZGbG9hdCA9IGdsLmdldEV4dGVuc2lvbignT0VTX3RleHR1cmVfaGFsZl9mbG9hdCcp%0AOw0KICAgICAgICAgICAgICAgIHN1cHBvcnRMaW5lYXJGaWx0ZXJpbmcgPSBnbC5nZXRFeHRlbnNp%0Ab24oJ09FU190ZXh0dXJlX2hhbGZfZmxvYXRfbGluZWFyJyk7DQogICAgICAgICAgICB9DQoNCiAg%0AICAgICAgICAgIGdsLmNsZWFyQ29sb3IoMC4wLCAwLjAsIDAuMCwgMS4wKTsNCg0KICAgICAgICAg%0AICAgY29uc3QgaGFsZkZsb2F0VGV4VHlwZSA9IGlzV2ViR0wyID8gZ2wuSEFMRl9GTE9BVCA6IGhh%0AbGZGbG9hdC5IQUxGX0ZMT0FUX09FUzsNCiAgICAgICAgICAgIGxldCBmb3JtYXRSR0JBOw0KICAg%0AICAgICAgICAgbGV0IGZvcm1hdFJHOw0KICAgICAgICAgICAgbGV0IGZvcm1hdFI7DQoNCiAgICAg%0AICAgICAgIGlmIChpc1dlYkdMMikgew0KICAgICAgICAgICAgICAgIGZvcm1hdFJHQkEgPSBnZXRT%0AdXBwb3J0ZWRGb3JtYXQoZ2wsIGdsLlJHQkExNkYsIGdsLlJHQkEsIGhhbGZGbG9hdFRleFR5cGUp%0AOw0KICAgICAgICAgICAgICAgIGZvcm1hdFJHID0gZ2V0U3VwcG9ydGVkRm9ybWF0KGdsLCBnbC5S%0ARzE2RiwgZ2wuUkcsIGhhbGZGbG9hdFRleFR5cGUpOw0KICAgICAgICAgICAgICAgIGZvcm1hdFIg%0APSBnZXRTdXBwb3J0ZWRGb3JtYXQoZ2wsIGdsLlIxNkYsIGdsLlJFRCwgaGFsZkZsb2F0VGV4VHlw%0AZSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZvcm1hdFJHQkEgPSBn%0AZXRTdXBwb3J0ZWRGb3JtYXQoZ2wsIGdsLlJHQkEsIGdsLlJHQkEsIGhhbGZGbG9hdFRleFR5cGUp%0AOw0KICAgICAgICAgICAgICAgIGZvcm1hdFJHID0gZ2V0U3VwcG9ydGVkRm9ybWF0KGdsLCBnbC5S%0AR0JBLCBnbC5SR0JBLCBoYWxmRmxvYXRUZXhUeXBlKTsNCiAgICAgICAgICAgICAgICBmb3JtYXRS%0AID0gZ2V0U3VwcG9ydGVkRm9ybWF0KGdsLCBnbC5SR0JBLCBnbC5SR0JBLCBoYWxmRmxvYXRUZXhU%0AeXBlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAg%0AICAgICBnbCwNCiAgICAgICAgICAgICAgICBleHQ6IHsNCiAgICAgICAgICAgICAgICAgICAgZm9y%0AbWF0UkdCQSwNCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0UkcsDQogICAgICAgICAgICAgICAg%0AICAgIGZvcm1hdFIsDQogICAgICAgICAgICAgICAgICAgIGhhbGZGbG9hdFRleFR5cGUsDQogICAg%0AICAgICAgICAgICAgICAgIHN1cHBvcnRMaW5lYXJGaWx0ZXJpbmcNCiAgICAgICAgICAgICAgICB9%0ADQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZ2V0U3VwcG9y%0AdGVkRm9ybWF0KGdsLCBpbnRlcm5hbEZvcm1hdCwgZm9ybWF0LCB0eXBlKSB7DQogICAgICAgICAg%0AICBpZiAoIXN1cHBvcnRSZW5kZXJUZXh0dXJlRm9ybWF0KGdsLCBpbnRlcm5hbEZvcm1hdCwgZm9y%0AbWF0LCB0eXBlKSkgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoaW50ZXJuYWxGb3JtYXQpIHsN%0ACiAgICAgICAgICAgICAgICAgICAgY2FzZSBnbC5SMTZGOg0KICAgICAgICAgICAgICAgICAgICAg%0AICAgcmV0dXJuIGdldFN1cHBvcnRlZEZvcm1hdChnbCwgZ2wuUkcxNkYsIGdsLlJHLCB0eXBlKTsN%0ACiAgICAgICAgICAgICAgICAgICAgY2FzZSBnbC5SRzE2RjoNCiAgICAgICAgICAgICAgICAgICAg%0AICAgIHJldHVybiBnZXRTdXBwb3J0ZWRGb3JtYXQoZ2wsIGdsLlJHQkExNkYsIGdsLlJHQkEsIHR5%0AcGUpOw0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAg%0AICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAg%0AICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGludGVybmFsRm9ybWF0LA0KICAgICAg%0AICAgICAgICAgIGZvcm1hdA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVu%0AY3Rpb24gc3VwcG9ydFJlbmRlclRleHR1cmVGb3JtYXQoZ2wsIGludGVybmFsRm9ybWF0LCBmb3Jt%0AYXQsIHR5cGUpIHsNCiAgICAgICAgICAgIGxldCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgp%0AOw0KICAgICAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZSk7DQog%0AICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlO%0AX0ZJTFRFUiwgZ2wuTkVBUkVTVCk7DQogICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRF%0AWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTkVBUkVTVCk7DQogICAgICAgICAg%0AICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5D%0ATEFNUF9UT19FREdFKTsNCiAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8y%0ARCwgZ2wuVEVYVFVSRV9XUkFQX1QsIGdsLkNMQU1QX1RPX0VER0UpOw0KICAgICAgICAgICAgZ2wu%0AdGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBpbnRlcm5hbEZvcm1hdCwgNCwgNCwgMCwgZm9y%0AbWF0LCB0eXBlLCBudWxsKTsNCg0KICAgICAgICAgICAgbGV0IGZibyA9IGdsLmNyZWF0ZUZyYW1l%0AYnVmZmVyKCk7DQogICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIs%0AIGZibyk7DQogICAgICAgICAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZF%0AUiwgZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLlRFWFRVUkVfMkQsIHRleHR1cmUsIDApOw0KDQog%0AICAgICAgICAgICBsZXQgc3RhdHVzID0gZ2wuY2hlY2tGcmFtZWJ1ZmZlclN0YXR1cyhnbC5GUkFN%0ARUJVRkZFUik7DQogICAgICAgICAgICByZXR1cm4gc3RhdHVzID09IGdsLkZSQU1FQlVGRkVSX0NP%0ATVBMRVRFOw0KICAgICAgICB9DQoNCg0KICAgICAgICBmdW5jdGlvbiBpc01vYmlsZSgpIHsNCiAg%0AICAgICAgICAgIHJldHVybiAvTW9iaXxBbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50%0AKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNsYXNzIE1hdGVyaWFsIHsNCiAgICAgICAgICAgIGNv%0AbnN0cnVjdG9yKHZlcnRleFNoYWRlciwgZnJhZ21lbnRTaGFkZXJTb3VyY2UpIHsNCiAgICAgICAg%0AICAgICAgICB0aGlzLnZlcnRleFNoYWRlciA9IHZlcnRleFNoYWRlcjsNCiAgICAgICAgICAgICAg%0AICB0aGlzLmZyYWdtZW50U2hhZGVyU291cmNlID0gZnJhZ21lbnRTaGFkZXJTb3VyY2U7DQogICAg%0AICAgICAgICAgICAgdGhpcy5wcm9ncmFtcyA9IFtdOw0KICAgICAgICAgICAgICAgIHRoaXMuYWN0%0AaXZlUHJvZ3JhbSA9IG51bGw7DQogICAgICAgICAgICAgICAgdGhpcy51bmlmb3JtcyA9IFtdOw0K%0AICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzZXRLZXl3b3JkcyhrZXl3b3Jkcykgew0KICAg%0AICAgICAgICAgICAgIGxldCBoYXNoID0gMDsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0g%0AMDsgaSA8IGtleXdvcmRzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgICAgICBoYXNoICs9%0AIGhhc2hDb2RlKGtleXdvcmRzW2ldKTsNCg0KICAgICAgICAgICAgICAgIGxldCBwcm9ncmFtID0g%0AdGhpcy5wcm9ncmFtc1toYXNoXTsNCiAgICAgICAgICAgICAgICBpZiAocHJvZ3JhbSA9PSBudWxs%0AKSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBmcmFnbWVudFNoYWRlciA9IGNvbXBpbGVTaGFk%0AZXIoZ2wuRlJBR01FTlRfU0hBREVSLCB0aGlzLmZyYWdtZW50U2hhZGVyU291cmNlLCBrZXl3b3Jk%0Acyk7DQogICAgICAgICAgICAgICAgICAgIHByb2dyYW0gPSBjcmVhdGVQcm9ncmFtKHRoaXMudmVy%0AdGV4U2hhZGVyLCBmcmFnbWVudFNoYWRlcik7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucHJv%0AZ3JhbXNbaGFzaF0gPSBwcm9ncmFtOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAg%0AICAgIGlmIChwcm9ncmFtID09IHRoaXMuYWN0aXZlUHJvZ3JhbSkgcmV0dXJuOw0KDQogICAgICAg%0AICAgICAgICAgdGhpcy51bmlmb3JtcyA9IGdldFVuaWZvcm1zKHByb2dyYW0pOw0KICAgICAgICAg%0AICAgICAgIHRoaXMuYWN0aXZlUHJvZ3JhbSA9IHByb2dyYW07DQogICAgICAgICAgICB9DQoNCiAg%0AICAgICAgICAgIGJpbmQoKSB7DQogICAgICAgICAgICAgICAgZ2wudXNlUHJvZ3JhbSh0aGlzLmFj%0AdGl2ZVByb2dyYW0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgY2xhc3Mg%0AUHJvZ3JhbSB7DQogICAgICAgICAgICBjb25zdHJ1Y3Rvcih2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50%0AU2hhZGVyKSB7DQogICAgICAgICAgICAgICAgdGhpcy51bmlmb3JtcyA9IHt9Ow0KICAgICAgICAg%0AICAgICAgIHRoaXMucHJvZ3JhbSA9IGNyZWF0ZVByb2dyYW0odmVydGV4U2hhZGVyLCBmcmFnbWVu%0AdFNoYWRlcik7DQogICAgICAgICAgICAgICAgdGhpcy51bmlmb3JtcyA9IGdldFVuaWZvcm1zKHRo%0AaXMucHJvZ3JhbSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGJpbmQoKSB7DQogICAg%0AICAgICAgICAgICAgZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOw0KICAgICAgICAgICAgfQ0K%0AICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlUHJvZ3JhbSh2ZXJ0ZXhTaGFkZXIs%0AIGZyYWdtZW50U2hhZGVyKSB7DQogICAgICAgICAgICBsZXQgcHJvZ3JhbSA9IGdsLmNyZWF0ZVBy%0Ab2dyYW0oKTsNCiAgICAgICAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0ZXhTaGFk%0AZXIpOw0KICAgICAgICAgICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50U2hhZGVy%0AKTsNCiAgICAgICAgICAgIGdsLmxpbmtQcm9ncmFtKHByb2dyYW0pOw0KDQogICAgICAgICAgICBp%0AZiAoIWdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMpKQ0KICAg%0AICAgICAgICAgICAgIGNvbnNvbGUudHJhY2UoZ2wuZ2V0UHJvZ3JhbUluZm9Mb2cocHJvZ3JhbSkp%0AOw0KDQogICAgICAgICAgICByZXR1cm4gcHJvZ3JhbTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1%0AbmN0aW9uIGdldFVuaWZvcm1zKHByb2dyYW0pIHsNCiAgICAgICAgICAgIGxldCB1bmlmb3JtcyA9%0AIFtdOw0KICAgICAgICAgICAgbGV0IHVuaWZvcm1Db3VudCA9IGdsLmdldFByb2dyYW1QYXJhbWV0%0AZXIocHJvZ3JhbSwgZ2wuQUNUSVZFX1VOSUZPUk1TKTsNCiAgICAgICAgICAgIGZvciAobGV0IGkg%0APSAwOyBpIDwgdW5pZm9ybUNvdW50OyBpKyspIHsNCiAgICAgICAgICAgICAgICBsZXQgdW5pZm9y%0AbU5hbWUgPSBnbC5nZXRBY3RpdmVVbmlmb3JtKHByb2dyYW0sIGkpLm5hbWU7DQogICAgICAgICAg%0AICAgICAgdW5pZm9ybXNbdW5pZm9ybU5hbWVdID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dy%0AYW0sIHVuaWZvcm1OYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB1bmlm%0Ab3JtczsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGNvbXBpbGVTaGFkZXIodHlwZSwg%0Ac291cmNlLCBrZXl3b3Jkcykgew0KICAgICAgICAgICAgc291cmNlID0gYWRkS2V5d29yZHMoc291%0AcmNlLCBrZXl3b3Jkcyk7DQoNCiAgICAgICAgICAgIGNvbnN0IHNoYWRlciA9IGdsLmNyZWF0ZVNo%0AYWRlcih0eXBlKTsNCiAgICAgICAgICAgIGdsLnNoYWRlclNvdXJjZShzaGFkZXIsIHNvdXJjZSk7%0ADQogICAgICAgICAgICBnbC5jb21waWxlU2hhZGVyKHNoYWRlcik7DQoNCiAgICAgICAgICAgIGlm%0AICghZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHNoYWRlciwgZ2wuQ09NUElMRV9TVEFUVVMpKQ0KICAg%0AICAgICAgICAgICAgIGNvbnNvbGUudHJhY2UoZ2wuZ2V0U2hhZGVySW5mb0xvZyhzaGFkZXIpKTsN%0ACg0KICAgICAgICAgICAgcmV0dXJuIHNoYWRlcjsNCiAgICAgICAgfTsNCg0KICAgICAgICBmdW5j%0AdGlvbiBhZGRLZXl3b3Jkcyhzb3VyY2UsIGtleXdvcmRzKSB7DQogICAgICAgICAgICBpZiAoa2V5%0Ad29yZHMgPT0gbnVsbCkgcmV0dXJuIHNvdXJjZTsNCiAgICAgICAgICAgIGxldCBrZXl3b3Jkc1N0%0AcmluZyA9ICcnOw0KICAgICAgICAgICAga2V5d29yZHMuZm9yRWFjaChrZXl3b3JkID0+IHsNCiAg%0AICAgICAgICAgICAgICBrZXl3b3Jkc1N0cmluZyArPSAnI2RlZmluZSAnICsga2V5d29yZCArICdc%0Abic7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHJldHVybiBrZXl3b3Jkc1N0cmluZyAr%0AIHNvdXJjZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IGJhc2VWZXJ0ZXhTaGFkZXIgPSBj%0Ab21waWxlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIsIGANCiAgICAgICAgICAgIHByZWNpc2lvbiBo%0AaWdocCBmbG9hdDsNCiAgICAgICAgDQogICAgICAgICAgICBhdHRyaWJ1dGUgdmVjMiBhUG9zaXRp%0Ab247DQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdlV2Ow0KICAgICAgICAgICAgdmFyeWluZyB2%0AZWMyIHZMOw0KICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZSOw0KICAgICAgICAgICAgdmFyeWlu%0AZyB2ZWMyIHZUOw0KICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZCOw0KICAgICAgICAgICAgdW5p%0AZm9ybSB2ZWMyIHRleGVsU2l6ZTsNCiAgICAgICAgDQogICAgICAgICAgICB2b2lkIG1haW4gKCkg%0Aew0KICAgICAgICAgICAgICAgIHZVdiA9IGFQb3NpdGlvbiAqIDAuNSArIDAuNTsNCiAgICAgICAg%0AICAgICAgICB2TCA9IHZVdiAtIHZlYzIodGV4ZWxTaXplLngsIDAuMCk7DQogICAgICAgICAgICAg%0AICAgdlIgPSB2VXYgKyB2ZWMyKHRleGVsU2l6ZS54LCAwLjApOw0KICAgICAgICAgICAgICAgIHZU%0AID0gdlV2ICsgdmVjMigwLjAsIHRleGVsU2l6ZS55KTsNCiAgICAgICAgICAgICAgICB2QiA9IHZV%0AdiAtIHZlYzIoMC4wLCB0ZXhlbFNpemUueSk7DQogICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24g%0APSB2ZWM0KGFQb3NpdGlvbiwgMC4wLCAxLjApOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgKTsN%0ACg0KICAgICAgICBjb25zdCBibHVyVmVydGV4U2hhZGVyID0gY29tcGlsZVNoYWRlcihnbC5WRVJU%0ARVhfU0hBREVSLCBgDQogICAgICAgICAgICBwcmVjaXNpb24gaGlnaHAgZmxvYXQ7DQogICAgICAg%0AIA0KICAgICAgICAgICAgYXR0cmlidXRlIHZlYzIgYVBvc2l0aW9uOw0KICAgICAgICAgICAgdmFy%0AeWluZyB2ZWMyIHZVdjsNCiAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2TDsNCiAgICAgICAgICAg%0AIHZhcnlpbmcgdmVjMiB2UjsNCiAgICAgICAgICAgIHVuaWZvcm0gdmVjMiB0ZXhlbFNpemU7DQog%0AICAgICAgIA0KICAgICAgICAgICAgdm9pZCBtYWluICgpIHsNCiAgICAgICAgICAgICAgICB2VXYg%0APSBhUG9zaXRpb24gKiAwLjUgKyAwLjU7DQogICAgICAgICAgICAgICAgZmxvYXQgb2Zmc2V0ID0g%0AMS4zMzMzMzMzMzsNCiAgICAgICAgICAgICAgICB2TCA9IHZVdiAtIHRleGVsU2l6ZSAqIG9mZnNl%0AdDsNCiAgICAgICAgICAgICAgICB2UiA9IHZVdiArIHRleGVsU2l6ZSAqIG9mZnNldDsNCiAgICAg%0AICAgICAgICAgICBnbF9Qb3NpdGlvbiA9IHZlYzQoYVBvc2l0aW9uLCAwLjAsIDEuMCk7DQogICAg%0AICAgICAgICB9DQogICAgICAgIGApOw0KDQogICAgICAgIGNvbnN0IGJsdXJTaGFkZXIgPSBjb21w%0AaWxlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUiwgYA0KICAgICAgICAgICAgcHJlY2lzaW9uIG1l%0AZGl1bXAgZmxvYXQ7DQogICAgICAgICAgICBwcmVjaXNpb24gbWVkaXVtcCBzYW1wbGVyMkQ7DQog%0AICAgICAgIA0KICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZVdjsNCiAgICAgICAgICAgIHZhcnlp%0AbmcgdmVjMiB2TDsNCiAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2UjsNCiAgICAgICAgICAgIHVu%0AaWZvcm0gc2FtcGxlcjJEIHVUZXh0dXJlOw0KICAgICAgICANCiAgICAgICAgICAgIHZvaWQgbWFp%0AbiAoKSB7DQogICAgICAgICAgICAgICAgdmVjNCBzdW0gPSB0ZXh0dXJlMkQodVRleHR1cmUsIHZV%0AdikgKiAwLjI5NDExNzY0Ow0KICAgICAgICAgICAgICAgIHN1bSArPSB0ZXh0dXJlMkQodVRleHR1%0AcmUsIHZMKSAqIDAuMzUyOTQxMTc7DQogICAgICAgICAgICAgICAgc3VtICs9IHRleHR1cmUyRCh1%0AVGV4dHVyZSwgdlIpICogMC4zNTI5NDExNzsNCiAgICAgICAgICAgICAgICBnbF9GcmFnQ29sb3Ig%0APSBzdW07DQogICAgICAgICAgICB9DQogICAgICAgIGApOw0KDQogICAgICAgIGNvbnN0IGNvcHlT%0AaGFkZXIgPSBjb21waWxlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUiwgYA0KICAgICAgICAgICAg%0AcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7DQogICAgICAgICAgICBwcmVjaXNpb24gbWVkaXVtcCBz%0AYW1wbGVyMkQ7DQogICAgICAgIA0KICAgICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZVdjsN%0ACiAgICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVUZXh0dXJlOw0KICAgICAgICANCiAgICAg%0AICAgICAgIHZvaWQgbWFpbiAoKSB7DQogICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdGV4%0AdHVyZTJEKHVUZXh0dXJlLCB2VXYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgKTsNCg0KICAg%0AICAgICBjb25zdCBjbGVhclNoYWRlciA9IGNvbXBpbGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVS%0ALCBgDQogICAgICAgICAgICBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsNCiAgICAgICAgICAgIHBy%0AZWNpc2lvbiBtZWRpdW1wIHNhbXBsZXIyRDsNCiAgICAgICAgDQogICAgICAgICAgICB2YXJ5aW5n%0AIGhpZ2hwIHZlYzIgdlV2Ow0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVRleHR1cmU7%0ADQogICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHZhbHVlOw0KICAgICAgICANCiAgICAgICAgICAg%0AIHZvaWQgbWFpbiAoKSB7DQogICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmFsdWUgKiB0%0AZXh0dXJlMkQodVRleHR1cmUsIHZVdik7DQogICAgICAgICAgICB9DQogICAgICAgIGApOw0KDQog%0AICAgICAgIGNvbnN0IGNvbG9yU2hhZGVyID0gY29tcGlsZVNoYWRlcihnbC5GUkFHTUVOVF9TSEFE%0ARVIsIGANCiAgICAgICAgICAgIHByZWNpc2lvbiBtZWRpdW1wIGZsb2F0Ow0KICAgICAgICANCiAg%0AICAgICAgICAgIHVuaWZvcm0gdmVjNCBjb2xvcjsNCiAgICAgICAgDQogICAgICAgICAgICB2b2lk%0AIG1haW4gKCkgew0KICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IGNvbG9yOw0KICAgICAg%0AICAgICAgfQ0KICAgICAgICBgKTsNCg0KICAgICAgICBjb25zdCBjaGVja2VyYm9hcmRTaGFkZXIg%0APSBjb21waWxlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUiwgYA0KICAgICAgICAgICAgcHJlY2lz%0AaW9uIGhpZ2hwIGZsb2F0Ow0KICAgICAgICAgICAgcHJlY2lzaW9uIGhpZ2hwIHNhbXBsZXIyRDsN%0ACiAgICAgICAgDQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdlV2Ow0KICAgICAgICAgICAgdW5p%0AZm9ybSBzYW1wbGVyMkQgdVRleHR1cmU7DQogICAgICAgICAgICB1bmlmb3JtIGZsb2F0IGFzcGVj%0AdFJhdGlvOw0KICAgICAgICANCiAgICAgICAgICAgICNkZWZpbmUgU0NBTEUgMjUuMA0KICAgICAg%0AICANCiAgICAgICAgICAgIHZvaWQgbWFpbiAoKSB7DQogICAgICAgICAgICAgICAgdmVjMiB1diA9%0AIGZsb29yKHZVdiAqIFNDQUxFICogdmVjMihhc3BlY3RSYXRpbywgMS4wKSk7DQogICAgICAgICAg%0AICAgICAgZmxvYXQgdiA9IG1vZCh1di54ICsgdXYueSwgMi4wKTsNCiAgICAgICAgICAgICAgICB2%0AID0gdiAqIDAuMSArIDAuODsNCiAgICAgICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KHZl%0AYzModiksIDEuMCk7DQogICAgICAgICAgICB9DQogICAgICAgIGApOw0KDQogICAgICAgIGNvbnN0%0AIGRpc3BsYXlTaGFkZXJTb3VyY2UgPSBgDQogICAgICAgICAgICBwcmVjaXNpb24gaGlnaHAgZmxv%0AYXQ7DQogICAgICAgICAgICBwcmVjaXNpb24gaGlnaHAgc2FtcGxlcjJEOw0KICAgICAgICANCiAg%0AICAgICAgICAgIHZhcnlpbmcgdmVjMiB2VXY7DQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdkw7%0ADQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdlI7DQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIg%0AdlQ7DQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdkI7DQogICAgICAgICAgICB1bmlmb3JtIHNh%0AbXBsZXIyRCB1VGV4dHVyZTsNCiAgICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVCbG9vbTsN%0ACiAgICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVTdW5yYXlzOw0KICAgICAgICAgICAgdW5p%0AZm9ybSBzYW1wbGVyMkQgdURpdGhlcmluZzsNCiAgICAgICAgICAgIHVuaWZvcm0gdmVjMiBkaXRo%0AZXJTY2FsZTsNCiAgICAgICAgICAgIHVuaWZvcm0gdmVjMiB0ZXhlbFNpemU7DQogICAgICAgIA0K%0AICAgICAgICAgICAgdmVjMyBsaW5lYXJUb0dhbW1hICh2ZWMzIGNvbG9yKSB7DQogICAgICAgICAg%0AICAgICAgY29sb3IgPSBtYXgoY29sb3IsIHZlYzMoMCkpOw0KICAgICAgICAgICAgICAgIHJldHVy%0AbiBtYXgoMS4wNTUgKiBwb3coY29sb3IsIHZlYzMoMC40MTY2NjY2NjcpKSAtIDAuMDU1LCB2ZWMz%0AKDApKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB2b2lkIG1haW4gKCkg%0Aew0KICAgICAgICAgICAgICAgIHZlYzMgYyA9IHRleHR1cmUyRCh1VGV4dHVyZSwgdlV2KS5yZ2I7%0ADQogICAgICAgIA0KICAgICAgICAgICAgI2lmZGVmIFNIQURJTkcNCiAgICAgICAgICAgICAgICB2%0AZWMzIGxjID0gdGV4dHVyZTJEKHVUZXh0dXJlLCB2TCkucmdiOw0KICAgICAgICAgICAgICAgIHZl%0AYzMgcmMgPSB0ZXh0dXJlMkQodVRleHR1cmUsIHZSKS5yZ2I7DQogICAgICAgICAgICAgICAgdmVj%0AMyB0YyA9IHRleHR1cmUyRCh1VGV4dHVyZSwgdlQpLnJnYjsNCiAgICAgICAgICAgICAgICB2ZWMz%0AIGJjID0gdGV4dHVyZTJEKHVUZXh0dXJlLCB2QikucmdiOw0KICAgICAgICANCiAgICAgICAgICAg%0AICAgICBmbG9hdCBkeCA9IGxlbmd0aChyYykgLSBsZW5ndGgobGMpOw0KICAgICAgICAgICAgICAg%0AIGZsb2F0IGR5ID0gbGVuZ3RoKHRjKSAtIGxlbmd0aChiYyk7DQogICAgICAgIA0KICAgICAgICAg%0AICAgICAgIHZlYzMgbiA9IG5vcm1hbGl6ZSh2ZWMzKGR4LCBkeSwgbGVuZ3RoKHRleGVsU2l6ZSkp%0AKTsNCiAgICAgICAgICAgICAgICB2ZWMzIGwgPSB2ZWMzKDAuMCwgMC4wLCAxLjApOw0KICAgICAg%0AICANCiAgICAgICAgICAgICAgICBmbG9hdCBkaWZmdXNlID0gY2xhbXAoZG90KG4sIGwpICsgMC43%0ALCAwLjcsIDEuMCk7DQogICAgICAgICAgICAgICAgYyAqPSBkaWZmdXNlOw0KICAgICAgICAgICAg%0AI2VuZGlmDQogICAgICAgIA0KICAgICAgICAgICAgI2lmZGVmIEJMT09NDQogICAgICAgICAgICAg%0AICAgdmVjMyBibG9vbSA9IHRleHR1cmUyRCh1Qmxvb20sIHZVdikucmdiOw0KICAgICAgICAgICAg%0AI2VuZGlmDQogICAgICAgIA0KICAgICAgICAgICAgI2lmZGVmIFNVTlJBWVMNCiAgICAgICAgICAg%0AICAgICBmbG9hdCBzdW5yYXlzID0gdGV4dHVyZTJEKHVTdW5yYXlzLCB2VXYpLnI7DQogICAgICAg%0AICAgICAgICAgYyAqPSBzdW5yYXlzOw0KICAgICAgICAgICAgI2lmZGVmIEJMT09NDQogICAgICAg%0AICAgICAgICAgYmxvb20gKj0gc3VucmF5czsNCiAgICAgICAgICAgICNlbmRpZg0KICAgICAgICAg%0AICAgI2VuZGlmDQogICAgICAgIA0KICAgICAgICAgICAgI2lmZGVmIEJMT09NDQogICAgICAgICAg%0AICAgICAgZmxvYXQgbm9pc2UgPSB0ZXh0dXJlMkQodURpdGhlcmluZywgdlV2ICogZGl0aGVyU2Nh%0AbGUpLnI7DQogICAgICAgICAgICAgICAgbm9pc2UgPSBub2lzZSAqIDIuMCAtIDEuMDsNCiAgICAg%0AICAgICAgICAgICBibG9vbSArPSBub2lzZSAvIDI1NS4wOw0KICAgICAgICAgICAgICAgIGJsb29t%0AID0gbGluZWFyVG9HYW1tYShibG9vbSk7DQogICAgICAgICAgICAgICAgYyArPSBibG9vbTsNCiAg%0AICAgICAgICAgICNlbmRpZg0KICAgICAgICANCiAgICAgICAgICAgICAgICBmbG9hdCBhID0gbWF4%0AKGMuciwgbWF4KGMuZywgYy5iKSk7DQogICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVj%0ANChjLCBhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYDsNCg0KICAgICAgICBjb25zdCBibG9v%0AbVByZWZpbHRlclNoYWRlciA9IGNvbXBpbGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVSLCBgDQog%0AICAgICAgICAgICBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsNCiAgICAgICAgICAgIHByZWNpc2lv%0AbiBtZWRpdW1wIHNhbXBsZXIyRDsNCiAgICAgICAgDQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIg%0AdlV2Ow0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVRleHR1cmU7DQogICAgICAgICAg%0AICB1bmlmb3JtIHZlYzMgY3VydmU7DQogICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHRocmVzaG9s%0AZDsNCiAgICAgICAgDQogICAgICAgICAgICB2b2lkIG1haW4gKCkgew0KICAgICAgICAgICAgICAg%0AIHZlYzMgYyA9IHRleHR1cmUyRCh1VGV4dHVyZSwgdlV2KS5yZ2I7DQogICAgICAgICAgICAgICAg%0AZmxvYXQgYnIgPSBtYXgoYy5yLCBtYXgoYy5nLCBjLmIpKTsNCiAgICAgICAgICAgICAgICBmbG9h%0AdCBycSA9IGNsYW1wKGJyIC0gY3VydmUueCwgMC4wLCBjdXJ2ZS55KTsNCiAgICAgICAgICAgICAg%0AICBycSA9IGN1cnZlLnogKiBycSAqIHJxOw0KICAgICAgICAgICAgICAgIGMgKj0gbWF4KHJxLCBi%0AciAtIHRocmVzaG9sZCkgLyBtYXgoYnIsIDAuMDAwMSk7DQogICAgICAgICAgICAgICAgZ2xfRnJh%0AZ0NvbG9yID0gdmVjNChjLCAwLjApOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgKTsNCg0KICAg%0AICAgICBjb25zdCBibG9vbUJsdXJTaGFkZXIgPSBjb21waWxlU2hhZGVyKGdsLkZSQUdNRU5UX1NI%0AQURFUiwgYA0KICAgICAgICAgICAgcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7DQogICAgICAgICAg%0AICBwcmVjaXNpb24gbWVkaXVtcCBzYW1wbGVyMkQ7DQogICAgICAgIA0KICAgICAgICAgICAgdmFy%0AeWluZyB2ZWMyIHZMOw0KICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZSOw0KICAgICAgICAgICAg%0AdmFyeWluZyB2ZWMyIHZUOw0KICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZCOw0KICAgICAgICAg%0AICAgdW5pZm9ybSBzYW1wbGVyMkQgdVRleHR1cmU7DQogICAgICAgIA0KICAgICAgICAgICAgdm9p%0AZCBtYWluICgpIHsNCiAgICAgICAgICAgICAgICB2ZWM0IHN1bSA9IHZlYzQoMC4wKTsNCiAgICAg%0AICAgICAgICAgICBzdW0gKz0gdGV4dHVyZTJEKHVUZXh0dXJlLCB2TCk7DQogICAgICAgICAgICAg%0AICAgc3VtICs9IHRleHR1cmUyRCh1VGV4dHVyZSwgdlIpOw0KICAgICAgICAgICAgICAgIHN1bSAr%0APSB0ZXh0dXJlMkQodVRleHR1cmUsIHZUKTsNCiAgICAgICAgICAgICAgICBzdW0gKz0gdGV4dHVy%0AZTJEKHVUZXh0dXJlLCB2Qik7DQogICAgICAgICAgICAgICAgc3VtICo9IDAuMjU7DQogICAgICAg%0AICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gc3VtOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgKTsN%0ACg0KICAgICAgICBjb25zdCBibG9vbUZpbmFsU2hhZGVyID0gY29tcGlsZVNoYWRlcihnbC5GUkFH%0ATUVOVF9TSEFERVIsIGANCiAgICAgICAgICAgIHByZWNpc2lvbiBtZWRpdW1wIGZsb2F0Ow0KICAg%0AICAgICAgICAgcHJlY2lzaW9uIG1lZGl1bXAgc2FtcGxlcjJEOw0KICAgICAgICANCiAgICAgICAg%0AICAgIHZhcnlpbmcgdmVjMiB2TDsNCiAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2UjsNCiAgICAg%0AICAgICAgIHZhcnlpbmcgdmVjMiB2VDsNCiAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2QjsNCiAg%0AICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVUZXh0dXJlOw0KICAgICAgICAgICAgdW5pZm9y%0AbSBmbG9hdCBpbnRlbnNpdHk7DQogICAgICAgIA0KICAgICAgICAgICAgdm9pZCBtYWluICgpIHsN%0ACiAgICAgICAgICAgICAgICB2ZWM0IHN1bSA9IHZlYzQoMC4wKTsNCiAgICAgICAgICAgICAgICBz%0AdW0gKz0gdGV4dHVyZTJEKHVUZXh0dXJlLCB2TCk7DQogICAgICAgICAgICAgICAgc3VtICs9IHRl%0AeHR1cmUyRCh1VGV4dHVyZSwgdlIpOw0KICAgICAgICAgICAgICAgIHN1bSArPSB0ZXh0dXJlMkQo%0AdVRleHR1cmUsIHZUKTsNCiAgICAgICAgICAgICAgICBzdW0gKz0gdGV4dHVyZTJEKHVUZXh0dXJl%0ALCB2Qik7DQogICAgICAgICAgICAgICAgc3VtICo9IDAuMjU7DQogICAgICAgICAgICAgICAgZ2xf%0ARnJhZ0NvbG9yID0gc3VtICogaW50ZW5zaXR5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICBgKTsN%0ACg0KICAgICAgICBjb25zdCBzdW5yYXlzTWFza1NoYWRlciA9IGNvbXBpbGVTaGFkZXIoZ2wuRlJB%0AR01FTlRfU0hBREVSLCBgDQogICAgICAgICAgICBwcmVjaXNpb24gaGlnaHAgZmxvYXQ7DQogICAg%0AICAgICAgICBwcmVjaXNpb24gaGlnaHAgc2FtcGxlcjJEOw0KICAgICAgICANCiAgICAgICAgICAg%0AIHZhcnlpbmcgdmVjMiB2VXY7DQogICAgICAgICAgICB1bmlmb3JtIHNhbXBsZXIyRCB1VGV4dHVy%0AZTsNCiAgICAgICAgDQogICAgICAgICAgICB2b2lkIG1haW4gKCkgew0KICAgICAgICAgICAgICAg%0AIHZlYzQgYyA9IHRleHR1cmUyRCh1VGV4dHVyZSwgdlV2KTsNCiAgICAgICAgICAgICAgICBmbG9h%0AdCBiciA9IG1heChjLnIsIG1heChjLmcsIGMuYikpOw0KICAgICAgICAgICAgICAgIGMuYSA9IDEu%0AMCAtIG1pbihtYXgoYnIgKiAyMC4wLCAwLjApLCAwLjgpOw0KICAgICAgICAgICAgICAgIGdsX0Zy%0AYWdDb2xvciA9IGM7DQogICAgICAgICAgICB9DQogICAgICAgIGApOw0KDQogICAgICAgIGNvbnN0%0AIHN1bnJheXNTaGFkZXIgPSBjb21waWxlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUiwgYA0KICAg%0AICAgICAgICAgcHJlY2lzaW9uIGhpZ2hwIGZsb2F0Ow0KICAgICAgICAgICAgcHJlY2lzaW9uIGhp%0AZ2hwIHNhbXBsZXIyRDsNCiAgICAgICAgDQogICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdlV2Ow0K%0AICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVRleHR1cmU7DQogICAgICAgICAgICB1bmlm%0Ab3JtIGZsb2F0IHdlaWdodDsNCiAgICAgICAgDQogICAgICAgICAgICAjZGVmaW5lIElURVJBVElP%0ATlMgMTYNCiAgICAgICAgDQogICAgICAgICAgICB2b2lkIG1haW4gKCkgew0KICAgICAgICAgICAg%0AICAgIGZsb2F0IERlbnNpdHkgPSAwLjM7DQogICAgICAgICAgICAgICAgZmxvYXQgRGVjYXkgPSAw%0ALjk1Ow0KICAgICAgICAgICAgICAgIGZsb2F0IEV4cG9zdXJlID0gMC43Ow0KICAgICAgICANCiAg%0AICAgICAgICAgICAgICB2ZWMyIGNvb3JkID0gdlV2Ow0KICAgICAgICAgICAgICAgIHZlYzIgZGly%0AID0gdlV2IC0gMC41Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICBkaXIgKj0gMS4wIC8gZmxv%0AYXQoSVRFUkFUSU9OUykgKiBEZW5zaXR5Ow0KICAgICAgICAgICAgICAgIGZsb2F0IGlsbHVtaW5h%0AdGlvbkRlY2F5ID0gMS4wOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBmbG9hdCBjb2xvciA9%0AIHRleHR1cmUyRCh1VGV4dHVyZSwgdlV2KS5hOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBm%0Ab3IgKGludCBpID0gMDsgaSA8IElURVJBVElPTlM7IGkrKykNCiAgICAgICAgICAgICAgICB7DQog%0AICAgICAgICAgICAgICAgICAgIGNvb3JkIC09IGRpcjsNCiAgICAgICAgICAgICAgICAgICAgZmxv%0AYXQgY29sID0gdGV4dHVyZTJEKHVUZXh0dXJlLCBjb29yZCkuYTsNCiAgICAgICAgICAgICAgICAg%0AICAgY29sb3IgKz0gY29sICogaWxsdW1pbmF0aW9uRGVjYXkgKiB3ZWlnaHQ7DQogICAgICAgICAg%0AICAgICAgICAgIGlsbHVtaW5hdGlvbkRlY2F5ICo9IERlY2F5Ow0KICAgICAgICAgICAgICAgIH0N%0ACiAgICAgICAgDQogICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNChjb2xvciAqIEV4%0AcG9zdXJlLCAwLjAsIDAuMCwgMS4wKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYCk7DQoNCiAg%0AICAgICAgY29uc3Qgc3BsYXRTaGFkZXIgPSBjb21waWxlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURF%0AUiwgYA0KICAgICAgICAgICAgcHJlY2lzaW9uIGhpZ2hwIGZsb2F0Ow0KICAgICAgICAgICAgcHJl%0AY2lzaW9uIGhpZ2hwIHNhbXBsZXIyRDsNCiAgICAgICAgDQogICAgICAgICAgICB2YXJ5aW5nIHZl%0AYzIgdlV2Ow0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVRhcmdldDsNCiAgICAgICAg%0AICAgIHVuaWZvcm0gZmxvYXQgYXNwZWN0UmF0aW87DQogICAgICAgICAgICB1bmlmb3JtIHZlYzMg%0AY29sb3I7DQogICAgICAgICAgICB1bmlmb3JtIHZlYzIgcG9pbnQ7DQogICAgICAgICAgICB1bmlm%0Ab3JtIGZsb2F0IHJhZGl1czsNCiAgICAgICAgDQogICAgICAgICAgICB2b2lkIG1haW4gKCkgew0K%0AICAgICAgICAgICAgICAgIHZlYzIgcCA9IHZVdiAtIHBvaW50Lnh5Ow0KICAgICAgICAgICAgICAg%0AIHAueCAqPSBhc3BlY3RSYXRpbzsNCiAgICAgICAgICAgICAgICB2ZWMzIHNwbGF0ID0gZXhwKC1k%0Ab3QocCwgcCkgLyByYWRpdXMpICogY29sb3I7DQogICAgICAgICAgICAgICAgdmVjMyBiYXNlID0g%0AdGV4dHVyZTJEKHVUYXJnZXQsIHZVdikueHl6Ow0KICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xv%0AciA9IHZlYzQoYmFzZSArIHNwbGF0LCAxLjApOw0KICAgICAgICAgICAgfQ0KICAgICAgICBgKTsN%0ACg0KICAgICAgICBjb25zdCBhZHZlY3Rpb25TaGFkZXIgPSBjb21waWxlU2hhZGVyKGdsLkZSQUdN%0ARU5UX1NIQURFUiwgYA0KICAgICAgICAgICAgcHJlY2lzaW9uIGhpZ2hwIGZsb2F0Ow0KICAgICAg%0AICAgICAgcHJlY2lzaW9uIGhpZ2hwIHNhbXBsZXIyRDsNCiAgICAgICAgDQogICAgICAgICAgICB2%0AYXJ5aW5nIHZlYzIgdlV2Ow0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVZlbG9jaXR5%0AOw0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVNvdXJjZTsNCiAgICAgICAgICAgIHVu%0AaWZvcm0gdmVjMiB0ZXhlbFNpemU7DQogICAgICAgICAgICB1bmlmb3JtIHZlYzIgZHllVGV4ZWxT%0AaXplOw0KICAgICAgICAgICAgdW5pZm9ybSBmbG9hdCBkdDsNCiAgICAgICAgICAgIHVuaWZvcm0g%0AZmxvYXQgZGlzc2lwYXRpb247DQogICAgICAgIA0KICAgICAgICAgICAgdmVjNCBiaWxlcnAgKHNh%0AbXBsZXIyRCBzYW0sIHZlYzIgdXYsIHZlYzIgdHNpemUpIHsNCiAgICAgICAgICAgICAgICB2ZWMy%0AIHN0ID0gdXYgLyB0c2l6ZSAtIDAuNTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdmVjMiBp%0AdXYgPSBmbG9vcihzdCk7DQogICAgICAgICAgICAgICAgdmVjMiBmdXYgPSBmcmFjdChzdCk7DQog%0AICAgICAgIA0KICAgICAgICAgICAgICAgIHZlYzQgYSA9IHRleHR1cmUyRChzYW0sIChpdXYgKyB2%0AZWMyKDAuNSwgMC41KSkgKiB0c2l6ZSk7DQogICAgICAgICAgICAgICAgdmVjNCBiID0gdGV4dHVy%0AZTJEKHNhbSwgKGl1diArIHZlYzIoMS41LCAwLjUpKSAqIHRzaXplKTsNCiAgICAgICAgICAgICAg%0AICB2ZWM0IGMgPSB0ZXh0dXJlMkQoc2FtLCAoaXV2ICsgdmVjMigwLjUsIDEuNSkpICogdHNpemUp%0AOw0KICAgICAgICAgICAgICAgIHZlYzQgZCA9IHRleHR1cmUyRChzYW0sIChpdXYgKyB2ZWMyKDEu%0ANSwgMS41KSkgKiB0c2l6ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBtaXgo%0AbWl4KGEsIGIsIGZ1di54KSwgbWl4KGMsIGQsIGZ1di54KSwgZnV2LnkpOw0KICAgICAgICAgICAg%0AfQ0KICAgICAgICANCiAgICAgICAgICAgIHZvaWQgbWFpbiAoKSB7DQogICAgICAgICAgICAjaWZk%0AZWYgTUFOVUFMX0ZJTFRFUklORw0KICAgICAgICAgICAgICAgIHZlYzIgY29vcmQgPSB2VXYgLSBk%0AdCAqIGJpbGVycCh1VmVsb2NpdHksIHZVdiwgdGV4ZWxTaXplKS54eSAqIHRleGVsU2l6ZTsNCiAg%0AICAgICAgICAgICAgICB2ZWM0IHJlc3VsdCA9IGJpbGVycCh1U291cmNlLCBjb29yZCwgZHllVGV4%0AZWxTaXplKTsNCiAgICAgICAgICAgICNlbHNlDQogICAgICAgICAgICAgICAgdmVjMiBjb29yZCA9%0AIHZVdiAtIGR0ICogdGV4dHVyZTJEKHVWZWxvY2l0eSwgdlV2KS54eSAqIHRleGVsU2l6ZTsNCiAg%0AICAgICAgICAgICAgICB2ZWM0IHJlc3VsdCA9IHRleHR1cmUyRCh1U291cmNlLCBjb29yZCk7DQog%0AICAgICAgICAgICAjZW5kaWYNCiAgICAgICAgICAgICAgICBmbG9hdCBkZWNheSA9IDEuMCArIGRp%0Ac3NpcGF0aW9uICogZHQ7DQogICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gcmVzdWx0IC8g%0AZGVjYXk7DQogICAgICAgICAgICB9YCwNCiAgICAgICAgICAgIGV4dC5zdXBwb3J0TGluZWFyRmls%0AdGVyaW5nID8gbnVsbCA6IFsnTUFOVUFMX0ZJTFRFUklORyddDQogICAgICAgICk7DQoNCiAgICAg%0AICAgY29uc3QgZGl2ZXJnZW5jZVNoYWRlciA9IGNvbXBpbGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hB%0AREVSLCBgDQogICAgICAgICAgICBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsNCiAgICAgICAgICAg%0AIHByZWNpc2lvbiBtZWRpdW1wIHNhbXBsZXIyRDsNCiAgICAgICAgDQogICAgICAgICAgICB2YXJ5%0AaW5nIGhpZ2hwIHZlYzIgdlV2Ow0KICAgICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZMOw0K%0AICAgICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZSOw0KICAgICAgICAgICAgdmFyeWluZyBo%0AaWdocCB2ZWMyIHZUOw0KICAgICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZCOw0KICAgICAg%0AICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVZlbG9jaXR5Ow0KICAgICAgICANCiAgICAgICAgICAg%0AIHZvaWQgbWFpbiAoKSB7DQogICAgICAgICAgICAgICAgZmxvYXQgTCA9IHRleHR1cmUyRCh1VmVs%0Ab2NpdHksIHZMKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IFIgPSB0ZXh0dXJlMkQodVZlbG9j%0AaXR5LCB2UikueDsNCiAgICAgICAgICAgICAgICBmbG9hdCBUID0gdGV4dHVyZTJEKHVWZWxvY2l0%0AeSwgdlQpLnk7DQogICAgICAgICAgICAgICAgZmxvYXQgQiA9IHRleHR1cmUyRCh1VmVsb2NpdHks%0AIHZCKS55Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICB2ZWMyIEMgPSB0ZXh0dXJlMkQodVZl%0AbG9jaXR5LCB2VXYpLnh5Ow0KICAgICAgICAgICAgICAgIGlmICh2TC54IDwgMC4wKSB7IEwgPSAt%0AQy54OyB9DQogICAgICAgICAgICAgICAgaWYgKHZSLnggPiAxLjApIHsgUiA9IC1DLng7IH0NCiAg%0AICAgICAgICAgICAgICBpZiAodlQueSA+IDEuMCkgeyBUID0gLUMueTsgfQ0KICAgICAgICAgICAg%0AICAgIGlmICh2Qi55IDwgMC4wKSB7IEIgPSAtQy55OyB9DQogICAgICAgIA0KICAgICAgICAgICAg%0AICAgIGZsb2F0IGRpdiA9IDAuNSAqIChSIC0gTCArIFQgLSBCKTsNCiAgICAgICAgICAgICAgICBn%0AbF9GcmFnQ29sb3IgPSB2ZWM0KGRpdiwgMC4wLCAwLjAsIDEuMCk7DQogICAgICAgICAgICB9DQog%0AICAgICAgIGApOw0KDQogICAgICAgIGNvbnN0IGN1cmxTaGFkZXIgPSBjb21waWxlU2hhZGVyKGds%0ALkZSQUdNRU5UX1NIQURFUiwgYA0KICAgICAgICAgICAgcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7%0ADQogICAgICAgICAgICBwcmVjaXNpb24gbWVkaXVtcCBzYW1wbGVyMkQ7DQogICAgICAgIA0KICAg%0AICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZVdjsNCiAgICAgICAgICAgIHZhcnlpbmcgaGln%0AaHAgdmVjMiB2TDsNCiAgICAgICAgICAgIHZhcnlpbmcgaGlnaHAgdmVjMiB2UjsNCiAgICAgICAg%0AICAgIHZhcnlpbmcgaGlnaHAgdmVjMiB2VDsNCiAgICAgICAgICAgIHZhcnlpbmcgaGlnaHAgdmVj%0AMiB2QjsNCiAgICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVWZWxvY2l0eTsNCiAgICAgICAg%0ADQogICAgICAgICAgICB2b2lkIG1haW4gKCkgew0KICAgICAgICAgICAgICAgIGZsb2F0IEwgPSB0%0AZXh0dXJlMkQodVZlbG9jaXR5LCB2TCkueTsNCiAgICAgICAgICAgICAgICBmbG9hdCBSID0gdGV4%0AdHVyZTJEKHVWZWxvY2l0eSwgdlIpLnk7DQogICAgICAgICAgICAgICAgZmxvYXQgVCA9IHRleHR1%0AcmUyRCh1VmVsb2NpdHksIHZUKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IEIgPSB0ZXh0dXJl%0AMkQodVZlbG9jaXR5LCB2QikueDsNCiAgICAgICAgICAgICAgICBmbG9hdCB2b3J0aWNpdHkgPSBS%0AIC0gTCAtIFQgKyBCOw0KICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQoMC41ICog%0Adm9ydGljaXR5LCAwLjAsIDAuMCwgMS4wKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgYCk7DQoN%0ACiAgICAgICAgY29uc3Qgdm9ydGljaXR5U2hhZGVyID0gY29tcGlsZVNoYWRlcihnbC5GUkFHTUVO%0AVF9TSEFERVIsIGANCiAgICAgICAgICAgIHByZWNpc2lvbiBoaWdocCBmbG9hdDsNCiAgICAgICAg%0AICAgIHByZWNpc2lvbiBoaWdocCBzYW1wbGVyMkQ7DQogICAgICAgIA0KICAgICAgICAgICAgdmFy%0AeWluZyB2ZWMyIHZVdjsNCiAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2TDsNCiAgICAgICAgICAg%0AIHZhcnlpbmcgdmVjMiB2UjsNCiAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2VDsNCiAgICAgICAg%0AICAgIHZhcnlpbmcgdmVjMiB2QjsNCiAgICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVWZWxv%0AY2l0eTsNCiAgICAgICAgICAgIHVuaWZvcm0gc2FtcGxlcjJEIHVDdXJsOw0KICAgICAgICAgICAg%0AdW5pZm9ybSBmbG9hdCBjdXJsOw0KICAgICAgICAgICAgdW5pZm9ybSBmbG9hdCBkdDsNCiAgICAg%0AICAgDQogICAgICAgICAgICB2b2lkIG1haW4gKCkgew0KICAgICAgICAgICAgICAgIGZsb2F0IEwg%0APSB0ZXh0dXJlMkQodUN1cmwsIHZMKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IFIgPSB0ZXh0%0AdXJlMkQodUN1cmwsIHZSKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IFQgPSB0ZXh0dXJlMkQo%0AdUN1cmwsIHZUKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IEIgPSB0ZXh0dXJlMkQodUN1cmws%0AIHZCKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IEMgPSB0ZXh0dXJlMkQodUN1cmwsIHZVdiku%0AeDsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdmVjMiBmb3JjZSA9IDAuNSAqIHZlYzIoYWJz%0AKFQpIC0gYWJzKEIpLCBhYnMoUikgLSBhYnMoTCkpOw0KICAgICAgICAgICAgICAgIGZvcmNlIC89%0AIGxlbmd0aChmb3JjZSkgKyAwLjAwMDE7DQogICAgICAgICAgICAgICAgZm9yY2UgKj0gY3VybCAq%0AIEM7DQogICAgICAgICAgICAgICAgZm9yY2UueSAqPSAtMS4wOw0KICAgICAgICANCiAgICAgICAg%0AICAgICAgICB2ZWMyIHZlbG9jaXR5ID0gdGV4dHVyZTJEKHVWZWxvY2l0eSwgdlV2KS54eTsNCiAg%0AICAgICAgICAgICAgICB2ZWxvY2l0eSArPSBmb3JjZSAqIGR0Ow0KICAgICAgICAgICAgICAgIHZl%0AbG9jaXR5ID0gbWluKG1heCh2ZWxvY2l0eSwgLTEwMDAuMCksIDEwMDAuMCk7DQogICAgICAgICAg%0AICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNCh2ZWxvY2l0eSwgMC4wLCAxLjApOw0KICAgICAgICAg%0AICAgfQ0KICAgICAgICBgKTsNCg0KICAgICAgICBjb25zdCBwcmVzc3VyZVNoYWRlciA9IGNvbXBp%0AbGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVSLCBgDQogICAgICAgICAgICBwcmVjaXNpb24gbWVk%0AaXVtcCBmbG9hdDsNCiAgICAgICAgICAgIHByZWNpc2lvbiBtZWRpdW1wIHNhbXBsZXIyRDsNCiAg%0AICAgICAgDQogICAgICAgICAgICB2YXJ5aW5nIGhpZ2hwIHZlYzIgdlV2Ow0KICAgICAgICAgICAg%0AdmFyeWluZyBoaWdocCB2ZWMyIHZMOw0KICAgICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZS%0AOw0KICAgICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZUOw0KICAgICAgICAgICAgdmFyeWlu%0AZyBoaWdocCB2ZWMyIHZCOw0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVByZXNzdXJl%0AOw0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdURpdmVyZ2VuY2U7DQogICAgICAgIA0K%0AICAgICAgICAgICAgdm9pZCBtYWluICgpIHsNCiAgICAgICAgICAgICAgICBmbG9hdCBMID0gdGV4%0AdHVyZTJEKHVQcmVzc3VyZSwgdkwpLng7DQogICAgICAgICAgICAgICAgZmxvYXQgUiA9IHRleHR1%0AcmUyRCh1UHJlc3N1cmUsIHZSKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IFQgPSB0ZXh0dXJl%0AMkQodVByZXNzdXJlLCB2VCkueDsNCiAgICAgICAgICAgICAgICBmbG9hdCBCID0gdGV4dHVyZTJE%0AKHVQcmVzc3VyZSwgdkIpLng7DQogICAgICAgICAgICAgICAgZmxvYXQgQyA9IHRleHR1cmUyRCh1%0AUHJlc3N1cmUsIHZVdikueDsNCiAgICAgICAgICAgICAgICBmbG9hdCBkaXZlcmdlbmNlID0gdGV4%0AdHVyZTJEKHVEaXZlcmdlbmNlLCB2VXYpLng7DQogICAgICAgICAgICAgICAgZmxvYXQgcHJlc3N1%0AcmUgPSAoTCArIFIgKyBCICsgVCAtIGRpdmVyZ2VuY2UpICogMC4yNTsNCiAgICAgICAgICAgICAg%0AICBnbF9GcmFnQ29sb3IgPSB2ZWM0KHByZXNzdXJlLCAwLjAsIDAuMCwgMS4wKTsNCiAgICAgICAg%0AICAgIH0NCiAgICAgICAgYCk7DQoNCiAgICAgICAgY29uc3QgZ3JhZGllbnRTdWJ0cmFjdFNoYWRl%0AciA9IGNvbXBpbGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVSLCBgDQogICAgICAgICAgICBwcmVj%0AaXNpb24gbWVkaXVtcCBmbG9hdDsNCiAgICAgICAgICAgIHByZWNpc2lvbiBtZWRpdW1wIHNhbXBs%0AZXIyRDsNCiAgICAgICAgDQogICAgICAgICAgICB2YXJ5aW5nIGhpZ2hwIHZlYzIgdlV2Ow0KICAg%0AICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZMOw0KICAgICAgICAgICAgdmFyeWluZyBoaWdo%0AcCB2ZWMyIHZSOw0KICAgICAgICAgICAgdmFyeWluZyBoaWdocCB2ZWMyIHZUOw0KICAgICAgICAg%0AICAgdmFyeWluZyBoaWdocCB2ZWMyIHZCOw0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQg%0AdVByZXNzdXJlOw0KICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdVZlbG9jaXR5Ow0KICAg%0AICAgICANCiAgICAgICAgICAgIHZvaWQgbWFpbiAoKSB7DQogICAgICAgICAgICAgICAgZmxvYXQg%0ATCA9IHRleHR1cmUyRCh1UHJlc3N1cmUsIHZMKS54Ow0KICAgICAgICAgICAgICAgIGZsb2F0IFIg%0APSB0ZXh0dXJlMkQodVByZXNzdXJlLCB2UikueDsNCiAgICAgICAgICAgICAgICBmbG9hdCBUID0g%0AdGV4dHVyZTJEKHVQcmVzc3VyZSwgdlQpLng7DQogICAgICAgICAgICAgICAgZmxvYXQgQiA9IHRl%0AeHR1cmUyRCh1UHJlc3N1cmUsIHZCKS54Ow0KICAgICAgICAgICAgICAgIHZlYzIgdmVsb2NpdHkg%0APSB0ZXh0dXJlMkQodVZlbG9jaXR5LCB2VXYpLnh5Ow0KICAgICAgICAgICAgICAgIHZlbG9jaXR5%0ALnh5IC09IHZlYzIoUiAtIEwsIFQgLSBCKTsNCiAgICAgICAgICAgICAgICBnbF9GcmFnQ29sb3Ig%0APSB2ZWM0KHZlbG9jaXR5LCAwLjAsIDEuMCk7DQogICAgICAgICAgICB9DQogICAgICAgIGApOw0K%0ADQogICAgICAgIGNvbnN0IGJsaXQgPSAoKCkgPT4gew0KICAgICAgICAgICAgZ2wuYmluZEJ1ZmZl%0AcihnbC5BUlJBWV9CVUZGRVIsIGdsLmNyZWF0ZUJ1ZmZlcigpKTsNCiAgICAgICAgICAgIGdsLmJ1%0AZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KFstMSwgLTEsIC0xLCAx%0ALCAxLCAxLCAxLCAtMV0pLCBnbC5TVEFUSUNfRFJBVyk7DQogICAgICAgICAgICBnbC5iaW5kQnVm%0AZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBnbC5jcmVhdGVCdWZmZXIoKSk7DQogICAgICAg%0AICAgICBnbC5idWZmZXJEYXRhKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBuZXcgVWludDE2QXJy%0AYXkoWzAsIDEsIDIsIDAsIDIsIDNdKSwgZ2wuU1RBVElDX0RSQVcpOw0KICAgICAgICAgICAgZ2wu%0AdmVydGV4QXR0cmliUG9pbnRlcigwLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApOw0KICAgICAg%0AICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoMCk7DQoNCiAgICAgICAgICAgIHJldHVy%0AbiAodGFyZ2V0LCBjbGVhciA9IGZhbHNlKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKHRhcmdl%0AdCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmRy%0AYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7DQogICAgICAgICAgICAg%0AICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7DQogICAgICAg%0AICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZ2wudmlld3BvcnQoMCwgMCwg%0AdGFyZ2V0LndpZHRoLCB0YXJnZXQuaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICAgICAgZ2wuYmlu%0AZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCB0YXJnZXQuZmJvKTsNCiAgICAgICAgICAgICAg%0AICB9DQogICAgICAgICAgICAgICAgaWYgKGNsZWFyKSB7DQogICAgICAgICAgICAgICAgICAgIGds%0ALmNsZWFyQ29sb3IoMC4wLCAwLjAsIDAuMCwgMS4wKTsNCiAgICAgICAgICAgICAgICAgICAgZ2wu%0AY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAg%0AICAgICAgIC8vIENIRUNLX0ZSQU1FQlVGRkVSX1NUQVRVUygpOw0KICAgICAgICAgICAgICAgIGds%0ALmRyYXdFbGVtZW50cyhnbC5UUklBTkdMRVMsIDYsIGdsLlVOU0lHTkVEX1NIT1JULCAwKTsNCiAg%0AICAgICAgICAgIH0NCiAgICAgICAgfSkoKTsNCg0KICAgICAgICBmdW5jdGlvbiBDSEVDS19GUkFN%0ARUJVRkZFUl9TVEFUVVMoKSB7DQogICAgICAgICAgICBsZXQgc3RhdHVzID0gZ2wuY2hlY2tGcmFt%0AZWJ1ZmZlclN0YXR1cyhnbC5GUkFNRUJVRkZFUik7DQogICAgICAgICAgICBpZiAoc3RhdHVzICE9%0AIGdsLkZSQU1FQlVGRkVSX0NPTVBMRVRFKQ0KICAgICAgICAgICAgICAgIGNvbnNvbGUudHJhY2Uo%0AIkZyYW1lYnVmZmVyIGVycm9yOiAiICsgc3RhdHVzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGxl%0AdCBkeWU7DQogICAgICAgIGxldCB2ZWxvY2l0eTsNCiAgICAgICAgbGV0IGRpdmVyZ2VuY2U7DQog%0AICAgICAgIGxldCBjdXJsOw0KICAgICAgICBsZXQgcHJlc3N1cmU7DQogICAgICAgIGxldCBibG9v%0AbTsNCiAgICAgICAgbGV0IGJsb29tRnJhbWVidWZmZXJzID0gW107DQogICAgICAgIGxldCBzdW5y%0AYXlzOw0KICAgICAgICBsZXQgc3VucmF5c1RlbXA7DQoNCiAgICAgICAgbGV0IGRpdGhlcmluZ1Rl%0AeHR1cmUgPSBjcmVhdGVUZXh0dXJlQXN5bmMoJ0xEUl9MTEwxXzAucG5nJyk7DQoNCiAgICAgICAg%0AY29uc3QgYmx1clByb2dyYW0gPSBuZXcgUHJvZ3JhbShibHVyVmVydGV4U2hhZGVyLCBibHVyU2hh%0AZGVyKTsNCiAgICAgICAgY29uc3QgY29weVByb2dyYW0gPSBuZXcgUHJvZ3JhbShiYXNlVmVydGV4%0AU2hhZGVyLCBjb3B5U2hhZGVyKTsNCiAgICAgICAgY29uc3QgY2xlYXJQcm9ncmFtID0gbmV3IFBy%0Ab2dyYW0oYmFzZVZlcnRleFNoYWRlciwgY2xlYXJTaGFkZXIpOw0KICAgICAgICBjb25zdCBjb2xv%0AclByb2dyYW0gPSBuZXcgUHJvZ3JhbShiYXNlVmVydGV4U2hhZGVyLCBjb2xvclNoYWRlcik7DQog%0AICAgICAgIGNvbnN0IGNoZWNrZXJib2FyZFByb2dyYW0gPSBuZXcgUHJvZ3JhbShiYXNlVmVydGV4%0AU2hhZGVyLCBjaGVja2VyYm9hcmRTaGFkZXIpOw0KICAgICAgICBjb25zdCBibG9vbVByZWZpbHRl%0AclByb2dyYW0gPSBuZXcgUHJvZ3JhbShiYXNlVmVydGV4U2hhZGVyLCBibG9vbVByZWZpbHRlclNo%0AYWRlcik7DQogICAgICAgIGNvbnN0IGJsb29tQmx1clByb2dyYW0gPSBuZXcgUHJvZ3JhbShiYXNl%0AVmVydGV4U2hhZGVyLCBibG9vbUJsdXJTaGFkZXIpOw0KICAgICAgICBjb25zdCBibG9vbUZpbmFs%0AUHJvZ3JhbSA9IG5ldyBQcm9ncmFtKGJhc2VWZXJ0ZXhTaGFkZXIsIGJsb29tRmluYWxTaGFkZXIp%0AOw0KICAgICAgICBjb25zdCBzdW5yYXlzTWFza1Byb2dyYW0gPSBuZXcgUHJvZ3JhbShiYXNlVmVy%0AdGV4U2hhZGVyLCBzdW5yYXlzTWFza1NoYWRlcik7DQogICAgICAgIGNvbnN0IHN1bnJheXNQcm9n%0AcmFtID0gbmV3IFByb2dyYW0oYmFzZVZlcnRleFNoYWRlciwgc3VucmF5c1NoYWRlcik7DQogICAg%0AICAgIGNvbnN0IHNwbGF0UHJvZ3JhbSA9IG5ldyBQcm9ncmFtKGJhc2VWZXJ0ZXhTaGFkZXIsIHNw%0AbGF0U2hhZGVyKTsNCiAgICAgICAgY29uc3QgYWR2ZWN0aW9uUHJvZ3JhbSA9IG5ldyBQcm9ncmFt%0AKGJhc2VWZXJ0ZXhTaGFkZXIsIGFkdmVjdGlvblNoYWRlcik7DQogICAgICAgIGNvbnN0IGRpdmVy%0AZ2VuY2VQcm9ncmFtID0gbmV3IFByb2dyYW0oYmFzZVZlcnRleFNoYWRlciwgZGl2ZXJnZW5jZVNo%0AYWRlcik7DQogICAgICAgIGNvbnN0IGN1cmxQcm9ncmFtID0gbmV3IFByb2dyYW0oYmFzZVZlcnRl%0AeFNoYWRlciwgY3VybFNoYWRlcik7DQogICAgICAgIGNvbnN0IHZvcnRpY2l0eVByb2dyYW0gPSBu%0AZXcgUHJvZ3JhbShiYXNlVmVydGV4U2hhZGVyLCB2b3J0aWNpdHlTaGFkZXIpOw0KICAgICAgICBj%0Ab25zdCBwcmVzc3VyZVByb2dyYW0gPSBuZXcgUHJvZ3JhbShiYXNlVmVydGV4U2hhZGVyLCBwcmVz%0Ac3VyZVNoYWRlcik7DQogICAgICAgIGNvbnN0IGdyYWRpZW5TdWJ0cmFjdFByb2dyYW0gPSBuZXcg%0AUHJvZ3JhbShiYXNlVmVydGV4U2hhZGVyLCBncmFkaWVudFN1YnRyYWN0U2hhZGVyKTsNCg0KICAg%0AICAgICBjb25zdCBkaXNwbGF5TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoYmFzZVZlcnRleFNoYWRl%0AciwgZGlzcGxheVNoYWRlclNvdXJjZSk7DQoNCiAgICAgICAgZnVuY3Rpb24gaW5pdEZyYW1lYnVm%0AZmVycygpIHsNCiAgICAgICAgICAgIGxldCBzaW1SZXMgPSBnZXRSZXNvbHV0aW9uKGNvbmZpZy5T%0ASU1fUkVTT0xVVElPTik7DQogICAgICAgICAgICBsZXQgZHllUmVzID0gZ2V0UmVzb2x1dGlvbihj%0Ab25maWcuRFlFX1JFU09MVVRJT04pOw0KDQogICAgICAgICAgICBjb25zdCB0ZXhUeXBlID0gZXh0%0ALmhhbGZGbG9hdFRleFR5cGU7DQogICAgICAgICAgICBjb25zdCByZ2JhID0gZXh0LmZvcm1hdFJH%0AQkE7DQogICAgICAgICAgICBjb25zdCByZyA9IGV4dC5mb3JtYXRSRzsNCiAgICAgICAgICAgIGNv%0AbnN0IHIgPSBleHQuZm9ybWF0UjsNCiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmluZyA9IGV4dC5z%0AdXBwb3J0TGluZWFyRmlsdGVyaW5nID8gZ2wuTElORUFSIDogZ2wuTkVBUkVTVDsNCg0KICAgICAg%0AICAgICAgZ2wuZGlzYWJsZShnbC5CTEVORCk7DQoNCiAgICAgICAgICAgIGlmIChkeWUgPT0gbnVs%0AbCkNCiAgICAgICAgICAgICAgICBkeWUgPSBjcmVhdGVEb3VibGVGQk8oZHllUmVzLndpZHRoLCBk%0AeWVSZXMuaGVpZ2h0LCByZ2JhLmludGVybmFsRm9ybWF0LCByZ2JhLmZvcm1hdCwgdGV4VHlwZSwg%0AZmlsdGVyaW5nKTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBkeWUgPSByZXNp%0AemVEb3VibGVGQk8oZHllLCBkeWVSZXMud2lkdGgsIGR5ZVJlcy5oZWlnaHQsIHJnYmEuaW50ZXJu%0AYWxGb3JtYXQsIHJnYmEuZm9ybWF0LCB0ZXhUeXBlLCBmaWx0ZXJpbmcpOw0KDQogICAgICAgICAg%0AICBpZiAodmVsb2NpdHkgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB2ZWxvY2l0eSA9IGNyZWF0%0AZURvdWJsZUZCTyhzaW1SZXMud2lkdGgsIHNpbVJlcy5oZWlnaHQsIHJnLmludGVybmFsRm9ybWF0%0ALCByZy5mb3JtYXQsIHRleFR5cGUsIGZpbHRlcmluZyk7DQogICAgICAgICAgICBlbHNlDQogICAg%0AICAgICAgICAgICAgdmVsb2NpdHkgPSByZXNpemVEb3VibGVGQk8odmVsb2NpdHksIHNpbVJlcy53%0AaWR0aCwgc2ltUmVzLmhlaWdodCwgcmcuaW50ZXJuYWxGb3JtYXQsIHJnLmZvcm1hdCwgdGV4VHlw%0AZSwgZmlsdGVyaW5nKTsNCg0KICAgICAgICAgICAgZGl2ZXJnZW5jZSA9IGNyZWF0ZUZCTyhzaW1S%0AZXMud2lkdGgsIHNpbVJlcy5oZWlnaHQsIHIuaW50ZXJuYWxGb3JtYXQsIHIuZm9ybWF0LCB0ZXhU%0AeXBlLCBnbC5ORUFSRVNUKTsNCiAgICAgICAgICAgIGN1cmwgPSBjcmVhdGVGQk8oc2ltUmVzLndp%0AZHRoLCBzaW1SZXMuaGVpZ2h0LCByLmludGVybmFsRm9ybWF0LCByLmZvcm1hdCwgdGV4VHlwZSwg%0AZ2wuTkVBUkVTVCk7DQogICAgICAgICAgICBwcmVzc3VyZSA9IGNyZWF0ZURvdWJsZUZCTyhzaW1S%0AZXMud2lkdGgsIHNpbVJlcy5oZWlnaHQsIHIuaW50ZXJuYWxGb3JtYXQsIHIuZm9ybWF0LCB0ZXhU%0AeXBlLCBnbC5ORUFSRVNUKTsNCg0KICAgICAgICAgICAgaW5pdEJsb29tRnJhbWVidWZmZXJzKCk7%0ADQogICAgICAgICAgICBpbml0U3VucmF5c0ZyYW1lYnVmZmVycygpOw0KICAgICAgICB9DQoNCiAg%0AICAgICAgZnVuY3Rpb24gaW5pdEJsb29tRnJhbWVidWZmZXJzKCkgew0KICAgICAgICAgICAgbGV0%0AIHJlcyA9IGdldFJlc29sdXRpb24oY29uZmlnLkJMT09NX1JFU09MVVRJT04pOw0KDQogICAgICAg%0AICAgICBjb25zdCB0ZXhUeXBlID0gZXh0LmhhbGZGbG9hdFRleFR5cGU7DQogICAgICAgICAgICBj%0Ab25zdCByZ2JhID0gZXh0LmZvcm1hdFJHQkE7DQogICAgICAgICAgICBjb25zdCBmaWx0ZXJpbmcg%0APSBleHQuc3VwcG9ydExpbmVhckZpbHRlcmluZyA/IGdsLkxJTkVBUiA6IGdsLk5FQVJFU1Q7DQoN%0ACiAgICAgICAgICAgIGJsb29tID0gY3JlYXRlRkJPKHJlcy53aWR0aCwgcmVzLmhlaWdodCwgcmdi%0AYS5pbnRlcm5hbEZvcm1hdCwgcmdiYS5mb3JtYXQsIHRleFR5cGUsIGZpbHRlcmluZyk7DQoNCiAg%0AICAgICAgICAgIGJsb29tRnJhbWVidWZmZXJzLmxlbmd0aCA9IDA7DQogICAgICAgICAgICBmb3Ig%0AKGxldCBpID0gMDsgaSA8IGNvbmZpZy5CTE9PTV9JVEVSQVRJT05TOyBpKyspIHsNCiAgICAgICAg%0AICAgICAgICBsZXQgd2lkdGggPSByZXMud2lkdGggPj4gKGkgKyAxKTsNCiAgICAgICAgICAgICAg%0AICBsZXQgaGVpZ2h0ID0gcmVzLmhlaWdodCA+PiAoaSArIDEpOw0KDQogICAgICAgICAgICAgICAg%0AaWYgKHdpZHRoIDwgMiB8fCBoZWlnaHQgPCAyKSBicmVhazsNCg0KICAgICAgICAgICAgICAgIGxl%0AdCBmYm8gPSBjcmVhdGVGQk8od2lkdGgsIGhlaWdodCwgcmdiYS5pbnRlcm5hbEZvcm1hdCwgcmdi%0AYS5mb3JtYXQsIHRleFR5cGUsIGZpbHRlcmluZyk7DQogICAgICAgICAgICAgICAgYmxvb21GcmFt%0AZWJ1ZmZlcnMucHVzaChmYm8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAg%0AZnVuY3Rpb24gaW5pdFN1bnJheXNGcmFtZWJ1ZmZlcnMoKSB7DQogICAgICAgICAgICBsZXQgcmVz%0AID0gZ2V0UmVzb2x1dGlvbihjb25maWcuU1VOUkFZU19SRVNPTFVUSU9OKTsNCg0KICAgICAgICAg%0AICAgY29uc3QgdGV4VHlwZSA9IGV4dC5oYWxmRmxvYXRUZXhUeXBlOw0KICAgICAgICAgICAgY29u%0Ac3QgciA9IGV4dC5mb3JtYXRSOw0KICAgICAgICAgICAgY29uc3QgZmlsdGVyaW5nID0gZXh0LnN1%0AcHBvcnRMaW5lYXJGaWx0ZXJpbmcgPyBnbC5MSU5FQVIgOiBnbC5ORUFSRVNUOw0KDQogICAgICAg%0AICAgICBzdW5yYXlzID0gY3JlYXRlRkJPKHJlcy53aWR0aCwgcmVzLmhlaWdodCwgci5pbnRlcm5h%0AbEZvcm1hdCwgci5mb3JtYXQsIHRleFR5cGUsIGZpbHRlcmluZyk7DQogICAgICAgICAgICBzdW5y%0AYXlzVGVtcCA9IGNyZWF0ZUZCTyhyZXMud2lkdGgsIHJlcy5oZWlnaHQsIHIuaW50ZXJuYWxGb3Jt%0AYXQsIHIuZm9ybWF0LCB0ZXhUeXBlLCBmaWx0ZXJpbmcpOw0KICAgICAgICB9DQoNCiAgICAgICAg%0AZnVuY3Rpb24gY3JlYXRlRkJPKHcsIGgsIGludGVybmFsRm9ybWF0LCBmb3JtYXQsIHR5cGUsIHBh%0AcmFtKSB7DQogICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTsNCiAgICAg%0AICAgICAgIGxldCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpOw0KICAgICAgICAgICAgZ2wu%0AYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZSk7DQogICAgICAgICAgICBnbC50ZXhQ%0AYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgcGFyYW0pOw0K%0AICAgICAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01B%0AR19GSUxURVIsIHBhcmFtKTsNCiAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVS%0ARV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLkNMQU1QX1RPX0VER0UpOw0KICAgICAgICAgICAg%0AZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xB%0ATVBfVE9fRURHRSk7DQogICAgICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAs%0AIGludGVybmFsRm9ybWF0LCB3LCBoLCAwLCBmb3JtYXQsIHR5cGUsIG51bGwpOw0KDQogICAgICAg%0AICAgICBsZXQgZmJvID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsNCiAgICAgICAgICAgIGdsLmJp%0AbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZmJvKTsNCiAgICAgICAgICAgIGdsLmZyYW1l%0AYnVmZmVyVGV4dHVyZTJEKGdsLkZSQU1FQlVGRkVSLCBnbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZ2wu%0AVEVYVFVSRV8yRCwgdGV4dHVyZSwgMCk7DQogICAgICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCB3%0ALCBoKTsNCiAgICAgICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpOw0KDQogICAg%0AICAgICAgICBsZXQgdGV4ZWxTaXplWCA9IDEuMCAvIHc7DQogICAgICAgICAgICBsZXQgdGV4ZWxT%0AaXplWSA9IDEuMCAvIGg7DQoNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAg%0AdGV4dHVyZSwNCiAgICAgICAgICAgICAgICBmYm8sDQogICAgICAgICAgICAgICAgd2lkdGg6IHcs%0ADQogICAgICAgICAgICAgICAgaGVpZ2h0OiBoLA0KICAgICAgICAgICAgICAgIHRleGVsU2l6ZVgs%0ADQogICAgICAgICAgICAgICAgdGV4ZWxTaXplWSwNCiAgICAgICAgICAgICAgICBhdHRhY2goaWQp%0AIHsNCiAgICAgICAgICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCArIGlk%0AKTsNCiAgICAgICAgICAgICAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4%0AdHVyZSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpZDsNCiAgICAgICAgICAgICAgICB9%0ADQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRG91%0AYmxlRkJPKHcsIGgsIGludGVybmFsRm9ybWF0LCBmb3JtYXQsIHR5cGUsIHBhcmFtKSB7DQogICAg%0AICAgICAgICBsZXQgZmJvMSA9IGNyZWF0ZUZCTyh3LCBoLCBpbnRlcm5hbEZvcm1hdCwgZm9ybWF0%0ALCB0eXBlLCBwYXJhbSk7DQogICAgICAgICAgICBsZXQgZmJvMiA9IGNyZWF0ZUZCTyh3LCBoLCBp%0AbnRlcm5hbEZvcm1hdCwgZm9ybWF0LCB0eXBlLCBwYXJhbSk7DQoNCiAgICAgICAgICAgIHJldHVy%0AbiB7DQogICAgICAgICAgICAgICAgd2lkdGg6IHcsDQogICAgICAgICAgICAgICAgaGVpZ2h0OiBo%0ALA0KICAgICAgICAgICAgICAgIHRleGVsU2l6ZVg6IGZibzEudGV4ZWxTaXplWCwNCiAgICAgICAg%0AICAgICAgICB0ZXhlbFNpemVZOiBmYm8xLnRleGVsU2l6ZVksDQogICAgICAgICAgICAgICAgZ2V0%0AIHJlYWQoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYm8xOw0KICAgICAgICAgICAg%0AICAgIH0sDQogICAgICAgICAgICAgICAgc2V0IHJlYWQodmFsdWUpIHsNCiAgICAgICAgICAgICAg%0AICAgICAgZmJvMSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAg%0AZ2V0IHdyaXRlKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmJvMjsNCiAgICAgICAg%0AICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNldCB3cml0ZSh2YWx1ZSkgew0KICAgICAgICAg%0AICAgICAgICAgICBmYm8yID0gdmFsdWU7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAg%0AICAgICBzd2FwKCkgew0KICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IGZibzE7DQogICAg%0AICAgICAgICAgICAgICAgIGZibzEgPSBmYm8yOw0KICAgICAgICAgICAgICAgICAgICBmYm8yID0g%0AdGVtcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAg%0AICAgICBmdW5jdGlvbiByZXNpemVGQk8odGFyZ2V0LCB3LCBoLCBpbnRlcm5hbEZvcm1hdCwgZm9y%0AbWF0LCB0eXBlLCBwYXJhbSkgew0KICAgICAgICAgICAgbGV0IG5ld0ZCTyA9IGNyZWF0ZUZCTyh3%0ALCBoLCBpbnRlcm5hbEZvcm1hdCwgZm9ybWF0LCB0eXBlLCBwYXJhbSk7DQogICAgICAgICAgICBj%0Ab3B5UHJvZ3JhbS5iaW5kKCk7DQogICAgICAgICAgICBnbC51bmlmb3JtMWkoY29weVByb2dyYW0u%0AdW5pZm9ybXMudVRleHR1cmUsIHRhcmdldC5hdHRhY2goMCkpOw0KICAgICAgICAgICAgYmxpdChu%0AZXdGQk8pOw0KICAgICAgICAgICAgcmV0dXJuIG5ld0ZCTzsNCiAgICAgICAgfQ0KDQogICAgICAg%0AIGZ1bmN0aW9uIHJlc2l6ZURvdWJsZUZCTyh0YXJnZXQsIHcsIGgsIGludGVybmFsRm9ybWF0LCBm%0Ab3JtYXQsIHR5cGUsIHBhcmFtKSB7DQogICAgICAgICAgICBpZiAodGFyZ2V0LndpZHRoID09IHcg%0AJiYgdGFyZ2V0LmhlaWdodCA9PSBoKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7DQog%0AICAgICAgICAgICB0YXJnZXQucmVhZCA9IHJlc2l6ZUZCTyh0YXJnZXQucmVhZCwgdywgaCwgaW50%0AZXJuYWxGb3JtYXQsIGZvcm1hdCwgdHlwZSwgcGFyYW0pOw0KICAgICAgICAgICAgdGFyZ2V0Lndy%0AaXRlID0gY3JlYXRlRkJPKHcsIGgsIGludGVybmFsRm9ybWF0LCBmb3JtYXQsIHR5cGUsIHBhcmFt%0AKTsNCiAgICAgICAgICAgIHRhcmdldC53aWR0aCA9IHc7DQogICAgICAgICAgICB0YXJnZXQuaGVp%0AZ2h0ID0gaDsNCiAgICAgICAgICAgIHRhcmdldC50ZXhlbFNpemVYID0gMS4wIC8gdzsNCiAgICAg%0AICAgICAgIHRhcmdldC50ZXhlbFNpemVZID0gMS4wIC8gaDsNCiAgICAgICAgICAgIHJldHVybiB0%0AYXJnZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVUZXh0dXJlQXN5bmMo%0AdXJsKSB7DQogICAgICAgICAgICBsZXQgdGV4dHVyZSA9IGdsLmNyZWF0ZVRleHR1cmUoKTsNCiAg%0AICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRleHR1cmUpOw0KICAgICAg%0AICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxU%0ARVIsIGdsLkxJTkVBUik7DQogICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVf%0AMkQsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTElORUFSKTsNCiAgICAgICAgICAgIGdsLnRl%0AeFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLlJFUEVBVCk7%0ADQogICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVf%0AV1JBUF9ULCBnbC5SRVBFQVQpOw0KICAgICAgICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJF%0AXzJELCAwLCBnbC5SR0IsIDEsIDEsIDAsIGdsLlJHQiwgZ2wuVU5TSUdORURfQllURSwgbmV3IFVp%0AbnQ4QXJyYXkoWzI1NSwgMjU1LCAyNTVdKSk7DQoNCiAgICAgICAgICAgIGxldCBvYmogPSB7DQog%0AICAgICAgICAgICAgICAgdGV4dHVyZSwNCiAgICAgICAgICAgICAgICB3aWR0aDogMSwNCiAgICAg%0AICAgICAgICAgICBoZWlnaHQ6IDEsDQogICAgICAgICAgICAgICAgYXR0YWNoKGlkKSB7DQogICAg%0AICAgICAgICAgICAgICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTAgKyBpZCk7DQogICAg%0AICAgICAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRleHR1cmUpOw0K%0AICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAg%0AICAgICAgfTsNCg0KICAgICAgICAgICAgbGV0IGltYWdlID0gbmV3IEltYWdlKCk7DQogICAgICAg%0AICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgb2JqLndpZHRoID0g%0AaW1hZ2Uud2lkdGg7DQogICAgICAgICAgICAgICAgb2JqLmhlaWdodCA9IGltYWdlLmhlaWdodDsN%0ACiAgICAgICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXh0dXJlKTsN%0ACiAgICAgICAgICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLlJHQiwg%0AZ2wuUkdCLCBnbC5VTlNJR05FRF9CWVRFLCBpbWFnZSk7DQogICAgICAgICAgICB9Ow0KICAgICAg%0AICAgICAgaW1hZ2Uuc3JjID0gdXJsOw0KDQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAg%0AICB9DQoNCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlS2V5d29yZHMoKSB7DQogICAgICAgICAgICBs%0AZXQgZGlzcGxheUtleXdvcmRzID0gW107DQogICAgICAgICAgICBpZiAoY29uZmlnLlNIQURJTkcp%0AIGRpc3BsYXlLZXl3b3Jkcy5wdXNoKCJTSEFESU5HIik7DQogICAgICAgICAgICBpZiAoY29uZmln%0ALkJMT09NKSBkaXNwbGF5S2V5d29yZHMucHVzaCgiQkxPT00iKTsNCiAgICAgICAgICAgIGlmIChj%0Ab25maWcuU1VOUkFZUykgZGlzcGxheUtleXdvcmRzLnB1c2goIlNVTlJBWVMiKTsNCiAgICAgICAg%0AICAgIGRpc3BsYXlNYXRlcmlhbC5zZXRLZXl3b3JkcyhkaXNwbGF5S2V5d29yZHMpOw0KICAgICAg%0AICB9DQoNCiAgICAgICAgdXBkYXRlS2V5d29yZHMoKTsNCiAgICAgICAgaW5pdEZyYW1lYnVmZmVy%0AcygpOw0KICAgICAgICBtdWx0aXBsZVNwbGF0cyhwYXJzZUludChNYXRoLnJhbmRvbSgpICogMjAp%0AICsgNSk7DQoNCiAgICAgICAgbGV0IGxhc3RVcGRhdGVUaW1lID0gRGF0ZS5ub3coKTsNCiAgICAg%0AICAgbGV0IGNvbG9yVXBkYXRlVGltZXIgPSAwLjA7DQogICAgICAgIHVwZGF0ZSgpOw0KDQogICAg%0AICAgIGZ1bmN0aW9uIHVwZGF0ZSgpIHsNCiAgICAgICAgICAgIGNvbnN0IGR0ID0gY2FsY0RlbHRh%0AVGltZSgpOw0KICAgICAgICAgICAgaWYgKHJlc2l6ZUNhbnZhcygpKQ0KICAgICAgICAgICAgICAg%0AIGluaXRGcmFtZWJ1ZmZlcnMoKTsNCiAgICAgICAgICAgIHVwZGF0ZUNvbG9ycyhkdCk7DQogICAg%0AICAgICAgICBhcHBseUlucHV0cygpOw0KICAgICAgICAgICAgc3RlcChkdCk7DQogICAgICAgICAg%0AICByZW5kZXIobnVsbCk7DQogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodXBkYXRl%0AKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGNhbGNEZWx0YVRpbWUoKSB7DQogICAg%0AICAgICAgICBsZXQgbm93ID0gRGF0ZS5ub3coKTsNCiAgICAgICAgICAgIGxldCBkdCA9IChub3cg%0ALSBsYXN0VXBkYXRlVGltZSkgLyAxMDAwOw0KICAgICAgICAgICAgZHQgPSBNYXRoLm1pbihkdCwg%0AMC4wMTY2NjYpOw0KICAgICAgICAgICAgbGFzdFVwZGF0ZVRpbWUgPSBub3c7DQogICAgICAgICAg%0AICByZXR1cm4gZHQ7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiByZXNpemVDYW52YXMo%0AKSB7DQogICAgICAgICAgICBsZXQgd2lkdGggPSBzY2FsZUJ5UGl4ZWxSYXRpbyhjYW52YXMuY2xp%0AZW50V2lkdGgpOw0KICAgICAgICAgICAgbGV0IGhlaWdodCA9IHNjYWxlQnlQaXhlbFJhdGlvKGNh%0AbnZhcy5jbGllbnRIZWlnaHQpOw0KICAgICAgICAgICAgaWYgKGNhbnZhcy53aWR0aCAhPSB3aWR0%0AaCB8fCBjYW52YXMuaGVpZ2h0ICE9IGhlaWdodCkgew0KICAgICAgICAgICAgICAgIGNhbnZhcy53%0AaWR0aCA9IHdpZHRoOw0KICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7DQog%0AICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBy%0AZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVDb2xvcnMo%0AZHQpIHsNCiAgICAgICAgICAgIGlmICghY29uZmlnLkNPTE9SRlVMKSByZXR1cm47DQoNCiAgICAg%0AICAgICAgIGNvbG9yVXBkYXRlVGltZXIgKz0gZHQgKiBjb25maWcuQ09MT1JfVVBEQVRFX1NQRUVE%0AOw0KICAgICAgICAgICAgaWYgKGNvbG9yVXBkYXRlVGltZXIgPj0gMSkgew0KICAgICAgICAgICAg%0AICAgIGNvbG9yVXBkYXRlVGltZXIgPSB3cmFwKGNvbG9yVXBkYXRlVGltZXIsIDAsIDEpOw0KICAg%0AICAgICAgICAgICAgIHBvaW50ZXJzLmZvckVhY2gocCA9PiB7DQogICAgICAgICAgICAgICAgICAg%0AIHAuY29sb3IgPSBnZW5lcmF0ZUNvbG9yKCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAg%0AICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBhcHBseUlucHV0cygpIHsNCiAg%0AICAgICAgICAgIGlmIChzcGxhdFN0YWNrLmxlbmd0aCA+IDApDQogICAgICAgICAgICAgICAgbXVs%0AdGlwbGVTcGxhdHMoc3BsYXRTdGFjay5wb3AoKSk7DQoNCiAgICAgICAgICAgIHBvaW50ZXJzLmZv%0AckVhY2gocCA9PiB7DQogICAgICAgICAgICAgICAgaWYgKHAubW92ZWQpIHsNCiAgICAgICAgICAg%0AICAgICAgICAgcC5tb3ZlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICBzcGxhdFBvaW50%0AZXIocCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0K%0AICAgICAgICBmdW5jdGlvbiBzdGVwKGR0KSB7DQogICAgICAgICAgICBnbC5kaXNhYmxlKGdsLkJM%0ARU5EKTsNCg0KICAgICAgICAgICAgY3VybFByb2dyYW0uYmluZCgpOw0KICAgICAgICAgICAgZ2wu%0AdW5pZm9ybTJmKGN1cmxQcm9ncmFtLnVuaWZvcm1zLnRleGVsU2l6ZSwgdmVsb2NpdHkudGV4ZWxT%0AaXplWCwgdmVsb2NpdHkudGV4ZWxTaXplWSk7DQogICAgICAgICAgICBnbC51bmlmb3JtMWkoY3Vy%0AbFByb2dyYW0udW5pZm9ybXMudVZlbG9jaXR5LCB2ZWxvY2l0eS5yZWFkLmF0dGFjaCgwKSk7DQog%0AICAgICAgICAgICBibGl0KGN1cmwpOw0KDQogICAgICAgICAgICB2b3J0aWNpdHlQcm9ncmFtLmJp%0AbmQoKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0yZih2b3J0aWNpdHlQcm9ncmFtLnVuaWZvcm1z%0ALnRleGVsU2l6ZSwgdmVsb2NpdHkudGV4ZWxTaXplWCwgdmVsb2NpdHkudGV4ZWxTaXplWSk7DQog%0AICAgICAgICAgICBnbC51bmlmb3JtMWkodm9ydGljaXR5UHJvZ3JhbS51bmlmb3Jtcy51VmVsb2Np%0AdHksIHZlbG9jaXR5LnJlYWQuYXR0YWNoKDApKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xaSh2%0Ab3J0aWNpdHlQcm9ncmFtLnVuaWZvcm1zLnVDdXJsLCBjdXJsLmF0dGFjaCgxKSk7DQogICAgICAg%0AICAgICBnbC51bmlmb3JtMWYodm9ydGljaXR5UHJvZ3JhbS51bmlmb3Jtcy5jdXJsLCBjb25maWcu%0AQ1VSTCk7DQogICAgICAgICAgICBnbC51bmlmb3JtMWYodm9ydGljaXR5UHJvZ3JhbS51bmlmb3Jt%0Acy5kdCwgZHQpOw0KICAgICAgICAgICAgYmxpdCh2ZWxvY2l0eS53cml0ZSk7DQogICAgICAgICAg%0AICB2ZWxvY2l0eS5zd2FwKCk7DQoNCiAgICAgICAgICAgIGRpdmVyZ2VuY2VQcm9ncmFtLmJpbmQo%0AKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0yZihkaXZlcmdlbmNlUHJvZ3JhbS51bmlmb3Jtcy50%0AZXhlbFNpemUsIHZlbG9jaXR5LnRleGVsU2l6ZVgsIHZlbG9jaXR5LnRleGVsU2l6ZVkpOw0KICAg%0AICAgICAgICAgZ2wudW5pZm9ybTFpKGRpdmVyZ2VuY2VQcm9ncmFtLnVuaWZvcm1zLnVWZWxvY2l0%0AeSwgdmVsb2NpdHkucmVhZC5hdHRhY2goMCkpOw0KICAgICAgICAgICAgYmxpdChkaXZlcmdlbmNl%0AKTsNCg0KICAgICAgICAgICAgY2xlYXJQcm9ncmFtLmJpbmQoKTsNCiAgICAgICAgICAgIGdsLnVu%0AaWZvcm0xaShjbGVhclByb2dyYW0udW5pZm9ybXMudVRleHR1cmUsIHByZXNzdXJlLnJlYWQuYXR0%0AYWNoKDApKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xZihjbGVhclByb2dyYW0udW5pZm9ybXMu%0AdmFsdWUsIGNvbmZpZy5QUkVTU1VSRSk7DQogICAgICAgICAgICBibGl0KHByZXNzdXJlLndyaXRl%0AKTsNCiAgICAgICAgICAgIHByZXNzdXJlLnN3YXAoKTsNCg0KICAgICAgICAgICAgcHJlc3N1cmVQ%0Acm9ncmFtLmJpbmQoKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0yZihwcmVzc3VyZVByb2dyYW0u%0AdW5pZm9ybXMudGV4ZWxTaXplLCB2ZWxvY2l0eS50ZXhlbFNpemVYLCB2ZWxvY2l0eS50ZXhlbFNp%0AemVZKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xaShwcmVzc3VyZVByb2dyYW0udW5pZm9ybXMu%0AdURpdmVyZ2VuY2UsIGRpdmVyZ2VuY2UuYXR0YWNoKDApKTsNCiAgICAgICAgICAgIGZvciAobGV0%0AIGkgPSAwOyBpIDwgY29uZmlnLlBSRVNTVVJFX0lURVJBVElPTlM7IGkrKykgew0KICAgICAgICAg%0AICAgICAgIGdsLnVuaWZvcm0xaShwcmVzc3VyZVByb2dyYW0udW5pZm9ybXMudVByZXNzdXJlLCBw%0AcmVzc3VyZS5yZWFkLmF0dGFjaCgxKSk7DQogICAgICAgICAgICAgICAgYmxpdChwcmVzc3VyZS53%0Acml0ZSk7DQogICAgICAgICAgICAgICAgcHJlc3N1cmUuc3dhcCgpOw0KICAgICAgICAgICAgfQ0K%0ADQogICAgICAgICAgICBncmFkaWVuU3VidHJhY3RQcm9ncmFtLmJpbmQoKTsNCiAgICAgICAgICAg%0AIGdsLnVuaWZvcm0yZihncmFkaWVuU3VidHJhY3RQcm9ncmFtLnVuaWZvcm1zLnRleGVsU2l6ZSwg%0AdmVsb2NpdHkudGV4ZWxTaXplWCwgdmVsb2NpdHkudGV4ZWxTaXplWSk7DQogICAgICAgICAgICBn%0AbC51bmlmb3JtMWkoZ3JhZGllblN1YnRyYWN0UHJvZ3JhbS51bmlmb3Jtcy51UHJlc3N1cmUsIHBy%0AZXNzdXJlLnJlYWQuYXR0YWNoKDApKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xaShncmFkaWVu%0AU3VidHJhY3RQcm9ncmFtLnVuaWZvcm1zLnVWZWxvY2l0eSwgdmVsb2NpdHkucmVhZC5hdHRhY2go%0AMSkpOw0KICAgICAgICAgICAgYmxpdCh2ZWxvY2l0eS53cml0ZSk7DQogICAgICAgICAgICB2ZWxv%0AY2l0eS5zd2FwKCk7DQoNCiAgICAgICAgICAgIGFkdmVjdGlvblByb2dyYW0uYmluZCgpOw0KICAg%0AICAgICAgICAgZ2wudW5pZm9ybTJmKGFkdmVjdGlvblByb2dyYW0udW5pZm9ybXMudGV4ZWxTaXpl%0ALCB2ZWxvY2l0eS50ZXhlbFNpemVYLCB2ZWxvY2l0eS50ZXhlbFNpemVZKTsNCiAgICAgICAgICAg%0AIGlmICghZXh0LnN1cHBvcnRMaW5lYXJGaWx0ZXJpbmcpDQogICAgICAgICAgICAgICAgZ2wudW5p%0AZm9ybTJmKGFkdmVjdGlvblByb2dyYW0udW5pZm9ybXMuZHllVGV4ZWxTaXplLCB2ZWxvY2l0eS50%0AZXhlbFNpemVYLCB2ZWxvY2l0eS50ZXhlbFNpemVZKTsNCiAgICAgICAgICAgIGxldCB2ZWxvY2l0%0AeUlkID0gdmVsb2NpdHkucmVhZC5hdHRhY2goMCk7DQogICAgICAgICAgICBnbC51bmlmb3JtMWko%0AYWR2ZWN0aW9uUHJvZ3JhbS51bmlmb3Jtcy51VmVsb2NpdHksIHZlbG9jaXR5SWQpOw0KICAgICAg%0AICAgICAgZ2wudW5pZm9ybTFpKGFkdmVjdGlvblByb2dyYW0udW5pZm9ybXMudVNvdXJjZSwgdmVs%0Ab2NpdHlJZCk7DQogICAgICAgICAgICBnbC51bmlmb3JtMWYoYWR2ZWN0aW9uUHJvZ3JhbS51bmlm%0Ab3Jtcy5kdCwgZHQpOw0KICAgICAgICAgICAgZ2wudW5pZm9ybTFmKGFkdmVjdGlvblByb2dyYW0u%0AdW5pZm9ybXMuZGlzc2lwYXRpb24sIGNvbmZpZy5WRUxPQ0lUWV9ESVNTSVBBVElPTik7DQogICAg%0AICAgICAgICBibGl0KHZlbG9jaXR5LndyaXRlKTsNCiAgICAgICAgICAgIHZlbG9jaXR5LnN3YXAo%0AKTsNCg0KICAgICAgICAgICAgaWYgKCFleHQuc3VwcG9ydExpbmVhckZpbHRlcmluZykNCiAgICAg%0AICAgICAgICAgICBnbC51bmlmb3JtMmYoYWR2ZWN0aW9uUHJvZ3JhbS51bmlmb3Jtcy5keWVUZXhl%0AbFNpemUsIGR5ZS50ZXhlbFNpemVYLCBkeWUudGV4ZWxTaXplWSk7DQogICAgICAgICAgICBnbC51%0Abmlmb3JtMWkoYWR2ZWN0aW9uUHJvZ3JhbS51bmlmb3Jtcy51VmVsb2NpdHksIHZlbG9jaXR5LnJl%0AYWQuYXR0YWNoKDApKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xaShhZHZlY3Rpb25Qcm9ncmFt%0ALnVuaWZvcm1zLnVTb3VyY2UsIGR5ZS5yZWFkLmF0dGFjaCgxKSk7DQogICAgICAgICAgICBnbC51%0Abmlmb3JtMWYoYWR2ZWN0aW9uUHJvZ3JhbS51bmlmb3Jtcy5kaXNzaXBhdGlvbiwgY29uZmlnLkRF%0ATlNJVFlfRElTU0lQQVRJT04pOw0KICAgICAgICAgICAgYmxpdChkeWUud3JpdGUpOw0KICAgICAg%0AICAgICAgZHllLnN3YXAoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHJlbmRlcih0%0AYXJnZXQpIHsNCiAgICAgICAgICAgIGlmIChjb25maWcuQkxPT00pDQogICAgICAgICAgICAgICAg%0AYXBwbHlCbG9vbShkeWUucmVhZCwgYmxvb20pOw0KICAgICAgICAgICAgaWYgKGNvbmZpZy5TVU5S%0AQVlTKSB7DQogICAgICAgICAgICAgICAgYXBwbHlTdW5yYXlzKGR5ZS5yZWFkLCBkeWUud3JpdGUs%0AIHN1bnJheXMpOw0KICAgICAgICAgICAgICAgIGJsdXIoc3VucmF5cywgc3VucmF5c1RlbXAsIDEp%0AOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodGFyZ2V0ID09IG51bGwgfHwgIWNv%0AbmZpZy5UUkFOU1BBUkVOVCkgew0KICAgICAgICAgICAgICAgIGdsLmJsZW5kRnVuYyhnbC5PTkUs%0AIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEpOw0KICAgICAgICAgICAgICAgIGdsLmVuYWJsZShnbC5C%0ATEVORCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGdsLmRpc2FibGUo%0AZ2wuQkxFTkQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIWNvbmZpZy5UUkFO%0AU1BBUkVOVCkNCiAgICAgICAgICAgICAgICBkcmF3Q29sb3IodGFyZ2V0LCBub3JtYWxpemVDb2xv%0Acihjb25maWcuQkFDS19DT0xPUikpOw0KICAgICAgICAgICAgaWYgKHRhcmdldCA9PSBudWxsICYm%0AIGNvbmZpZy5UUkFOU1BBUkVOVCkNCiAgICAgICAgICAgICAgICBkcmF3Q2hlY2tlcmJvYXJkKHRh%0AcmdldCk7DQogICAgICAgICAgICBkcmF3RGlzcGxheSh0YXJnZXQpOw0KICAgICAgICB9DQoNCiAg%0AICAgICAgZnVuY3Rpb24gZHJhd0NvbG9yKHRhcmdldCwgY29sb3IpIHsNCiAgICAgICAgICAgIGNv%0AbG9yUHJvZ3JhbS5iaW5kKCk7DQogICAgICAgICAgICBnbC51bmlmb3JtNGYoY29sb3JQcm9ncmFt%0ALnVuaWZvcm1zLmNvbG9yLCBjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iLCAxKTsNCiAgICAgICAg%0AICAgIGJsaXQodGFyZ2V0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGRyYXdDaGVj%0Aa2VyYm9hcmQodGFyZ2V0KSB7DQogICAgICAgICAgICBjaGVja2VyYm9hcmRQcm9ncmFtLmJpbmQo%0AKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xZihjaGVja2VyYm9hcmRQcm9ncmFtLnVuaWZvcm1z%0ALmFzcGVjdFJhdGlvLCBjYW52YXMud2lkdGggLyBjYW52YXMuaGVpZ2h0KTsNCiAgICAgICAgICAg%0AIGJsaXQodGFyZ2V0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGRyYXdEaXNwbGF5%0AKHRhcmdldCkgew0KICAgICAgICAgICAgbGV0IHdpZHRoID0gdGFyZ2V0ID09IG51bGwgPyBnbC5k%0AcmF3aW5nQnVmZmVyV2lkdGggOiB0YXJnZXQud2lkdGg7DQogICAgICAgICAgICBsZXQgaGVpZ2h0%0AID0gdGFyZ2V0ID09IG51bGwgPyBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0IDogdGFyZ2V0LmhlaWdo%0AdDsNCg0KICAgICAgICAgICAgZGlzcGxheU1hdGVyaWFsLmJpbmQoKTsNCiAgICAgICAgICAgIGlm%0AIChjb25maWcuU0hBRElORykNCiAgICAgICAgICAgICAgICBnbC51bmlmb3JtMmYoZGlzcGxheU1h%0AdGVyaWFsLnVuaWZvcm1zLnRleGVsU2l6ZSwgMS4wIC8gd2lkdGgsIDEuMCAvIGhlaWdodCk7DQog%0AICAgICAgICAgICBnbC51bmlmb3JtMWkoZGlzcGxheU1hdGVyaWFsLnVuaWZvcm1zLnVUZXh0dXJl%0ALCBkeWUucmVhZC5hdHRhY2goMCkpOw0KICAgICAgICAgICAgaWYgKGNvbmZpZy5CTE9PTSkgew0K%0AICAgICAgICAgICAgICAgIGdsLnVuaWZvcm0xaShkaXNwbGF5TWF0ZXJpYWwudW5pZm9ybXMudUJs%0Ab29tLCBibG9vbS5hdHRhY2goMSkpOw0KICAgICAgICAgICAgICAgIGdsLnVuaWZvcm0xaShkaXNw%0AbGF5TWF0ZXJpYWwudW5pZm9ybXMudURpdGhlcmluZywgZGl0aGVyaW5nVGV4dHVyZS5hdHRhY2go%0AMikpOw0KICAgICAgICAgICAgICAgIGxldCBzY2FsZSA9IGdldFRleHR1cmVTY2FsZShkaXRoZXJp%0AbmdUZXh0dXJlLCB3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBnbC51bmlmb3JtMmYo%0AZGlzcGxheU1hdGVyaWFsLnVuaWZvcm1zLmRpdGhlclNjYWxlLCBzY2FsZS54LCBzY2FsZS55KTsN%0ACiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChjb25maWcuU1VOUkFZUykNCiAgICAgICAg%0AICAgICAgICBnbC51bmlmb3JtMWkoZGlzcGxheU1hdGVyaWFsLnVuaWZvcm1zLnVTdW5yYXlzLCBz%0AdW5yYXlzLmF0dGFjaCgzKSk7DQogICAgICAgICAgICBibGl0KHRhcmdldCk7DQogICAgICAgIH0N%0ACg0KICAgICAgICBmdW5jdGlvbiBhcHBseUJsb29tKHNvdXJjZSwgZGVzdGluYXRpb24pIHsNCiAg%0AICAgICAgICAgIGlmIChibG9vbUZyYW1lYnVmZmVycy5sZW5ndGggPCAyKQ0KICAgICAgICAgICAg%0AICAgIHJldHVybjsNCg0KICAgICAgICAgICAgbGV0IGxhc3QgPSBkZXN0aW5hdGlvbjsNCg0KICAg%0AICAgICAgICAgZ2wuZGlzYWJsZShnbC5CTEVORCk7DQogICAgICAgICAgICBibG9vbVByZWZpbHRl%0AclByb2dyYW0uYmluZCgpOw0KICAgICAgICAgICAgbGV0IGtuZWUgPSBjb25maWcuQkxPT01fVEhS%0ARVNIT0xEICogY29uZmlnLkJMT09NX1NPRlRfS05FRSArIDAuMDAwMTsNCiAgICAgICAgICAgIGxl%0AdCBjdXJ2ZTAgPSBjb25maWcuQkxPT01fVEhSRVNIT0xEIC0ga25lZTsNCiAgICAgICAgICAgIGxl%0AdCBjdXJ2ZTEgPSBrbmVlICogMjsNCiAgICAgICAgICAgIGxldCBjdXJ2ZTIgPSAwLjI1IC8ga25l%0AZTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0zZihibG9vbVByZWZpbHRlclByb2dyYW0udW5pZm9y%0AbXMuY3VydmUsIGN1cnZlMCwgY3VydmUxLCBjdXJ2ZTIpOw0KICAgICAgICAgICAgZ2wudW5pZm9y%0AbTFmKGJsb29tUHJlZmlsdGVyUHJvZ3JhbS51bmlmb3Jtcy50aHJlc2hvbGQsIGNvbmZpZy5CTE9P%0ATV9USFJFU0hPTEQpOw0KICAgICAgICAgICAgZ2wudW5pZm9ybTFpKGJsb29tUHJlZmlsdGVyUHJv%0AZ3JhbS51bmlmb3Jtcy51VGV4dHVyZSwgc291cmNlLmF0dGFjaCgwKSk7DQogICAgICAgICAgICBi%0AbGl0KGxhc3QpOw0KDQogICAgICAgICAgICBibG9vbUJsdXJQcm9ncmFtLmJpbmQoKTsNCiAgICAg%0AICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvb21GcmFtZWJ1ZmZlcnMubGVuZ3RoOyBpKysp%0AIHsNCiAgICAgICAgICAgICAgICBsZXQgZGVzdCA9IGJsb29tRnJhbWVidWZmZXJzW2ldOw0KICAg%0AICAgICAgICAgICAgIGdsLnVuaWZvcm0yZihibG9vbUJsdXJQcm9ncmFtLnVuaWZvcm1zLnRleGVs%0AU2l6ZSwgbGFzdC50ZXhlbFNpemVYLCBsYXN0LnRleGVsU2l6ZVkpOw0KICAgICAgICAgICAgICAg%0AIGdsLnVuaWZvcm0xaShibG9vbUJsdXJQcm9ncmFtLnVuaWZvcm1zLnVUZXh0dXJlLCBsYXN0LmF0%0AdGFjaCgwKSk7DQogICAgICAgICAgICAgICAgYmxpdChkZXN0KTsNCiAgICAgICAgICAgICAgICBs%0AYXN0ID0gZGVzdDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZ2wuYmxlbmRGdW5jKGds%0ALk9ORSwgZ2wuT05FKTsNCiAgICAgICAgICAgIGdsLmVuYWJsZShnbC5CTEVORCk7DQoNCiAgICAg%0AICAgICAgIGZvciAobGV0IGkgPSBibG9vbUZyYW1lYnVmZmVycy5sZW5ndGggLSAyOyBpID49IDA7%0AIGktLSkgew0KICAgICAgICAgICAgICAgIGxldCBiYXNlVGV4ID0gYmxvb21GcmFtZWJ1ZmZlcnNb%0AaV07DQogICAgICAgICAgICAgICAgZ2wudW5pZm9ybTJmKGJsb29tQmx1clByb2dyYW0udW5pZm9y%0AbXMudGV4ZWxTaXplLCBsYXN0LnRleGVsU2l6ZVgsIGxhc3QudGV4ZWxTaXplWSk7DQogICAgICAg%0AICAgICAgICAgZ2wudW5pZm9ybTFpKGJsb29tQmx1clByb2dyYW0udW5pZm9ybXMudVRleHR1cmUs%0AIGxhc3QuYXR0YWNoKDApKTsNCiAgICAgICAgICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCBiYXNl%0AVGV4LndpZHRoLCBiYXNlVGV4LmhlaWdodCk7DQogICAgICAgICAgICAgICAgYmxpdChiYXNlVGV4%0AKTsNCiAgICAgICAgICAgICAgICBsYXN0ID0gYmFzZVRleDsNCiAgICAgICAgICAgIH0NCg0KICAg%0AICAgICAgICAgZ2wuZGlzYWJsZShnbC5CTEVORCk7DQogICAgICAgICAgICBibG9vbUZpbmFsUHJv%0AZ3JhbS5iaW5kKCk7DQogICAgICAgICAgICBnbC51bmlmb3JtMmYoYmxvb21GaW5hbFByb2dyYW0u%0AdW5pZm9ybXMudGV4ZWxTaXplLCBsYXN0LnRleGVsU2l6ZVgsIGxhc3QudGV4ZWxTaXplWSk7DQog%0AICAgICAgICAgICBnbC51bmlmb3JtMWkoYmxvb21GaW5hbFByb2dyYW0udW5pZm9ybXMudVRleHR1%0AcmUsIGxhc3QuYXR0YWNoKDApKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xZihibG9vbUZpbmFs%0AUHJvZ3JhbS51bmlmb3Jtcy5pbnRlbnNpdHksIGNvbmZpZy5CTE9PTV9JTlRFTlNJVFkpOw0KICAg%0AICAgICAgICAgYmxpdChkZXN0aW5hdGlvbik7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlv%0AbiBhcHBseVN1bnJheXMoc291cmNlLCBtYXNrLCBkZXN0aW5hdGlvbikgew0KICAgICAgICAgICAg%0AZ2wuZGlzYWJsZShnbC5CTEVORCk7DQogICAgICAgICAgICBzdW5yYXlzTWFza1Byb2dyYW0uYmlu%0AZCgpOw0KICAgICAgICAgICAgZ2wudW5pZm9ybTFpKHN1bnJheXNNYXNrUHJvZ3JhbS51bmlmb3Jt%0Acy51VGV4dHVyZSwgc291cmNlLmF0dGFjaCgwKSk7DQogICAgICAgICAgICBibGl0KG1hc2spOw0K%0ADQogICAgICAgICAgICBzdW5yYXlzUHJvZ3JhbS5iaW5kKCk7DQogICAgICAgICAgICBnbC51bmlm%0Ab3JtMWYoc3VucmF5c1Byb2dyYW0udW5pZm9ybXMud2VpZ2h0LCBjb25maWcuU1VOUkFZU19XRUlH%0ASFQpOw0KICAgICAgICAgICAgZ2wudW5pZm9ybTFpKHN1bnJheXNQcm9ncmFtLnVuaWZvcm1zLnVU%0AZXh0dXJlLCBtYXNrLmF0dGFjaCgwKSk7DQogICAgICAgICAgICBibGl0KGRlc3RpbmF0aW9uKTsN%0ACiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGJsdXIodGFyZ2V0LCB0ZW1wLCBpdGVyYXRp%0Ab25zKSB7DQogICAgICAgICAgICBibHVyUHJvZ3JhbS5iaW5kKCk7DQogICAgICAgICAgICBmb3Ig%0AKGxldCBpID0gMDsgaSA8IGl0ZXJhdGlvbnM7IGkrKykgew0KICAgICAgICAgICAgICAgIGdsLnVu%0AaWZvcm0yZihibHVyUHJvZ3JhbS51bmlmb3Jtcy50ZXhlbFNpemUsIHRhcmdldC50ZXhlbFNpemVY%0ALCAwLjApOw0KICAgICAgICAgICAgICAgIGdsLnVuaWZvcm0xaShibHVyUHJvZ3JhbS51bmlmb3Jt%0Acy51VGV4dHVyZSwgdGFyZ2V0LmF0dGFjaCgwKSk7DQogICAgICAgICAgICAgICAgYmxpdCh0ZW1w%0AKTsNCg0KICAgICAgICAgICAgICAgIGdsLnVuaWZvcm0yZihibHVyUHJvZ3JhbS51bmlmb3Jtcy50%0AZXhlbFNpemUsIDAuMCwgdGFyZ2V0LnRleGVsU2l6ZVkpOw0KICAgICAgICAgICAgICAgIGdsLnVu%0AaWZvcm0xaShibHVyUHJvZ3JhbS51bmlmb3Jtcy51VGV4dHVyZSwgdGVtcC5hdHRhY2goMCkpOw0K%0AICAgICAgICAgICAgICAgIGJsaXQodGFyZ2V0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0K%0ADQogICAgICAgIGZ1bmN0aW9uIHNwbGF0UG9pbnRlcihwb2ludGVyKSB7DQogICAgICAgICAgICBs%0AZXQgZHggPSBwb2ludGVyLmRlbHRhWCAqIGNvbmZpZy5TUExBVF9GT1JDRTsNCiAgICAgICAgICAg%0AIGxldCBkeSA9IHBvaW50ZXIuZGVsdGFZICogY29uZmlnLlNQTEFUX0ZPUkNFOw0KICAgICAgICAg%0AICAgc3BsYXQocG9pbnRlci50ZXhjb29yZFgsIHBvaW50ZXIudGV4Y29vcmRZLCBkeCwgZHksIHBv%0AaW50ZXIuY29sb3IpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbGVTcGxh%0AdHMoYW1vdW50KSB7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFtb3VudDsgaSsr%0AKSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBnZW5lcmF0ZUNvbG9yKCk7DQogICAg%0AICAgICAgICAgICAgY29sb3IuciAqPSAxMC4wOw0KICAgICAgICAgICAgICAgIGNvbG9yLmcgKj0g%0AMTAuMDsNCiAgICAgICAgICAgICAgICBjb2xvci5iICo9IDEwLjA7DQogICAgICAgICAgICAgICAg%0AY29uc3QgeCA9IE1hdGgucmFuZG9tKCk7DQogICAgICAgICAgICAgICAgY29uc3QgeSA9IE1hdGgu%0AcmFuZG9tKCk7DQogICAgICAgICAgICAgICAgY29uc3QgZHggPSAxMDAwICogKE1hdGgucmFuZG9t%0AKCkgLSAwLjUpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0gMTAwMCAqIChNYXRoLnJhbmRv%0AbSgpIC0gMC41KTsNCiAgICAgICAgICAgICAgICBzcGxhdCh4LCB5LCBkeCwgZHksIGNvbG9yKTsN%0ACiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHNwbGF0KHgsIHks%0AIGR4LCBkeSwgY29sb3IpIHsNCiAgICAgICAgICAgIHNwbGF0UHJvZ3JhbS5iaW5kKCk7DQogICAg%0AICAgICAgICBnbC51bmlmb3JtMWkoc3BsYXRQcm9ncmFtLnVuaWZvcm1zLnVUYXJnZXQsIHZlbG9j%0AaXR5LnJlYWQuYXR0YWNoKDApKTsNCiAgICAgICAgICAgIGdsLnVuaWZvcm0xZihzcGxhdFByb2dy%0AYW0udW5pZm9ybXMuYXNwZWN0UmF0aW8sIGNhbnZhcy53aWR0aCAvIGNhbnZhcy5oZWlnaHQpOw0K%0AICAgICAgICAgICAgZ2wudW5pZm9ybTJmKHNwbGF0UHJvZ3JhbS51bmlmb3Jtcy5wb2ludCwgeCwg%0AeSk7DQogICAgICAgICAgICBnbC51bmlmb3JtM2Yoc3BsYXRQcm9ncmFtLnVuaWZvcm1zLmNvbG9y%0ALCBkeCwgZHksIDAuMCk7DQogICAgICAgICAgICBnbC51bmlmb3JtMWYoc3BsYXRQcm9ncmFtLnVu%0AaWZvcm1zLnJhZGl1cywgY29ycmVjdFJhZGl1cyhjb25maWcuU1BMQVRfUkFESVVTIC8gMTAwLjAp%0AKTsNCiAgICAgICAgICAgIGJsaXQodmVsb2NpdHkud3JpdGUpOw0KICAgICAgICAgICAgdmVsb2Np%0AdHkuc3dhcCgpOw0KDQogICAgICAgICAgICBnbC51bmlmb3JtMWkoc3BsYXRQcm9ncmFtLnVuaWZv%0Acm1zLnVUYXJnZXQsIGR5ZS5yZWFkLmF0dGFjaCgwKSk7DQogICAgICAgICAgICBnbC51bmlmb3Jt%0AM2Yoc3BsYXRQcm9ncmFtLnVuaWZvcm1zLmNvbG9yLCBjb2xvci5yLCBjb2xvci5nLCBjb2xvci5i%0AKTsNCiAgICAgICAgICAgIGJsaXQoZHllLndyaXRlKTsNCiAgICAgICAgICAgIGR5ZS5zd2FwKCk7%0ADQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBjb3JyZWN0UmFkaXVzKHJhZGl1cykgew0K%0AICAgICAgICAgICAgbGV0IGFzcGVjdFJhdGlvID0gY2FudmFzLndpZHRoIC8gY2FudmFzLmhlaWdo%0AdDsNCiAgICAgICAgICAgIGlmIChhc3BlY3RSYXRpbyA+IDEpDQogICAgICAgICAgICAgICAgcmFk%0AaXVzICo9IGFzcGVjdFJhdGlvOw0KICAgICAgICAgICAgcmV0dXJuIHJhZGl1czsNCiAgICAgICAg%0AfQ0KDQogICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBlID0+IHsN%0ACiAgICAgICAgICAgIGxldCBwb3NYID0gc2NhbGVCeVBpeGVsUmF0aW8oZS5vZmZzZXRYKTsNCiAg%0AICAgICAgICAgIGxldCBwb3NZID0gc2NhbGVCeVBpeGVsUmF0aW8oZS5vZmZzZXRZKTsNCiAgICAg%0AICAgICAgIGxldCBwb2ludGVyID0gcG9pbnRlcnMuZmluZChwID0+IHAuaWQgPT0gLTEpOw0KICAg%0AICAgICAgICAgaWYgKHBvaW50ZXIgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBwb2ludGVyID0g%0AbmV3IHBvaW50ZXJQcm90b3R5cGUoKTsNCiAgICAgICAgICAgIHVwZGF0ZVBvaW50ZXJEb3duRGF0%0AYShwb2ludGVyLCAtMSwgcG9zWCwgcG9zWSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGNhbnZh%0Acy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBlID0+IHsNCiAgICAgICAgICAgIGxldCBw%0Ab2ludGVyID0gcG9pbnRlcnNbMF07DQogICAgICAgICAgICBpZiAoIXBvaW50ZXIuZG93bikgcmV0%0AdXJuOw0KICAgICAgICAgICAgbGV0IHBvc1ggPSBzY2FsZUJ5UGl4ZWxSYXRpbyhlLm9mZnNldFgp%0AOw0KICAgICAgICAgICAgbGV0IHBvc1kgPSBzY2FsZUJ5UGl4ZWxSYXRpbyhlLm9mZnNldFkpOw0K%0AICAgICAgICAgICAgdXBkYXRlUG9pbnRlck1vdmVEYXRhKHBvaW50ZXIsIHBvc1gsIHBvc1kpOw0K%0AICAgICAgICB9KTsNCg0KICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcs%0AICgpID0+IHsNCiAgICAgICAgICAgIHVwZGF0ZVBvaW50ZXJVcERhdGEocG9pbnRlcnNbMF0pOw0K%0AICAgICAgICB9KTsNCg0KICAgICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFy%0AdCcsIGUgPT4gew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAg%0AY29uc3QgdG91Y2hlcyA9IGUudGFyZ2V0VG91Y2hlczsNCiAgICAgICAgICAgIHdoaWxlICh0b3Vj%0AaGVzLmxlbmd0aCA+PSBwb2ludGVycy5sZW5ndGgpDQogICAgICAgICAgICAgICAgcG9pbnRlcnMu%0AcHVzaChuZXcgcG9pbnRlclByb3RvdHlwZSgpKTsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAw%0AOyBpIDwgdG91Y2hlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGxldCBwb3NYID0g%0Ac2NhbGVCeVBpeGVsUmF0aW8odG91Y2hlc1tpXS5wYWdlWCk7DQogICAgICAgICAgICAgICAgbGV0%0AIHBvc1kgPSBzY2FsZUJ5UGl4ZWxSYXRpbyh0b3VjaGVzW2ldLnBhZ2VZKTsNCiAgICAgICAgICAg%0AICAgICB1cGRhdGVQb2ludGVyRG93bkRhdGEocG9pbnRlcnNbaSArIDFdLCB0b3VjaGVzW2ldLmlk%0AZW50aWZpZXIsIHBvc1gsIHBvc1kpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAg%0AICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZSA9PiB7DQogICAgICAg%0AICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBjb25zdCB0b3VjaGVzID0gZS50%0AYXJnZXRUb3VjaGVzOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3VjaGVzLmxl%0Abmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgbGV0IHBvaW50ZXIgPSBwb2ludGVyc1tpICsg%0AMV07DQogICAgICAgICAgICAgICAgaWYgKCFwb2ludGVyLmRvd24pIGNvbnRpbnVlOw0KICAgICAg%0AICAgICAgICAgIGxldCBwb3NYID0gc2NhbGVCeVBpeGVsUmF0aW8odG91Y2hlc1tpXS5wYWdlWCk7%0ADQogICAgICAgICAgICAgICAgbGV0IHBvc1kgPSBzY2FsZUJ5UGl4ZWxSYXRpbyh0b3VjaGVzW2ld%0ALnBhZ2VZKTsNCiAgICAgICAgICAgICAgICB1cGRhdGVQb2ludGVyTW92ZURhdGEocG9pbnRlciwg%0AcG9zWCwgcG9zWSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sIGZhbHNlKTsNCg0KICAgICAg%0AICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBlID0+IHsNCiAgICAgICAgICAg%0AIGNvbnN0IHRvdWNoZXMgPSBlLmNoYW5nZWRUb3VjaGVzOw0KICAgICAgICAgICAgZm9yIChsZXQg%0AaSA9IDA7IGkgPCB0b3VjaGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgbGV0IHBv%0AaW50ZXIgPSBwb2ludGVycy5maW5kKHAgPT4gcC5pZCA9PSB0b3VjaGVzW2ldLmlkZW50aWZpZXIp%0AOw0KICAgICAgICAgICAgICAgIGlmIChwb2ludGVyID09IG51bGwpIGNvbnRpbnVlOw0KICAgICAg%0AICAgICAgICAgIHVwZGF0ZVBvaW50ZXJVcERhdGEocG9pbnRlcik7DQogICAgICAgICAgICB9DQog%0AICAgICAgIH0pOw0KDQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywg%0AZSA9PiB7DQogICAgICAgICAgICBpZiAoZS5rZXkgPT09ICcgJykNCiAgICAgICAgICAgICAgICBz%0AcGxhdFN0YWNrLnB1c2gocGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIDIwKSArIDUpOw0KICAgICAg%0AICB9KTsNCg0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVQb2ludGVyRG93bkRhdGEocG9pbnRlciwg%0AaWQsIHBvc1gsIHBvc1kpIHsNCiAgICAgICAgICAgIHBvaW50ZXIuaWQgPSBpZDsNCiAgICAgICAg%0AICAgIHBvaW50ZXIuZG93biA9IHRydWU7DQogICAgICAgICAgICBwb2ludGVyLm1vdmVkID0gZmFs%0Ac2U7DQogICAgICAgICAgICBwb2ludGVyLnRleGNvb3JkWCA9IHBvc1ggLyBjYW52YXMud2lkdGg7%0ADQogICAgICAgICAgICBwb2ludGVyLnRleGNvb3JkWSA9IDEuMCAtIHBvc1kgLyBjYW52YXMuaGVp%0AZ2h0Ow0KICAgICAgICAgICAgcG9pbnRlci5wcmV2VGV4Y29vcmRYID0gcG9pbnRlci50ZXhjb29y%0AZFg7DQogICAgICAgICAgICBwb2ludGVyLnByZXZUZXhjb29yZFkgPSBwb2ludGVyLnRleGNvb3Jk%0AWTsNCiAgICAgICAgICAgIHBvaW50ZXIuZGVsdGFYID0gMDsNCiAgICAgICAgICAgIHBvaW50ZXIu%0AZGVsdGFZID0gMDsNCiAgICAgICAgICAgIHBvaW50ZXIuY29sb3IgPSBnZW5lcmF0ZUNvbG9yKCk7%0ADQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVQb2ludGVyTW92ZURhdGEocG9p%0AbnRlciwgcG9zWCwgcG9zWSkgew0KICAgICAgICAgICAgcG9pbnRlci5wcmV2VGV4Y29vcmRYID0g%0AcG9pbnRlci50ZXhjb29yZFg7DQogICAgICAgICAgICBwb2ludGVyLnByZXZUZXhjb29yZFkgPSBw%0Ab2ludGVyLnRleGNvb3JkWTsNCiAgICAgICAgICAgIHBvaW50ZXIudGV4Y29vcmRYID0gcG9zWCAv%0AIGNhbnZhcy53aWR0aDsNCiAgICAgICAgICAgIHBvaW50ZXIudGV4Y29vcmRZID0gMS4wIC0gcG9z%0AWSAvIGNhbnZhcy5oZWlnaHQ7DQogICAgICAgICAgICBwb2ludGVyLmRlbHRhWCA9IGNvcnJlY3RE%0AZWx0YVgocG9pbnRlci50ZXhjb29yZFggLSBwb2ludGVyLnByZXZUZXhjb29yZFgpOw0KICAgICAg%0AICAgICAgcG9pbnRlci5kZWx0YVkgPSBjb3JyZWN0RGVsdGFZKHBvaW50ZXIudGV4Y29vcmRZIC0g%0AcG9pbnRlci5wcmV2VGV4Y29vcmRZKTsNCiAgICAgICAgICAgIHBvaW50ZXIubW92ZWQgPSBNYXRo%0ALmFicyhwb2ludGVyLmRlbHRhWCkgPiAwIHx8IE1hdGguYWJzKHBvaW50ZXIuZGVsdGFZKSA+IDA7%0ADQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVQb2ludGVyVXBEYXRhKHBvaW50%0AZXIpIHsNCiAgICAgICAgICAgIHBvaW50ZXIuZG93biA9IGZhbHNlOw0KICAgICAgICB9DQoNCiAg%0AICAgICAgZnVuY3Rpb24gY29ycmVjdERlbHRhWChkZWx0YSkgew0KICAgICAgICAgICAgbGV0IGFz%0AcGVjdFJhdGlvID0gY2FudmFzLndpZHRoIC8gY2FudmFzLmhlaWdodDsNCiAgICAgICAgICAgIGlm%0AIChhc3BlY3RSYXRpbyA8IDEpIGRlbHRhICo9IGFzcGVjdFJhdGlvOw0KICAgICAgICAgICAgcmV0%0AdXJuIGRlbHRhOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gY29ycmVjdERlbHRhWShk%0AZWx0YSkgew0KICAgICAgICAgICAgbGV0IGFzcGVjdFJhdGlvID0gY2FudmFzLndpZHRoIC8gY2Fu%0AdmFzLmhlaWdodDsNCiAgICAgICAgICAgIGlmIChhc3BlY3RSYXRpbyA+IDEpIGRlbHRhIC89IGFz%0AcGVjdFJhdGlvOw0KICAgICAgICAgICAgcmV0dXJuIGRlbHRhOw0KICAgICAgICB9DQoNCiAgICAg%0AICAgZnVuY3Rpb24gZ2VuZXJhdGVDb2xvcigpIHsNCg0KICAgICAgICAgICAgaWYgKGNvbmZpZy5T%0ASU5HTEVfQ09MT1IpIHsNCiAgICAgICAgICAgICAgICBsZXQgayA9IFJHQkNvbG9yKCk7DQogICAg%0AICAgICAgICAgICAgcmV0dXJuIGs7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCBj%0AID0gSFNWdG9SR0IoTWF0aC5yYW5kb20oKSwgMS4wLCAxLjApOw0KICAgICAgICAgICAgYy5yICo9%0AIDAuMTU7DQogICAgICAgICAgICBjLmcgKj0gMC4xNTsNCiAgICAgICAgICAgIGMuYiAqPSAwLjE1%0AOw0KICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhjKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGM7%0ADQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBSR0JDb2xvcigpIHsNCiAgICAgICAgICAg%0AIGxldCByID0gY29uZmlnLkJSVVNIX0NPTE9SLnI7DQogICAgICAgICAgICBsZXQgZyA9IGNvbmZp%0AZy5CUlVTSF9DT0xPUi5nOw0KICAgICAgICAgICAgbGV0IGIgPSBjb25maWcuQlJVU0hfQ09MT1Iu%0AYjsNCg0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICByLA0KICAgICAgICAg%0AICAgICAgIGcsDQogICAgICAgICAgICAgICAgYg0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0K%0ADQogICAgICAgIGZ1bmN0aW9uIEhTVnRvUkdCKGgsIHMsIHYpIHsNCiAgICAgICAgICAgIGxldCBy%0ALCBnLCBiLCBpLCBmLCBwLCBxLCB0Ow0KICAgICAgICAgICAgaSA9IE1hdGguZmxvb3IoaCAqIDYp%0AOw0KICAgICAgICAgICAgZiA9IGggKiA2IC0gaTsNCiAgICAgICAgICAgIHAgPSB2ICogKDEgLSBz%0AKTsNCiAgICAgICAgICAgIHEgPSB2ICogKDEgLSBmICogcyk7DQogICAgICAgICAgICB0ID0gdiAq%0AICgxIC0gKDEgLSBmKSAqIHMpOw0KDQogICAgICAgICAgICBzd2l0Y2ggKGkgJSA2KSB7DQogICAg%0AICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgICAgICByID0gdiwgZyA9IHQsIGIg%0APSBwOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDE6%0ADQogICAgICAgICAgICAgICAgICAgIHIgPSBxLCBnID0gdiwgYiA9IHA7DQogICAgICAgICAgICAg%0AICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICAg%0AICAgciA9IHAsIGcgPSB2LCBiID0gdDsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAg%0AICAgICAgICAgICAgY2FzZSAzOg0KICAgICAgICAgICAgICAgICAgICByID0gcCwgZyA9IHEsIGIg%0APSB2Ow0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDQ6%0ADQogICAgICAgICAgICAgICAgICAgIHIgPSB0LCBnID0gcCwgYiA9IHY7DQogICAgICAgICAgICAg%0AICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgNToNCiAgICAgICAgICAgICAgICAg%0AICAgciA9IHYsIGcgPSBwLCBiID0gcTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAg%0AICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgciwNCiAg%0AICAgICAgICAgICAgICBnLA0KICAgICAgICAgICAgICAgIGINCiAgICAgICAgICAgIH07DQogICAg%0AICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVDb2xvcihpbnB1dCkgew0KICAgICAg%0AICAgICAgbGV0IG91dHB1dCA9IHsNCiAgICAgICAgICAgICAgICByOiBpbnB1dC5yIC8gMjU1LA0K%0AICAgICAgICAgICAgICAgIGc6IGlucHV0LmcgLyAyNTUsDQogICAgICAgICAgICAgICAgYjogaW5w%0AdXQuYiAvIDI1NQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7DQog%0AICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiB3cmFwKHZhbHVlLCBtaW4sIG1heCkgew0KICAg%0AICAgICAgICAgbGV0IHJhbmdlID0gbWF4IC0gbWluOw0KICAgICAgICAgICAgaWYgKHJhbmdlID09%0AIDApIHJldHVybiBtaW47DQogICAgICAgICAgICByZXR1cm4gKHZhbHVlIC0gbWluKSAlIHJhbmdl%0AICsgbWluOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZ2V0UmVzb2x1dGlvbihyZXNv%0AbHV0aW9uKSB7DQogICAgICAgICAgICBsZXQgYXNwZWN0UmF0aW8gPSBnbC5kcmF3aW5nQnVmZmVy%0AV2lkdGggLyBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0Ow0KICAgICAgICAgICAgaWYgKGFzcGVjdFJh%0AdGlvIDwgMSkNCiAgICAgICAgICAgICAgICBhc3BlY3RSYXRpbyA9IDEuMCAvIGFzcGVjdFJhdGlv%0AOw0KDQogICAgICAgICAgICBsZXQgbWluID0gTWF0aC5yb3VuZChyZXNvbHV0aW9uKTsNCiAgICAg%0AICAgICAgIGxldCBtYXggPSBNYXRoLnJvdW5kKHJlc29sdXRpb24gKiBhc3BlY3RSYXRpbyk7DQoN%0ACiAgICAgICAgICAgIGlmIChnbC5kcmF3aW5nQnVmZmVyV2lkdGggPiBnbC5kcmF3aW5nQnVmZmVy%0ASGVpZ2h0KQ0KICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgIHdp%0AZHRoOiBtYXgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodDogbWluDQogICAgICAgICAgICAg%0AICAgfTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAg%0AICAgICAgICAgICAgICB3aWR0aDogbWluLA0KICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IG1h%0AeA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBnZXRU%0AZXh0dXJlU2NhbGUodGV4dHVyZSwgd2lkdGgsIGhlaWdodCkgew0KICAgICAgICAgICAgcmV0dXJu%0AIHsNCiAgICAgICAgICAgICAgICB4OiB3aWR0aCAvIHRleHR1cmUud2lkdGgsDQogICAgICAgICAg%0AICAgICAgeTogaGVpZ2h0IC8gdGV4dHVyZS5oZWlnaHQNCiAgICAgICAgICAgIH07DQogICAgICAg%0AIH0NCg0KICAgICAgICBmdW5jdGlvbiBzY2FsZUJ5UGl4ZWxSYXRpbyhpbnB1dCkgew0KICAgICAg%0AICAgICAgbGV0IHBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOw0KICAg%0AICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoaW5wdXQgKiBwaXhlbFJhdGlvKTsNCiAgICAgICAg%0AfQ0KDQogICAgICAgIGZ1bmN0aW9uIGhhc2hDb2RlKHMpIHsNCiAgICAgICAgICAgIGlmIChzLmxl%0Abmd0aCA9PSAwKSByZXR1cm4gMDsNCiAgICAgICAgICAgIGxldCBoYXNoID0gMDsNCiAgICAgICAg%0AICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAg%0AIGhhc2ggPSAoaGFzaCA8PCA1KSAtIGhhc2ggKyBzLmNoYXJDb2RlQXQoaSk7DQogICAgICAgICAg%0AICAgICAgaGFzaCB8PSAwOyAvLyBDb252ZXJ0IHRvIDMyYml0IGludGVnZXINCiAgICAgICAgICAg%0AIH0NCiAgICAgICAgICAgIHJldHVybiBoYXNoOw0KICAgICAgICB9Ow0KICAgIDwvc2NyaXB0Pg0K%0APC9ib2R5Pg0KDQo8L2h0bWw+ -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="Cache-Control" content="no-cache">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <meta property="og:type" content="website">

    <script>
        !function (e, t) {
            "object" == typeof exports && "undefined" != typeof module ? t(exports) : "function" == typeof define && define.amd ? define(["exports"], t) : t(e.dat = {})
        }(this, function (e) {
            "use strict";

            function t(e, t) {
                var n = e.__state.conversionName.toString(),
                    o = Math.round(e.r),
                    i = Math.round(e.g),
                    r = Math.round(e.b),
                    s = e.a,
                    a = Math.round(e.h),
                    l = e.s.toFixed(1),
                    d = e.v.toFixed(1);
                if (t || "THREE_CHAR_HEX" === n || "SIX_CHAR_HEX" === n) {
                    for (var c = e.hex.toString(16); c.length < 6;) c = "0" + c;
                    return "#" + c
                }
                return "CSS_RGB" === n ? "rgb(" + o + "," + i + "," + r + ")" : "CSS_RGBA" === n ? "rgba(" + o + "," + i + "," + r + "," + s + ")" : "HEX" === n ? "0x" + e.hex.toString(16) : "RGB_ARRAY" === n ? "[" + o + "," + i + "," + r + "]" : "RGBA_ARRAY" === n ? "[" + o + "," + i + "," + r + "," + s + "]" : "RGB_OBJ" === n ? "{r:" + o + ",g:" + i + ",b:" + r + "}" : "RGBA_OBJ" === n ? "{r:" + o + ",g:" + i + ",b:" + r + ",a:" + s + "}" : "HSV_OBJ" === n ? "{h:" + a + ",s:" + l + ",v:" + d + "}" : "HSVA_OBJ" === n ? "{h:" + a + ",s:" + l + ",v:" + d + ",a:" + s + "}" : "unknown format"
            }

            function n(e, t, n) {
                Object.defineProperty(e, t, {
                    get: function () {
                        return "RGB" === this.__state.space ? this.__state[t] : (I.recalculateRGB(this, t, n), this.__state[t])
                    },
                    set: function (e) {
                        "RGB" !== this.__state.space && (I.recalculateRGB(this, t, n), this.__state.space = "RGB"), this.__state[t] = e
                    }
                })
            }

            function o(e, t) {
                Object.defineProperty(e, t, {
                    get: function () {
                        return "HSV" === this.__state.space ? this.__state[t] : (I.recalculateHSV(this), this.__state[t])
                    },
                    set: function (e) {
                        "HSV" !== this.__state.space && (I.recalculateHSV(this), this.__state.space = "HSV"), this.__state[t] = e
                    }
                })
            }

            function i(e) {
                if ("0" === e || S.isUndefined(e)) return 0;
                var t = e.match(U);
                return S.isNull(t) ? 0 : parseFloat(t[1])
            }

            function r(e) {
                var t = e.toString();
                return t.indexOf(".") > -1 ? t.length - t.indexOf(".") - 1 : 0
            }

            function s(e, t) {
                var n = Math.pow(10, t);
                return Math.round(e * n) / n
            }

            function a(e, t, n, o, i) {
                return o + (e - t) / (n - t) * (i - o)
            }

            function l(e, t, n, o) {
                e.style.background = "", S.each(ee, function (i) {
                    e.style.cssText += "background: " + i + "linear-gradient(" + t + ", " + n + " 0%, " + o + " 100%); "
                })
            }

            function d(e) {
                e.style.background = "", e.style.cssText += "background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);", e.style.cssText += "background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);", e.style.cssText += "background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);", e.style.cssText += "background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);", e.style.cssText += "background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"
            }

            function c(e, t, n) {
                var o = document.createElement("li");
                return t && o.appendChild(t), n ? e.__ul.insertBefore(o, n) : e.__ul.appendChild(o), e.onResize(), o
            }

            function u(e) {
                X.unbind(window, "resize", e.__resizeHandler), e.saveToLocalStorageIfPossible && X.unbind(window, "unload", e.saveToLocalStorageIfPossible)
            }

            function _(e, t) {
                var n = e.__preset_select[e.__preset_select.selectedIndex];
                n.innerHTML = t ? n.value + "*" : n.value
            }

            function h(e, t, n) {
                if (n.__li = t, n.__gui = e, S.extend(n, {
                    options: function (t) {
                        if (arguments.length > 1) {
                            var o = n.__li.nextElementSibling;
                            return n.remove(), f(e, n.object, n.property, {
                                before: o,
                                factoryArgs: [S.toArray(arguments)]
                            })
                        }
                        if (S.isArray(t) || S.isObject(t)) {
                            var i = n.__li.nextElementSibling;
                            return n.remove(), f(e, n.object, n.property, {
                                before: i,
                                factoryArgs: [t]
                            })
                        }
                    },
                    name: function (e) {
                        return n.__li.firstElementChild.firstElementChild.innerHTML = e, n
                    },
                    listen: function () {
                        return n.__gui.listen(n), n
                    },
                    remove: function () {
                        return n.__gui.remove(n), n
                    }
                }), n instanceof q) {
                    var o = new Q(n.object, n.property, {
                        min: n.__min,
                        max: n.__max,
                        step: n.__step
                    });
                    S.each(["updateDisplay", "onChange", "onFinishChange", "step"], function (e) {
                        var t = n[e],
                            i = o[e];
                        n[e] = o[e] = function () {
                            var e = Array.prototype.slice.call(arguments);
                            return i.apply(o, e), t.apply(n, e)
                        }
                    }), X.addClass(t, "has-slider"), n.domElement.insertBefore(o.domElement, n.domElement.firstElementChild)
                } else if (n instanceof Q) {
                    var i = function (t) {
                        if (S.isNumber(n.__min) && S.isNumber(n.__max)) {
                            var o = n.__li.firstElementChild.firstElementChild.innerHTML,
                                i = n.__gui.__listening.indexOf(n) > -1;
                            n.remove();
                            var r = f(e, n.object, n.property, {
                                before: n.__li.nextElementSibling,
                                factoryArgs: [n.__min, n.__max, n.__step]
                            });
                            return r.name(o), i && r.listen(), r
                        }
                        return t
                    };
                    n.min = S.compose(i, n.min), n.max = S.compose(i, n.max)
                } else n instanceof K ? (X.bind(t, "click", function () {
                    X.fakeEvent(n.__checkbox, "click")
                }), X.bind(n.__checkbox, "click", function (e) {
                    e.stopPropagation()
                })) : n instanceof Z ? (X.bind(t, "click", function () {
                    X.fakeEvent(n.__button, "click")
                }), X.bind(t, "mouseover", function () {
                    X.addClass(n.__button, "hover")
                }), X.bind(t, "mouseout", function () {
                    X.removeClass(n.__button, "hover")
                })) : n instanceof $ && (X.addClass(t, "color"), n.updateDisplay = S.compose(function (e) {
                    return t.style.borderLeftColor = n.__color.toString(), e
                }, n.updateDisplay), n.updateDisplay());
                n.setValue = S.compose(function (t) {
                    return e.getRoot().__preset_select && n.isModified() && _(e.getRoot(), !0), t
                }, n.setValue)
            }

            function p(e, t) {
                var n = e.getRoot(),
                    o = n.__rememberedObjects.indexOf(t.object);
                if (-1 !== o) {
                    var i = n.__rememberedObjectIndecesToControllers[o];
                    if (void 0 === i && (i = {}, n.__rememberedObjectIndecesToControllers[o] = i), i[t.property] = t, n.load && n.load.remembered) {
                        var r = n.load.remembered,
                            s = void 0;
                        if (r[e.preset]) s = r[e.preset];
                        else {
                            if (!r[se]) return;
                            s = r[se]
                        }
                        if (s[o] && void 0 !== s[o][t.property]) {
                            var a = s[o][t.property];
                            t.initialValue = a, t.setValue(a)
                        }
                    }
                }
            }

            function f(e, t, n, o) {
                if (void 0 === t[n]) throw new Error('Object "' + t + '" has no property "' + n + '"');
                var i = void 0;
                if (o.color) i = new $(t, n);
                else {
                    var r = [t, n].concat(o.factoryArgs);
                    i = ne.apply(e, r)
                }
                o.before instanceof z && (o.before = o.before.__li), p(e, i), X.addClass(i.domElement, "c");
                var s = document.createElement("span");
                X.addClass(s, "property-name"), s.innerHTML = i.property;
                var a = document.createElement("div");
                a.appendChild(s), a.appendChild(i.domElement);
                var l = c(e, a, o.before);
                return X.addClass(l, he.CLASS_CONTROLLER_ROW), i instanceof $ ? X.addClass(l, "color") : X.addClass(l, H(i.getValue())), h(e, l, i), e.__controllers.push(i), i
            }

            function m(e, t) {
                return document.location.href + "." + t
            }

            function g(e, t, n) {
                var o = document.createElement("option");
                o.innerHTML = t, o.value = t, e.__preset_select.appendChild(o), n && (e.__preset_select.selectedIndex = e.__preset_select.length - 1)
            }

            function b(e, t) {
                t.style.display = e.useLocalStorage ? "block" : "none"
            }

            function y(e) {
                function t(t) {
                    return t.preventDefault(), e.width += i - t.clientX, e.onResize(), i = t.clientX, !1
                }

                function n() {
                    X.removeClass(e.__closeButton, he.CLASS_DRAG), X.unbind(window, "mousemove", t), X.unbind(window, "mouseup", n)
                }

                function o(o) {
                    return o.preventDefault(), i = o.clientX, X.addClass(e.__closeButton, he.CLASS_DRAG), X.bind(window, "mousemove", t), X.bind(window, "mouseup", n), !1
                }

                var i = void 0;
                e.__resize_handle = document.createElement("div"), S.extend(e.__resize_handle.style, {
                    width: "6px",
                    marginLeft: "-3px",
                    height: "200px",
                    cursor: "ew-resize",
                    position: "absolute"
                }), X.bind(e.__resize_handle, "mousedown", o), X.bind(e.__closeButton, "mousedown", o), e.domElement.insertBefore(e.__resize_handle, e.domElement.firstElementChild)
            }

            function w(e, t) {
                e.domElement.style.width = t + "px", e.__save_row && e.autoPlace && (e.__save_row.style.width = t + "px"), e.__closeButton && (e.__closeButton.style.width = t + "px")
            }

            function x(e, t) {
                var n = {};
                return S.each(e.__rememberedObjects, function (o, i) {
                    var r = {},
                        s = e.__rememberedObjectIndecesToControllers[i];
                    S.each(s, function (e, n) {
                        r[n] = t ? e.initialValue : e.getValue()
                    }), n[i] = r
                }), n
            }

            function E(e) {
                for (var t = 0; t < e.__preset_select.length; t++) e.__preset_select[t].value === e.preset && (e.__preset_select.selectedIndex = t)
            }

            function C(e) {
                0 !== e.length && oe.call(window, function () {
                    C(e)
                }), S.each(e, function (e) {
                    e.updateDisplay()
                })
            }

            {
                var A = Array.prototype.forEach,
                    k = Array.prototype.slice,
                    S = {
                        BREAK: {},
                        extend: function (e) {
                            return this.each(k.call(arguments, 1), function (t) {
                                (this.isObject(t) ? Object.keys(t) : []).forEach(function (n) {
                                    this.isUndefined(t[n]) || (e[n] = t[n])
                                }.bind(this))
                            }, this), e
                        },
                        defaults: function (e) {
                            return this.each(k.call(arguments, 1), function (t) {
                                (this.isObject(t) ? Object.keys(t) : []).forEach(function (n) {
                                    this.isUndefined(e[n]) && (e[n] = t[n])
                                }.bind(this))
                            }, this), e
                        },
                        compose: function () {
                            var e = k.call(arguments);
                            return function () {
                                for (var t = k.call(arguments), n = e.length - 1; n >= 0; n--) t = [e[n].apply(this, t)];
                                return t[0]
                            }
                        },
                        each: function (e, t, n) {
                            if (e)
                                if (A && e.forEach && e.forEach === A) e.forEach(t, n);
                                else if (e.length === e.length + 0) {
                                    var o = void 0,
                                        i = void 0;
                                    for (o = 0, i = e.length; o < i; o++)
                                        if (o in e && t.call(n, e[o], o) === this.BREAK) return
                                } else
                                    for (var r in e)
                                        if (t.call(n, e[r], r) === this.BREAK) return
                        },
                        defer: function (e) {
                            setTimeout(e, 0)
                        },
                        debounce: function (e, t, n) {
                            var o = void 0;
                            return function () {
                                var i = this,
                                    r = arguments,
                                    s = n || !o;
                                clearTimeout(o), o = setTimeout(function () {
                                    o = null, n || e.apply(i, r)
                                }, t), s && e.apply(i, r)
                            }
                        },
                        toArray: function (e) {
                            return e.toArray ? e.toArray() : k.call(e)
                        },
                        isUndefined: function (e) {
                            return void 0 === e
                        },
                        isNull: function (e) {
                            return null === e
                        },
                        isNaN: function (e) {
                            function t(t) {
                                return e.apply(this, arguments)
                            }

                            return t.toString = function () {
                                return e.toString()
                            }, t
                        }(function (e) {
                            return isNaN(e)
                        }),
                        isArray: Array.isArray || function (e) {
                            return e.constructor === Array
                        },
                        isObject: function (e) {
                            return e === Object(e)
                        },
                        isNumber: function (e) {
                            return e === e + 0
                        },
                        isString: function (e) {
                            return e === e + ""
                        },
                        isBoolean: function (e) {
                            return !1 === e || !0 === e
                        },
                        isFunction: function (e) {
                            return "[object Function]" === Object.prototype.toString.call(e)
                        }
                    },
                    O = [{
                        litmus: S.isString,
                        conversions: {
                            THREE_CHAR_HEX: {
                                read: function (e) {
                                    var t = e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);
                                    return null !== t && {
                                        space: "HEX",
                                        hex: parseInt("0x" + t[1].toString() + t[1].toString() + t[2].toString() + t[2].toString() + t[3].toString() + t[3].toString(), 0)
                                    }
                                },
                                write: t
                            },
                            SIX_CHAR_HEX: {
                                read: function (e) {
                                    var t = e.match(/^#([A-F0-9]{6})$/i);
                                    return null !== t && {
                                        space: "HEX",
                                        hex: parseInt("0x" + t[1].toString(), 0)
                                    }
                                },
                                write: t
                            },
                            CSS_RGB: {
                                read: function (e) {
                                    var t = e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
                                    return null !== t && {
                                        space: "RGB",
                                        r: parseFloat(t[1]),
                                        g: parseFloat(t[2]),
                                        b: parseFloat(t[3])
                                    }
                                },
                                write: t
                            },
                            CSS_RGBA: {
                                read: function (e) {
                                    var t = e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
                                    return null !== t && {
                                        space: "RGB",
                                        r: parseFloat(t[1]),
                                        g: parseFloat(t[2]),
                                        b: parseFloat(t[3]),
                                        a: parseFloat(t[4])
                                    }
                                },
                                write: t
                            }
                        }
                    }, {
                        litmus: S.isNumber,
                        conversions: {
                            HEX: {
                                read: function (e) {
                                    return {
                                        space: "HEX",
                                        hex: e,
                                        conversionName: "HEX"
                                    }
                                },
                                write: function (e) {
                                    return e.hex
                                }
                            }
                        }
                    }, {
                        litmus: S.isArray,
                        conversions: {
                            RGB_ARRAY: {
                                read: function (e) {
                                    return 3 === e.length && {
                                        space: "RGB",
                                        r: e[0],
                                        g: e[1],
                                        b: e[2]
                                    }
                                },
                                write: function (e) {
                                    return [e.r, e.g, e.b]
                                }
                            },
                            RGBA_ARRAY: {
                                read: function (e) {
                                    return 4 === e.length && {
                                        space: "RGB",
                                        r: e[0],
                                        g: e[1],
                                        b: e[2],
                                        a: e[3]
                                    }
                                },
                                write: function (e) {
                                    return [e.r, e.g, e.b, e.a]
                                }
                            }
                        }
                    }, {
                        litmus: S.isObject,
                        conversions: {
                            RGBA_OBJ: {
                                read: function (e) {
                                    return !!(S.isNumber(e.r) && S.isNumber(e.g) && S.isNumber(e.b) && S.isNumber(e.a)) && {
                                        space: "RGB",
                                        r: e.r,
                                        g: e.g,
                                        b: e.b,
                                        a: e.a
                                    }
                                },
                                write: function (e) {
                                    return {
                                        r: e.r,
                                        g: e.g,
                                        b: e.b,
                                        a: e.a
                                    }
                                }
                            },
                            RGB_OBJ: {
                                read: function (e) {
                                    return !!(S.isNumber(e.r) && S.isNumber(e.g) && S.isNumber(e.b)) && {
                                        space: "RGB",
                                        r: e.r,
                                        g: e.g,
                                        b: e.b
                                    }
                                },
                                write: function (e) {
                                    return {
                                        r: e.r,
                                        g: e.g,
                                        b: e.b
                                    }
                                }
                            },
                            HSVA_OBJ: {
                                read: function (e) {
                                    return !!(S.isNumber(e.h) && S.isNumber(e.s) && S.isNumber(e.v) && S.isNumber(e.a)) && {
                                        space: "HSV",
                                        h: e.h,
                                        s: e.s,
                                        v: e.v,
                                        a: e.a
                                    }
                                },
                                write: function (e) {
                                    return {
                                        h: e.h,
                                        s: e.s,
                                        v: e.v,
                                        a: e.a
                                    }
                                }
                            },
                            HSV_OBJ: {
                                read: function (e) {
                                    return !!(S.isNumber(e.h) && S.isNumber(e.s) && S.isNumber(e.v)) && {
                                        space: "HSV",
                                        h: e.h,
                                        s: e.s,
                                        v: e.v
                                    }
                                },
                                write: function (e) {
                                    return {
                                        h: e.h,
                                        s: e.s,
                                        v: e.v
                                    }
                                }
                            }
                        }
                    }],
                    T = void 0,
                    L = void 0,
                    R = function () {
                        L = !1;
                        var e = arguments.length > 1 ? S.toArray(arguments) : arguments[0];
                        return S.each(O, function (t) {
                            if (t.litmus(e)) return S.each(t.conversions, function (t, n) {
                                if (T = t.read(e), !1 === L && !1 !== T) return L = T, T.conversionName = n, T.conversion = t, S.BREAK
                            }), S.BREAK
                        }), L
                    },
                    B = void 0,
                    N = {
                        hsv_to_rgb: function (e, t, n) {
                            var o = Math.floor(e / 60) % 6,
                                i = e / 60 - Math.floor(e / 60),
                                r = n * (1 - t),
                                s = n * (1 - i * t),
                                a = n * (1 - (1 - i) * t),
                                l = [
                                    [n, a, r],
                                    [s, n, r],
                                    [r, n, a],
                                    [r, s, n],
                                    [a, r, n],
                                    [n, r, s]
                                ][o];
                            return {
                                r: 255 * l[0],
                                g: 255 * l[1],
                                b: 255 * l[2]
                            }
                        },
                        rgb_to_hsv: function (e, t, n) {
                            var o = Math.min(e, t, n),
                                i = Math.max(e, t, n),
                                r = i - o,
                                s = void 0,
                                a = void 0;
                            return 0 === i ? {
                                h: NaN,
                                s: 0,
                                v: 0
                            } : (a = r / i, s = e === i ? (t - n) / r : t === i ? 2 + (n - e) / r : 4 + (e - t) / r, (s /= 6) < 0 && (s += 1), {
                                h: 360 * s,
                                s: a,
                                v: i / 255
                            })
                        },
                        rgb_to_hex: function (e, t, n) {
                            var o = this.hex_with_component(0, 2, e);
                            return o = this.hex_with_component(o, 1, t), o = this.hex_with_component(o, 0, n)
                        },
                        component_from_hex: function (e, t) {
                            return e >> 8 * t & 255
                        },
                        hex_with_component: function (e, t, n) {
                            return n << (B = 8 * t) | e & ~(255 << B)
                        }
                    },
                    H = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) {
                        return typeof e
                    } : function (e) {
                        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
                    },
                    F = function (e, t) {
                        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
                    },
                    P = function () {
                        function e(e, t) {
                            for (var n = 0; n < t.length; n++) {
                                var o = t[n];
                                o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o)
                            }
                        }

                        return function (t, n, o) {
                            return n && e(t.prototype, n), o && e(t, o), t
                        }
                    }(),
                    j = function e(t, n, o) {
                        null === t && (t = Function.prototype);
                        var i = Object.getOwnPropertyDescriptor(t, n);
                        if (void 0 === i) {
                            var r = Object.getPrototypeOf(t);
                            return null === r ? void 0 : e(r, n, o)
                        }
                        if ("value" in i) return i.value;
                        var s = i.get;
                        if (void 0 !== s) return s.call(o)
                    },
                    D = function (e, t) {
                        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
                        e.prototype = Object.create(t && t.prototype, {
                            constructor: {
                                value: e,
                                enumerable: !1,
                                writable: !0,
                                configurable: !0
                            }
                        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
                    },
                    V = function (e, t) {
                        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
                        return !t || "object" != typeof t && "function" != typeof t ? e : t
                    },
                    I = function () {
                        function e() {
                            if (F(this, e), this.__state = R.apply(this, arguments), !1 === this.__state) throw new Error("Failed to interpret color arguments");
                            this.__state.a = this.__state.a || 1
                        }

                        return P(e, [{
                            key: "toString",
                            value: function () {
                                return t(this)
                            }
                        }, {
                            key: "toHexString",
                            value: function () {
                                return t(this, !0)
                            }
                        }, {
                            key: "toOriginal",
                            value: function () {
                                return this.__state.conversion.write(this)
                            }
                        }]), e
                    }();
                I.recalculateRGB = function (e, t, n) {
                    if ("HEX" === e.__state.space) e.__state[t] = N.component_from_hex(e.__state.hex, n);
                    else {
                        if ("HSV" !== e.__state.space) throw new Error("Corrupted color state");
                        S.extend(e.__state, N.hsv_to_rgb(e.__state.h, e.__state.s, e.__state.v))
                    }
                }, I.recalculateHSV = function (e) {
                    var t = N.rgb_to_hsv(e.r, e.g, e.b);
                    S.extend(e.__state, {
                        s: t.s,
                        v: t.v
                    }), S.isNaN(t.h) ? S.isUndefined(e.__state.h) && (e.__state.h = 0) : e.__state.h = t.h
                }, I.COMPONENTS = ["r", "g", "b", "h", "s", "v", "hex", "a"], n(I.prototype, "r", 2), n(I.prototype, "g", 1), n(I.prototype, "b", 0), o(I.prototype, "h"), o(I.prototype, "s"), o(I.prototype, "v"), Object.defineProperty(I.prototype, "a", {
                    get: function () {
                        return this.__state.a
                    },
                    set: function (e) {
                        this.__state.a = e
                    }
                }), Object.defineProperty(I.prototype, "hex", {
                    get: function () {
                        return "HEX" !== !this.__state.space && (this.__state.hex = N.rgb_to_hex(this.r, this.g, this.b)), this.__state.hex
                    },
                    set: function (e) {
                        this.__state.space = "HEX", this.__state.hex = e
                    }
                });
                var z = function () {
                        function e(t, n) {
                            F(this, e), this.initialValue = t[n], this.domElement = document.createElement("div"), this.object = t, this.property = n, this.__onChange = void 0, this.__onFinishChange = void 0
                        }

                        return P(e, [{
                            key: "onChange",
                            value: function (e) {
                                return this.__onChange = e, this
                            }
                        }, {
                            key: "onFinishChange",
                            value: function (e) {
                                return this.__onFinishChange = e, this
                            }
                        }, {
                            key: "setValue",
                            value: function (e) {
                                return this.object[this.property] = e, this.__onChange && this.__onChange.call(this, e), this.updateDisplay(), this
                            }
                        }, {
                            key: "getValue",
                            value: function () {
                                return this.object[this.property]
                            }
                        }, {
                            key: "updateDisplay",
                            value: function () {
                                return this
                            }
                        }, {
                            key: "isModified",
                            value: function () {
                                return this.initialValue !== this.getValue()
                            }
                        }]), e
                    }(),
                    M = {
                        HTMLEvents: ["change"],
                        MouseEvents: ["click", "mousemove", "mousedown", "mouseup", "mouseover"],
                        KeyboardEvents: ["keydown"]
                    },
                    G = {};
                S.each(M, function (e, t) {
                    S.each(e, function (e) {
                        G[e] = t
                    })
                });
                var U = /(\d+(\.\d+)?)px/,
                    X = {
                        makeSelectable: function (e, t) {
                            void 0 !== e && void 0 !== e.style && (e.onselectstart = t ? function () {
                                return !1
                            } : function () {
                            }, e.style.MozUserSelect = t ? "auto" : "none", e.style.KhtmlUserSelect = t ? "auto" : "none", e.unselectable = t ? "on" : "off")
                        },
                        makeFullscreen: function (e, t, n) {
                            var o = n,
                                i = t;
                            S.isUndefined(i) && (i = !0), S.isUndefined(o) && (o = !0), e.style.position = "absolute", i && (e.style.left = 0, e.style.right = 0), o && (e.style.top = 0, e.style.bottom = 0)
                        },
                        fakeEvent: function (e, t, n, o) {
                            var i = n || {},
                                r = G[t];
                            if (!r) throw new Error("Event type " + t + " not supported.");
                            var s = document.createEvent(r);
                            switch (r) {
                                case "MouseEvents":
                                    var a = i.x || i.clientX || 0,
                                        l = i.y || i.clientY || 0;
                                    s.initMouseEvent(t, i.bubbles || !1, i.cancelable || !0, window, i.clickCount || 1, 0, 0, a, l, !1, !1, !1, !1, 0, null);
                                    break;
                                case "KeyboardEvents":
                                    var d = s.initKeyboardEvent || s.initKeyEvent;
                                    S.defaults(i, {
                                        cancelable: !0,
                                        ctrlKey: !1,
                                        altKey: !1,
                                        shiftKey: !1,
                                        metaKey: !1,
                                        keyCode: void 0,
                                        charCode: void 0
                                    }), d(t, i.bubbles || !1, i.cancelable, window, i.ctrlKey, i.altKey, i.shiftKey, i.metaKey, i.keyCode, i.charCode);
                                    break;
                                default:
                                    s.initEvent(t, i.bubbles || !1, i.cancelable || !0)
                            }
                            S.defaults(s, o), e.dispatchEvent(s)
                        },
                        bind: function (e, t, n, o) {
                            var i = o || !1;
                            return e.addEventListener ? e.addEventListener(t, n, i) : e.attachEvent && e.attachEvent("on" + t, n), X
                        },
                        unbind: function (e, t, n, o) {
                            var i = o || !1;
                            return e.removeEventListener ? e.removeEventListener(t, n, i) : e.detachEvent && e.detachEvent("on" + t, n), X
                        },
                        addClass: function (e, t) {
                            if (void 0 === e.className) e.className = t;
                            else if (e.className !== t) {
                                var n = e.className.split(/ +/);
                                -1 === n.indexOf(t) && (n.push(t), e.className = n.join(" ").replace(/^\s+/, "").replace(/\s+$/, ""))
                            }
                            return X
                        },
                        removeClass: function (e, t) {
                            if (t)
                                if (e.className === t) e.removeAttribute("class");
                                else {
                                    var n = e.className.split(/ +/),
                                        o = n.indexOf(t);
                                    -1 !== o && (n.splice(o, 1), e.className = n.join(" "))
                                }
                            else e.className = void 0;
                            return X
                        },
                        hasClass: function (e, t) {
                            return new RegExp("(?:^|\\s+)" + t + "(?:\\s+|$)").test(e.className) || !1
                        },
                        getWidth: function (e) {
                            var t = getComputedStyle(e);
                            return i(t["border-left-width"]) + i(t["border-right-width"]) + i(t["padding-left"]) + i(t["padding-right"]) + i(t.width)
                        },
                        getHeight: function (e) {
                            var t = getComputedStyle(e);
                            return i(t["border-top-width"]) + i(t["border-bottom-width"]) + i(t["padding-top"]) + i(t["padding-bottom"]) + i(t.height)
                        },
                        getOffset: function (e) {
                            var t = e,
                                n = {
                                    left: 0,
                                    top: 0
                                };
                            if (t.offsetParent)
                                do {
                                    n.left += t.offsetLeft, n.top += t.offsetTop, t = t.offsetParent
                                } while (t);
                            return n
                        },
                        isActive: function (e) {
                            return e === document.activeElement && (e.type || e.href)
                        }
                    },
                    K = function (e) {
                        function t(e, n) {
                            F(this, t);
                            var o = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)),
                                i = o;
                            return o.__prev = o.getValue(), o.__checkbox = document.createElement("input"), o.__checkbox.setAttribute("type", "checkbox"), X.bind(o.__checkbox, "change", function () {
                                i.setValue(!i.__prev)
                            }, !1), o.domElement.appendChild(o.__checkbox), o.updateDisplay(), o
                        }

                        return D(t, z), P(t, [{
                            key: "setValue",
                            value: function (e) {
                                var n = j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "setValue", this).call(this, e);
                                return this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()), this.__prev = this.getValue(), n
                            }
                        }, {
                            key: "updateDisplay",
                            value: function () {
                                return !0 === this.getValue() ? (this.__checkbox.setAttribute("checked", "checked"), this.__checkbox.checked = !0, this.__prev = !0) : (this.__checkbox.checked = !1, this.__prev = !1), j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "updateDisplay", this).call(this)
                            }
                        }]), t
                    }(),
                    Y = function (e) {
                        function t(e, n, o) {
                            F(this, t);
                            var i = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)),
                                r = o,
                                s = i;
                            if (i.__select = document.createElement("select"), S.isArray(r)) {
                                var a = {};
                                S.each(r, function (e) {
                                    a[e] = e
                                }), r = a
                            }
                            return S.each(r, function (e, t) {
                                var n = document.createElement("option");
                                n.innerHTML = t, n.setAttribute("value", e), s.__select.appendChild(n)
                            }), i.updateDisplay(), X.bind(i.__select, "change", function () {
                                var e = this.options[this.selectedIndex].value;
                                s.setValue(e)
                            }), i.domElement.appendChild(i.__select), i
                        }

                        return D(t, z), P(t, [{
                            key: "setValue",
                            value: function (e) {
                                var n = j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "setValue", this).call(this, e);
                                return this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()), n
                            }
                        }, {
                            key: "updateDisplay",
                            value: function () {
                                return X.isActive(this.__select) ? this : (this.__select.value = this.getValue(), j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "updateDisplay", this).call(this))
                            }
                        }]), t
                    }(),
                    J = function (e) {
                        function t(e, n) {
                            function o() {
                                r.setValue(r.__input.value)
                            }

                            F(this, t);
                            var i = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)),
                                r = i;
                            return i.__input = document.createElement("input"), i.__input.setAttribute("type", "text"), X.bind(i.__input, "keyup", o), X.bind(i.__input, "change", o), X.bind(i.__input, "blur", function () {
                                r.__onFinishChange && r.__onFinishChange.call(r, r.getValue())
                            }), X.bind(i.__input, "keydown", function (e) {
                                13 === e.keyCode && this.blur()
                            }), i.updateDisplay(), i.domElement.appendChild(i.__input), i
                        }

                        return D(t, z), P(t, [{
                            key: "updateDisplay",
                            value: function () {
                                return X.isActive(this.__input) || (this.__input.value = this.getValue()), j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "updateDisplay", this).call(this)
                            }
                        }]), t
                    }(),
                    W = function (e) {
                        function t(e, n, o) {
                            F(this, t);
                            var i = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)),
                                s = o || {};
                            return i.__min = s.min, i.__max = s.max, i.__step = s.step, S.isUndefined(i.__step) ? 0 === i.initialValue ? i.__impliedStep = 1 : i.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(i.initialValue)) / Math.LN10)) / 10 : i.__impliedStep = i.__step, i.__precision = r(i.__impliedStep), i
                        }

                        return D(t, z), P(t, [{
                            key: "setValue",
                            value: function (e) {
                                var n = e;
                                return void 0 !== this.__min && n < this.__min ? n = this.__min : void 0 !== this.__max && n > this.__max && (n = this.__max), void 0 !== this.__step && n % this.__step != 0 && (n = Math.round(n / this.__step) * this.__step), j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "setValue", this).call(this, n)
                            }
                        }, {
                            key: "min",
                            value: function (e) {
                                return this.__min = e, this
                            }
                        }, {
                            key: "max",
                            value: function (e) {
                                return this.__max = e, this
                            }
                        }, {
                            key: "step",
                            value: function (e) {
                                return this.__step = e, this.__impliedStep = e, this.__precision = r(e), this
                            }
                        }]), t
                    }(),
                    Q = function (e) {
                        function t(e, n, o) {
                            function i() {
                                l.__onFinishChange && l.__onFinishChange.call(l, l.getValue())
                            }

                            function r(e) {
                                var t = d - e.clientY;
                                l.setValue(l.getValue() + t * l.__impliedStep), d = e.clientY
                            }

                            function s() {
                                X.unbind(window, "mousemove", r), X.unbind(window, "mouseup", s), i()
                            }

                            F(this, t);
                            var a = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n, o));
                            a.__truncationSuspended = !1;
                            var l = a,
                                d = void 0;
                            return a.__input = document.createElement("input"), a.__input.setAttribute("type", "text"), X.bind(a.__input, "change", function () {
                                var e = parseFloat(l.__input.value);
                                S.isNaN(e) || l.setValue(e)
                            }), X.bind(a.__input, "blur", function () {
                                i()
                            }), X.bind(a.__input, "mousedown", function (e) {
                                X.bind(window, "mousemove", r), X.bind(window, "mouseup", s), d = e.clientY
                            }), X.bind(a.__input, "keydown", function (e) {
                                13 === e.keyCode && (l.__truncationSuspended = !0, this.blur(), l.__truncationSuspended = !1, i())
                            }), a.updateDisplay(), a.domElement.appendChild(a.__input), a
                        }

                        return D(t, W), P(t, [{
                            key: "updateDisplay",
                            value: function () {
                                return this.__input.value = this.__truncationSuspended ? this.getValue() : s(this.getValue(), this.__precision), j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "updateDisplay", this).call(this)
                            }
                        }]), t
                    }(),
                    q = function (e) {
                        function t(e, n, o, i, r) {
                            function s(e) {
                                e.preventDefault();
                                var t = _.__background.getBoundingClientRect();
                                return _.setValue(a(e.clientX, t.left, t.right, _.__min, _.__max)), !1
                            }

                            function l() {
                                X.unbind(window, "mousemove", s), X.unbind(window, "mouseup", l), _.__onFinishChange && _.__onFinishChange.call(_, _.getValue())
                            }

                            function d(e) {
                                var t = e.touches[0].clientX,
                                    n = _.__background.getBoundingClientRect();
                                _.setValue(a(t, n.left, n.right, _.__min, _.__max))
                            }

                            function c() {
                                X.unbind(window, "touchmove", d), X.unbind(window, "touchend", c), _.__onFinishChange && _.__onFinishChange.call(_, _.getValue())
                            }

                            F(this, t);
                            var u = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n, {
                                    min: o,
                                    max: i,
                                    step: r
                                })),
                                _ = u;
                            return u.__background = document.createElement("div"), u.__foreground = document.createElement("div"), X.bind(u.__background, "mousedown", function (e) {
                                document.activeElement.blur(), X.bind(window, "mousemove", s), X.bind(window, "mouseup", l), s(e)
                            }), X.bind(u.__background, "touchstart", function (e) {
                                1 === e.touches.length && (X.bind(window, "touchmove", d), X.bind(window, "touchend", c), d(e))
                            }), X.addClass(u.__background, "slider"), X.addClass(u.__foreground, "slider-fg"), u.updateDisplay(), u.__background.appendChild(u.__foreground), u.domElement.appendChild(u.__background), u
                        }

                        return D(t, W), P(t, [{
                            key: "updateDisplay",
                            value: function () {
                                var e = (this.getValue() - this.__min) / (this.__max - this.__min);
                                return this.__foreground.style.width = 100 * e + "%", j(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "updateDisplay", this).call(this)
                            }
                        }]), t
                    }(),
                    Z = function (e) {
                        function t(e, n, o) {
                            F(this, t);
                            var i = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n)),
                                r = i;
                            return i.__button = document.createElement("div"), i.__button.innerHTML = void 0 === o ? "Fire" : o, X.bind(i.__button, "click", function (e) {
                                return e.preventDefault(), r.fire(), !1
                            }), X.addClass(i.__button, "button"), i.domElement.appendChild(i.__button), i
                        }

                        return D(t, z), P(t, [{
                            key: "fire",
                            value: function () {
                                this.__onChange && this.__onChange.call(this), this.getValue().call(this.object), this.__onFinishChange && this.__onFinishChange.call(this, this.getValue())
                            }
                        }]), t
                    }(),
                    $ = function (e) {
                        function t(e, n) {
                            function o(e) {
                                u(e), X.bind(window, "mousemove", u), X.bind(window, "touchmove", u), X.bind(window, "mouseup", r), X.bind(window, "touchend", r)
                            }

                            function i(e) {
                                _(e), X.bind(window, "mousemove", _), X.bind(window, "touchmove", _), X.bind(window, "mouseup", s), X.bind(window, "touchend", s)
                            }

                            function r() {
                                X.unbind(window, "mousemove", u), X.unbind(window, "touchmove", u), X.unbind(window, "mouseup", r), X.unbind(window, "touchend", r), c()
                            }

                            function s() {
                                X.unbind(window, "mousemove", _), X.unbind(window, "touchmove", _), X.unbind(window, "mouseup", s), X.unbind(window, "touchend", s), c()
                            }

                            function a() {
                                var e = R(this.value);
                                !1 !== e ? (p.__color.__state = e, p.setValue(p.__color.toOriginal())) : this.value = p.__color.toString()
                            }

                            function c() {
                                p.__onFinishChange && p.__onFinishChange.call(p, p.__color.toOriginal())
                            }

                            function u(e) {
                                -1 === e.type.indexOf("touch") && e.preventDefault();
                                var t = p.__saturation_field.getBoundingClientRect(),
                                    n = e.touches && e.touches[0] || e,
                                    o = n.clientX,
                                    i = n.clientY,
                                    r = (o - t.left) / (t.right - t.left),
                                    s = 1 - (i - t.top) / (t.bottom - t.top);
                                return s > 1 ? s = 1 : s < 0 && (s = 0), r > 1 ? r = 1 : r < 0 && (r = 0), p.__color.v = s, p.__color.s = r, p.setValue(p.__color.toOriginal()), !1
                            }

                            function _(e) {
                                -1 === e.type.indexOf("touch") && e.preventDefault();
                                var t = p.__hue_field.getBoundingClientRect(),
                                    n = 1 - ((e.touches && e.touches[0] || e).clientY - t.top) / (t.bottom - t.top);
                                return n > 1 ? n = 1 : n < 0 && (n = 0), p.__color.h = 360 * n, p.setValue(p.__color.toOriginal()), !1
                            }

                            F(this, t);
                            var h = V(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e, n));
                            h.__color = new I(h.getValue()), h.__temp = new I(0);
                            var p = h;
                            h.domElement = document.createElement("div"), X.makeSelectable(h.domElement, !1), h.__selector = document.createElement("div"), h.__selector.className = "selector", h.__saturation_field = document.createElement("div"), h.__saturation_field.className = "saturation-field", h.__field_knob = document.createElement("div"), h.__field_knob.className = "field-knob", h.__field_knob_border = "2px solid ", h.__hue_knob = document.createElement("div"), h.__hue_knob.className = "hue-knob", h.__hue_field = document.createElement("div"), h.__hue_field.className = "hue-field", h.__input = document.createElement("input"), h.__input.type = "text", h.__input_textShadow = "0 1px 1px ", X.bind(h.__input, "keydown", function (e) {
                                13 === e.keyCode && a.call(this)
                            }), X.bind(h.__input, "blur", a), X.bind(h.__selector, "mousedown", function () {
                                X.addClass(this, "drag").bind(window, "mouseup", function () {
                                    X.removeClass(p.__selector, "drag")
                                })
                            }), X.bind(h.__selector, "touchstart", function () {
                                X.addClass(this, "drag").bind(window, "touchend", function () {
                                    X.removeClass(p.__selector, "drag")
                                })
                            });
                            var f = document.createElement("div");
                            return S.extend(h.__selector.style, {
                                width: "122px",
                                height: "102px",
                                padding: "3px",
                                backgroundColor: "#222",
                                boxShadow: "0px 1px 3px rgba(0,0,0,0.3)"
                            }), S.extend(h.__field_knob.style, {
                                position: "absolute",
                                width: "12px",
                                height: "12px",
                                border: h.__field_knob_border + (h.__color.v < .5 ? "#fff" : "#000"),
                                boxShadow: "0px 1px 3px rgba(0,0,0,0.5)",
                                borderRadius: "12px",
                                zIndex: 1
                            }), S.extend(h.__hue_knob.style, {
                                position: "absolute",
                                width: "15px",
                                height: "2px",
                                borderRight: "4px solid #fff",
                                zIndex: 1
                            }), S.extend(h.__saturation_field.style, {
                                width: "100px",
                                height: "100px",
                                border: "1px solid #555",
                                marginRight: "3px",
                                display: "inline-block",
                                cursor: "pointer"
                            }), S.extend(f.style, {
                                width: "100%",
                                height: "100%",
                                background: "none"
                            }), l(f, "top", "rgba(0,0,0,0)", "#000"), S.extend(h.__hue_field.style, {
                                width: "15px",
                                height: "100px",
                                border: "1px solid #555",
                                cursor: "ns-resize",
                                position: "absolute",
                                top: "3px",
                                right: "3px"
                            }), d(h.__hue_field), S.extend(h.__input.style, {
                                outline: "none",
                                textAlign: "center",
                                color: "#fff",
                                border: 0,
                                fontWeight: "bold",
                                textShadow: h.__input_textShadow + "rgba(0,0,0,0.7)"
                            }), X.bind(h.__saturation_field, "mousedown", o), X.bind(h.__saturation_field, "touchstart", o), X.bind(h.__field_knob, "mousedown", o), X.bind(h.__field_knob, "touchstart", o), X.bind(h.__hue_field, "mousedown", i), X.bind(h.__hue_field, "touchstart", i), h.__saturation_field.appendChild(f), h.__selector.appendChild(h.__field_knob), h.__selector.appendChild(h.__saturation_field), h.__selector.appendChild(h.__hue_field), h.__hue_field.appendChild(h.__hue_knob), h.domElement.appendChild(h.__input), h.domElement.appendChild(h.__selector), h.updateDisplay(), h
                        }

                        return D(t, z), P(t, [{
                            key: "updateDisplay",
                            value: function () {
                                var e = R(this.getValue());
                                if (!1 !== e) {
                                    var t = !1;
                                    S.each(I.COMPONENTS, function (n) {
                                        if (!S.isUndefined(e[n]) && !S.isUndefined(this.__color.__state[n]) && e[n] !== this.__color.__state[n]) return t = !0, {}
                                    }, this), t && S.extend(this.__color.__state, e)
                                }
                                S.extend(this.__temp.__state, this.__color.__state), this.__temp.a = 1;
                                var n = this.__color.v < .5 || this.__color.s > .5 ? 255 : 0,
                                    o = 255 - n;
                                S.extend(this.__field_knob.style, {
                                    marginLeft: 100 * this.__color.s - 7 + "px",
                                    marginTop: 100 * (1 - this.__color.v) - 7 + "px",
                                    backgroundColor: this.__temp.toHexString(),
                                    border: this.__field_knob_border + "rgb(" + n + "," + n + "," + n + ")"
                                }), this.__hue_knob.style.marginTop = 100 * (1 - this.__color.h / 360) + "px", this.__temp.s = 1, this.__temp.v = 1, l(this.__saturation_field, "left", "#fff", this.__temp.toHexString()), this.__input.value = this.__color.toString(), S.extend(this.__input.style, {
                                    backgroundColor: this.__color.toHexString(),
                                    color: "rgb(" + n + "," + n + "," + n + ")",
                                    textShadow: this.__input_textShadow + "rgba(" + o + "," + o + "," + o + ",.7)"
                                })
                            }
                        }]), t
                    }(),
                    ee = ["-moz-", "-o-", "-webkit-", "-ms-", ""],
                    te = {
                        load: function (e, t) {
                            var n = t || document,
                                o = n.createElement("link");
                            o.type = "text/css", o.rel = "stylesheet", o.href = e, n.getElementsByTagName("head")[0].appendChild(o)
                        },
                        inject: function (e, t) {
                            var n = t || document,
                                o = document.createElement("style");
                            o.type = "text/css", o.innerHTML = e;
                            var i = n.getElementsByTagName("head")[0];
                            try {
                                i.appendChild(o)
                            } catch (e) {
                            }
                        }
                    },
                    ne = function (e, t) {
                        var n = e[t];
                        return S.isArray(arguments[2]) || S.isObject(arguments[2]) ? new Y(e, t, arguments[2]) : S.isNumber(n) ? S.isNumber(arguments[2]) && S.isNumber(arguments[3]) ? S.isNumber(arguments[4]) ? new q(e, t, arguments[2], arguments[3], arguments[4]) : new q(e, t, arguments[2], arguments[3]) : S.isNumber(arguments[4]) ? new Q(e, t, {
                            min: arguments[2],
                            max: arguments[3],
                            step: arguments[4]
                        }) : new Q(e, t, {
                            min: arguments[2],
                            max: arguments[3]
                        }) : S.isString(n) ? new J(e, t) : S.isFunction(n) ? new Z(e, t, "") : S.isBoolean(n) ? new K(e, t) : null
                    },
                    oe = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (e) {
                        setTimeout(e, 1e3 / 60)
                    },
                    ie = function () {
                        function e() {
                            F(this, e), this.backgroundElement = document.createElement("div"), S.extend(this.backgroundElement.style, {
                                backgroundColor: "rgba(0,0,0,0.8)",
                                top: 0,
                                left: 0,
                                display: "none",
                                zIndex: "1000",
                                opacity: 0,
                                WebkitTransition: "opacity 0.2s linear",
                                transition: "opacity 0.2s linear"
                            }), X.makeFullscreen(this.backgroundElement), this.backgroundElement.style.position = "fixed", this.domElement = document.createElement("div"), S.extend(this.domElement.style, {
                                position: "fixed",
                                display: "none",
                                zIndex: "1001",
                                opacity: 0,
                                WebkitTransition: "-webkit-transform 0.2s ease-out, opacity 0.2s linear",
                                transition: "transform 0.2s ease-out, opacity 0.2s linear"
                            }), document.body.appendChild(this.backgroundElement), document.body.appendChild(this.domElement);
                            var t = this;
                            X.bind(this.backgroundElement, "click", function () {
                                t.hide()
                            })
                        }

                        return P(e, [{
                            key: "show",
                            value: function () {
                                var e = this;
                                this.backgroundElement.style.display = "block", this.domElement.style.display = "block", this.domElement.style.opacity = 0, this.domElement.style.webkitTransform = "scale(1.1)", this.layout(), S.defer(function () {
                                    e.backgroundElement.style.opacity = 1, e.domElement.style.opacity = 1, e.domElement.style.webkitTransform = "scale(1)"
                                })
                            }
                        }, {
                            key: "hide",
                            value: function () {
                                var e = this,
                                    t = function t() {
                                        e.domElement.style.display = "none", e.backgroundElement.style.display = "none", X.unbind(e.domElement, "webkitTransitionEnd", t), X.unbind(e.domElement, "transitionend", t), X.unbind(e.domElement, "oTransitionEnd", t)
                                    };
                                X.bind(this.domElement, "webkitTransitionEnd", t), X.bind(this.domElement, "transitionend", t), X.bind(this.domElement, "oTransitionEnd", t), this.backgroundElement.style.opacity = 0, this.domElement.style.opacity = 0, this.domElement.style.webkitTransform = "scale(1.1)"
                            }
                        }, {
                            key: "layout",
                            value: function () {
                                this.domElement.style.left = window.innerWidth / 2 - X.getWidth(this.domElement) / 2 + "px", this.domElement.style.top = window.innerHeight / 2 - X.getHeight(this.domElement) / 2 + "px"
                            }
                        }]), e
                    }(),
                    re = function (e) {
                        if (e && "undefined" != typeof window) {
                            var t = document.createElement("style");
                            return t.setAttribute("type", "text/css"), t.innerHTML = e, document.head.appendChild(t), e
                        }
                    }(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");
                te.inject(re);
                var se = "Default",
                    ae = function () {
                        try {
                            return !!window.localStorage
                        } catch (e) {
                            return !1
                        }
                    }(),
                    le = void 0,
                    de = !0,
                    ce = void 0,
                    ue = !1,
                    _e = [],
                    he = function e(t) {
                        var n = this,
                            o = t || {};
                        this.domElement = document.createElement("div"), this.__ul = document.createElement("ul"), this.domElement.appendChild(this.__ul), X.addClass(this.domElement, "dg"), this.__folders = {}, this.__controllers = [], this.__rememberedObjects = [], this.__rememberedObjectIndecesToControllers = [], this.__listening = [], o = S.defaults(o, {
                            closeOnTop: !1,
                            autoPlace: !0,
                            width: e.DEFAULT_WIDTH
                        }), o = S.defaults(o, {
                            resizable: o.autoPlace,
                            hideable: o.autoPlace
                        }), S.isUndefined(o.load) ? o.load = {
                            preset: se
                        } : o.preset && (o.load.preset = o.preset), S.isUndefined(o.parent) && o.hideable && _e.push(this), o.resizable = S.isUndefined(o.parent) && o.resizable, o.autoPlace && S.isUndefined(o.scrollable) && (o.scrollable = !0);
                        var i = ae && "true" === localStorage.getItem(m(this, "isLocal")),
                            r = void 0,
                            s = void 0;
                        if (Object.defineProperties(this, {
                            parent: {
                                get: function () {
                                    return o.parent
                                }
                            },
                            scrollable: {
                                get: function () {
                                    return o.scrollable
                                }
                            },
                            autoPlace: {
                                get: function () {
                                    return o.autoPlace
                                }
                            },
                            closeOnTop: {
                                get: function () {
                                    return o.closeOnTop
                                }
                            },
                            preset: {
                                get: function () {
                                    return n.parent ? n.getRoot().preset : o.load.preset
                                },
                                set: function (e) {
                                    n.parent ? n.getRoot().preset = e : o.load.preset = e, E(this), n.revert()
                                }
                            },
                            width: {
                                get: function () {
                                    return o.width
                                },
                                set: function (e) {
                                    o.width = e, w(n, e)
                                }
                            },
                            name: {
                                get: function () {
                                    return o.name
                                },
                                set: function (e) {
                                    o.name = e, s && (s.innerHTML = o.name)
                                }
                            },
                            closed: {
                                get: function () {
                                    return o.closed
                                },
                                set: function (t) {
                                    o.closed = t, o.closed ? X.addClass(n.__ul, e.CLASS_CLOSED) : X.removeClass(n.__ul, e.CLASS_CLOSED), this.onResize(), n.__closeButton && (n.__closeButton.innerHTML = t ? e.TEXT_OPEN : e.TEXT_CLOSED)
                                }
                            },
                            load: {
                                get: function () {
                                    return o.load
                                }
                            },
                            useLocalStorage: {
                                get: function () {
                                    return i
                                },
                                set: function (e) {
                                    ae && (i = e, e ? X.bind(window, "unload", r) : X.unbind(window, "unload", r), localStorage.setItem(m(n, "isLocal"), e))
                                }
                            }
                        }), S.isUndefined(o.parent)) {
                            if (o.closed = !1, X.addClass(this.domElement, e.CLASS_MAIN), X.makeSelectable(this.domElement, !1), ae && i) {
                                n.useLocalStorage = !0;
                                var a = localStorage.getItem(m(this, "gui"));
                                a && (o.load = JSON.parse(a))
                            }
                            this.__closeButton = document.createElement("div"), this.__closeButton.innerHTML = e.TEXT_CLOSED, X.addClass(this.__closeButton, e.CLASS_CLOSE_BUTTON), o.closeOnTop ? (X.addClass(this.__closeButton, e.CLASS_CLOSE_TOP), this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0])) : (X.addClass(this.__closeButton, e.CLASS_CLOSE_BOTTOM), this.domElement.appendChild(this.__closeButton)), X.bind(this.__closeButton, "click", function () {
                                n.closed = !n.closed
                            })
                        } else {
                            void 0 === o.closed && (o.closed = !0);
                            var l = document.createTextNode(o.name);
                            X.addClass(l, "controller-name"), s = c(n, l);
                            X.addClass(this.__ul, e.CLASS_CLOSED), X.addClass(s, "title"), X.bind(s, "click", function (e) {
                                return e.preventDefault(), n.closed = !n.closed, !1
                            }), o.closed || (this.closed = !1)
                        }
                        o.autoPlace && (S.isUndefined(o.parent) && (de && (ce = document.createElement("div"), X.addClass(ce, "dg"), X.addClass(ce, e.CLASS_AUTO_PLACE_CONTAINER), document.body.appendChild(ce), de = !1), ce.appendChild(this.domElement), X.addClass(this.domElement, e.CLASS_AUTO_PLACE)), this.parent || w(n, o.width)), this.__resizeHandler = function () {
                            n.onResizeDebounced()
                        }, X.bind(window, "resize", this.__resizeHandler), X.bind(this.__ul, "webkitTransitionEnd", this.__resizeHandler), X.bind(this.__ul, "transitionend", this.__resizeHandler), X.bind(this.__ul, "oTransitionEnd", this.__resizeHandler), this.onResize(), o.resizable && y(this), r = function () {
                            ae && "true" === localStorage.getItem(m(n, "isLocal")) && localStorage.setItem(m(n, "gui"), JSON.stringify(n.getSaveObject()))
                        }, this.saveToLocalStorageIfPossible = r, o.parent || function () {
                            var e = n.getRoot();
                            e.width += 1, S.defer(function () {
                                e.width -= 1
                            })
                        }()
                    };
                he.toggleHide = function () {
                    ue = !ue, S.each(_e, function (e) {
                        e.domElement.style.display = ue ? "none" : ""
                    })
                }, he.CLASS_AUTO_PLACE = "a", he.CLASS_AUTO_PLACE_CONTAINER = "ac", he.CLASS_MAIN = "main", he.CLASS_CONTROLLER_ROW = "cr", he.CLASS_TOO_TALL = "taller-than-window", he.CLASS_CLOSED = "closed", he.CLASS_CLOSE_BUTTON = "close-button", he.CLASS_CLOSE_TOP = "close-top", he.CLASS_CLOSE_BOTTOM = "close-bottom", he.CLASS_DRAG = "drag", he.DEFAULT_WIDTH = 245, he.TEXT_CLOSED = "Close Controls", he.TEXT_OPEN = "Open Controls", he._keydownHandler = function (e) {
                    "text" === document.activeElement.type || 72 !== e.which && 72 !== e.keyCode || he.toggleHide()
                }, X.bind(window, "keydown", he._keydownHandler, !1), S.extend(he.prototype, {
                    add: function (e, t) {
                        return f(this, e, t, {
                            factoryArgs: Array.prototype.slice.call(arguments, 2)
                        })
                    },
                    addColor: function (e, t) {
                        return f(this, e, t, {
                            color: !0
                        })
                    },
                    remove: function (e) {
                        this.__ul.removeChild(e.__li), this.__controllers.splice(this.__controllers.indexOf(e), 1);
                        var t = this;
                        S.defer(function () {
                            t.onResize()
                        })
                    },
                    destroy: function () {
                        if (this.parent) throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");
                        this.autoPlace && ce.removeChild(this.domElement);
                        var e = this;
                        S.each(this.__folders, function (t) {
                            e.removeFolder(t)
                        }), X.unbind(window, "keydown", he._keydownHandler, !1), u(this)
                    },
                    addFolder: function (e) {
                        if (void 0 !== this.__folders[e]) throw new Error('You already have a folder in this GUI by the name "' + e + '"');
                        var t = {
                            name: e,
                            parent: this
                        };
                        t.autoPlace = this.autoPlace, this.load && this.load.folders && this.load.folders[e] && (t.closed = this.load.folders[e].closed, t.load = this.load.folders[e]);
                        var n = new he(t);
                        this.__folders[e] = n;
                        var o = c(this, n.domElement);
                        return X.addClass(o, "folder"), n
                    },
                    removeFolder: function (e) {
                        this.__ul.removeChild(e.domElement.parentElement), delete this.__folders[e.name], this.load && this.load.folders && this.load.folders[e.name] && delete this.load.folders[e.name], u(e);
                        var t = this;
                        S.each(e.__folders, function (t) {
                            e.removeFolder(t)
                        }), S.defer(function () {
                            t.onResize()
                        })
                    },
                    open: function () {
                        this.closed = !1
                    },
                    close: function () {
                        this.closed = !0
                    },
                    onResize: function () {
                        var e = this.getRoot();
                        if (e.scrollable) {
                            var t = X.getOffset(e.__ul).top,
                                n = 0;
                            S.each(e.__ul.childNodes, function (t) {
                                e.autoPlace && t === e.__save_row || (n += X.getHeight(t))
                            }), window.innerHeight - t - 20 < n ? (X.addClass(e.domElement, he.CLASS_TOO_TALL), e.__ul.style.height = window.innerHeight - t - 20 + "px") : (X.removeClass(e.domElement, he.CLASS_TOO_TALL), e.__ul.style.height = "auto")
                        }
                        e.__resize_handle && S.defer(function () {
                            e.__resize_handle.style.height = e.__ul.offsetHeight + "px"
                        }), e.__closeButton && (e.__closeButton.style.width = e.width + "px")
                    },
                    onResizeDebounced: S.debounce(function () {
                        this.onResize()
                    }, 50),
                    remember: function () {
                        if (S.isUndefined(le) && ((le = new ie).domElement.innerHTML = '<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'), this.parent) throw new Error("You can only call remember on a top level GUI.");
                        var e = this;
                        S.each(Array.prototype.slice.call(arguments), function (t) {
                            0 === e.__rememberedObjects.length && v(e), -1 === e.__rememberedObjects.indexOf(t) && e.__rememberedObjects.push(t)
                        }), this.autoPlace && w(this, this.width)
                    },
                    getRoot: function () {
                        for (var e = this; e.parent;) e = e.parent;
                        return e
                    },
                    getSaveObject: function () {
                        var e = this.load;
                        return e.closed = this.closed, this.__rememberedObjects.length > 0 && (e.preset = this.preset, e.remembered || (e.remembered = {}), e.remembered[this.preset] = x(this)), e.folders = {}, S.each(this.__folders, function (t, n) {
                            e.folders[n] = t.getSaveObject()
                        }), e
                    },
                    save: function () {
                        this.load.remembered || (this.load.remembered = {}), this.load.remembered[this.preset] = x(this), _(this, !1), this.saveToLocalStorageIfPossible()
                    },
                    saveAs: function (e) {
                        this.load.remembered || (this.load.remembered = {}, this.load.remembered[se] = x(this, !0)), this.load.remembered[e] = x(this), this.preset = e, g(this, e, !0), this.saveToLocalStorageIfPossible()
                    },
                    revert: function (e) {
                        S.each(this.__controllers, function (t) {
                            this.getRoot().load.remembered ? p(e || this.getRoot(), t) : t.setValue(t.initialValue), t.__onFinishChange && t.__onFinishChange.call(t, t.getValue())
                        }, this), S.each(this.__folders, function (e) {
                            e.revert(e)
                        }), e || _(this.getRoot(), !1)
                    },
                    listen: function (e) {
                        var t = 0 === this.__listening.length;
                        this.__listening.push(e), t && C(this.__listening)
                    },
                    updateDisplay: function () {
                        S.each(this.__controllers, function (e) {
                            e.updateDisplay()
                        }), S.each(this.__folders, function (e) {
                            e.updateDisplay()
                        })
                    }
                });
                var pe = {
                        Color: I,
                        math: N,
                        interpret: R
                    },
                    fe = {
                        Controller: z,
                        BooleanController: K,
                        OptionController: Y,
                        StringController: J,
                        NumberController: W,
                        NumberControllerBox: Q,
                        NumberControllerSlider: q,
                        FunctionController: Z,
                        ColorController: $
                    },
                    me = {
                        dom: X
                    },
                    ge = {
                        GUI: he
                    },
                    be = he,
                    ve = {
                        color: pe,
                        controllers: fe,
                        dom: me,
                        gui: ge,
                        GUI: be
                    };
                e.color = pe, e.controllers = fe, e.dom = me, e.gui = ge, e.GUI = be, e.default = ve, Object.defineProperty(e, "__esModule", {
                    value: !0
                })
            }
        });
    </script>
    <style type="text/css">.dg ul {
        list-style: none;
        margin: 0;
        padding: 0;
        width: 100%;
        clear: both
    }

    .dg.ac {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 0;
        z-index: 0
    }

    .dg:not(.ac) .main {
        overflow: hidden
    }

    .dg.main {
        -webkit-transition: opacity .1s linear;
        -o-transition: opacity .1s linear;
        -moz-transition: opacity .1s linear;
        transition: opacity .1s linear
    }

    .dg.main.taller-than-window {
        overflow-y: auto
    }

    .dg.main.taller-than-window .close-button {
        opacity: 1;
        margin-top: -1px;
        border-top: 1px solid #2c2c2c
    }

    .dg.main ul.closed .close-button {
        opacity: 1 !important
    }

    .dg.main:hover .close-button, .dg.main .close-button.drag {
        opacity: 1
    }

    .dg.main .close-button {
        -webkit-transition: opacity .1s linear;
        -o-transition: opacity .1s linear;
        -moz-transition: opacity .1s linear;
        transition: opacity .1s linear;
        border: 0;
        line-height: 19px;
        height: 20px;
        cursor: pointer;
        text-align: center;
        background-color: #000
    }

    .dg.main .close-button.close-top {
        position: relative
    }

    .dg.main .close-button.close-bottom {
        position: absolute
    }

    .dg.main .close-button:hover {
        background-color: #111
    }

    .dg.a {
        float: right;
        margin-right: 15px;
        overflow-y: visible
    }

    .dg.a.has-save > ul.close-top {
        margin-top: 0
    }

    .dg.a.has-save > ul.close-bottom {
        margin-top: 27px
    }

    .dg.a.has-save > ul.closed {
        margin-top: 0
    }

    .dg.a .save-row {
        top: 0;
        z-index: 1002
    }

    .dg.a .save-row.close-top {
        position: relative
    }

    .dg.a .save-row.close-bottom {
        position: fixed
    }

    .dg li {
        -webkit-transition: height .1s ease-out;
        -o-transition: height .1s ease-out;
        -moz-transition: height .1s ease-out;
        transition: height .1s ease-out;
        -webkit-transition: overflow .1s linear;
        -o-transition: overflow .1s linear;
        -moz-transition: overflow .1s linear;
        transition: overflow .1s linear
    }

    .dg li:not(.folder) {
        cursor: auto;
        height: 27px;
        line-height: 27px;
        padding: 0 4px 0 5px
    }

    .dg li.folder {
        padding: 0;
        border-left: 4px solid rgba(0, 0, 0, 0)
    }

    .dg li.title {
        cursor: pointer;
        margin-left: -4px
    }

    .dg .closed li:not(.title), .dg .closed ul li, .dg .closed ul li > * {
        height: 0;
        overflow: hidden;
        border: 0
    }

    .dg .cr {
        clear: both;
        padding-left: 3px;
        height: 27px;
        overflow: hidden
    }

    .dg .property-name {
        cursor: default;
        float: left;
        clear: left;
        width: 40%;
        overflow: hidden;
        text-overflow: ellipsis
    }

    .dg .c {
        float: left;
        width: 60%;
        position: relative
    }

    .dg .c input[type=text] {
        border: 0;
        margin-top: 4px;
        padding: 3px;
        width: 100%;
        float: right
    }

    .dg .has-slider input[type=text] {
        width: 30%;
        margin-left: 0
    }

    .dg .slider {
        float: left;
        width: 66%;
        margin-left: -5px;
        margin-right: 0;
        height: 19px;
        margin-top: 4px
    }

    .dg .slider-fg {
        height: 100%
    }

    .dg .c input[type=checkbox] {
        margin-top: 7px
    }

    .dg .c select {
        margin-top: 5px
    }

    .dg .cr.function, .dg .cr.function .property-name, .dg .cr.function *, .dg .cr.boolean, .dg .cr.boolean * {
        cursor: pointer
    }

    .dg .cr.color {
        overflow: visible
    }

    .dg .selector {
        display: none;
        position: absolute;
        margin-left: -9px;
        margin-top: 23px;
        z-index: 10
    }

    .dg .c:hover .selector, .dg .selector.drag {
        display: block
    }

    .dg li.save-row {
        padding: 0
    }

    .dg li.save-row .button {
        display: inline-block;
        padding: 0px 6px
    }

    .dg.dialogue {
        background-color: #222;
        width: 460px;
        padding: 15px;
        font-size: 13px;
        line-height: 15px
    }

    #dg-new-constructor {
        padding: 10px;
        color: #222;
        font-family: Monaco, monospace;
        font-size: 10px;
        border: 0;
        resize: none;
        box-shadow: inset 1px 1px 1px #888;
        word-wrap: break-word;
        margin: 12px 0;
        display: block;
        width: 440px;
        overflow-y: scroll;
        height: 100px;
        position: relative
    }

    #dg-local-explain {
        display: none;
        font-size: 11px;
        line-height: 17px;
        border-radius: 3px;
        background-color: #333;
        padding: 8px;
        margin-top: 10px
    }

    #dg-local-explain code {
        font-size: 10px
    }

    #dat-gui-save-locally {
        display: none
    }

    .dg {
        color: #eee;
        font: 11px 'Lucida Grande', sans-serif;
        text-shadow: 0 -1px 0 #111
    }

    .dg.main::-webkit-scrollbar {
        width: 5px;
        background: #1a1a1a
    }

    .dg.main::-webkit-scrollbar-corner {
        height: 0;
        display: none
    }

    .dg.main::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background: #676767
    }

    .dg li:not(.folder) {
        background: #1a1a1a;
        border-bottom: 1px solid #2c2c2c
    }

    .dg li.save-row {
        line-height: 25px;
        background: #dad5cb;
        border: 0
    }

    .dg li.save-row select {
        margin-left: 5px;
        width: 108px
    }

    .dg li.save-row .button {
        margin-left: 5px;
        margin-top: 1px;
        border-radius: 2px;
        font-size: 9px;
        line-height: 7px;
        padding: 4px 4px 5px 4px;
        background: #c5bdad;
        color: #fff;
        text-shadow: 0 1px 0 #b0a58f;
        box-shadow: 0 -1px 0 #b0a58f;
        cursor: pointer
    }

    .dg li.save-row .button.gears {
        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;
        height: 7px;
        width: 8px
    }

    .dg li.save-row .button:hover {
        background-color: #bab19e;
        box-shadow: 0 -1px 0 #b0a58f
    }

    .dg li.folder {
        border-bottom: 0
    }

    .dg li.title {
        padding-left: 16px;
        background: #000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2)
    }

    .dg .closed li.title {
        background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)
    }

    .dg .cr.boolean {
        border-left: 3px solid #806787
    }

    .dg .cr.color {
        border-left: 3px solid
    }

    .dg .cr.function {
        border-left: 3px solid #e61d5f
    }

    .dg .cr.number {
        border-left: 3px solid #2FA1D6
    }

    .dg .cr.number input[type=text] {
        color: #2FA1D6
    }

    .dg .cr.string {
        border-left: 3px solid #1ed36f
    }

    .dg .cr.string input[type=text] {
        color: #1ed36f
    }

    .dg .cr.function:hover, .dg .cr.boolean:hover {
        background: #111
    }

    .dg .c input[type=text] {
        background: #303030;
        outline: none
    }

    .dg .c input[type=text]:hover {
        background: #3c3c3c
    }

    .dg .c input[type=text]:focus {
        background: #494949;
        color: #fff
    }

    .dg .c .slider {
        background: #303030;
        cursor: ew-resize
    }

    .dg .c .slider-fg {
        background: #2FA1D6;
        max-width: 100%
    }

    .dg .c .slider:hover {
        background: #3c3c3c
    }

    .dg .c .slider:hover .slider-fg {
        background: #44abda
    }
    </style>
    <style type="text/css">.dg ul {
        list-style: none;
        margin: 0;
        padding: 0;
        width: 100%;
        clear: both
    }

    .dg.ac {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 0;
        z-index: 0
    }

    .dg:not(.ac) .main {
        overflow: hidden
    }

    .dg.main {
        -webkit-transition: opacity .1s linear;
        -o-transition: opacity .1s linear;
        -moz-transition: opacity .1s linear;
        transition: opacity .1s linear
    }

    .dg.main.taller-than-window {
        overflow-y: auto
    }

    .dg.main.taller-than-window .close-button {
        opacity: 1;
        margin-top: -1px;
        border-top: 1px solid #2c2c2c
    }

    .dg.main ul.closed .close-button {
        opacity: 1 !important
    }

    .dg.main:hover .close-button, .dg.main .close-button.drag {
        opacity: 1
    }

    .dg.main .close-button {
        -webkit-transition: opacity .1s linear;
        -o-transition: opacity .1s linear;
        -moz-transition: opacity .1s linear;
        transition: opacity .1s linear;
        border: 0;
        line-height: 19px;
        height: 20px;
        cursor: pointer;
        text-align: center;
        background-color: #000
    }

    .dg.main .close-button.close-top {
        position: relative
    }

    .dg.main .close-button.close-bottom {
        position: absolute
    }

    .dg.main .close-button:hover {
        background-color: #111
    }

    .dg.a {
        float: right;
        margin-right: 15px;
        overflow-y: visible
    }

    .dg.a.has-save > ul.close-top {
        margin-top: 0
    }

    .dg.a.has-save > ul.close-bottom {
        margin-top: 27px
    }

    .dg.a.has-save > ul.closed {
        margin-top: 0
    }

    .dg.a .save-row {
        top: 0;
        z-index: 1002
    }

    .dg.a .save-row.close-top {
        position: relative
    }

    .dg.a .save-row.close-bottom {
        position: fixed
    }

    .dg li {
        -webkit-transition: height .1s ease-out;
        -o-transition: height .1s ease-out;
        -moz-transition: height .1s ease-out;
        transition: height .1s ease-out;
        -webkit-transition: overflow .1s linear;
        -o-transition: overflow .1s linear;
        -moz-transition: overflow .1s linear;
        transition: overflow .1s linear
    }

    .dg li:not(.folder) {
        cursor: auto;
        height: 27px;
        line-height: 27px;
        padding: 0 4px 0 5px
    }

    .dg li.folder {
        padding: 0;
        border-left: 4px solid rgba(0, 0, 0, 0)
    }

    .dg li.title {
        cursor: pointer;
        margin-left: -4px
    }

    .dg .closed li:not(.title), .dg .closed ul li, .dg .closed ul li > * {
        height: 0;
        overflow: hidden;
        border: 0
    }

    .dg .cr {
        clear: both;
        padding-left: 3px;
        height: 27px;
        overflow: hidden
    }

    .dg .property-name {
        cursor: default;
        float: left;
        clear: left;
        width: 40%;
        overflow: hidden;
        text-overflow: ellipsis
    }

    .dg .c {
        float: left;
        width: 60%;
        position: relative
    }

    .dg .c input[type=text] {
        border: 0;
        margin-top: 4px;
        padding: 3px;
        width: 100%;
        float: right
    }

    .dg .has-slider input[type=text] {
        width: 30%;
        margin-left: 0
    }

    .dg .slider {
        float: left;
        width: 66%;
        margin-left: -5px;
        margin-right: 0;
        height: 19px;
        margin-top: 4px
    }

    .dg .slider-fg {
        height: 100%
    }

    .dg .c input[type=checkbox] {
        margin-top: 7px
    }

    .dg .c select {
        margin-top: 5px
    }

    .dg .cr.function, .dg .cr.function .property-name, .dg .cr.function *, .dg .cr.boolean, .dg .cr.boolean * {
        cursor: pointer
    }

    .dg .cr.color {
        overflow: visible
    }

    .dg .selector {
        display: none;
        position: absolute;
        margin-left: -9px;
        margin-top: 23px;
        z-index: 10
    }

    .dg .c:hover .selector, .dg .selector.drag {
        display: block
    }

    .dg li.save-row {
        padding: 0
    }

    .dg li.save-row .button {
        display: inline-block;
        padding: 0px 6px
    }

    .dg.dialogue {
        background-color: #222;
        width: 460px;
        padding: 15px;
        font-size: 13px;
        line-height: 15px
    }

    #dg-new-constructor {
        padding: 10px;
        color: #222;
        font-family: Monaco, monospace;
        font-size: 10px;
        border: 0;
        resize: none;
        box-shadow: inset 1px 1px 1px #888;
        word-wrap: break-word;
        margin: 12px 0;
        display: block;
        width: 440px;
        overflow-y: scroll;
        height: 100px;
        position: relative
    }

    #dg-local-explain {
        display: none;
        font-size: 11px;
        line-height: 17px;
        border-radius: 3px;
        background-color: #333;
        padding: 8px;
        margin-top: 10px
    }

    #dg-local-explain code {
        font-size: 10px
    }

    #dat-gui-save-locally {
        display: none
    }

    .dg {
        color: #eee;
        font: 11px 'Lucida Grande', sans-serif;
        text-shadow: 0 -1px 0 #111
    }

    .dg.main::-webkit-scrollbar {
        width: 5px;
        background: #1a1a1a
    }

    .dg.main::-webkit-scrollbar-corner {
        height: 0;
        display: none
    }

    .dg.main::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background: #676767
    }

    .dg li:not(.folder) {
        background: #1a1a1a;
        border-bottom: 1px solid #2c2c2c
    }

    .dg li.save-row {
        line-height: 25px;
        background: #dad5cb;
        border: 0
    }

    .dg li.save-row select {
        margin-left: 5px;
        width: 108px
    }

    .dg li.save-row .button {
        margin-left: 5px;
        margin-top: 1px;
        border-radius: 2px;
        font-size: 9px;
        line-height: 7px;
        padding: 4px 4px 5px 4px;
        background: #c5bdad;
        color: #fff;
        text-shadow: 0 1px 0 #b0a58f;
        box-shadow: 0 -1px 0 #b0a58f;
        cursor: pointer
    }

    .dg li.save-row .button.gears {
        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;
        height: 7px;
        width: 8px
    }

    .dg li.save-row .button:hover {
        background-color: #bab19e;
        box-shadow: 0 -1px 0 #b0a58f
    }

    .dg li.folder {
        border-bottom: 0
    }

    .dg li.title {
        padding-left: 16px;
        background: #000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2)
    }

    .dg .closed li.title {
        background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)
    }

    .dg .cr.boolean {
        border-left: 3px solid #806787
    }

    .dg .cr.color {
        border-left: 3px solid
    }

    .dg .cr.function {
        border-left: 3px solid #e61d5f
    }

    .dg .cr.number {
        border-left: 3px solid #2FA1D6
    }

    .dg .cr.number input[type=text] {
        color: #2FA1D6
    }

    .dg .cr.string {
        border-left: 3px solid #1ed36f
    }

    .dg .cr.string input[type=text] {
        color: #1ed36f
    }

    .dg .cr.function:hover, .dg .cr.boolean:hover {
        background: #111
    }

    .dg .c input[type=text] {
        background: #303030;
        outline: none
    }

    .dg .c input[type=text]:hover {
        background: #3c3c3c
    }

    .dg .c input[type=text]:focus {
        background: #494949;
        color: #fff
    }

    .dg .c .slider {
        background: #303030;
        cursor: ew-resize
    }

    .dg .c .slider-fg {
        background: #2FA1D6;
        max-width: 100%
    }

    .dg .c .slider:hover {
        background: #3c3c3c
    }

    .dg .c .slider:hover .slider-fg {
        background: #44abda
    }
    </style>

    <style>
        @font-face {
            font-family: 'iconfont';
            src: url('iconfont.ttf') format('truetype');
        }

        * {
            user-select: none;
        }

        html,
        body {
            overflow: hidden;
            background-color: #000;
        }

        body {
            margin: 0;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .dg {
            margin-left: 0px;
            opacity: 0.9;
        }

        .dg .property-name {
            overflow: visible;
        }

        .bigFont {
            font-size: 150%;
            color: #8C8C8C;
        }

        .cr.function.appBigFont {
            font-size: 150%;
            line-height: 27px;
            color: #A5F8D3;
            background-color: #023C40;
        }

        .cr.function.appBigFont .property-name {
            float: none;
        }

        .cr.function.appBigFont .icon {
            position: sticky;
            bottom: 27px;
        }

        .icon {
            font-family: 'iconfont';
            font-size: 130%;
            float: right;
        }
    </style>
</head>

<body>
<canvas width="2277" height="650"></canvas>
<script>
    if (isMobile()) {
        setTimeout(() => {
            promoPopup.style.display = 'table';
        }, 20000);
    }

    const canvas = document.getElementsByTagName('canvas')[0];
    resizeCanvas();
    let config = {
        SIM_RESOLUTION: 255,
        DYE_RESOLUTION: 1024,
        DENSITY_DISSIPATION: 3.03,
        VELOCITY_DISSIPATION: 0.21,
        PRESSURE: 0.7722087575924623,
        PRESSURE_ITERATIONS: 20,
        CURL: 28,
        SPLAT_RADIUS: 0.3928315608728824,
        SPLAT_FORCE: 6000,
        SHADING: true,
        COLORFUL: true,
        COLOR_UPDATE_SPEED: 10,
        PAUSED: false,
        SINGLE_COLOR: false,
        BRUSH_COLOR: {
            r: 0.16847758561767526,
            g: 0.24414012289798825,
            b: 0.23170391504266483,
        },
        BACK_COLOR: {
            r: 0,
            g: 0,
            b: 0,
        },
        TRANSPARENT: false,
        BLOOM: false,
        BLOOM_ITERATIONS: 8,
        BLOOM_RESOLUTION: 256,
        BLOOM_INTENSITY: 0.5978126533319301,
        BLOOM_THRESHOLD: 0.7449185823765204,
        BLOOM_SOFT_KNEE: 0.7,
        SUNRAYS: false,
        SUNRAYS_RESOLUTION: 196,
        SUNRAYS_WEIGHT: 0.7684403428660893,
    }


    function pointerPrototype() {
        this.id = -1;
        this.texcoordX = 0;
        this.texcoordY = 0;
        this.prevTexcoordX = 0;
        this.prevTexcoordY = 0;
        this.deltaX = 0;
        this.deltaY = 0;
        this.down = false;
        this.moved = false;
        this.color = [30, 0, 300];
    }

    let pointers = [];
    let splatStack = [];
    pointers.push(new pointerPrototype());

    const {
        gl,
        ext
    } = getWebGLContext(canvas);

    if (isMobile()) {
        config.DYE_RESOLUTION = 512;
    }
    if (!ext.supportLinearFiltering) {
        config.DYE_RESOLUTION = 512;
        config.SHADING = false;
        config.BLOOM = false;
        config.SUNRAYS = false;
    }


    function getWebGLContext(canvas) {
        const params = {
            alpha: true,
            depth: false,
            stencil: false,
            antialias: false,
            preserveDrawingBuffer: false
        };

        let gl = canvas.getContext('webgl2', params);
        const isWebGL2 = !!gl;
        if (!isWebGL2)
            gl = canvas.getContext('webgl', params) || canvas.getContext('experimental-webgl', params);

        let halfFloat;
        let supportLinearFiltering;
        if (isWebGL2) {
            gl.getExtension('EXT_color_buffer_float');
            supportLinearFiltering = gl.getExtension('OES_texture_float_linear');
        } else {
            halfFloat = gl.getExtension('OES_texture_half_float');
            supportLinearFiltering = gl.getExtension('OES_texture_half_float_linear');
        }

        gl.clearColor(0.0, 0.0, 0.0, 1.0);

        const halfFloatTexType = isWebGL2 ? gl.HALF_FLOAT : halfFloat.HALF_FLOAT_OES;
        let formatRGBA;
        let formatRG;
        let formatR;

        if (isWebGL2) {
            formatRGBA = getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, halfFloatTexType);
            formatRG = getSupportedFormat(gl, gl.RG16F, gl.RG, halfFloatTexType);
            formatR = getSupportedFormat(gl, gl.R16F, gl.RED, halfFloatTexType);
        } else {
            formatRGBA = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);
            formatRG = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);
            formatR = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);
        }

        return {
            gl,
            ext: {
                formatRGBA,
                formatRG,
                formatR,
                halfFloatTexType,
                supportLinearFiltering
            }
        };
    }

    function getSupportedFormat(gl, internalFormat, format, type) {
        if (!supportRenderTextureFormat(gl, internalFormat, format, type)) {
            switch (internalFormat) {
                case gl.R16F:
                    return getSupportedFormat(gl, gl.RG16F, gl.RG, type);
                case gl.RG16F:
                    return getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, type);
                default:
                    return null;
            }
        }

        return {
            internalFormat,
            format
        }
    }

    function supportRenderTextureFormat(gl, internalFormat, format, type) {
        let texture = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, texture);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, 4, 4, 0, format, type, null);

        let fbo = gl.createFramebuffer();
        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);

        let status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
        return status == gl.FRAMEBUFFER_COMPLETE;
    }


    function isMobile() {
        return /Mobi|Android/i.test(navigator.userAgent);
    }

    class Material {
        constructor(vertexShader, fragmentShaderSource) {
            this.vertexShader = vertexShader;
            this.fragmentShaderSource = fragmentShaderSource;
            this.programs = [];
            this.activeProgram = null;
            this.uniforms = [];
        }

        setKeywords(keywords) {
            let hash = 0;
            for (let i = 0; i < keywords.length; i++)
                hash += hashCode(keywords[i]);

            let program = this.programs[hash];
            if (program == null) {
                let fragmentShader = compileShader(gl.FRAGMENT_SHADER, this.fragmentShaderSource, keywords);
                program = createProgram(this.vertexShader, fragmentShader);
                this.programs[hash] = program;
            }

            if (program == this.activeProgram) return;

            this.uniforms = getUniforms(program);
            this.activeProgram = program;
        }

        bind() {
            gl.useProgram(this.activeProgram);
        }
    }

    class Program {
        constructor(vertexShader, fragmentShader) {
            this.uniforms = {};
            this.program = createProgram(vertexShader, fragmentShader);
            this.uniforms = getUniforms(this.program);
        }

        bind() {
            gl.useProgram(this.program);
        }
    }

    function createProgram(vertexShader, fragmentShader) {
        let program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);

        if (!gl.getProgramParameter(program, gl.LINK_STATUS))
            console.trace(gl.getProgramInfoLog(program));

        return program;
    }

    function getUniforms(program) {
        let uniforms = [];
        let uniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);
        for (let i = 0; i < uniformCount; i++) {
            let uniformName = gl.getActiveUniform(program, i).name;
            uniforms[uniformName] = gl.getUniformLocation(program, uniformName);
        }
        return uniforms;
    }

    function compileShader(type, source, keywords) {
        source = addKeywords(source, keywords);

        const shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);

        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))
            console.trace(gl.getShaderInfoLog(shader));

        return shader;
    };

    function addKeywords(source, keywords) {
        if (keywords == null) return source;
        let keywordsString = '';
        keywords.forEach(keyword => {
            keywordsString += '#define ' + keyword + '\n';
        });
        return keywordsString + source;
    }

    const baseVertexShader = compileShader(gl.VERTEX_SHADER, `
            precision highp float;
        
            attribute vec2 aPosition;
            varying vec2 vUv;
            varying vec2 vL;
            varying vec2 vR;
            varying vec2 vT;
            varying vec2 vB;
            uniform vec2 texelSize;
        
            void main () {
                vUv = aPosition * 0.5 + 0.5;
                vL = vUv - vec2(texelSize.x, 0.0);
                vR = vUv + vec2(texelSize.x, 0.0);
                vT = vUv + vec2(0.0, texelSize.y);
                vB = vUv - vec2(0.0, texelSize.y);
                gl_Position = vec4(aPosition, 0.0, 1.0);
            }
        `);

    const blurVertexShader = compileShader(gl.VERTEX_SHADER, `
            precision highp float;
        
            attribute vec2 aPosition;
            varying vec2 vUv;
            varying vec2 vL;
            varying vec2 vR;
            uniform vec2 texelSize;
        
            void main () {
                vUv = aPosition * 0.5 + 0.5;
                float offset = 1.33333333;
                vL = vUv - texelSize * offset;
                vR = vUv + texelSize * offset;
                gl_Position = vec4(aPosition, 0.0, 1.0);
            }
        `);

    const blurShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying vec2 vUv;
            varying vec2 vL;
            varying vec2 vR;
            uniform sampler2D uTexture;
        
            void main () {
                vec4 sum = texture2D(uTexture, vUv) * 0.29411764;
                sum += texture2D(uTexture, vL) * 0.35294117;
                sum += texture2D(uTexture, vR) * 0.35294117;
                gl_FragColor = sum;
            }
        `);

    const copyShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying highp vec2 vUv;
            uniform sampler2D uTexture;
        
            void main () {
                gl_FragColor = texture2D(uTexture, vUv);
            }
        `);

    const clearShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying highp vec2 vUv;
            uniform sampler2D uTexture;
            uniform float value;
        
            void main () {
                gl_FragColor = value * texture2D(uTexture, vUv);
            }
        `);

    const colorShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
        
            uniform vec4 color;
        
            void main () {
                gl_FragColor = color;
            }
        `);

    const checkerboardShader = compileShader(gl.FRAGMENT_SHADER, `
            precision highp float;
            precision highp sampler2D;
        
            varying vec2 vUv;
            uniform sampler2D uTexture;
            uniform float aspectRatio;
        
            #define SCALE 25.0
        
            void main () {
                vec2 uv = floor(vUv * SCALE * vec2(aspectRatio, 1.0));
                float v = mod(uv.x + uv.y, 2.0);
                v = v * 0.1 + 0.8;
                gl_FragColor = vec4(vec3(v), 1.0);
            }
        `);

    const displayShaderSource = `
            precision highp float;
            precision highp sampler2D;
        
            varying vec2 vUv;
            varying vec2 vL;
            varying vec2 vR;
            varying vec2 vT;
            varying vec2 vB;
            uniform sampler2D uTexture;
            uniform sampler2D uBloom;
            uniform sampler2D uSunrays;
            uniform sampler2D uDithering;
            uniform vec2 ditherScale;
            uniform vec2 texelSize;
        
            vec3 linearToGamma (vec3 color) {
                color = max(color, vec3(0));
                return max(1.055 * pow(color, vec3(0.416666667)) - 0.055, vec3(0));
            }
        
            void main () {
                vec3 c = texture2D(uTexture, vUv).rgb;
        
            #ifdef SHADING
                vec3 lc = texture2D(uTexture, vL).rgb;
                vec3 rc = texture2D(uTexture, vR).rgb;
                vec3 tc = texture2D(uTexture, vT).rgb;
                vec3 bc = texture2D(uTexture, vB).rgb;
        
                float dx = length(rc) - length(lc);
                float dy = length(tc) - length(bc);
        
                vec3 n = normalize(vec3(dx, dy, length(texelSize)));
                vec3 l = vec3(0.0, 0.0, 1.0);
        
                float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0);
                c *= diffuse;
            #endif
        
            #ifdef BLOOM
                vec3 bloom = texture2D(uBloom, vUv).rgb;
            #endif
        
            #ifdef SUNRAYS
                float sunrays = texture2D(uSunrays, vUv).r;
                c *= sunrays;
            #ifdef BLOOM
                bloom *= sunrays;
            #endif
            #endif
        
            #ifdef BLOOM
                float noise = texture2D(uDithering, vUv * ditherScale).r;
                noise = noise * 2.0 - 1.0;
                bloom += noise / 255.0;
                bloom = linearToGamma(bloom);
                c += bloom;
            #endif
        
                float a = max(c.r, max(c.g, c.b));
                gl_FragColor = vec4(c, a);
            }
        `;

    const bloomPrefilterShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying vec2 vUv;
            uniform sampler2D uTexture;
            uniform vec3 curve;
            uniform float threshold;
        
            void main () {
                vec3 c = texture2D(uTexture, vUv).rgb;
                float br = max(c.r, max(c.g, c.b));
                float rq = clamp(br - curve.x, 0.0, curve.y);
                rq = curve.z * rq * rq;
                c *= max(rq, br - threshold) / max(br, 0.0001);
                gl_FragColor = vec4(c, 0.0);
            }
        `);

    const bloomBlurShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying vec2 vL;
            varying vec2 vR;
            varying vec2 vT;
            varying vec2 vB;
            uniform sampler2D uTexture;
        
            void main () {
                vec4 sum = vec4(0.0);
                sum += texture2D(uTexture, vL);
                sum += texture2D(uTexture, vR);
                sum += texture2D(uTexture, vT);
                sum += texture2D(uTexture, vB);
                sum *= 0.25;
                gl_FragColor = sum;
            }
        `);

    const bloomFinalShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying vec2 vL;
            varying vec2 vR;
            varying vec2 vT;
            varying vec2 vB;
            uniform sampler2D uTexture;
            uniform float intensity;
        
            void main () {
                vec4 sum = vec4(0.0);
                sum += texture2D(uTexture, vL);
                sum += texture2D(uTexture, vR);
                sum += texture2D(uTexture, vT);
                sum += texture2D(uTexture, vB);
                sum *= 0.25;
                gl_FragColor = sum * intensity;
            }
        `);

    const sunraysMaskShader = compileShader(gl.FRAGMENT_SHADER, `
            precision highp float;
            precision highp sampler2D;
        
            varying vec2 vUv;
            uniform sampler2D uTexture;
        
            void main () {
                vec4 c = texture2D(uTexture, vUv);
                float br = max(c.r, max(c.g, c.b));
                c.a = 1.0 - min(max(br * 20.0, 0.0), 0.8);
                gl_FragColor = c;
            }
        `);

    const sunraysShader = compileShader(gl.FRAGMENT_SHADER, `
            precision highp float;
            precision highp sampler2D;
        
            varying vec2 vUv;
            uniform sampler2D uTexture;
            uniform float weight;
        
            #define ITERATIONS 16
        
            void main () {
                float Density = 0.3;
                float Decay = 0.95;
                float Exposure = 0.7;
        
                vec2 coord = vUv;
                vec2 dir = vUv - 0.5;
        
                dir *= 1.0 / float(ITERATIONS) * Density;
                float illuminationDecay = 1.0;
        
                float color = texture2D(uTexture, vUv).a;
        
                for (int i = 0; i < ITERATIONS; i++)
                {
                    coord -= dir;
                    float col = texture2D(uTexture, coord).a;
                    color += col * illuminationDecay * weight;
                    illuminationDecay *= Decay;
                }
        
                gl_FragColor = vec4(color * Exposure, 0.0, 0.0, 1.0);
            }
        `);

    const splatShader = compileShader(gl.FRAGMENT_SHADER, `
            precision highp float;
            precision highp sampler2D;
        
            varying vec2 vUv;
            uniform sampler2D uTarget;
            uniform float aspectRatio;
            uniform vec3 color;
            uniform vec2 point;
            uniform float radius;
        
            void main () {
                vec2 p = vUv - point.xy;
                p.x *= aspectRatio;
                vec3 splat = exp(-dot(p, p) / radius) * color;
                vec3 base = texture2D(uTarget, vUv).xyz;
                gl_FragColor = vec4(base + splat, 1.0);
            }
        `);

    const advectionShader = compileShader(gl.FRAGMENT_SHADER, `
            precision highp float;
            precision highp sampler2D;
        
            varying vec2 vUv;
            uniform sampler2D uVelocity;
            uniform sampler2D uSource;
            uniform vec2 texelSize;
            uniform vec2 dyeTexelSize;
            uniform float dt;
            uniform float dissipation;
        
            vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) {
                vec2 st = uv / tsize - 0.5;
        
                vec2 iuv = floor(st);
                vec2 fuv = fract(st);
        
                vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize);
                vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize);
                vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize);
                vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize);
        
                return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y);
            }
        
            void main () {
            #ifdef MANUAL_FILTERING
                vec2 coord = vUv - dt * bilerp(uVelocity, vUv, texelSize).xy * texelSize;
                vec4 result = bilerp(uSource, coord, dyeTexelSize);
            #else
                vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;
                vec4 result = texture2D(uSource, coord);
            #endif
                float decay = 1.0 + dissipation * dt;
                gl_FragColor = result / decay;
            }`,
        ext.supportLinearFiltering ? null : ['MANUAL_FILTERING']
    );

    const divergenceShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying highp vec2 vUv;
            varying highp vec2 vL;
            varying highp vec2 vR;
            varying highp vec2 vT;
            varying highp vec2 vB;
            uniform sampler2D uVelocity;
        
            void main () {
                float L = texture2D(uVelocity, vL).x;
                float R = texture2D(uVelocity, vR).x;
                float T = texture2D(uVelocity, vT).y;
                float B = texture2D(uVelocity, vB).y;
        
                vec2 C = texture2D(uVelocity, vUv).xy;
                if (vL.x < 0.0) { L = -C.x; }
                if (vR.x > 1.0) { R = -C.x; }
                if (vT.y > 1.0) { T = -C.y; }
                if (vB.y < 0.0) { B = -C.y; }
        
                float div = 0.5 * (R - L + T - B);
                gl_FragColor = vec4(div, 0.0, 0.0, 1.0);
            }
        `);

    const curlShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying highp vec2 vUv;
            varying highp vec2 vL;
            varying highp vec2 vR;
            varying highp vec2 vT;
            varying highp vec2 vB;
            uniform sampler2D uVelocity;
        
            void main () {
                float L = texture2D(uVelocity, vL).y;
                float R = texture2D(uVelocity, vR).y;
                float T = texture2D(uVelocity, vT).x;
                float B = texture2D(uVelocity, vB).x;
                float vorticity = R - L - T + B;
                gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);
            }
        `);

    const vorticityShader = compileShader(gl.FRAGMENT_SHADER, `
            precision highp float;
            precision highp sampler2D;
        
            varying vec2 vUv;
            varying vec2 vL;
            varying vec2 vR;
            varying vec2 vT;
            varying vec2 vB;
            uniform sampler2D uVelocity;
            uniform sampler2D uCurl;
            uniform float curl;
            uniform float dt;
        
            void main () {
                float L = texture2D(uCurl, vL).x;
                float R = texture2D(uCurl, vR).x;
                float T = texture2D(uCurl, vT).x;
                float B = texture2D(uCurl, vB).x;
                float C = texture2D(uCurl, vUv).x;
        
                vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));
                force /= length(force) + 0.0001;
                force *= curl * C;
                force.y *= -1.0;
        
                vec2 velocity = texture2D(uVelocity, vUv).xy;
                velocity += force * dt;
                velocity = min(max(velocity, -1000.0), 1000.0);
                gl_FragColor = vec4(velocity, 0.0, 1.0);
            }
        `);

    const pressureShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying highp vec2 vUv;
            varying highp vec2 vL;
            varying highp vec2 vR;
            varying highp vec2 vT;
            varying highp vec2 vB;
            uniform sampler2D uPressure;
            uniform sampler2D uDivergence;
        
            void main () {
                float L = texture2D(uPressure, vL).x;
                float R = texture2D(uPressure, vR).x;
                float T = texture2D(uPressure, vT).x;
                float B = texture2D(uPressure, vB).x;
                float C = texture2D(uPressure, vUv).x;
                float divergence = texture2D(uDivergence, vUv).x;
                float pressure = (L + R + B + T - divergence) * 0.25;
                gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);
            }
        `);

    const gradientSubtractShader = compileShader(gl.FRAGMENT_SHADER, `
            precision mediump float;
            precision mediump sampler2D;
        
            varying highp vec2 vUv;
            varying highp vec2 vL;
            varying highp vec2 vR;
            varying highp vec2 vT;
            varying highp vec2 vB;
            uniform sampler2D uPressure;
            uniform sampler2D uVelocity;
        
            void main () {
                float L = texture2D(uPressure, vL).x;
                float R = texture2D(uPressure, vR).x;
                float T = texture2D(uPressure, vT).x;
                float B = texture2D(uPressure, vB).x;
                vec2 velocity = texture2D(uVelocity, vUv).xy;
                velocity.xy -= vec2(R - L, T - B);
                gl_FragColor = vec4(velocity, 0.0, 1.0);
            }
        `);

    const blit = (() => {
        gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([0, 1, 2, 0, 2, 3]), gl.STATIC_DRAW);
        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);
        gl.enableVertexAttribArray(0);

        return (target, clear = false) => {
            if (target == null) {
                gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
                gl.bindFramebuffer(gl.FRAMEBUFFER, null);
            } else {
                gl.viewport(0, 0, target.width, target.height);
                gl.bindFramebuffer(gl.FRAMEBUFFER, target.fbo);
            }
            if (clear) {
                gl.clearColor(0.0, 0.0, 0.0, 1.0);
                gl.clear(gl.COLOR_BUFFER_BIT);
            }
            // CHECK_FRAMEBUFFER_STATUS();
            gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
        }
    })();

    function CHECK_FRAMEBUFFER_STATUS() {
        let status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
        if (status != gl.FRAMEBUFFER_COMPLETE)
            console.trace("Framebuffer error: " + status);
    }

    let dye;
    let velocity;
    let divergence;
    let curl;
    let pressure;
    let bloom;
    let bloomFramebuffers = [];
    let sunrays;
    let sunraysTemp;

    let ditheringTexture = createTextureAsync('LDR_LLL1_0.png');

    const blurProgram = new Program(blurVertexShader, blurShader);
    const copyProgram = new Program(baseVertexShader, copyShader);
    const clearProgram = new Program(baseVertexShader, clearShader);
    const colorProgram = new Program(baseVertexShader, colorShader);
    const checkerboardProgram = new Program(baseVertexShader, checkerboardShader);
    const bloomPrefilterProgram = new Program(baseVertexShader, bloomPrefilterShader);
    const bloomBlurProgram = new Program(baseVertexShader, bloomBlurShader);
    const bloomFinalProgram = new Program(baseVertexShader, bloomFinalShader);
    const sunraysMaskProgram = new Program(baseVertexShader, sunraysMaskShader);
    const sunraysProgram = new Program(baseVertexShader, sunraysShader);
    const splatProgram = new Program(baseVertexShader, splatShader);
    const advectionProgram = new Program(baseVertexShader, advectionShader);
    const divergenceProgram = new Program(baseVertexShader, divergenceShader);
    const curlProgram = new Program(baseVertexShader, curlShader);
    const vorticityProgram = new Program(baseVertexShader, vorticityShader);
    const pressureProgram = new Program(baseVertexShader, pressureShader);
    const gradienSubtractProgram = new Program(baseVertexShader, gradientSubtractShader);

    const displayMaterial = new Material(baseVertexShader, displayShaderSource);

    function initFramebuffers() {
        let simRes = getResolution(config.SIM_RESOLUTION);
        let dyeRes = getResolution(config.DYE_RESOLUTION);

        const texType = ext.halfFloatTexType;
        const rgba = ext.formatRGBA;
        const rg = ext.formatRG;
        const r = ext.formatR;
        const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST;

        gl.disable(gl.BLEND);

        if (dye == null)
            dye = createDoubleFBO(dyeRes.width, dyeRes.height, rgba.internalFormat, rgba.format, texType, filtering);
        else
            dye = resizeDoubleFBO(dye, dyeRes.width, dyeRes.height, rgba.internalFormat, rgba.format, texType, filtering);

        if (velocity == null)
            velocity = createDoubleFBO(simRes.width, simRes.height, rg.internalFormat, rg.format, texType, filtering);
        else
            velocity = resizeDoubleFBO(velocity, simRes.width, simRes.height, rg.internalFormat, rg.format, texType, filtering);

        divergence = createFBO(simRes.width, simRes.height, r.internalFormat, r.format, texType, gl.NEAREST);
        curl = createFBO(simRes.width, simRes.height, r.internalFormat, r.format, texType, gl.NEAREST);
        pressure = createDoubleFBO(simRes.width, simRes.height, r.internalFormat, r.format, texType, gl.NEAREST);

        initBloomFramebuffers();
        initSunraysFramebuffers();
    }

    function initBloomFramebuffers() {
        let res = getResolution(config.BLOOM_RESOLUTION);

        const texType = ext.halfFloatTexType;
        const rgba = ext.formatRGBA;
        const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST;

        bloom = createFBO(res.width, res.height, rgba.internalFormat, rgba.format, texType, filtering);

        bloomFramebuffers.length = 0;
        for (let i = 0; i < config.BLOOM_ITERATIONS; i++) {
            let width = res.width >> (i + 1);
            let height = res.height >> (i + 1);

            if (width < 2 || height < 2) break;

            let fbo = createFBO(width, height, rgba.internalFormat, rgba.format, texType, filtering);
            bloomFramebuffers.push(fbo);
        }
    }

    function initSunraysFramebuffers() {
        let res = getResolution(config.SUNRAYS_RESOLUTION);

        const texType = ext.halfFloatTexType;
        const r = ext.formatR;
        const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST;

        sunrays = createFBO(res.width, res.height, r.internalFormat, r.format, texType, filtering);
        sunraysTemp = createFBO(res.width, res.height, r.internalFormat, r.format, texType, filtering);
    }

    function createFBO(w, h, internalFormat, format, type, param) {
        gl.activeTexture(gl.TEXTURE0);
        let texture = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, texture);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, w, h, 0, format, type, null);

        let fbo = gl.createFramebuffer();
        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);
        gl.viewport(0, 0, w, h);
        gl.clear(gl.COLOR_BUFFER_BIT);

        let texelSizeX = 1.0 / w;
        let texelSizeY = 1.0 / h;

        return {
            texture,
            fbo,
            width: w,
            height: h,
            texelSizeX,
            texelSizeY,
            attach(id) {
                gl.activeTexture(gl.TEXTURE0 + id);
                gl.bindTexture(gl.TEXTURE_2D, texture);
                return id;
            }
        };
    }

    function createDoubleFBO(w, h, internalFormat, format, type, param) {
        let fbo1 = createFBO(w, h, internalFormat, format, type, param);
        let fbo2 = createFBO(w, h, internalFormat, format, type, param);

        return {
            width: w,
            height: h,
            texelSizeX: fbo1.texelSizeX,
            texelSizeY: fbo1.texelSizeY,
            get read() {
                return fbo1;
            },
            set read(value) {
                fbo1 = value;
            },
            get write() {
                return fbo2;
            },
            set write(value) {
                fbo2 = value;
            },
            swap() {
                let temp = fbo1;
                fbo1 = fbo2;
                fbo2 = temp;
            }
        }
    }

    function resizeFBO(target, w, h, internalFormat, format, type, param) {
        let newFBO = createFBO(w, h, internalFormat, format, type, param);
        copyProgram.bind();
        gl.uniform1i(copyProgram.uniforms.uTexture, target.attach(0));
        blit(newFBO);
        return newFBO;
    }

    function resizeDoubleFBO(target, w, h, internalFormat, format, type, param) {
        if (target.width == w && target.height == h)
            return target;
        target.read = resizeFBO(target.read, w, h, internalFormat, format, type, param);
        target.write = createFBO(w, h, internalFormat, format, type, param);
        target.width = w;
        target.height = h;
        target.texelSizeX = 1.0 / w;
        target.texelSizeY = 1.0 / h;
        return target;
    }

    function createTextureAsync(url) {
        let texture = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, texture);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 1, 1, 0, gl.RGB, gl.UNSIGNED_BYTE, new Uint8Array([255, 255, 255]));

        let obj = {
            texture,
            width: 1,
            height: 1,
            attach(id) {
                gl.activeTexture(gl.TEXTURE0 + id);
                gl.bindTexture(gl.TEXTURE_2D, texture);
                return id;
            }
        };

        let image = new Image();
        image.onload = () => {
            obj.width = image.width;
            obj.height = image.height;
            gl.bindTexture(gl.TEXTURE_2D, texture);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image);
        };
        image.src = url;

        return obj;
    }

    function updateKeywords() {
        let displayKeywords = [];
        if (config.SHADING) displayKeywords.push("SHADING");
        if (config.BLOOM) displayKeywords.push("BLOOM");
        if (config.SUNRAYS) displayKeywords.push("SUNRAYS");
        displayMaterial.setKeywords(displayKeywords);
    }

    updateKeywords();
    initFramebuffers();
    multipleSplats(parseInt(Math.random() * 20) + 5);

    let lastUpdateTime = Date.now();
    let colorUpdateTimer = 0.0;
    update();

    function update() {
        const dt = calcDeltaTime();
        if (resizeCanvas())
            initFramebuffers();
        updateColors(dt);
        applyInputs();
        step(dt);
        render(null);
        requestAnimationFrame(update);
    }

    function calcDeltaTime() {
        let now = Date.now();
        let dt = (now - lastUpdateTime) / 1000;
        dt = Math.min(dt, 0.016666);
        lastUpdateTime = now;
        return dt;
    }

    function resizeCanvas() {
        let width = scaleByPixelRatio(canvas.clientWidth);
        let height = scaleByPixelRatio(canvas.clientHeight);
        if (canvas.width != width || canvas.height != height) {
            canvas.width = width;
            canvas.height = height;
            return true;
        }
        return false;
    }

    function updateColors(dt) {
        if (!config.COLORFUL) return;

        colorUpdateTimer += dt * config.COLOR_UPDATE_SPEED;
        if (colorUpdateTimer >= 1) {
            colorUpdateTimer = wrap(colorUpdateTimer, 0, 1);
            pointers.forEach(p => {
                p.color = generateColor();
            });
        }
    }

    function applyInputs() {
        if (splatStack.length > 0)
            multipleSplats(splatStack.pop());

        pointers.forEach(p => {
            if (p.moved) {
                p.moved = false;
                splatPointer(p);
            }
        });
    }

    function step(dt) {
        gl.disable(gl.BLEND);

        curlProgram.bind();
        gl.uniform2f(curlProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);
        gl.uniform1i(curlProgram.uniforms.uVelocity, velocity.read.attach(0));
        blit(curl);

        vorticityProgram.bind();
        gl.uniform2f(vorticityProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);
        gl.uniform1i(vorticityProgram.uniforms.uVelocity, velocity.read.attach(0));
        gl.uniform1i(vorticityProgram.uniforms.uCurl, curl.attach(1));
        gl.uniform1f(vorticityProgram.uniforms.curl, config.CURL);
        gl.uniform1f(vorticityProgram.uniforms.dt, dt);
        blit(velocity.write);
        velocity.swap();

        divergenceProgram.bind();
        gl.uniform2f(divergenceProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);
        gl.uniform1i(divergenceProgram.uniforms.uVelocity, velocity.read.attach(0));
        blit(divergence);

        clearProgram.bind();
        gl.uniform1i(clearProgram.uniforms.uTexture, pressure.read.attach(0));
        gl.uniform1f(clearProgram.uniforms.value, config.PRESSURE);
        blit(pressure.write);
        pressure.swap();

        pressureProgram.bind();
        gl.uniform2f(pressureProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);
        gl.uniform1i(pressureProgram.uniforms.uDivergence, divergence.attach(0));
        for (let i = 0; i < config.PRESSURE_ITERATIONS; i++) {
            gl.uniform1i(pressureProgram.uniforms.uPressure, pressure.read.attach(1));
            blit(pressure.write);
            pressure.swap();
        }

        gradienSubtractProgram.bind();
        gl.uniform2f(gradienSubtractProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);
        gl.uniform1i(gradienSubtractProgram.uniforms.uPressure, pressure.read.attach(0));
        gl.uniform1i(gradienSubtractProgram.uniforms.uVelocity, velocity.read.attach(1));
        blit(velocity.write);
        velocity.swap();

        advectionProgram.bind();
        gl.uniform2f(advectionProgram.uniforms.texelSize, velocity.texelSizeX, velocity.texelSizeY);
        if (!ext.supportLinearFiltering)
            gl.uniform2f(advectionProgram.uniforms.dyeTexelSize, velocity.texelSizeX, velocity.texelSizeY);
        let velocityId = velocity.read.attach(0);
        gl.uniform1i(advectionProgram.uniforms.uVelocity, velocityId);
        gl.uniform1i(advectionProgram.uniforms.uSource, velocityId);
        gl.uniform1f(advectionProgram.uniforms.dt, dt);
        gl.uniform1f(advectionProgram.uniforms.dissipation, config.VELOCITY_DISSIPATION);
        blit(velocity.write);
        velocity.swap();

        if (!ext.supportLinearFiltering)
            gl.uniform2f(advectionProgram.uniforms.dyeTexelSize, dye.texelSizeX, dye.texelSizeY);
        gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read.attach(0));
        gl.uniform1i(advectionProgram.uniforms.uSource, dye.read.attach(1));
        gl.uniform1f(advectionProgram.uniforms.dissipation, config.DENSITY_DISSIPATION);
        blit(dye.write);
        dye.swap();
    }

    function render(target) {
        if (config.BLOOM)
            applyBloom(dye.read, bloom);
        if (config.SUNRAYS) {
            applySunrays(dye.read, dye.write, sunrays);
            blur(sunrays, sunraysTemp, 1);
        }

        if (target == null || !config.TRANSPARENT) {
            gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);
            gl.enable(gl.BLEND);
        } else {
            gl.disable(gl.BLEND);
        }

        if (!config.TRANSPARENT)
            drawColor(target, normalizeColor(config.BACK_COLOR));
        if (target == null && config.TRANSPARENT)
            drawCheckerboard(target);
        drawDisplay(target);
    }

    function drawColor(target, color) {
        colorProgram.bind();
        gl.uniform4f(colorProgram.uniforms.color, color.r, color.g, color.b, 1);
        blit(target);
    }

    function drawCheckerboard(target) {
        checkerboardProgram.bind();
        gl.uniform1f(checkerboardProgram.uniforms.aspectRatio, canvas.width / canvas.height);
        blit(target);
    }

    function drawDisplay(target) {
        let width = target == null ? gl.drawingBufferWidth : target.width;
        let height = target == null ? gl.drawingBufferHeight : target.height;

        displayMaterial.bind();
        if (config.SHADING)
            gl.uniform2f(displayMaterial.uniforms.texelSize, 1.0 / width, 1.0 / height);
        gl.uniform1i(displayMaterial.uniforms.uTexture, dye.read.attach(0));
        if (config.BLOOM) {
            gl.uniform1i(displayMaterial.uniforms.uBloom, bloom.attach(1));
            gl.uniform1i(displayMaterial.uniforms.uDithering, ditheringTexture.attach(2));
            let scale = getTextureScale(ditheringTexture, width, height);
            gl.uniform2f(displayMaterial.uniforms.ditherScale, scale.x, scale.y);
        }
        if (config.SUNRAYS)
            gl.uniform1i(displayMaterial.uniforms.uSunrays, sunrays.attach(3));
        blit(target);
    }

    function applyBloom(source, destination) {
        if (bloomFramebuffers.length < 2)
            return;

        let last = destination;

        gl.disable(gl.BLEND);
        bloomPrefilterProgram.bind();
        let knee = config.BLOOM_THRESHOLD * config.BLOOM_SOFT_KNEE + 0.0001;
        let curve0 = config.BLOOM_THRESHOLD - knee;
        let curve1 = knee * 2;
        let curve2 = 0.25 / knee;
        gl.uniform3f(bloomPrefilterProgram.uniforms.curve, curve0, curve1, curve2);
        gl.uniform1f(bloomPrefilterProgram.uniforms.threshold, config.BLOOM_THRESHOLD);
        gl.uniform1i(bloomPrefilterProgram.uniforms.uTexture, source.attach(0));
        blit(last);

        bloomBlurProgram.bind();
        for (let i = 0; i < bloomFramebuffers.length; i++) {
            let dest = bloomFramebuffers[i];
            gl.uniform2f(bloomBlurProgram.uniforms.texelSize, last.texelSizeX, last.texelSizeY);
            gl.uniform1i(bloomBlurProgram.uniforms.uTexture, last.attach(0));
            blit(dest);
            last = dest;
        }

        gl.blendFunc(gl.ONE, gl.ONE);
        gl.enable(gl.BLEND);

        for (let i = bloomFramebuffers.length - 2; i >= 0; i--) {
            let baseTex = bloomFramebuffers[i];
            gl.uniform2f(bloomBlurProgram.uniforms.texelSize, last.texelSizeX, last.texelSizeY);
            gl.uniform1i(bloomBlurProgram.uniforms.uTexture, last.attach(0));
            gl.viewport(0, 0, baseTex.width, baseTex.height);
            blit(baseTex);
            last = baseTex;
        }

        gl.disable(gl.BLEND);
        bloomFinalProgram.bind();
        gl.uniform2f(bloomFinalProgram.uniforms.texelSize, last.texelSizeX, last.texelSizeY);
        gl.uniform1i(bloomFinalProgram.uniforms.uTexture, last.attach(0));
        gl.uniform1f(bloomFinalProgram.uniforms.intensity, config.BLOOM_INTENSITY);
        blit(destination);
    }

    function applySunrays(source, mask, destination) {
        gl.disable(gl.BLEND);
        sunraysMaskProgram.bind();
        gl.uniform1i(sunraysMaskProgram.uniforms.uTexture, source.attach(0));
        blit(mask);

        sunraysProgram.bind();
        gl.uniform1f(sunraysProgram.uniforms.weight, config.SUNRAYS_WEIGHT);
        gl.uniform1i(sunraysProgram.uniforms.uTexture, mask.attach(0));
        blit(destination);
    }

    function blur(target, temp, iterations) {
        blurProgram.bind();
        for (let i = 0; i < iterations; i++) {
            gl.uniform2f(blurProgram.uniforms.texelSize, target.texelSizeX, 0.0);
            gl.uniform1i(blurProgram.uniforms.uTexture, target.attach(0));
            blit(temp);

            gl.uniform2f(blurProgram.uniforms.texelSize, 0.0, target.texelSizeY);
            gl.uniform1i(blurProgram.uniforms.uTexture, temp.attach(0));
            blit(target);
        }
    }

    function splatPointer(pointer) {
        let dx = pointer.deltaX * config.SPLAT_FORCE;
        let dy = pointer.deltaY * config.SPLAT_FORCE;
        splat(pointer.texcoordX, pointer.texcoordY, dx, dy, pointer.color);
    }

    function multipleSplats(amount) {
        for (let i = 0; i < amount; i++) {
            const color = generateColor();
            color.r *= 10.0;
            color.g *= 10.0;
            color.b *= 10.0;
            const x = Math.random();
            const y = Math.random();
            const dx = 1000 * (Math.random() - 0.5);
            const dy = 1000 * (Math.random() - 0.5);
            splat(x, y, dx, dy, color);
        }
    }

    function splat(x, y, dx, dy, color) {
        splatProgram.bind();
        gl.uniform1i(splatProgram.uniforms.uTarget, velocity.read.attach(0));
        gl.uniform1f(splatProgram.uniforms.aspectRatio, canvas.width / canvas.height);
        gl.uniform2f(splatProgram.uniforms.point, x, y);
        gl.uniform3f(splatProgram.uniforms.color, dx, dy, 0.0);
        gl.uniform1f(splatProgram.uniforms.radius, correctRadius(config.SPLAT_RADIUS / 100.0));
        blit(velocity.write);
        velocity.swap();

        gl.uniform1i(splatProgram.uniforms.uTarget, dye.read.attach(0));
        gl.uniform3f(splatProgram.uniforms.color, color.r, color.g, color.b);
        blit(dye.write);
        dye.swap();
    }

    function correctRadius(radius) {
        let aspectRatio = canvas.width / canvas.height;
        if (aspectRatio > 1)
            radius *= aspectRatio;
        return radius;
    }

    canvas.addEventListener('mousedown', e => {
        let posX = scaleByPixelRatio(e.offsetX);
        let posY = scaleByPixelRatio(e.offsetY);
        let pointer = pointers.find(p => p.id == -1);
        if (pointer == null)
            pointer = new pointerPrototype();
        updatePointerDownData(pointer, -1, posX, posY);
    });

    canvas.addEventListener('mousemove', e => {
        let pointer = pointers[0];
        if (!pointer.down) return;
        let posX = scaleByPixelRatio(e.offsetX);
        let posY = scaleByPixelRatio(e.offsetY);
        updatePointerMoveData(pointer, posX, posY);
    });

    window.addEventListener('mouseup', () => {
        updatePointerUpData(pointers[0]);
    });

    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        const touches = e.targetTouches;
        while (touches.length >= pointers.length)
            pointers.push(new pointerPrototype());
        for (let i = 0; i < touches.length; i++) {
            let posX = scaleByPixelRatio(touches[i].pageX);
            let posY = scaleByPixelRatio(touches[i].pageY);
            updatePointerDownData(pointers[i + 1], touches[i].identifier, posX, posY);
        }
    });

    canvas.addEventListener('touchmove', e => {
        e.preventDefault();
        const touches = e.targetTouches;
        for (let i = 0; i < touches.length; i++) {
            let pointer = pointers[i + 1];
            if (!pointer.down) continue;
            let posX = scaleByPixelRatio(touches[i].pageX);
            let posY = scaleByPixelRatio(touches[i].pageY);
            updatePointerMoveData(pointer, posX, posY);
        }
    }, false);

    window.addEventListener('touchend', e => {
        const touches = e.changedTouches;
        for (let i = 0; i < touches.length; i++) {
            let pointer = pointers.find(p => p.id == touches[i].identifier);
            if (pointer == null) continue;
            updatePointerUpData(pointer);
        }
    });

    window.addEventListener('keydown', e => {
        if (e.key === ' ')
            splatStack.push(parseInt(Math.random() * 20) + 5);
    });

    function updatePointerDownData(pointer, id, posX, posY) {
        pointer.id = id;
        pointer.down = true;
        pointer.moved = false;
        pointer.texcoordX = posX / canvas.width;
        pointer.texcoordY = 1.0 - posY / canvas.height;
        pointer.prevTexcoordX = pointer.texcoordX;
        pointer.prevTexcoordY = pointer.texcoordY;
        pointer.deltaX = 0;
        pointer.deltaY = 0;
        pointer.color = generateColor();
    }

    function updatePointerMoveData(pointer, posX, posY) {
        pointer.prevTexcoordX = pointer.texcoordX;
        pointer.prevTexcoordY = pointer.texcoordY;
        pointer.texcoordX = posX / canvas.width;
        pointer.texcoordY = 1.0 - posY / canvas.height;
        pointer.deltaX = correctDeltaX(pointer.texcoordX - pointer.prevTexcoordX);
        pointer.deltaY = correctDeltaY(pointer.texcoordY - pointer.prevTexcoordY);
        pointer.moved = Math.abs(pointer.deltaX) > 0 || Math.abs(pointer.deltaY) > 0;
    }

    function updatePointerUpData(pointer) {
        pointer.down = false;
    }

    function correctDeltaX(delta) {
        let aspectRatio = canvas.width / canvas.height;
        if (aspectRatio < 1) delta *= aspectRatio;
        return delta;
    }

    function correctDeltaY(delta) {
        let aspectRatio = canvas.width / canvas.height;
        if (aspectRatio > 1) delta /= aspectRatio;
        return delta;
    }

    function generateColor() {

        if (config.SINGLE_COLOR) {
            let k = RGBColor();
            return k;
        }

        let c = HSVtoRGB(Math.random(), 1.0, 1.0);
        c.r *= 0.15;
        c.g *= 0.15;
        c.b *= 0.15;
        //console.log(c);

        return c;
    }

    function RGBColor() {
        let r = config.BRUSH_COLOR.r;
        let g = config.BRUSH_COLOR.g;
        let b = config.BRUSH_COLOR.b;

        return {
            r,
            g,
            b
        };
    }

    function HSVtoRGB(h, s, v) {
        let r, g, b, i, f, p, q, t;
        i = Math.floor(h * 6);
        f = h * 6 - i;
        p = v * (1 - s);
        q = v * (1 - f * s);
        t = v * (1 - (1 - f) * s);

        switch (i % 6) {
            case 0:
                r = v, g = t, b = p;
                break;
            case 1:
                r = q, g = v, b = p;
                break;
            case 2:
                r = p, g = v, b = t;
                break;
            case 3:
                r = p, g = q, b = v;
                break;
            case 4:
                r = t, g = p, b = v;
                break;
            case 5:
                r = v, g = p, b = q;
                break;
        }

        return {
            r,
            g,
            b
        };
    }

    function normalizeColor(input) {
        let output = {
            r: input.r / 255,
            g: input.g / 255,
            b: input.b / 255
        };
        return output;
    }

    function wrap(value, min, max) {
        let range = max - min;
        if (range == 0) return min;
        return (value - min) % range + min;
    }

    function getResolution(resolution) {
        let aspectRatio = gl.drawingBufferWidth / gl.drawingBufferHeight;
        if (aspectRatio < 1)
            aspectRatio = 1.0 / aspectRatio;

        let min = Math.round(resolution);
        let max = Math.round(resolution * aspectRatio);

        if (gl.drawingBufferWidth > gl.drawingBufferHeight)
            return {
                width: max,
                height: min
            };
        else
            return {
                width: min,
                height: max
            };
    }

    function getTextureScale(texture, width, height) {
        return {
            x: width / texture.width,
            y: height / texture.height
        };
    }

    function scaleByPixelRatio(input) {
        let pixelRatio = window.devicePixelRatio || 1;
        return Math.floor(input * pixelRatio);
    }

    function hashCode(s) {
        if (s.length == 0) return 0;
        let hash = 0;
        for (let i = 0; i < s.length; i++) {
            hash = (hash << 5) - hash + s.charCodeAt(i);
            hash |= 0; // Convert to 32bit integer
        }
        return hash;
    };
</script>


</body>
</html>