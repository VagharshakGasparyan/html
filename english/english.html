<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes">
    <title>English</title>
    <style>
        :root {
            --bg: #112233;
            --c: #dddddd;
            --c1: #5f5;
            --c2: #7af;
            --c3: #a70;
            --c4: #f59;
            --c5: #ff4;
            --bd: #fff2;
        }
        ::selection {
            background: #f07;
            color: #ff0;
        }

        * {
            box-sizing: border-box;
        }

        html {
            font-family: Consolas, sans-serif;
            background-color: var(--bg);
            color: var(--c);
        }

        .content {
            max-width: 100vw;
            width: max-content;
            margin: 0 auto;
        }

        .table {
            border-collapse: collapse;
            font-size: 14px;
        }

        .table td, .table th {
            border: 1px solid var(--bd);
            padding: 3px 5px;
        }

        .table tbody tr td {
            position: relative;
        }

        #test_table.table tbody tr td:nth-child(1) {
            color: var(--c1);
        }

        #test_table.table tbody tr td:nth-child(2) {
            color: var(--c);
        }

        #test_table.table tbody tr td:nth-child(3) {
            color: var(--c1);
            text-align: center;
        }

        #test_table.table tbody tr td:nth-child(4) {
            color: var(--c2);
        }

        #test_table.table tbody tr td:nth-child(5) {
            color: var(--c3);
        }
        .copy {
            border: 2px solid var(--c);
            position: absolute;
            top: 0;
            right: 0;
            width: 15px;
            height: 20px;
            background-color: var(--bd);
            cursor: pointer;
        }

        .copy:hover {
            background-color: var(--c1);
        }

        .copy:active {
            background-color: var(--c2);
        }

        select {
            background-color: var(--bg);
            color: var(--c);
            border: 1px solid var(--bd);
            outline: none;
        }

        #variants {
            min-width: 200px;
        }

        button {
            background-color: var(--bg);
            color: var(--c);
            border: 1px solid var(--bd);
            outline: none;
            cursor: pointer;
        }

        button:hover {
            background-color: var(--bd);
        }

        button:active {
            background-color: var(--c);
            color: var(--bg);
        }

        .info-items {
            border: 1px solid var(--bd);
            font-size: 14px;
            padding: 2px 5px;
        }

        #ppf tbody td {
            white-space: pre-line;
        }

        c1 {
            color: var(--c1);
        }

        c2 {
            color: var(--c2);
        }

        c3 {
            color: var(--c3);
        }

        c4 {
            color: var(--c4);
        }

        c5 {
            color: var(--c5);
        }

        c1, c2, c3, c4, c5 {
            display: inline-block;
        }
        #variants{
            font-size: 18px;
            min-width: 100px;
        }
        .hy_tr{
            color: var(--c3);
            display: inline-block;
            padding-right: 7px;
        }
        .mtr td:first-of-type{
            cursor: pointer;
        }
        .mtr:hover td:first-of-type{
            background-color: #fff2;
            /*color: var(--bg) !important;*/
        }
        .mtr_c{
            background-color: #fff2;
        }
    </style>

</head>
<body>

<div class="content" style="padding-bottom: 20px;">
    <div>
        <label>
            <input type="checkbox" id="training">
            <span>Մարզում</span>
        </label>
    </div>
    <div id="training_body" style="display: none;margin-top: 10px;font-size: 18px;">
        <div>
            <label for="variants" id="word_label"
                   style="padding: 0 10px;margin-right: 10px; border: 1px solid var(--bd);">
                <span id="word"></span>
            </label>
            <select id="variants" style="display: block">
                <option value=""></option>
            </select>
            <button id="dont_know">Չգիտեմ</button>
        </div>
        <div id="info"></div>
    </div>
</div>
<div class="content">
    <table class="table" id="test_table">
        <thead>
        <tr>
            <th>N</th>
            <th>English</th>
            <th>Transcription</th>
<!--            <th>Перевод</th>-->
<!--            <th>Թարգմանություն</th>-->
            <th>Translation</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>
<div>
    <table class="table" id="ppf" style="margin: 20px auto 0 auto;">
        <thead>
        </thead>
        <tbody>
        <tr>
            <td></td>
            <td style="min-width: 300px">1. Present (Настоящее время)</td>
            <td style="min-width: 300px">2. Past (Прошедшее время)</td>
            <td style="min-width: 300px">3. Future (Будущее время)</td>
        </tr>
        <tr>
            <td>Simple (Простое)</td>
            <td>
                <c5>1.1. Present Simple (Простое настоящее)</c5>
                <c2>I / We / You / They</c2> + <c4>Verb</c4>.
                <c2>He / She / It</c2> + <c4>Verb</c4><c1>s</c1>.
                You work. He works.
                <c2>I / We / You / They</c2> + don't + <c4>Verb</c4>.
                <c2>He / She / It</c2> + doesn't + <c4>Verb</c4>.
                You don't work. He doesn't work.
                Do + <c2>I / We / You / They</c2> + <c4>Verb</c4>?
                Do<c1>es</c1> + <c2>He / She / It</c2> + <c4>Verb</c4>?
                Do you work? Does it work?
                <c2>I / We / You / They</c2> + don't + <c4>Verb</c4>?
                <c2>He / She / It</c2> + do<c1>es</c1>n't + <c4>Verb</c4>?
                You don't work? He doesn't work?
            </td>
            <td>
                <c5>2.1. Past Simple (Простое прошедшее)</c5>
                <c4>Verb2</c4> | <c4>Verb</c4><c1>ed</c1>
                He went. You worked.
                <c2>I / We / You / They / He / She / It</c2> + <c1>didn't</c1> + <c4>Verb</c4>
                He didn't go. You didn't work.
                <c1>Did</c1> + <c2>I / We / You / They / He / She / It</c2> + <c4>Verb</c4>?
                Did He go? Did You work?
                <c2>I / We / You / They / He / She / It</c2> + <c1>didn't</c1> + <c4>Verb</c4>?
                He didn't go? You didn't work?
            </td>
            <td>
                <c5>3.1. Future Simple (Простое будущее)</c5>

                Что выражает: Спонтанное решение, обещание, прогноз, простое действие в будущем.
                Маркеры: tomorrow, next week, in 2030, I think, I hope.
                Формула:
                <c1>will</c1> + <c4>Verb</c4>.
                Примеры:
                I think it will rain tomorrow. (Думаю, завтра будет дождь) — прогноз.
                The phone is ringing! — I will answer it. (Телефон звонит! — Я отвечу) — спонтанное решение.
            </td>
        </tr>
        <tr>
            <td>Continuous (продолженное)</td>
            <td>
                <c5>1.2. Present Continuous (Настоящее продолженное)</c5>

                Что выражает: Действие, происходящее прямо сейчас, в момент речи; или временная ситуация вокруг
                настоящего момента.
                Маркеры: now, at the moment, currently, right now.
                Формула:
                <c2>am / is / are</c2> + <c4>Verb</c4><c1>ing</c1>.
                Примеры:
                I am working right now. (Я работаю прямо сейчас) — в данный момент.
                She is staying with her friends this week. (Она гостит у друзей на этой неделе) — временная ситуация.
                Look! It is raining! (Смотри! Идет дождь!) — действие в момент речи.
            </td>
            <td>
                <c5>2.2. Past Continuous (Прошедшее продолженное)</c5>

                Что выражает: Действие, которое длилось в определенный момент в прошлом; или два действия, одно из
                которых (Continuous) было прервано другим (Simple).
                Маркеры: at 5 pm yesterday, while, when.
                Формула:
                <c1>was / were</c1> + <c4>Verb</c4><c1>ing</c1>.
                Примеры:
                I was working at 6 pm yesterday. (Я работал в 6 вечера вчера) — в определенный момент.
                When he came home, I was cooking dinner. (Когда он пришел домой, я готовила ужин) — готовила, когда он
                прервал мое действие.
            </td>
            <td>
                <c5>3.2. Future Continuous (Будущее продолженное)</c5>

                Что выражает: Действие, которое будет длиться в определенный момент в будущем.
                Маркеры: at 5 pm tomorrow, this time next week.
                Формула:
                <c1>will be</c1> + <c4>Verb</c4><c1>ing</c1>.
                Примеры:
                This time tomorrow I will be flying to Rome.
                (В это же время завтра я буду лететь в Рим).
                Don't call at 8, I will be having dinner.
                (Не звони в 8, я буду ужинать).
            </td>
        </tr>
        <tr>
            <td>Perfect (совершенное)</td>
            <td>
                <c5>1.3. Present Perfect (Настоящее совершенное)</c5>

                Что выражает: Действие в прошлом, результат которого важен СЕЙЧАС. Или действие, которое началось в
                прошлом и длится до сих пор.
                Маркеры: already, yet, ever, never, just, since, for.
                Формула:
                <c2>I / We / You / They</c2> + <c1>have</c1> + <c4>Verb3 (Verb<c1>ed</c1>)</c4>.
                <c2>He / She / It</c2> + <c1>has</c1> + <c4>Verb3 (Verb<c1>ed</c1>)</c4>.
                (третия форма глагола/причастие прошедшего времени).
                Примеры:
                I have finished my work. (Я закончил работу) — результат: работа готова сейчас.
                He has lost his keys. (Он потерял ключи) — результат: ключей сейчас нет.
                We have known each other since childhood. (Мы знаем друг друга с детства) — действие, длящееся до сих
                пор.
            </td>
            <td>
                <c5>2.3. Past Perfect (Прошедшее совершенное)</c5>
                Что выражает: Действие, которое произошло раньше другого действия в прошлом. "Прошлое до прошлого".
                Маркеры: by the time, after, before, when.
                Формула:
                <c1>had</c1> + <c4>Verb3 (Verb<c1>ed</c1>)</c4>.
                Примеры:
                When I arrived, she had already left.
                (Когда я приехал, она уже ушла) — Сначала она ушла, потом я приехал.
                He had finished his report by 5 o'clock.
                (Он закончил отчет к 5 часам).
            </td>
            <td>
                <c5>3.3. Future Perfect (Будущее совершенное)</c5>

                Что выражает: Действие, которое завершится к определенному моменту в будущем.
                Маркеры: by, by the time, before.
                Формула:
                <c1>will have</c1> + <c4>Verb3 (Verb<c1>ed</c1>)</c4>.
                Примеры:
                By 2030, I will have bought a house. (К 2030 году я куплю дом).
                She will have finished the report by Friday. (Она закончит отчет к пятнице).
            </td>
        </tr>
        <tr>
            <td>Perfect Continuous
                (совершенное продолженное)
            </td>
            <td>
                <c5>1.4. Present Perfect Continuous (Настоящее совершенное продолженное)</c5>
                Что выражает: Действие, которое началось в прошлом, длилось какое-то время и все еще продолжается сейчас
                (или только что закончилось, и виден его результат). Акцент на продолжительности.
                Маркеры: for, since, all day/week.
                Формула:
                <c2>I / We / You / They</c2> + <c1>have (not) been</c1> + <c4>Verb</c4><c1>ing</c1>.
                <c2>He / She / It</c2> + <c1>has (not) been</c1> + <c4>Verb</c4><c1>ing</c1>.
                <c1>Have not</c1> + <c2>I / We / You / They</c2> + <c1>been</c1> <c4>Verb</c4><c1>ing?</c1>
                <c1>Has not</c1> + <c2>He / She / It</c2> + <c1>been</c1> <c4>Verb</c4><c1>ing?</c1>
                Примеры:
                I have been working for 3 hours. (Я работаю уже 3 часа) — начал в прошлом, все еще работаю.
                She has been cooking all day. (Она готовит весь день) — и кухня, вероятно, в беспорядке (видимый
                результат).
                Why are you tired? — I have been running. (Почему ты устал? — Я бегал) — действие только что
                закончилось, и мы видим его результат (усталость).
            </td>
            <td>
                <c5>2.4. Past Perfect Continuous (Прошедшее совершенное продолженное)</c5>

                Что выражает: Действие, которое длилось в прошлом в течение какого-то времени и закончилось (или имело
                видимый результат) к определенному моменту в прошлом. Акцент на продолжительности.<br>
                Маркеры: for, since.
                Формула:
                <c1>had + been</c1> + <c4>Verb</c4><c1>ing</c1>.
                Примеры:
                He had been working for 5 hours when I called him. (Он проработал уже 5 часов, когда я ему позвонил) — к
                моменту звонка в прошлом он уже 5 часов работал.
                Her eyes were red because she had been crying. (Ее глаза были красными, потому что она плакала) —
                видимый результат в прошлом.
            </td>
            <td>
                <c5>3.4. Future Perfect Continuous (Будущее совершенное продолженное)</c5>

                Что выражает: Действие, которое будет длиться в течение какого-то времени и все еще будет продолжаться
                (или только что завершится) к определенному моменту в будущем. Акцент на продолжительности.
                Маркеры: by... for.
                Формула:
                <c1>will have been</c1> + <c4>Verb</c4><c1>ing</c1>.
                Примеры:
                By next month, I will have been working here for 10 years. (К следующему месяцу я буду работать здесь
                уже 10 лет).
            </td>
        </tr>
        </tbody>
    </table>
</div>
<div style="height: 50vh"></div>
<script>document.write(new Date().getFullYear().toString())</script>
<!--<script src="text.txt"></script>-->
<script src="irregular_verbs.js"></script>
<!--<script src="en1_0_2000.js"></script>-->
<!--<script src="en_base1.js"></script>-->
<script src="en_hy_0_2000.js"></script>
<script src="en1_2000_3000.js"></script>
<script>

    // let en_ru_8000_modern = {};
    // en_ru_8000.forEach((item) => {
    //     en_ru_8000_modern[item.en] = item.en_transcription;
    // });


    // let en_ru = en1_0_2000;
    let irregular_verbs_obj = {};
    irregular_verbs.forEach((irregular_verb)=>{
        let key = irregular_verb.en[0];
        irregular_verbs_obj[key] = irregular_verb;
    });
    let en_ru = [];
    en_hy_0_2000.forEach((item)=>{
        if(("s" in item) /*&& item.s === 0*/){
            let en = item.en;
            if(en in irregular_verbs_obj){
                item.en = irregular_verbs_obj[en].en;
                item.t = irregular_verbs_obj[en]._;
            }
            en_ru.push(item);
        }
    });
    en1_2000_3000.forEach((item)=>{
        if(("s" in item) /*&& item.s === 0*/){
            let en = item.en;
            if(en in irregular_verbs_obj){
                item.en = irregular_verbs_obj[en].en;
                item.t = irregular_verbs_obj[en]._;
            }
            en_ru.push(item);
        }
    });
    // console.log(JSON.stringify(en_ru));
    // en_ru.push(...irregular_verbs);

    window.addEventListener('load', function () {
        // let ens = [];

        let tbody = document.querySelector('#test_table.table tbody');
        let trs = '';
        en_ru.forEach((tr, index) => {
            // ens.push(tr.en);
            let s = "_" in tr ? "_" : "t";
            let en_tr = s in tr
                ? Array.isArray(tr[s]) ? tr[s].join("<br>") : tr[s]
                : "";
            let tr_en = "en" in tr
                ? Array.isArray(tr["en"]) ? tr["en"].join("<br>") : tr["en"]
                : "";
            let tr_ru = "ru" in tr
                ? Array.isArray(tr["ru"]) ? tr["ru"].join("<br>") : tr["ru"]
                : "";
            let tr_hy = "hy" in tr
                ? Array.isArray(tr["hy"]) ? tr["hy"].join("<br>") : tr["hy"]
                : "";
            trs += '<tr class="mtr" id="mtrc' + index + '">'
                + '<td>' + (index + 1) + '</td>'
                + '<td>' + tr_en + '</td>'
                + '<td>' + en_tr + '</td>'
                + '<td>' + '<span class="hy_tr" style="color: var(--c3)">' + tr_hy + '</span>' + tr_ru + '</td>'
                // + '<td>' + tr_hy + '</td>'
                + '</tr>';
        });
        tbody.innerHTML = trs;

        let mtr_last_i = document.querySelectorAll('.mtr').length - 1;
        let mtrc = localStorage.getItem("mtrc");
        let prev_tr = document.getElementById('mtrc' + mtrc);
        if(mtrc !== null && prev_tr){
            prev_tr.classList.add('mtr_c');
        }

        document.querySelectorAll('.mtr').forEach((tr, i)=>{
            tr.querySelector('td:first-of-type').addEventListener('click', (e)=>{
                if(prev_tr){
                    prev_tr.classList.remove('mtr_c');
                }
                tr.classList.add('mtr_c');
                prev_tr = tr;
                localStorage.setItem('mtrc', i.toString());
            });
        });
        document.addEventListener('keydown', (e)=>{
            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                e.preventDefault();
            }
            // console.log(e.code);
            if(mtr_last_i < 0){
                return;
            }
            let prev_i = -1, prev_top = 0;
            if(prev_tr){
                let prev_id = prev_tr.getAttribute("id");
                prev_i = parseInt(prev_id.slice(4));
                prev_top = prev_tr.getBoundingClientRect().top;
            }
            let next_i = prev_i;
            if(e.code === "ArrowDown"){
                next_i++;
            }else if(e.code === "ArrowUp"){
                next_i--;
            }else{
                return;
            }
            next_i = next_i < 0 ? 0 : next_i;
            next_i = next_i > mtr_last_i ? mtr_last_i : next_i;
            if(prev_tr){
                prev_tr.classList.remove('mtr_c');
            }
            prev_tr = document.getElementById('mtrc' + next_i);
            prev_tr.classList.add('mtr_c');
            let top = prev_tr.getBoundingClientRect().top;
            let bottom = prev_tr.getBoundingClientRect().bottom;
            let scrollY = window.scrollY;
            let wsh = window.innerHeight;
            localStorage.setItem('mtrc', next_i.toString());
            // window.scrollTo(0, top - wsh * 0.5 + scrollY);
            let scrollBy = top - prev_top;
            if(top < 0){
                scrollBy = top;
            }else if(top > wsh){
                scrollBy = bottom - wsh;
            }
            window.scrollBy(0, scrollBy);
            // setTimeout(()=>{
            //     window.scrollTo(0, top - wsh * 0.5 + scrollY);
            // }, 200);
        });
        // console.log(JSON.stringify(ens));
        //----------------------------------------------------------------------------------------------
        let training = document.getElementById('training');
        let training_body = document.getElementById('training_body');
        let word = document.getElementById('word');
        let word_label = document.getElementById('word_label');
        let variants = document.getElementById('variants');
        let dont_know = document.getElementById('dont_know');
        let info = document.getElementById('info');
        //----variables------------------------------------------------
        let trueVariant = -1;
        let trueVariantObj = {en: "", ru: "", _: ""};
        let forgets = [];

        training.addEventListener('input', () => {
            if (training.checked) {
                tbody.style.display = 'none';
                training_body.style.display = 'block';
                generateVariants();
            } else {
                tbody.style.display = 'table-row-group';
                training_body.style.display = 'none';
            }
        });

        dont_know.addEventListener('click', () => {
            forgets.push(trueVariantObj);
            en_ru.push(trueVariantObj);
            addToInfo();
            generateVariants();
        });
        variants.addEventListener('input', () => {
            let val = variants.value;
            if (val) {
                if (parseInt(val) === trueVariant) {
                    word_label.style.borderColor = '#0f0';
                    setTimeout(() => {
                        generateVariants();
                    }, 1000);
                } else {
                    word_label.style.borderColor = '#f05';
                    forgets.push(trueVariantObj);
                    en_ru.push(trueVariantObj);
                }
                addToInfo();
            }
        });

        function addToInfo() {
            let htm = en_ru.length.toString();
            forgets.forEach((f) => {
                htm += '<div style="display: flex">'
                    + '<div class="info-items" style="flex: 1;white-space: nowrap;">' + f.en + '</div>'
                    + '<div class="info-items" style="flex: 1;white-space: nowrap; color: var(--c1)">' + (f._ ?? f.t) + '</div>'
                    + '<div class="info-items" style="flex: 1;white-space: nowrap; color: var(--c2)">' + (f.hy ? '<span style="color: var(--c3);margin-right: 10px;">' + f.hy + '</span>' : '') + f.ru + '</div>'
                    + '</div>';
            });
            info.innerHTML = htm;
        }

        function generateVariants() {
            word_label.style.borderColor = 'var(--bd)';
            let variantsCount = Math.min(10, en_ru.length);
            let n = Math.floor(Math.random() * en_ru.length);
            trueVariant = n;
            trueVariantObj = en_ru[n];
            let myWord = en_ru[n].en;
            let transcription = en_ru[n]._ ?? en_ru[n].t;
            let translated = (en_ru[n].hy ? en_ru[n].hy + ", " : "") + en_ru[n].ru;
            word.innerHTML = myWord + '<span style="margin-left: 10px;color: green">' + transcription + '</span>';
            variants.innerHTML = '<option value=""></option>';

            let ns = [];
            ns.length = en_ru.length;
            ns.fill(0);
            ns.forEach((v, index) => {
                ns[index] = index;
            });
            let last_n = ns.length - 1;
            let r = ns[last_n];
            ns[last_n] = ns[n];
            ns[n] = r;
            last_n--;
            let items = [];
            items.push('<option value="' + n + '">' + translated + '</option>');
            for (let i = 0; i < variantsCount - 1; i++) {
                let n1 = Math.floor(Math.random() * (last_n + 1));
                let translated1 = (en_ru[ns[n1]].hy ? en_ru[ns[n1]].hy + ", " : "") + en_ru[ns[n1]].ru;
                items.push('<option value="' + n1 + '">' + translated1 + '</option>');
                r = ns[last_n];
                ns[last_n] = ns[n1];
                ns[n1] = r;
                last_n--;
            }
            let r_item_n = Math.floor(Math.random() * variantsCount);
            let r_item = items[r_item_n];
            items[r_item_n] = items[0];
            items[0] = r_item;
            variants.innerHTML += items.join('');
            en_ru.splice(n, 1);
            // variants.focus();
            // console.log(en_ru);
        }


    });

    function downloadTextFile() {
        const content = "Это содержимое файла\nВторая строка";
        const blob = new Blob([content], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'example.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // fetch('english_2.js')
    //     // .then(response => response.json())
    //     .then(response => response.text())
    //     .then(data => {
    //         console.log(data);
    //         // работаем с данными
    //     })
    //     .catch(error => console.error('Ошибка:', error));


</script>
</body>
</html>
